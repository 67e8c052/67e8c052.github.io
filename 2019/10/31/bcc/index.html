<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="bcc toolstrace123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979">
<meta property="og:type" content="article">
<meta property="og:title" content="Trace by bcc tools">
<meta property="og:url" content="http://example.com/2019/10/31/bcc/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="bcc toolstrace123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-10-31T08:25:34.000Z">
<meta property="article:modified_time" content="2023-03-14T08:25:12.084Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="bcc">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Trace by bcc tools</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2019/11/26/xfs/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2019/10/10/golang/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/10/31/bcc/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/10/31/bcc/&text=Trace by bcc tools"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/10/31/bcc/&is_video=false&description=Trace by bcc tools"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Trace by bcc tools&body=Check out this article: http://example.com/2019/10/31/bcc/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/10/31/bcc/&name=Trace by bcc tools&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/10/31/bcc/&t=Trace by bcc tools"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#bcc-tools"><span class="toc-number">1.</span> <span class="toc-text">bcc tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#trace"><span class="toc-number">1.1.</span> <span class="toc-text">trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#profile"><span class="toc-number">1.2.</span> <span class="toc-text">profile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network"><span class="toc-number">1.3.</span> <span class="toc-text">Network</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#func"><span class="toc-number">1.4.</span> <span class="toc-text">func</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Trace by bcc tools
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-10-31T08:25:34.000Z" itemprop="datePublished">2019-10-31</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Scripts/">Scripts</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/bcc/" rel="tag">bcc</a>, <a class="tag-link-link" href="/tags/debug/" rel="tag">debug</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="bcc-tools"><a href="#bcc-tools" class="headerlink" title="bcc tools"></a>bcc tools</h3><h4 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">$ ./trace /lib64/libpthread-2.28.so:pthread_create</span><br><span class="line">PID     TID     COMM            FUNC</span><br><span class="line">338161  338161  qemu-kvm        pthread_create</span><br><span class="line">$ ./trace /lib64/libpthread-2.28.so:pthread_create</span><br><span class="line">PID     TID     COMM            FUNC</span><br><span class="line">338161  338161  qemu-kvm        pthread_create</span><br><span class="line"></span><br><span class="line">http://blog.witalis.net/linux%20dropwatch.html</span><br><span class="line">$ dropwatch -l kas</span><br><span class="line">Initalizing kallsyms db</span><br><span class="line">dropwatch&gt; start</span><br><span class="line">Enabling monitoring...</span><br><span class="line">Kernel monitoring activated.</span><br><span class="line">Issue Ctrl-C to stop monitoring</span><br><span class="line">1 drops at skb_queue_purge+18 (0xffffffff9a23c808)</span><br><span class="line">3 drops at skb_queue_purge+18 (0xffffffff9a23c808)</span><br><span class="line"></span><br><span class="line">$ /usr/share/bcc/tools/trace <span class="string">&#x27;r::skb_queue_purge &quot;%d&quot;, retval&#x27;</span></span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line">1       1       systemd         skb_queue_purge  0</span><br><span class="line"></span><br><span class="line"><span class="comment">#include/linux/skbuff.h</span></span><br><span class="line">/**</span><br><span class="line"> *	__skb_queue_purge - empty a list</span><br><span class="line"> *	@list: list to empty</span><br><span class="line"> *</span><br><span class="line"> *	Delete all buffers on an &amp;sk_buff list. Each buffer is removed from</span><br><span class="line"> *	the list and one reference dropped. This <span class="keyword">function</span> does not take the</span><br><span class="line"> *	list lock and the <span class="built_in">caller</span> must hold the relevant locks to use it.</span><br><span class="line"> */</span><br><span class="line">void skb_queue_purge(struct sk_buff_head *list);</span><br><span class="line">static inline void __skb_queue_purge(struct sk_buff_head *list)</span><br><span class="line">&#123;</span><br><span class="line">	struct sk_buff *skb;</span><br><span class="line">	<span class="keyword">while</span> ((skb = __skb_dequeue(list)) != NULL)</span><br><span class="line">		kfree_skb(skb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /proc/56531/stack  | grep do_sys_open</span><br><span class="line">[&lt;ffffffff89249924&gt;] do_sys_open+0x124/0x220</span><br><span class="line"></span><br><span class="line">$ ./trace -p 56531 <span class="string">&#x27;do_sys_open &quot;%d,%s&quot;, arg3,arg2&#x27;</span></span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line">56531   56531   <span class="built_in">touch</span>           do_sys_open      35137,/455f50ec5f4beedd/8f03548dd535b880</span><br><span class="line"></span><br><span class="line">include/linux/fs.h</span><br><span class="line">extern long do_sys_open(int dfd, const char __user *filename, int flags,</span><br><span class="line">                        umode_t mode);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ./trace <span class="string">&#x27;sys_execve &quot;%s&quot;, arg1&#x27;</span></span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line">13312   13312   bash            sys_execve       /usr/bin/bpftrace</span><br><span class="line">13326   13326   bash            sys_execve       /usr/bin/bpftrace</span><br><span class="line"></span><br><span class="line">$ ./trace <span class="string">&#x27;sys_read (arg3 &gt; 20000) &quot;read %d bytes&quot;, arg3&#x27;</span></span><br><span class="line">49911   49911   rsync           sys_read         <span class="built_in">read</span> 32768 bytes</span><br><span class="line">49911   49911   rsync           sys_read         <span class="built_in">read</span> 32768 bytes</span><br><span class="line">49909   49909   rsync           sys_read         <span class="built_in">read</span> 262144 bytes</span><br><span class="line">49911   49911   rsync           sys_read         <span class="built_in">read</span> 32768 bytes</span><br><span class="line">49911   49911   rsync           sys_read         <span class="built_in">read</span> 32768 bytes</span><br><span class="line"></span><br><span class="line">  -K, --kernel-stack    output kernel stack trace</span><br><span class="line">  -U, --user-stack      output user stack trace</span><br><span class="line">  -n NAME, --name NAME  only <span class="built_in">print</span> process names containing this name</span><br><span class="line"></span><br><span class="line">$ ./trace <span class="string">&#x27;do_sys_open &quot;%s&quot;, arg2@user&#x27;</span> -UK -n rsync</span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line">49909   49909   rsync           do_sys_open      data/test_file</span><br><span class="line">        do_sys_open+0x1 [kernel]</span><br><span class="line">        system_call_fastpath+0x25 [kernel]</span><br><span class="line">        __open_nocancel+0x7 [libc-2.17.so]</span><br><span class="line">        [unknown]</span><br><span class="line">        [unknown]</span><br><span class="line"></span><br><span class="line">The special retval keyword stands <span class="keyword">for</span> the <span class="keyword">function</span><span class="string">&#x27;s return value, and can be used only in a retprobe, specified by the &#x27;</span>r<span class="string">&#x27; prefix</span></span><br><span class="line"><span class="string">$ ./trace &#x27;</span>r:bash:readline <span class="string">&quot;%s&quot;</span>, retval<span class="string">&#x27;</span></span><br><span class="line"><span class="string">PID     TID     COMM            FUNC             -</span></span><br><span class="line"><span class="string">51006   51006   bash            readline         echo test</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   -a, --address         print virtual address in stacks</span></span><br><span class="line"><span class="string">$ ./trace -U -a &#x27;</span>r::sys_futex <span class="string">&quot;%d&quot;</span>, retval<span class="string">&#x27;</span></span><br><span class="line"><span class="string">PID     TID     COMM            FUNC             -</span></span><br><span class="line"><span class="string">1       51216   systemd         sys_futex        0</span></span><br><span class="line"><span class="string">            7f86f0025ef4 start_thread+0x154 [libpthread-2.17.so]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   -T, --time            print time column</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ trace &#x27;</span>r:c:<span class="built_in">read</span> ((int)retval &lt; <span class="number">0</span>) &quot;read failed: %d&quot;, retval&#x27; &#x27;r:c:write ((int)retval &lt; <span class="number">0</span>) &quot;write failed: %d&quot;, retval&#x27; -T</span><br><span class="line">TIME     PID    COMM         FUNC             -</span><br><span class="line"><span class="number">05</span>:<span class="number">31</span>:<span class="number">57</span> <span class="number">3388</span>   bash         write            write failed: -<span class="number">1</span></span><br><span class="line"><span class="number">05</span>:<span class="number">32</span>:<span class="number">00</span> <span class="number">3388</span>   bash         write            write failed: -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">$ ./trace &#x27;c:malloc &quot;size = %d&quot;, arg1&#x27;</span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line"><span class="number">338289</span>  <span class="number">338289</span>  qemu-kvm        malloc           size = <span class="number">100</span></span><br><span class="line"><span class="number">338289</span>  <span class="number">338289</span>  qemu-kvm        malloc           size = <span class="number">22</span></span><br><span class="line"><span class="number">338289</span>  <span class="number">338289</span>  qemu-kvm        malloc           size = <span class="number">32</span></span><br><span class="line"><span class="number">338289</span>  <span class="number">338289</span>  qemu-kvm        malloc           size = <span class="number">22</span></span><br><span class="line"><span class="number">338619</span>  <span class="number">338619</span>  qemu-kvm        malloc           size = <span class="number">100</span></span><br><span class="line"><span class="number">338619</span>  <span class="number">338619</span>  qemu-kvm        malloc           size = <span class="number">22</span></span><br><span class="line"><span class="number">338619</span>  <span class="number">338619</span>  qemu-kvm        malloc           size = <span class="number">32</span></span><br><span class="line"><span class="number">338619</span>  <span class="number">338619</span>  qemu-kvm        malloc           size = <span class="number">22</span></span><br><span class="line"><span class="number">338098</span>  <span class="number">338124</span>  CPU <span class="number">1</span>/KVM       malloc           size = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">## kernel tracepoint</span><br><span class="line">$ ./trace &#x27;t:block:block_rq_complete &quot;sectors=%d&quot;, args-&gt;nr_sector&#x27; -T</span><br><span class="line">TIME     PID     TID     COMM            FUNC             -</span><br><span class="line"><span class="number">17</span>:<span class="number">26</span>:<span class="number">16</span> <span class="number">0</span>       <span class="number">0</span>       swapper/<span class="number">12</span>      block_rq_complete sectors=<span class="number">0</span></span><br><span class="line"><span class="number">17</span>:<span class="number">26</span>:<span class="number">18</span> <span class="number">0</span>       <span class="number">0</span>       swapper/<span class="number">12</span>      block_rq_complete sectors=<span class="number">0</span></span><br><span class="line"><span class="number">17</span>:<span class="number">26</span>:<span class="number">21</span> <span class="number">0</span>       <span class="number">0</span>       swapper/<span class="number">12</span>      block_rq_complete sectors=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">Suppose that you want to trace a system-call in a short-lived process, you can use the -s option to trace. The option is followed by list of libraries/executables to use for symbol resolution.</span><br><span class="line">$ trace -s /lib/x86_64-linux-gnu/libc.so.<span class="number">6</span>,/bin/ping &#x27;p:c:inet_pton&#x27; -U</span><br><span class="line">Note: Kernel bpf will report stack map with ip/build_id</span><br><span class="line"><span class="number">53298</span>   <span class="number">53298</span>   ping            inet_pton</span><br><span class="line">        [unknown]</span><br><span class="line">        [unknown]</span><br><span class="line">        _init+<span class="number">0</span>xf08 [ping]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">More and more high-level libraries are instrumented with USDT probe support.</span><br><span class="line">The &quot;%U&quot; format specifier tells trace to resolve arg3 as a user-space symbol, if possible. Similarly, use &quot;%K&quot; for kernel symbols.</span><br><span class="line"></span><br><span class="line">$ ./trace &#x27;u:pthread:pthread_create &quot;%U&quot;, arg3&#x27; -T -C</span><br><span class="line">TIME     CPU PID     TID     COMM            FUNC             -</span><br><span class="line"><span class="number">17</span>:<span class="number">39</span>:<span class="number">51</span> <span class="number">4</span>   <span class="number">1</span>       <span class="number">1</span>       systemd         pthread_create   [unknown] [systemd]</span><br><span class="line"><span class="number">17</span>:<span class="number">39</span>:<span class="number">53</span> <span class="number">4</span>   <span class="number">1</span>       <span class="number">1</span>       systemd         pthread_create   [unknown] [systemd]</span><br><span class="line"><span class="number">17</span>:<span class="number">39</span>:<span class="number">54</span> <span class="number">4</span>   <span class="number">1</span>       <span class="number">1</span>       systemd         pthread_create   [unknown] [systemd]</span><br><span class="line"></span><br><span class="line">Ruby, Node, and OpenJDK are also instrumented with USDT. </span><br><span class="line"></span><br><span class="line"># trace &#x27;u:ruby:method__entry &quot;%s.%s&quot;, arg1, arg2&#x27; -p $(pidof irb) -T</span><br><span class="line">TIME     PID    COMM         FUNC             -</span><br><span class="line"><span class="number">12</span>:<span class="number">08</span>:<span class="number">43</span> <span class="number">18420</span>  irb          method__entry    IRB::Context.verbose?</span><br><span class="line"><span class="number">12</span>:<span class="number">08</span>:<span class="number">43</span> <span class="number">18420</span>  irb          method__entry    RubyLex.ungetc</span><br><span class="line"><span class="number">12</span>:<span class="number">08</span>:<span class="number">43</span> <span class="number">18420</span>  irb          method__entry    RuxyLex.debug?</span><br><span class="line"></span><br><span class="line">You can also trace exported functions from shared libraries, or an imported</span><br><span class="line">function on the actual executable:</span><br><span class="line"></span><br><span class="line">$ ./trace.py &#x27;r:/usr/lib64/libtinfo.so:curses_version &quot;Version=%s&quot;, retval&#x27;</span><br><span class="line"></span><br><span class="line">$  trace &#x27;p:c:open (STRCMP(&quot;test.txt&quot;, arg1)) <span class="string">&quot;opening %s&quot;</span>, arg1<span class="string">&#x27; -T</span></span><br><span class="line"><span class="string">TIME     PID     TID     COMM            FUNC             -</span></span><br><span class="line"><span class="string">17:44:39 53592   53592   cat             open             opening test.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ trace &#x27;</span>p:c:open(char *filename) <span class="string">&quot;opening %s&quot;</span>, filename<span class="string">&#x27;</span></span><br><span class="line"><span class="string">PID     TID     COMM            FUNC             -</span></span><br><span class="line"><span class="string">53665   53665   bash            open             opening test2.txt</span></span><br><span class="line"><span class="string">53665   53665   cat             open             opening test1.txt</span></span><br><span class="line"><span class="string">2381    2381    irqbalance      open             opening /proc/interrupts</span></span><br><span class="line"><span class="string">2381    2381    irqbalance      open             opening /proc/stat</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./trace &#x27;</span>p::SyS_nanosleep(struct timespec *ts) <span class="string">&quot;sleep for %lld ns&quot;</span>, ts-&gt;tv_nsec<span class="string">&#x27;</span></span><br><span class="line"><span class="string">PID     TID     COMM            FUNC             -</span></span><br><span class="line"><span class="string">2381    2381    irqbalance      SyS_nanosleep    sleep for 998581000 ns</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Remember to use the -I argument include the appropriate header file. We didn&#x27;</span>t need to <span class="keyword">do</span> that here because `struct timespec` is used internally by the tool, so it always includes this header file.</span><br><span class="line"></span><br><span class="line">$ ./trace -I <span class="string">&#x27;/usr/include/linux/perf_event.h&#x27;</span> <span class="string">&#x27;t:syscalls:sys_enter_perf_event_open &quot;%d&quot;, args-&gt;attr_uptr-&gt;config1&#x27;</span></span><br><span class="line"></span><br><span class="line">$ trace -p 2740 <span class="string">&#x27;do_sys_open &quot;%s&quot;, arg2@user&#x27;</span> -T</span><br><span class="line">extern long do_sys_open(int dfd, const char __user *filename, int flags,</span><br><span class="line">			umode_t mode);</span><br><span class="line"></span><br><span class="line">$  ./trace sys_open</span><br><span class="line">PID     TID     COMM            FUNC</span><br><span class="line">2551    2551    irqbalance      sys_open</span><br><span class="line"></span><br><span class="line">The perf ring buffer size can be changed with -b. The unit is size per-CPU buffer size and is measured <span class="keyword">in</span> pages. The value must be a power of two and defaults to 64 pages.</span><br><span class="line">asmlinkage long sys_setsockopt(int fd, int level, int optname,</span><br><span class="line">				char __user *optval, int optlen);</span><br><span class="line"></span><br><span class="line">$ ./trace <span class="string">&#x27;sys_setsockopt(int fd, int level, int optname, char* optval, int optlen)(level==0 &amp;&amp; optname == 1 &amp;&amp; STRCMP(&quot;&#123;0x6C, 0x00, 0x00, 0x00&#125;&quot;, optval))&#x27;</span> -U -M 1 --bin_cmp</span><br><span class="line">PID     TID     COMM            FUNC             -</span><br><span class="line">1855611 1863183 worker          sys_setsockopt   found</span><br><span class="line"></span><br><span class="line">In this example we are catching setsockopt syscall to change IPv4 IP_TOS value only <span class="keyword">for</span> the cases <span class="built_in">where</span> new TOS value is equal to 108. we are using STRCMP helper <span class="keyword">in</span> binary mode (--bin_cmp flag) to compare optval array against int value of 108 (parametr of setsockopt call) <span class="keyword">in</span> hex representation (little endian format)</span><br></pre></td></tr></table></figure>

<h4 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">./profile             # profile stack traces at 49 Hertz until Ctrl-C</span><br><span class="line">./profile -F 99       # profile stack traces at 99 Hertz</span><br><span class="line">./profile -c 1000000  # profile stack traces every 1 in a million events</span><br><span class="line">./profile 5           # profile at 49 Hertz for 5 seconds only</span><br><span class="line">./profile -f 5        # output in folded format for flame graphs</span><br><span class="line">     ./profile -df -p `pgrep -n func_ab` 5 &gt; out.profile</span><br><span class="line">     ./FlameGraph/flamegraph.pl --color=mem &lt; out.profile &gt; out.svg</span><br><span class="line"></span><br><span class="line">./profile -p 185      # only profile process with PID 185</span><br><span class="line">./profile -L 185      # only profile thread with TID 185</span><br><span class="line">./profile -U          # only show user space stacks (no kernel)</span><br><span class="line">./profile -K          # only show kernel space stacks (no user)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$ ./profile -adf -p `pgrep -n <span class="built_in">touch</span>` 10</span><br><span class="line"><span class="built_in">touch</span>;__close_nocancel;-;system_call_fastpath;SyS_close;__close_fd;filp_close;nfs_file_flush;nfs_file_fsync;nfs_file_fsync 1</span><br><span class="line"><span class="built_in">touch</span>;__open_nocancel;-;system_call_fastpath;sys_open;do_sys_open;do_filp_open;path_openat;do_last;lookup_real;nfs_lookup;nfs3_proc_lookup;nfs3_rpc_wrapper.constprop.11;rpc_call_sync;rpc_run_task;rpc_execute;__rpc_execute;out_of_line_wait_on_bit;__wait_on_bit;rpc_wait_bit_killable;schedule;__schedule;finish_task_switch;finish_task_switch 1</span><br><span class="line"><span class="built_in">touch</span>;__close_nocancel;-;int_signal;do_notify_resume;task_work_run;____fput;__fput;nfs_file_release;nfs_file_clear_open_context;__put_nfs_open_context;kfree;kfree 1</span><br><span class="line"><span class="built_in">touch</span>;__open_nocancel;-;system_call_fastpath;sys_open;do_sys_open;do_filp_open;path_openat;do_last;vfs_create;nfs_create;nfs3_proc_create;nfs3_do_create;nfs3_rpc_wrapper.constprop.11;rpc_call_sync;rpc_run_task;rpc_execute;__rpc_execute;out_of_line_wait_on_bit;__wait_on_bit;rpc_wait_bit_killable;schedule;__schedule;finish_task_switch;finish_task_switch 1</span><br><span class="line"><span class="built_in">touch</span>;futimens;-;system_call_fastpath;sys_utimensat;do_utimes;utimes_common;notify_change;nfs_setattr;nfs3_proc_setattr;nfs3_rpc_wrapper.constprop.11;rpc_call_sync;rpc_run_task;rpc_execute;__rpc_execute;out_of_line_wait_on_bit;__wait_on_bit;rpc_wait_bit_killable;schedule;__schedule;finish_task_switch;finish_task_switch 1</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">#stack tracing as a list of function</span></span><br><span class="line">$ ./profile -p 3826757</span><br><span class="line">Sampling at 49 Hertz of PID 3826757 by user + kernel stack... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">    b<span class="string">&#x27;_raw_spin_lock&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;_raw_spin_lock&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;dmu_buf_will_dirty_impl&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;sa_attr_op&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;sa_bulk_update_impl&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;sa_bulk_update&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_write_common_iovec&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_iter_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;new_sync_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;vfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;ksys_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;do_syscall_64&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;entry_SYSCALL_64_after_hwframe&#x27;</span></span><br><span class="line">    __libc_write</span><br><span class="line">    -                <span class="built_in">dd</span> (3826757)</span><br><span class="line">        1</span><br><span class="line"></span><br><span class="line">    b<span class="string">&#x27;__slab_alloc&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;__slab_alloc&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;kmem_cache_alloc&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;spl_kmem_cache_alloc&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;arc_hdr_alloc&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;arc_alloc_buf&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;arc_loan_buf&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_write_common_iovec&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_iter_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;new_sync_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;vfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;ksys_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;do_syscall_64&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;entry_SYSCALL_64_after_hwframe&#x27;</span></span><br><span class="line">    __libc_write</span><br><span class="line">    -                <span class="built_in">dd</span> (3826757)</span><br><span class="line">        1</span><br><span class="line"></span><br><span class="line">    b<span class="string">&#x27;dmu_tx_hold_sa&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;dmu_tx_hold_sa&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_write_common_iovec&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;zpl_iter_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;new_sync_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;vfs_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;ksys_write&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;do_syscall_64&#x27;</span></span><br><span class="line">    b<span class="string">&#x27;entry_SYSCALL_64_after_hwframe&#x27;</span></span><br><span class="line">    __libc_write</span><br><span class="line">    -                <span class="built_in">dd</span> (3826757)</span><br><span class="line">        1</span><br><span class="line"></span><br><span class="line">$ ./profile -F 49 -U -p 204067</span><br><span class="line">Sampling at 49 Hertz of PID 204067 by user stack... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">    StealMarkingTask::do_it(GCTaskManager*, unsigned int)</span><br><span class="line">    GCTaskThread::run()</span><br><span class="line">    java_start(Thread*)</span><br><span class="line">    start_thread</span><br><span class="line">    -                java (204067)</span><br><span class="line">        1</span><br><span class="line"></span><br><span class="line">    ParCompactionManager::follow_marking_stacks()</span><br><span class="line">    StealMarkingTask::do_it(GCTaskManager*, unsigned int)</span><br><span class="line">    GCTaskThread::run()</span><br><span class="line">    java_start(Thread*)</span><br><span class="line">    start_thread</span><br><span class="line">    -                java (204067)</span><br><span class="line">        1</span><br><span class="line"></span><br><span class="line">    ParallelTaskTerminator::offer_termination(TerminatorTerminator*)</span><br><span class="line">    StealMarkingTask::do_it(GCTaskManager*, unsigned int)</span><br><span class="line">    GCTaskThread::run()</span><br><span class="line">    java_start(Thread*)</span><br><span class="line">    start_thread</span><br><span class="line">    -                java (204067)</span><br><span class="line">        1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/266596607">reference</a></p>
<h4 id="Network"><a href="#Network" class="headerlink" title="Network"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/network-tracing-using-the-bpf-compiler-collection_configuring-and-managing-networking">Network</a></h4><ul>
<li><p>tcpaccept </p>
<ul>
<li>Each time the kernel accepts a connection, tcpaccept displays the details of the connections<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./tcpaccept -t        # include timestamps</span><br><span class="line">./tcpaccept -P 80,81  # only trace port 80 and 81</span><br><span class="line">./tcpaccept -p 181    # only trace PID 181</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcpconnect</p>
<ul>
<li>Each time the kernel processes an outgoing connection, tcpconnect displays the details of the connections<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./tcpconnect           # trace all TCP connect()s</span><br><span class="line">./tcpconnect -t        # include timestamps</span><br><span class="line">./tcpconnect -p 181    # only trace PID 181</span><br><span class="line">./tcpconnect -P 80     # only trace port 80</span><br><span class="line">./tcpconnect -P 80,81  # only trace port 80 and 81</span><br><span class="line">./tcpconnect -U        # include UID</span><br><span class="line">./tcpconnect -u 1000   # only trace UID 1000</span><br><span class="line">./tcpconnect -c        # count connects per src ip and dest ip/port</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcpconnlat</p>
<ul>
<li>Each time the kernel processes an outgoing connection, tcpconnlat displays the details of the connection after the kernel receives the response packet<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./tcpconnlat           # trace all TCP connect()s</span><br><span class="line">./tcpconnlat -t        # include timestamps</span><br><span class="line">./tcpconnlat -p 181    # only trace PID 181</span><br><span class="line">./tcpconnlat 1         # only show connects longer than 1 ms</span><br><span class="line">./tcpconnlat 0.1       # only show connects longer than 100 us</span><br><span class="line">./tcpconnlat -v        # Show the BPF program</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcpdrop</p>
<ul>
<li>Each time the kernel drops TCP packets and segments, tcpdrop displays the details of the connection, including the kernel stack trace that led to the dropped package</li>
</ul>
</li>
<li><p>tcplife</p>
<ul>
<li>Each time a connection is closed, tcplife displays the details of the connections<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./tcplife           # trace all TCP connect()s</span><br><span class="line">./tcplife -t        # include time column (HH:MM:SS)</span><br><span class="line">./tcplife -w        # wider colums (fit IPv6)</span><br><span class="line">./tcplife -stT      # csv output, with times &amp; timestamps</span><br><span class="line">./tcplife -p 181    # only trace PID 181</span><br><span class="line">./tcplife -L 80     # only trace local port 80</span><br><span class="line">./tcplife -L 80,81  # only trace local ports 80 and 81</span><br><span class="line">./tcplife -D 80     # only trace remote port 80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcpretrans</p>
<ul>
<li>Each time the kernel calls the TCP retransmit function, tcpretrans displays the details of the connection</li>
</ul>
</li>
<li><p>tcpstates</p>
<ul>
<li>Each time a connection changes its state, tcpstates displays a new line with updated connection details<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./tcpstates           # trace all TCP state changes</span><br><span class="line">./tcpstates -t        # include timestamp column</span><br><span class="line">./tcpstates -T        # include time column (HH:MM:SS)</span><br><span class="line">./tcpstates -w        # wider colums (fit IPv6)</span><br><span class="line">./tcpstates -stT      # csv output, with times &amp; timestamps</span><br><span class="line">./tcpstates -Y        # log events to the systemd journal</span><br><span class="line">./tcpstates -L 80     # only trace local port 80</span><br><span class="line">./tcpstates -L 80,81  # only trace local ports 80 and 81</span><br><span class="line">./tcpstates -D 80     # only trace remote port 80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcpsubnet</p>
<ul>
<li>This command displays the traffic in bytes for the specified subnets once per second<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./tcpsubnet -f K            # Trace TCP sent to the default subnets</span><br><span class="line">                            # aggregated in KBytes.</span><br><span class="line">./tcpsubnet 10.80.0.0/24    # Trace TCP sent to 10.80.0.0/24 only</span><br><span class="line">./tcpsubnet -J              # Format the output in JSON.</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcptop</p>
<ul>
<li>The output of the command includes only active TCP connections. If the local or remote system closes a connection, the connection is no longer visible in the output<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./tcptop           # trace TCP send/recv by host</span><br><span class="line">./tcptop -C        # don&#x27;t clear the screen</span><br><span class="line">./tcptop -p 181    # only trace PID 181</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>tcptracer</p>
<ul>
<li>Each time the kernel connects, accepts, or closes a connection, tcptracer displays the details of the connections</li>
</ul>
</li>
<li><p>solisten</p>
<ul>
<li>This tool traces the kernel function called when a program wants to listen for TCP connections. It will not see UDP neither UNIX domain sockets<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ./solisten.py --show-netns</span><br><span class="line">PID    COMM         NETNS        PROTO  BACKLOG  ADDR                                    PORT</span><br><span class="line">3643   nc           4026531957   TCPv4  1        0.0.0.0                                 4242</span><br><span class="line">3659   nc           4026531957   TCPv6  1        2001:f0d0:1002:51::4                    4242</span><br><span class="line">4221   redis-server 4026532165   TCPv6  128      ::                                      6379</span><br><span class="line">4221   redis-server 4026532165   TCPv4  128      0.0.0.0                                 6379</span><br><span class="line">6067   nginx        4026531957   TCPv4  128      0.0.0.0                                 80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>softirqs</p>
<ul>
<li>This program traces soft interrupts (irqs), and stores timing statistics in-kernel for efficiency<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./softirqs            # sum soft irq event time</span><br><span class="line">./softirqs -d         # show soft irq event time as histograms</span><br><span class="line">./softirqs 1 10       # print 1 second summaries, 10 times</span><br><span class="line">./softirqs -NT 1      # 1s summaries, nanoseconds, and timestamps</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="func"><a href="#func" class="headerlink" title="func"></a>func</h4><ul>
<li><p>funclatency</p>
<ul>
<li>Time functions and print latency as a histogram<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">./funclatency net_rx_action</span><br><span class="line">Tracing 1 <span class="built_in">functions</span> <span class="keyword">for</span> <span class="string">&quot;net_rx_action&quot;</span>... Hit Ctrl-C to end.</span><br><span class="line">     nsecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 0        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 359      |                                        |</span><br><span class="line">       256 -&gt; 511        : 629512   |********                                |</span><br><span class="line">       512 -&gt; 1023       : 2571487  |********************************        |</span><br><span class="line">      1024 -&gt; 2047       : 2720136  |**********************************      |</span><br><span class="line">      2048 -&gt; 4095       : 3120474  |****************************************|</span><br><span class="line">      4096 -&gt; 8191       : 657204   |********                                |</span><br><span class="line">      8192 -&gt; 16383      : 114649   |*                                       |</span><br><span class="line">     16384 -&gt; 32767      : 7222     |                                        |</span><br><span class="line">     32768 -&gt; 65535      : 177      |                                        |</span><br><span class="line">     65536 -&gt; 131071     : 12       |                                        |</span><br><span class="line">    131072 -&gt; 262143     : 0        |                                        |</span><br><span class="line">    262144 -&gt; 524287     : 0        |                                        |</span><br><span class="line">    524288 -&gt; 1048575    : 2070     |                                        |</span><br><span class="line">   1048576 -&gt; 2097151    : 3        |                                        |</span><br><span class="line">Detaching...</span><br><span class="line"></span><br><span class="line">/usr/share/bcc/tools/funclatency -T -m -d 3600 dsl_pool_sync</span><br><span class="line"></span><br><span class="line">    ./funclatency do_sys_open       <span class="comment"># time the do_sys_open() kernel function</span></span><br><span class="line">    ./funclatency c:<span class="built_in">read</span>            <span class="comment"># time the read() C library function</span></span><br><span class="line">    ./funclatency -u vfs_read       <span class="comment"># time vfs_read(), in microseconds</span></span><br><span class="line">    ./funclatency -m do_nanosleep   <span class="comment"># time do_nanosleep(), in milliseconds</span></span><br><span class="line">    ./funclatency -i 2 -d 10 c:open <span class="comment"># output every 2 seconds, for duration 10s</span></span><br><span class="line">    ./funclatency -mTi 5 vfs_read   <span class="comment"># output every 5 seconds, with timestamps</span></span><br><span class="line">    ./funclatency -p 181 vfs_read   <span class="comment"># time process 181 only</span></span><br><span class="line">    ./funclatency <span class="string">&#x27;vfs_fstat*&#x27;</span>      <span class="comment"># time both vfs_fstat() and vfs_fstatat()</span></span><br><span class="line">    ./funclatency <span class="string">&#x27;c:*printf&#x27;</span>       <span class="comment"># time the *printf family of functions</span></span><br><span class="line">    ./funclatency -F <span class="string">&#x27;vfs_r*&#x27;</span>       <span class="comment"># show one histogram per matched function</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>funccount</p>
<ul>
<li>This program traces functions, tracepoints, or USDT probes that match a specified pattern<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">    ./funccount &#x27;vfs_*&#x27;             # count kernel fns starting with &quot;vfs&quot;</span><br><span class="line">    ./funccount -r &#x27;^vfs.*&#x27;         # same as above, using regular expressions</span><br><span class="line">    ./funccount -Ti 5 &#x27;vfs_*&#x27;       # output every 5 seconds, with timestamps</span><br><span class="line">    ./funccount -d 10 &#x27;vfs_*&#x27;       # trace for 10 seconds only</span><br><span class="line">    ./funccount -p 185 &#x27;vfs_*&#x27;      # count vfs calls for PID 181 only</span><br><span class="line">    ./funccount t:sched:sched_fork  # count calls to the sched_fork tracepoint</span><br><span class="line">    ./funccount -p 185 u:node:gc*   # count all GC USDT probes in node, PID 185</span><br><span class="line">    ./funccount c:malloc            # count all malloc() calls in libc</span><br><span class="line">    ./funccount go:os.*             # count all &quot;os.*&quot; calls in libgo</span><br><span class="line">    ./funccount -p 185 go:os.*      # count all &quot;os.*&quot; calls in libgo, PID 185</span><br><span class="line">    ./funccount ./test:read*        # count &quot;read*&quot; calls in the ./test binary</span><br><span class="line"></span><br><span class="line">$ ./funccount -i 1  &#x27;tcp_*&#x27;</span><br><span class="line">Tracing 282 functions for &quot;tcp_*&quot;... Hit Ctrl-C to end.</span><br><span class="line"></span><br><span class="line">FUNC                                    COUNT</span><br><span class="line">tcp_drop                                    1</span><br><span class="line">tcp_validate_incoming                       1</span><br><span class="line">tcp_send_dupack                             1</span><br><span class="line">tcp_oow_rate_limited                        1</span><br><span class="line">tcp_write_wakeup                            3</span><br><span class="line">tcp_xmit_probe_skb                          3</span><br><span class="line">tcp_delack_timer                            4</span><br><span class="line">tcp_delack_timer_handler                    6</span><br><span class="line">tcp_write_timer                             6</span><br><span class="line">tcp_poll                                    6</span><br><span class="line">tcp_keepalive_timer                         7</span><br><span class="line">tcp_write_timer_handler                     7</span><br><span class="line">tcp_try_rmem_schedule                       7</span><br><span class="line">tcp_init_cwnd                               8</span><br><span class="line">tcp_urg                                    12</span><br><span class="line">tcp_data_queue                             15</span><br><span class="line">tcp_check_space                            30</span><br><span class="line">tcp_set_skb_tso_segs                       38</span><br><span class="line">tcp_nagle_check                            38</span><br><span class="line">tcp_ack                                    42</span><br><span class="line">tcp_stream_memory_free                     44</span><br><span class="line">tcp_send_mss                               54</span><br><span class="line">tcp_init_tso_segs                          54</span><br><span class="line">tcp_wfree                                  57</span><br><span class="line">tcp_event_new_data_sent                    72</span><br><span class="line"></span><br><span class="line">$ ./funccount -i 1  &#x27;get_page_from_freelist&#x27;</span><br><span class="line">Tracing 1 functions for &quot;get_page_from_freelist&quot;... Hit Ctrl-C to end.</span><br><span class="line"></span><br><span class="line">FUNC                                    COUNT</span><br><span class="line">get_page_from_freelist                  14785</span><br><span class="line"></span><br><span class="line">FUNC                                    COUNT</span><br><span class="line">get_page_from_freelist                   7397</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>.&#x2F;funcgraph </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./funcgraph truncate_inode_pages_range</span><br></pre></td></tr></table></figure>
</li>
<li><p>funcslower</p>
<ul>
<li>funcslower shows kernel or user function invocations slower than a threshold<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./funcslower vfs_write       # trace vfs_write calls slower than 1ms</span><br><span class="line">./funcslower -m 10 vfs_write # same, but slower than 10ms</span><br><span class="line">./funcslower -u 10 c:open    # trace open calls slower than 10us</span><br><span class="line">./funcslower -p 135 c:open   # trace pid 135 only</span><br><span class="line">./funcslower c:malloc c:free # trace both malloc and free slower than 1ms</span><br><span class="line">./funcslower -a 2 c:open     # show first two arguments to open</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>vfsstat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ ./vfsstat 5 10</span><br><span class="line">TIME         READ/s  WRITE/s CREATE/s   OPEN/s  FSYNC/s</span><br><span class="line">14:34:53:       575        7        0      537        0</span><br><span class="line">14:34:58:       850        9        0      792        0</span><br><span class="line">14:35:03:       842        8        0      791        0</span><br><span class="line">14:35:08:       580        8        0      535        0</span><br><span class="line">14:35:13:       839        8        0      789        0</span><br><span class="line"></span><br><span class="line">$  bpftrace -e &#x27;kprobe:vfs_* &#123; @[probe] = count() &#125;&#x27;</span><br><span class="line">Attaching 53 probes...</span><br><span class="line">^C</span><br><span class="line">@[kprobe:vfs_llseek]: 1</span><br><span class="line">@[kprobe:vfs_fsync_range]: 33</span><br><span class="line">@[kprobe:vfs_iter_write]: 61</span><br><span class="line">@[kprobe:vfs_statfs]: 93</span><br><span class="line">@[kprobe:vfs_statx_fd]: 469</span><br><span class="line">@[kprobe:vfs_statx]: 2299</span><br><span class="line">@[kprobe:vfs_getattr_nosec]: 2872</span><br><span class="line">@[kprobe:vfs_getattr]: 2873</span><br><span class="line">@[kprobe:vfs_write]: 3754</span><br><span class="line">@[kprobe:vfs_open]: 4965</span><br><span class="line">@[kprobe:vfs_read]: 8020</span><br></pre></td></tr></table></figure>
<p>runqslower is BCC tools that lists instance of run queue latency exceeding a configurable threshold and show the process that suffered the latency and its duration  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">examples:</span><br><span class="line">    ./runqslower         # trace run queue latency higher than 10000 us (default)</span><br><span class="line">    ./runqslower 1000    # trace run queue latency higher than 1000 us</span><br><span class="line">    ./runqslower -p 123  # trace pid 123 only</span><br><span class="line">[root@test-2643a /usr/share/bcc/tools]# ./runqslower</span><br><span class="line">Tracing run queue latency higher than 10000 us</span><br><span class="line">TIME     COMM             PID           LAT(us)</span><br><span class="line">00:20:20 bwa              5836            22182</span><br><span class="line">00:20:22 sh               5844            12056</span><br><span class="line">00:20:22 bwa              5838            12061</span><br><span class="line">00:20:22 bwa              5835            13001</span><br><span class="line">00:20:22 bwa              5835            12109</span><br></pre></td></tr></table></figure>
<p>cpudist show the distribution of on-cpu time for each thread wakeup tracing schduler contect switch events</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ ./cpudist</span><br><span class="line">Tracing on-CPU time... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">     usecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 209      |                                        |</span><br><span class="line">         2 -&gt; 3          : 16066    |*****                                   |</span><br><span class="line">         4 -&gt; 7          : 125262   |****************************************|</span><br><span class="line">         8 -&gt; 15         : 59764    |*******************                     |</span><br><span class="line">        16 -&gt; 31         : 13689    |****                                    |</span><br><span class="line">        32 -&gt; 63         : 2320     |                                        |</span><br><span class="line"></span><br><span class="line"><span class="comment">#trace dd write</span></span><br><span class="line">$ ./cpudist -m -p 3826757</span><br><span class="line">Tracing on-CPU time... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">     msecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 190      |****************************************|</span><br><span class="line">$ ./cpudist -p 3826757</span><br><span class="line">Tracing on-CPU time... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">     usecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 11       |*****                                   |</span><br><span class="line">         4 -&gt; 7          : 35       |***************                         |</span><br><span class="line">         8 -&gt; 15         : 41       |******************                      |</span><br><span class="line">        16 -&gt; 31         : 36       |****************                        |</span><br><span class="line">        32 -&gt; 63         : 88       |****************************************|</span><br><span class="line">        64 -&gt; 127        : 32       |**************                          |</span><br><span class="line">       128 -&gt; 255        : 25       |***********                             |</span><br><span class="line">       256 -&gt; 511        : 13       |*****                                   |</span><br><span class="line">       512 -&gt; 1023       : 6        |**                                      |</span><br><span class="line">      1024 -&gt; 2047       : 2        |                                        |</span><br></pre></td></tr></table></figure>
<p>argdist show the read requested size since entry to the syscall was in instrumented   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ ./argdist -H <span class="string">&#x27;t:syscalls:sys_exit_read():int:args-&gt;ret&#x27;</span></span><br><span class="line">[00:36:40]</span><br><span class="line">     args-&gt;ret           : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 1        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 0        |                                        |</span><br><span class="line">       256 -&gt; 511        : 0        |                                        |</span><br><span class="line">       512 -&gt; 1023       : 0        |                                        |</span><br><span class="line">      1024 -&gt; 2047       : 0        |                                        |</span><br><span class="line">      2048 -&gt; 4095       : 0        |                                        |</span><br><span class="line">      4096 -&gt; 8191       : 0        |                                        |</span><br><span class="line">      8192 -&gt; 16383      : 3584     |****************************************|</span><br><span class="line"></span><br><span class="line">$  bpftrace -lv <span class="string">&#x27;tracepoint:syscalls:sys_exit_write&#x27;</span></span><br><span class="line">tracepoint:syscalls:sys_exit_write</span><br><span class="line">    int __syscall_nr;</span><br><span class="line">    long ret;</span><br><span class="line"></span><br><span class="line">$ bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_exit_write &#123; @ = hist(args-&gt;ret) &#125;&#x27;</span></span><br><span class="line">Attaching 1 probe...</span><br><span class="line">c^C</span><br><span class="line"></span><br><span class="line">@:</span><br><span class="line">[1]                    2 |                                                    |</span><br><span class="line">[2, 4)                 0 |                                                    |</span><br><span class="line">[4, 8)                 0 |                                                    |</span><br><span class="line">[8, 16)               45 |@                                                   |</span><br><span class="line">[16, 32)              18 |                                                    |</span><br><span class="line">[32, 64)               1 |                                                    |</span><br><span class="line">[64, 128)              0 |                                                    |</span><br><span class="line">[128, 256)             0 |                                                    |</span><br><span class="line">[256, 512)             0 |                                                    |</span><br><span class="line">[512, 1K)              0 |                                                    |</span><br><span class="line">[1K, 2K)               0 |                                                    |</span><br><span class="line">[2K, 4K)               0 |                                                    |</span><br><span class="line">[4K, 8K)               0 |                                                    |</span><br><span class="line">[8K, 16K)              0 |                                                    |</span><br><span class="line">[16K, 32K)             0 |                                                    |</span><br><span class="line">[32K, 64K)             0 |                                                    |</span><br><span class="line">[64K, 128K)            0 |                                                    |</span><br><span class="line">[128K, 256K)           0 |                                                    |</span><br><span class="line">[256K, 512K)           0 |                                                    |</span><br><span class="line">[512K, 1M)             0 |                                                    |</span><br><span class="line">[1M, 2M)            1558 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>execsnoop   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PCOMM            PID    PPID   RET ARGS</span><br><span class="line">ps               205430 205429   0 /usr/bin/ps aux</span><br><span class="line">grep             205431 205429   0 /usr/bin/grep nobody</span><br><span class="line">awk              205432 205429   0 /usr/bin/awk <span class="variable">$3</span>&gt;0 &#123;<span class="built_in">print</span> <span class="variable">$2</span>&#125;</span><br><span class="line"><span class="built_in">tail</span>             205434 205429   0 /usr/bin/tail -n 1</span><br><span class="line"><span class="built_in">ls</span>               205436 205435   0 /usr/bin/ls /proc/204067/fd</span><br><span class="line">grep             205437 205435   0 /usr/bin/grep -v dev</span><br><span class="line">grep             205438 205435   0 /usr/bin/grep -v socket</span><br><span class="line"><span class="built_in">wc</span>               205439 205435   0 /usr/bin/wc -l</span><br><span class="line"><span class="built_in">sleep</span>            205440 210303   0 /usr/bin/sleep 5</span><br></pre></td></tr></table></figure>

<p>syscount    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./syscount -p 204067</span><br><span class="line">Tracing syscalls, printing top 10... Ctrl+C to quit.</span><br><span class="line">^C[12:26:18]</span><br><span class="line">SYSCALL                   COUNT</span><br><span class="line">sched_yield              187351</span><br><span class="line"><span class="built_in">read</span>                      26216</span><br><span class="line">mprotect                   7533</span><br><span class="line">futex                      1863</span><br><span class="line">write                        24</span><br></pre></td></tr></table></figure>



  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#bcc-tools"><span class="toc-number">1.</span> <span class="toc-text">bcc tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#trace"><span class="toc-number">1.1.</span> <span class="toc-text">trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#profile"><span class="toc-number">1.2.</span> <span class="toc-text">profile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network"><span class="toc-number">1.3.</span> <span class="toc-text">Network</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#func"><span class="toc-number">1.4.</span> <span class="toc-text">func</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/10/31/bcc/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/10/31/bcc/&text=Trace by bcc tools"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/10/31/bcc/&is_video=false&description=Trace by bcc tools"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Trace by bcc tools&body=Check out this article: http://example.com/2019/10/31/bcc/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/10/31/bcc/&title=Trace by bcc tools"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/10/31/bcc/&name=Trace by bcc tools&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/10/31/bcc/&t=Trace by bcc tools"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
