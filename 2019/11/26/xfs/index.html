<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="reference format1234567891011#Warning: AG size is a multiple of stripe width. This can cause performance problems by aligning all AGs on the same disk. To avoid this, run mkfs with an AG size that is">
<meta property="og:type" content="article">
<meta property="og:title" content="xfs">
<meta property="og:url" content="http://example.com/2019/11/26/xfs/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="reference format1234567891011#Warning: AG size is a multiple of stripe width. This can cause performance problems by aligning all AGs on the same disk. To avoid this, run mkfs with an AG size that is">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-11-26T08:12:19.000Z">
<meta property="article:modified_time" content="2022-11-15T01:59:51.687Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="xfs">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>xfs</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/06/01/mdadm/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2019/10/10/golang/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/11/26/xfs/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/11/26/xfs/&text=xfs"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/11/26/xfs/&is_video=false&description=xfs"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=xfs&body=Check out this article: http://example.com/2019/11/26/xfs/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/11/26/xfs/&name=xfs&description=&lt;p&gt;&lt;a href=&#34;http://fibrevillage.com/storage&#34;&gt;reference&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;format&#34;&gt;&lt;a href=&#34;#format&#34; class=&#34;headerlink&#34; title=&#34;format&#34;&gt;&lt;/a&gt;format&lt;/h4&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#Warning: AG size is a multiple of stripe width. This can cause performance problems by aligning all AGs on the same disk. To avoid this, run mkfs with an AG size that is one stripe unit smaller, for example xxxxxx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# that means you can&amp;#x27;t set agcount by youself through&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;reference : https://knowledge.autodesk.com/support/flame-products/learn-explore/caas/sfdcarticles/sfdcarticles/Configuring-a-Logical-Volume-for-Flame-Media-Storage-Step-3.html&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#Raid 60  24 HDD ，12HDD/per raid6   （12-2）× 2 ， Raid stripe size 64KB&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.xfs -f -d sunit=64,swidth=$((&lt;span class=&#34;number&#34;&gt;64&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;)) /dev/sdxx1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#su: Stripe unit, which is the RAID chunk size, in bytes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#sw: Multiplier of the stripe unit, i.e. number of data disks&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.xfs /dev/device&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs. xfs -d su= 64k,sw= 4 /dev/device&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;su &amp;#x3D; value&lt;br&gt;    Specifies a stripe unit or RAID chunk size. The value must be specified in bytes, with an optional k, m, or g suffix.&lt;br&gt;sw&amp;#x3D; value&lt;br&gt;    Specifies the number of data disks in a RAID device, or the number of stripe units in the stripe.&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/11/26/xfs/&t=xfs"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#format"><span class="toc-number">1.</span> <span class="toc-text">format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grow"><span class="toc-number">2.</span> <span class="toc-text">Grow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Suspend-file-system"><span class="toc-number">3.</span> <span class="toc-text">Suspend file system</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Quota"><span class="toc-number">4.</span> <span class="toc-text">Quota</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Backup-and-restore"><span class="toc-number">5.</span> <span class="toc-text">Backup and restore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compare-with-ext4"><span class="toc-number">6.</span> <span class="toc-text">Compare with ext4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Defragment"><span class="toc-number">7.</span> <span class="toc-text">Defragment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xfs-admin"><span class="toc-number">8.</span> <span class="toc-text">xfs_admin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Repair"><span class="toc-number">9.</span> <span class="toc-text">Repair</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recover-file"><span class="toc-number">10.</span> <span class="toc-text">Recover file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-estimate"><span class="toc-number"></span> <span class="toc-text">xfs_estimate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-info"><span class="toc-number"></span> <span class="toc-text">xfs_info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-logprint"><span class="toc-number"></span> <span class="toc-text">xfs_logprint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#About-barriers"><span class="toc-number">1.</span> <span class="toc-text">About barriers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-file-block"><span class="toc-number"></span> <span class="toc-text">The file block</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-from-this-article"><span class="toc-number"></span> <span class="toc-text">copy from this article</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#superblock"><span class="toc-number"></span> <span class="toc-text">superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inode"><span class="toc-number"></span> <span class="toc-text">inode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#directory"><span class="toc-number"></span> <span class="toc-text">directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#re-test-xfs"><span class="toc-number"></span> <span class="toc-text">re-test xfs</span></a>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        xfs
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-11-26T08:12:19.000Z" itemprop="datePublished">2019-11-26</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Storage/">Storage</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/xfs/" rel="tag">xfs</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><a target="_blank" rel="noopener" href="http://fibrevillage.com/storage">reference</a></p>
<h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Warning: AG size is a multiple of stripe width. This can cause performance problems by aligning all AGs on the same disk. To avoid this, run mkfs with an AG size that is one stripe unit smaller, for example xxxxxx</span></span><br><span class="line"><span class="comment"># that means you can&#x27;t set agcount by youself through</span></span><br><span class="line">reference : https://knowledge.autodesk.com/support/flame-products/learn-explore/caas/sfdcarticles/sfdcarticles/Configuring-a-Logical-Volume-for-Flame-Media-Storage-Step-3.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#Raid 60  24 HDD ，12HDD/per raid6   （12-2）× 2 ， Raid stripe size 64KB</span></span><br><span class="line">$ mkfs.xfs -f -d sunit=64,swidth=$((<span class="number">64</span>*<span class="number">20</span>)) /dev/sdxx1</span><br><span class="line"><span class="comment">#su: Stripe unit, which is the RAID chunk size, in bytes</span></span><br><span class="line"><span class="comment">#sw: Multiplier of the stripe unit, i.e. number of data disks</span></span><br><span class="line"></span><br><span class="line">$ mkfs.xfs /dev/device</span><br><span class="line">$ mkfs. xfs -d su= 64k,sw= 4 /dev/device</span><br></pre></td></tr></table></figure>
<p>su &#x3D; value<br>    Specifies a stripe unit or RAID chunk size. The value must be specified in bytes, with an optional k, m, or g suffix.<br>sw&#x3D; value<br>    Specifies the number of data disks in a RAID device, or the number of stripe units in the stripe.</p>
<span id="more"></span>

<h4 id="Grow"><a href="#Grow" class="headerlink" title="Grow"></a>Grow</h4><p>While XFS file systems can be grown while mounted</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_growfs /mount/point -D size</span><br></pre></td></tr></table></figure>

<h4 id="Suspend-file-system"><a href="#Suspend-file-system" class="headerlink" title="Suspend file system"></a>Suspend file system</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_freeze -f /mount/point</span><br><span class="line"></span><br><span class="line"><span class="comment">#unfreeze</span></span><br><span class="line">$ xfs_freeze -u /mount/point</span><br></pre></td></tr></table></figure>
<p>When taking an LVM snapshot, it is not necessary to use xfs_freeze to suspend the file system first.</p>
<h4 id="Quota"><a href="#Quota" class="headerlink" title="Quota"></a>Quota</h4><p>uquota User quotas<br>gquota Group quotas<br>pquota Project quota</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ mount -o uquota /dev/mapper/LUN13 /lun13</span><br><span class="line">$ xfs_quota  /lun13</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27;limit isoft=500 ihard=700 trteam&#x27;</span> /lun13</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; limit -g bsoft=1000 m bhard=1200m test &#x27;</span> /lun13</span><br><span class="line"></span><br><span class="line"><span class="comment"># report</span></span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27;report -bih&#x27;</span> /lun13</span><br><span class="line"></span><br><span class="line"><span class="comment">#project quota</span></span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; project -s projectname&#x27;</span> project_path</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; limit -p bsoft=1000m bhard=1200m projectname&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Backup-and-restore"><a href="#Backup-and-restore" class="headerlink" title="Backup and restore"></a>Backup and restore</h4><p>To perform a full backup, perform a level 0 dump on the file system.<br>A level 1 dump is the first incremental backup after a full backup. The next incremental backup would be level 2, which only backs up files that have changed since the last level 1 dump; and so on, to a maximum of level 9.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ xfsdump -l level [-L label] -f backup-destination path-to-xfs-filesystem</span><br><span class="line">$ xfsdump -l 0 -f /backup-files/data.xfsdump /data</span><br><span class="line">$ xfsdump -l 0 -L <span class="string">&quot;backup_data&quot;</span> -f /dev/st0 /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># restore</span></span><br><span class="line">$ xfsrestore [-r] [-S session-id] [-L session-label] [-i] -f backup-location restoration-path</span><br><span class="line">$ xfsrestore -f /backup-files/data.xfsdump /mnt/data/</span><br><span class="line">$ xfsrestore -f /dev/st0 -L <span class="string">&quot;backup_data&quot;</span> /mnt/data/</span><br><span class="line"></span><br><span class="line">$ xfsrestore -I <span class="comment"># get the session ID</span></span><br><span class="line">$ xfsrestore -f /dev/st0 -S <span class="string">&quot;45e9af35-efd2-4244-87bc-4762e476cbab&quot;</span> /mnt/data/</span><br><span class="line"></span><br><span class="line">$ xfs_metadump /dev/mapper/vg0-data /home/vg0-data.metadump</span><br><span class="line">$ xfs_mdrestore /home/vg0-data.metadump /home/vg0-data.img</span><br></pre></td></tr></table></figure>

<h4 id="Compare-with-ext4"><a href="#Compare-with-ext4" class="headerlink" title="Compare with ext4"></a>Compare with ext4</h4><table>
<thead>
<tr>
<th>Task</th>
<th>Ext3&#x2F;4</th>
<th>XFS</th>
</tr>
</thead>
<tbody><tr>
<td>File System check</td>
<td>e2fsck</td>
<td>xfs_repair</td>
</tr>
<tr>
<td>REsizing a File System</td>
<td>resize2fs</td>
<td>xfs_growfs</td>
</tr>
<tr>
<td>Save an image of a file system</td>
<td>e2image</td>
<td>xfs_metadump and xfs_mdrestore</td>
</tr>
<tr>
<td>Label or tune a File System</td>
<td>tune2fs</td>
<td>xfs_admin</td>
</tr>
<tr>
<td>Backup a File System</td>
<td>dump and restore</td>
<td>xfsdump xfsrestore</td>
</tr>
</tbody></table>
<h4 id="Defragment"><a href="#Defragment" class="headerlink" title="Defragment"></a>Defragment</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_db -r  /dev/sdb</span><br><span class="line">$ xfs_db&gt; frag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Defragment</span></span><br><span class="line">$ xfs_fsr -t 3600  -v /lun10</span><br></pre></td></tr></table></figure>
<h4 id="xfs-admin"><a href="#xfs-admin" class="headerlink" title="xfs_admin"></a>xfs_admin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_admin -l /dev/sdb</span><br><span class="line">$ xfs_admin -L <span class="string">&quot;data&quot;</span> /dev/sdb</span><br><span class="line"></span><br><span class="line">$ xfs_admin -u /dev/sdb</span><br><span class="line">$ xfs_admin -U generate-id /dev/sdb</span><br><span class="line">$ xfs_admin -U nil /dev/sdb</span><br><span class="line"></span><br><span class="line">$ xfs_admin -c 0 /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable xfs lazy counters</span></span><br><span class="line">$ xfs_admin -c 1 /dev/sdb</span><br></pre></td></tr></table></figure>

<h4 id="Repair"><a href="#Repair" class="headerlink" title="Repair"></a>Repair</h4><p>-n     No modify mode. Specifies that xfs_repair should not modify the filesystem  but  should  only  scan the filesystem and indicate what repairs would have been made</p>
<p>-L The xfs_repair utility cannot repair an XFS file system with a dirty log. To clear the log, mount and unmount the XFS file system. force log zeroing to clean log<br>-v option gives you xfs_repair verbose outpt, inaddition to the regular repair message +extra verbosity, it has a summary for each repair phase.<br>-d Repair  dangerously.  Allow  xfs_repair to repair an XFS filesystem mounted read only. This is typically done on a root filesystem from single user mode, immediately followed by a reboot.<br>-l option, external log<br>-f Specifies  that  the  filesystem  image  to  be processed is stored in a regular file at device (see the mkfs.xfs -d file option). This might happen if an image copy of a filesystem has been copied or written into an ordinary file.  This option implies that any external log or realtime section is also in an ordinary file.<br>-P option, disable prefetching<br>-t interval Modify reporting interval, specified in seconds. During long runs xfs_repair outputs its progress every 15 minutes. Reporting is only activated when ag_stride is enabled.<br>-m Specifies the approximate maximum amount of memory, in megabytes, to use for xfs_repair.  xfs_repair has its own internal block cache which  will  scale  out  up  to  the lesser of the process’s virtual address limit or about 75% of the system’s physical RAM.  This option overrides these limits. NOTE: These memory limits are only approximate and may use more than the specified limit</p>
<p>If xfs_repair failed in phase 1, you must restore lost files from backups.<br>If xfs_repair failed in phase 2 or later, you may be able to restore files from the disk by backing up and restoring the files on the file system<br>    * Mount the file system using mount -r (read-only).<br>    * Make a file system backup with xfsdump.<br>    * Use mkfs to a make new file system on the same disk partition or XLV logical volume.<br>    * Restore the files from the backup with xfsrestore.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mount -r /dev/sdb /mnt</span><br><span class="line">$ mount /dev/sdb /mnt -o norecover</span><br></pre></td></tr></table></figure>


<p>Without any option, xfs_repair will check and repair errors that it encounters.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_repair -n /dev/device</span><br><span class="line">Phase 1 - find and verify superblock...</span><br><span class="line">Phase 2 - using internal log</span><br><span class="line">        - scan filesystem freespace and inode maps...</span><br><span class="line">        - found root inode chunk</span><br><span class="line">Phase 3 - for each AG...</span><br><span class="line">        - scan (but don&#x27;t clear) agi unlinked lists...</span><br><span class="line">        - process known inodes and perform inode discovery...</span><br><span class="line">        - agno = 0</span><br><span class="line">        - agno = 1</span><br><span class="line">        - agno = 2</span><br><span class="line">        - agno = 3</span><br><span class="line">        - process newly discovered inodes...</span><br><span class="line">Phase 4 - check for duplicate blocks...</span><br><span class="line">        - setting up duplicate extent list...</span><br><span class="line">        - check for inodes claiming duplicate blocks...</span><br><span class="line">        - agno = 0</span><br><span class="line">        - agno = 1</span><br><span class="line">        - agno = 2</span><br><span class="line">        - agno = 3</span><br><span class="line">No modify flag set, skipping phase 5</span><br><span class="line">Phase 6 - check inode connectivity...</span><br><span class="line">        - traversing filesystem ...</span><br><span class="line">        - traversal finished ...</span><br><span class="line">        - moving disconnected inodes to lost+found ...</span><br><span class="line">Phase 7 - verify link counts...</span><br><span class="line">No modify flag set, skipping filesystem flush and exiting.</span><br><span class="line"></span><br><span class="line">$ xfs_repair -L /dev/device</span><br><span class="line">$ xfs_repair -d /</span><br></pre></td></tr></table></figure>
<ol>
<li>Inode  and inode blockmap (addressing) checks:bad magic number  in inode, bad magic numbers in inode blockmap  blocks,  extents out  of  order,  incorrect  number of records in inode blockmap blocks, blocks claimed that are not in a legal data area of the filesystem, blocks that are claimed by more than one inode.</li>
<li>Inode  allocation  map  checks:bad  magic number in inode map blocks, inode state as indicated by map (free or in-use) inconsistent with state indicated by the inode, inodes referenced by the filesystem that do not appear in the inode allocation  map, inode  allocation  map referencing blocks that do not appear to contain inodes.</li>
<li>Size checks:number of blocks  claimed  by  inode  inconsistent with  inode  size, directory size not block aligned, inode size not consistent with inode format.</li>
<li>Directory checks:bad magic numbers in directory blocks, incorrect  number  of  entries  in  a directory block, bad freespace information in a directory leaf block,  entry  pointing  to  an unallocated  (free) or out of range inode, overlapping entries, missing or incorrect dot and dotdot  entries,  entries  out  of hashvalue  order, incorrect internal directory pointers, directory type not consistent with inode format and size.</li>
<li>Pathname checks:files or directories not referenced by a pathname starting from the filesystem root, illegal pathname components.</li>
<li>Link count checks:link counts that do not agree with the  number of directory references to the inode.</li>
<li>Freemap  checks: blocks  claimed  free by the freemap but also claimed by an inode, blocks unclaimed  by  any  inode  but  not appearing in the freemap.</li>
<li>Super  Block  checks: total free block and&#x2F;or free i-node count incorrect, filesystem geometry inconsistent, secondary and primary superblocks contradictory.</li>
</ol>
<h4 id="Recover-file"><a href="#Recover-file" class="headerlink" title="Recover file"></a>Recover file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -ih</span><br><span class="line">70179 -r-xr-xr-x 1 testuser testuser    0 Jan 10  2013 report.htm</span><br><span class="line"></span><br><span class="line">$ xfs_db -r /dev/sdb -c <span class="string">&quot;inode 70179&quot;</span> -c <span class="string">&quot;bmap&quot;</span></span><br><span class="line">data offset 0 startblock 2459337662 (9/43418558) count 1 flag 0a</span><br><span class="line"></span><br><span class="line">$ agblocks=$(xfs_db -r /dev/sdb1 -c sb -c p | grep ^agblocks | sed <span class="string">&#x27;s/.* = //&#x27;</span>)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$agblocks</span></span><br><span class="line">268435455</span><br><span class="line">$ agcount=$(xfs_db -r /dev/sdb1 -c sb -c p | awk <span class="string">&#x27;$0~/agcount/&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$agcount</span></span><br><span class="line">9</span><br><span class="line">$ b=43418558</span><br><span class="line">$ c=1</span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="variable">$agblocks</span>*<span class="variable">$agcount</span>+<span class="variable">$b</span>)) </span><br><span class="line">2459337653</span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">2459337662</span>-<span class="number">9</span>))</span><br><span class="line">2459337653</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdb bs=4096 skip=$((<span class="variable">$agblocks</span>*<span class="variable">$agcount</span>+<span class="variable">$b</span>)) count=<span class="variable">$c</span> of=/tmp/report.htm</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">4096 bytes (4.1 kB) copied, 4.6345e-05 s, 88.4 MB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /tmp/report.htm   <span class="comment"># file come back</span></span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=gbk&quot;</span>/&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> -li</span><br><span class="line">total 8344</span><br><span class="line">201802827 -rw-r--r-- 1 root root 4270448 Jan 20 20:37 files.md5</span><br><span class="line"></span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;inode 201802827&quot;</span> -c <span class="string">&quot;bmap&quot;</span></span><br><span class="line">data offset 0 startblock 25205566 (3/39742) count 1043 flag 0</span><br><span class="line"></span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c sb -c p | grep agblocks</span><br><span class="line">agblocks = 7781888</span><br><span class="line"></span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;convert inode 201802827 agino&quot;</span></span><br><span class="line">0x7444b (476235)</span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;convert inode 201802827 agno&quot;</span></span><br><span class="line">0x3 (3)</span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;convert inode 201802827 agblock&quot;</span></span><br><span class="line">0xe889 (59529)</span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;convert inode 201802827 offset&quot;</span></span><br><span class="line">0x3 (3)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mapper/cl-root bs=4096 skip=$((<span class="variable">$agno</span>*<span class="variable">$agblocks</span>+<span class="number">39742</span>)) count=1043 of=files.md5.copy</span><br><span class="line"><span class="comment">## there are some zero in the end of the recovery file</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####</span></span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;inode <span class="variable">$inode</span>&quot;</span> -c <span class="string">&quot;bmap&quot;</span></span><br><span class="line">data offset 0 startblock 25205566 (3/39742) count 1043 flag 0</span><br><span class="line"><span class="comment">## Got the offset=39742 and count=1043</span></span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c <span class="string">&quot;convert inode <span class="variable">$inode</span> agno&quot;</span></span><br><span class="line">0x3 (3)</span><br><span class="line">xfs_db -r /dev/mapper/cl-root -c sb -c p | grep agblocks</span><br><span class="line">agblocks = 7781888</span><br><span class="line"><span class="comment">## Got the agblock and agno</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/xxx bs=4096 skip=$((<span class="variable">$agno</span>*<span class="variable">$agblocks</span>+<span class="variable">$offset</span>)) count=1043 of=files.copy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="xfs-estimate"><a href="#xfs-estimate" class="headerlink" title="xfs_estimate"></a>xfs_estimate</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xfs_estimate -v /mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">/mnt                                     4096     1138        4.4MB    4096000</span><br><span class="line">$ xfs_estimate -v -b 512 /mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">/mnt                                      512     1138        0.6MB     512000</span><br><span class="line">$ xfs_estimate -v -b 4096 /mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">/mnt                                     4096     1138        4.4MB    4096000</span><br></pre></td></tr></table></figure>

<h3 id="xfs-info"><a href="#xfs-info" class="headerlink" title="xfs_info"></a>xfs_info</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_info /mnt</span><br><span class="line">meta-data=/dev/sdb               isize=512    agcount=16, agsize=4799984 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=76799744, imaxpct=25</span><br><span class="line">         =                       sunit=16     swidth=32 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=37504, version=2</span><br><span class="line">         =                       sectsz=512   sunit=16 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<h3 id="xfs-logprint"><a href="#xfs-logprint" class="headerlink" title="xfs_logprint"></a>xfs_logprint</h3><p>-t print out transactional view of an xfs log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">xfs_logprint -t  /dev/sdb</span><br><span class="line">xfs_logprint:</span><br><span class="line">xfs_logprint: /dev/sdb contains a mounted and writable filesystem</span><br><span class="line">    data device: 0x810</span><br><span class="line">    <span class="built_in">log</span> device: 0x810 daddr: 307199104 length: 300032</span><br><span class="line"></span><br><span class="line">    <span class="built_in">log</span> <span class="built_in">tail</span>: 256 <span class="built_in">head</span>: 512 state: &lt;DIRTY&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LOG REC AT LSN cycle 1 block 256 (0x1, 0x100)</span><br><span class="line">============================================================================</span><br><span class="line">TRANS: tid:0xb4cdd37c  <span class="built_in">type</span>:SWAPEXT  <span class="comment">#items:2  trans:0xb4cdd37c  q:0x20bcbe0</span></span><br><span class="line">BUF: cnt:2 total:2 a:0x20bd010 len:24 a:0x20bd060 len:384</span><br><span class="line">	BUF:  <span class="comment">#regs:2   start blkno:0x0   len:1   bmap size:1   flags:0x9000</span></span><br><span class="line">	SUPER Block Buffer:</span><br><span class="line"></span><br><span class="line">LOG REC AT LSN cycle 1 block 384 (0x1, 0x180)</span><br><span class="line">============================================================================</span><br><span class="line">TRANS: tid:0xb84fc956  <span class="built_in">type</span>:SWAPEXT  <span class="comment">#items:2  trans:0xb84fc956  q:0x20bcbe0</span></span><br><span class="line">BUF: cnt:2 total:2 a:0x20bd010 len:24 a:0x20cd250 len:384</span><br><span class="line">	BUF:  <span class="comment">#regs:2   start blkno:0x0   len:1   bmap size:1   flags:0x9000</span></span><br><span class="line">	SUPER Block Buffer:</span><br></pre></td></tr></table></figure>
<p>-i extract and print inode info<br>-q extract and print quota info<br>-e, exit when an error is found in the log<br>-c, Attempt to continue when an error is detected</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_logprint -C xfs.log /dev/sdb</span><br></pre></td></tr></table></figure>

<h4 id="About-barriers"><a href="#About-barriers" class="headerlink" title="About barriers"></a><a target="_blank" rel="noopener" href="https://xfs.org/index.php/XFS_FAQ#Write_barrier_support.">About barriers</a></h4><p>Write barrier support is enabled by default in XFS since kernel version 2.6.17. It is disabled by mounting the filesystem with “nobarrier”. Barrier support will flush the write back cache at the appropriate times (such as on XFS log writes). </p>
<h3 id="The-file-block"><a href="#The-file-block" class="headerlink" title="The file block"></a>The file block</h3><p>sdc is the 4K block device, the xfs count by 512 Bytes  </p>
<p>Here is the 1MB file, it ‘s aligned   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -h /mnt</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc2       948M   36M  913M   4% /mnt</span><br><span class="line"></span><br><span class="line">$ xfs_info /dev/sdc2</span><br><span class="line">meta-data=/dev/sdc2              isize=512    agcount=4, agsize=61056 blks</span><br><span class="line">         =                       sectsz=4096  attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1 spinodes=0 rmapbt=0</span><br><span class="line">         =                       reflink=0</span><br><span class="line">data     =                       bsize=4096   blocks=244224, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=1605, version=2</span><br><span class="line">         =                       sectsz=4096  sunit=1 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=<span class="built_in">test</span> bs=1M count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00214354 s, 489 MB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -shl</span><br><span class="line">total 1.0M</span><br><span class="line">1.0M -rw-r--r-- 1 root root 1.0M April 17 22:16 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ xfs_bmap -v ./test</span><br><span class="line">./test:</span><br><span class="line"> EXT: FILE-OFFSET      BLOCK-RANGE      AG AG-OFFSET        TOTAL</span><br><span class="line">   0: [0..2047]:       160..2207         0 (160..2207)       2048</span><br><span class="line"></span><br><span class="line"><span class="comment">#BLOCK-RANGE start at 160 block and total blocks: 2048; 2048 x 512</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdc2 of=dd-test bs=512 skip=160 count=2048</span><br><span class="line">2048+0 records <span class="keyword">in</span></span><br><span class="line">2048+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00779449 s, 135 MB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">du</span> -hs <span class="built_in">test</span> dd-test</span><br><span class="line">1.0M	<span class="built_in">test</span></span><br><span class="line">1.0M	dd-test</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">md5sum</span> ./*</span><br><span class="line">b6d81b360a5672d80c27430f39153e2c  ./test</span><br><span class="line">b6d81b360a5672d80c27430f39153e2c  ./dd-test</span><br></pre></td></tr></table></figure>

<p>Not aligned example  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rand -hex 255 &gt; flag1</span><br><span class="line">$ openssl rand -hex 255 &gt; flag2</span><br><span class="line">$ openssl rand -hex 255 &gt; flag3</span><br><span class="line">$ <span class="built_in">cat</span> flag* &gt; flag</span><br><span class="line"></span><br><span class="line">$ xfs_bmap -v ./flag</span><br><span class="line">./flag:</span><br><span class="line"> EXT: FILE-OFFSET      BLOCK-RANGE      AG AG-OFFSET          TOTAL</span><br><span class="line">   0: [0..7]:          1052728..1052735  0 (1052728..1052735)     8</span><br><span class="line"></span><br><span class="line"><span class="comment">## it &#x27;s 4K file ?</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdc2 of=flag-copy bs=512 skip=1052728 count=8</span><br><span class="line">8+0 records <span class="keyword">in</span></span><br><span class="line">8+0 records out</span><br><span class="line">4096 bytes (4.1 kB, 4.0 KiB) copied, 0.00178995 s, 2.3 MB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">md5sum</span> flag-copy flag</span><br><span class="line">fd39ee533070b2bbd46f38f81e16c72f  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ hexdump -C flag</span><br><span class="line">...</span><br><span class="line">000005c0  34 33 31 66 63 62 63 30  64 35 66 31 31 32 63 33  |431fcbc0d5f112c3|</span><br><span class="line">000005d0  64 34 34 35 30 30 33 35  65 38 35 37 33 38 36 63  |d4450035e857386c|</span><br><span class="line">000005e0  32 34 32 33 31 34 39 30  36 32 64 62 36 39 61 30  |2423149062db69a0|</span><br><span class="line">000005f0  64 33 31 66 61 64 34 66  38 37 62 30 0a           |d31fad4f87b0.|</span><br><span class="line">000005fd</span><br><span class="line"></span><br><span class="line">$ hexdump -C flag-copy</span><br><span class="line">000005d0  64 34 34 35 30 30 33 35  65 38 35 37 33 38 36 63  |d4450035e857386c|</span><br><span class="line">000005e0  32 34 32 33 31 34 39 30  36 32 64 62 36 39 61 30  |2423149062db69a0|</span><br><span class="line">000005f0  64 33 31 66 61 64 34 66  38 37 62 30 0a 00 00 00  |d31fad4f87b0....|</span><br><span class="line">00000600  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000</span><br><span class="line"></span><br><span class="line"><span class="comment"># it &#x27;s just 1533 Bytes, not 4K</span></span><br><span class="line">$  <span class="built_in">stat</span> flag</span><br><span class="line">  File: flag</span><br><span class="line">  Size: 1533      	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 822h/2082d	Inode: 105         Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2020-04-18 01:00:50.197468163 +0800</span><br><span class="line">Modify: 2020-04-18 01:00:48.173261473 +0800</span><br><span class="line">Change: 2020-04-18 01:00:48.173261473 +0800</span><br><span class="line"> Birth: -</span><br><span class="line"></span><br><span class="line"><span class="comment"># just overwrite the 1533 Bytes in the 4K file...</span></span><br><span class="line">$  <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdc2 of=flag-copy conv=notrunc bs=1 skip=$((<span class="number">1052728</span>*<span class="number">512</span>)) count=1533</span><br><span class="line">1533+0 records <span class="keyword">in</span></span><br><span class="line">1533+0 records out</span><br><span class="line">1533 bytes (1.5 kB, 1.5 KiB) copied, 0.00655476 s, 234 kB/s</span><br><span class="line">root@homerl-To-be-filled-by-O-E-M:/mnt<span class="comment"># md5sum flag-copy flag</span></span><br><span class="line">fd39ee533070b2bbd46f38f81e16c72f  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -shl</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:00 flag</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag1</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag2</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag3</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  4.0K April  18 01:07 flag-copy</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">rm</span> flag-copy</span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdc2 of=flag-copy conv=notrunc bs=1 skip=$((<span class="number">1052728</span>*<span class="number">512</span>)) count=1533</span><br><span class="line">$ <span class="built_in">ls</span> -shl</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:00 flag</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag1</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag2</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag3</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:07 flag-copy</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">md5sum</span> flag-copy flag</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br></pre></td></tr></table></figure>

<p>Big file   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=big-file bs=1M count=1000</span><br><span class="line">$ xfs_bmap -v big-file </span><br><span class="line">big-file:</span><br><span class="line"> EXT: FILE-OFFSET         BLOCK-RANGE      AG AG-OFFSET          TOTAL</span><br><span class="line">   0: [0..1048447]:       4280..1052727     0 (4280..1052727)  1048448</span><br><span class="line">   1: [1048448..2047999]: 1953376..2952927  1 (96..999647)      999552</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">stat</span> big-file </span><br><span class="line">  File: big-file</span><br><span class="line">  Size: 1048576000	Blocks: 2048000    IO Block: 4096   regular file</span><br><span class="line">Device: 822h/2082d	Inode: 104         Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2020-04-18 01:00:37.464167969 +0800</span><br><span class="line">Modify: 2020-04-18 01:00:39.196344841 +0800</span><br><span class="line">Change: 2020-04-18 01:38:26.999014414 +0800</span><br><span class="line"> Birth: -</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">3e800000</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> flag1 flag2 flag3 </span><br><span class="line">56c80696e82e2f88984e369e5dcee45142b3682020adf733e68f692a70747b99b307b15022ed21f3d843cba8abf52e3432e6203fe2bf5bc2ecd79891dcfc133ae3350c0b8ea8d5c7d9e449938959a411ee96ca9a56653b34f2de236ddd3007b30a9876bcedcfeb73489d17a263b0af5b7a069848280dc55ecfeaccca6af46f0a637d97fcd94dd3c3d75bd871398753da6abe52d3c8d54abc6339acb094a2c33a1b772c8d51a0306ad20920c8a749d334030b5a072049572fc2d7c1183e575bd66aa2020f115b62d05bb15ddd07000e6fde5387d2807ec21605286190bfe3b77e2d3f4991bed0a716c8419ca5d4ddd7815f39e3579090040ff77be5fe730dbc</span><br><span class="line">6baa2fc5a2115063030d7d4a8633974f2fc14cd502ec6df38f575d2d6dcff299b7dcdeca9d4dd513d7d77a6099aa8604108628109f871ac414942f0f5efe58b61f5b160f5bdf34bb30ff6655f958b62731c0097ed92090ec1c2433e7baa0bca9e385f9c7b3dd1188aaedaefdfd6a9e6dadaf6bd08a7096c2219b4c8e9d9cf1daa0bbeb3dd9994666cbbd1c45e5d07afefbe0af42f508b49869f54edd34865423cb0bdd71a99f6c2f0f19f1aa494f0694b6baa3ebe090b3aeb6443b7b5f210b00560aba8bdbfdd15ab8ae909c6d99477dde90a5ad9ac28338dbe2abc663cb8092519b7258fdbba92f62d2c9dd70861274acb5180dbd8371ccf6469d5fc4940c</span><br><span class="line">b621e3e516b0a54defdde7e05b846dc8a91c29f191d2f74305b7d6e5f742c5cb1ce793450b83f2d1e5f692d78994d558ed47e8e3fe58db32aab4dc87d10452db5cf99bab7fa5915b30cc6844e4d1393bd41c56c65a7ed8eb916976d122dbf955035bd2c39ba320838d39b0e1d4cee3db53c35bfa860412f4aeef71f3e3b4d6d1edaff216e385fa667c0e08cbd780e1246adb8ae932a261f0df9c8e4a0e627e6775ddb602308efaa49e0e6413edcb577660b0ea749a3b737a00f9ef56dbb834505f4ce0950a04dce4c159d2c459f382e4d41cf517c4329d3b241e5d8eb8872b0bdd431fcbc0d5f112c3d4450035e857386c2423149062db69a0d31fad4f87b0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=flag1 of=/dev/sdc2 bs=512 seek=4280</span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">511 bytes copied, 0.000275702 s, 1.9 MB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=flag2 of=/dev/sdc2 bs=512 seek=1953376</span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">511 bytes copied, 0.0125594 s, 40.7 kB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ umount /mnt</span><br><span class="line">$ mount /dev/sdc2 /mnt</span><br><span class="line">$ <span class="built_in">cd</span> /mnt/</span><br><span class="line">$ hexdump -C big-file</span><br><span class="line">00000000  35 36 63 38 30 36 39 36  65 38 32 65 32 66 38 38  |56c80696e82e2f88|</span><br><span class="line">.....</span><br><span class="line">000001f0  66 37 37 62 65 35 66 65  37 33 30 64 62 63 0a 00  |f77be5fe730dbc..|</span><br><span class="line">00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1fff0000  36 62 61 61 32 66 63 35  61 32 31 31 35 30 36 33  |6baa2fc5a2115063|</span><br><span class="line">.....</span><br><span class="line">1fff01f0  66 36 34 36 39 64 35 66  63 34 39 34 30 63 0a 00  |f6469d5fc4940c..|</span><br><span class="line">1fff0200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">3e800000</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cp</span> big-file big-file-2</span><br><span class="line">$ xfs_bmap -v big-file-2</span><br><span class="line">big-file-2:</span><br><span class="line"> EXT: FILE-OFFSET         BLOCK-RANGE      AG AG-OFFSET           TOTAL</span><br><span class="line">   0: [0..900551]:        1052728..1953279  0 (1052728..1953279) 900552</span><br><span class="line">   1: [900552..902695]:   160..2303         0 (160..2303)          2144</span><br><span class="line">   2: [902696..1854375]:  2952928..3904607  1 (999648..1951327)  951680</span><br><span class="line">   3: [1854376..2047999]: 4975584..5169207  2 (1069024..1262647) 193624</span><br><span class="line">$ big-file*</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-2</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -lhs big-file-2-p* </span><br><span class="line">440M -rw-r--r-- 1 root root 440M April  18 01:54 big-file-2-p1</span><br><span class="line">1.1M -rw-r--r-- 1 root root 1.1M April  18 01:55 big-file-2-p2</span><br><span class="line">465M -rw-r--r-- 1 root root 465M April  18 01:55 big-file-2-p3</span><br><span class="line"> 95M -rw-r--r-- 1 root root  95M April  18 01:56 big-file-2-p4</span><br><span class="line"></span><br><span class="line"><span class="comment"># if the file not out of order</span></span><br><span class="line">$ hexdump -C big-file-2-p1 </span><br><span class="line">00000000  35 36 63 38 30 36 39 36  65 38 32 65 32 66 38 38  |56c80696e82e2f88|</span><br><span class="line">...</span><br><span class="line">000001f0  66 37 37 62 65 35 66 65  37 33 30 64 62 63 0a 00  |f77be5fe730dbc..|</span><br><span class="line">00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1b7b9000</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file-2-p2 </span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">0010c000</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file-2-p3</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">0472b000  36 62 61 61 32 66 63 35  61 32 31 31 35 30 36 33  |6baa2fc5a2115063|</span><br><span class="line">...</span><br><span class="line">0472b1f0  66 36 34 36 39 64 35 66  63 34 39 34 30 63 0a 00  |f6469d5fc4940c..|</span><br><span class="line">0472b200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1d0b0000</span><br><span class="line"></span><br><span class="line"><span class="comment"># second flag show at 1fff0000 (536805376)</span></span><br><span class="line"><span class="comment"># p1 end at 1b7b9000 (461082624)</span></span><br><span class="line"><span class="comment"># p2 from 0x0 to 0010c000 (1097728)</span></span><br><span class="line"><span class="comment"># p3 from 0x0 to 0472b000 (74625024)</span></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">461082624</span>+<span class="number">1097728</span>+<span class="number">74625024</span>))</span><br><span class="line">536805376</span><br><span class="line"></span><br><span class="line"><span class="comment"># it &#x27;s the 1fff0000 (536805376)</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> big-file-2-p1 big-file-2-p2 big-file-2-p3 big-file-2-p4 &gt; big-file-3</span><br><span class="line">$ <span class="built_in">md5sum</span> big-file-2 big-file-3</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-2</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-3</span><br></pre></td></tr></table></figure>

<h3 id="copy-from-this-article"><a href="#copy-from-this-article" class="headerlink" title="copy from this article"></a><a target="_blank" rel="noopener" href="https://righteousit.wordpress.com/2018/05/21/xfs-part-1-superblock/">copy from this article</a></h3><p>XFS magic num: “58 46 53 42”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">00000000  58 46 53 42 00 00 10 00  00 00 00 00 06 <span class="built_in">fc</span> 85 00  |XFSB............|</span><br><span class="line">magicnum = 0x58465342  <span class="comment"># 0-3 bytes mangic num: &quot;58 46 53 42&quot; XFSB</span></span><br><span class="line">blocksize = 4096       <span class="comment"># 4-7  &quot;00 00 10 00&quot;</span></span><br><span class="line">dblocks = 117212416    <span class="comment"># 8-15 &quot;00 00 00 00 06 fc 85 00&quot; Total blocks in file system</span></span><br><span class="line">                       <span class="comment"># echo $((117212416*4096))=480102055936 ;</span></span><br><span class="line">                  <span class="comment"># blockdev --getsz /dev/sdg1 937699328; echo $((937699328*512))=480102055936</span></span><br><span class="line"></span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">rblocks = 0 <span class="comment"># 16-23    Num blocks in real-time device</span></span><br><span class="line">rextents = 0 <span class="comment"># 24-31    Num extents in real-time device</span></span><br><span class="line"></span><br><span class="line">00000020  ce 72 48 bd 0f 2e 4b 04  a4 77 bc <span class="built_in">cd</span> a5 91 67 <span class="built_in">cd</span>  |.rH...K..w....g.|</span><br><span class="line">uuid = ce7248bd-0f2e-4b04-a477-bccda59167cd</span><br><span class="line"></span><br><span class="line">00000030  00 00 00 00 04 00 00 07  00 00 00 00 00 00 00 60  |...............`|</span><br><span class="line">logstart = 67108871  <span class="comment">## 48-55 bytes,First block of journal &quot;00 00 00 00 04 00 00 07&quot;</span></span><br><span class="line">rootino = 96  <span class="comment">## 56-63 bytes,Root directory&#x27;s inode &quot;00 00 00 00 00 00 00 60&quot;</span></span><br><span class="line"></span><br><span class="line">00000040  00 00 00 00 00 00 00 61  00 00 00 00 00 00 00 62  |.......a.......b|</span><br><span class="line">rbmino = 97 <span class="comment"># 64-71    Real-time extents bitmap inode</span></span><br><span class="line">rsumino = 98 <span class="comment"># 72-79    Real-time bitmap summary inode</span></span><br><span class="line"></span><br><span class="line">00000050  00 00 00 01 01 bf 21 40  00 00 00 04 00 00 00 00  |......!@........|</span><br><span class="line">rextsize = 1 <span class="comment">#80-83    Real-time extent size (in blocks)</span></span><br><span class="line">agblocks = 29303104 <span class="comment">#84-87 1bf2140=29303104   single AG size (in blocks), there are 4x AGs , awk &#x27;BEGIN&#123;print 29303104*4096*4&#125;&#x27; = 480102055936, same with dblocks echo $((117212416*4096))=480102055936</span></span><br><span class="line">agcount = 4    <span class="comment">#88-91    Number of AGs # 4 x AG</span></span><br><span class="line">rbmblocks = 0  <span class="comment">#92-95    Num of real-time bitmap blocks</span></span><br><span class="line"></span><br><span class="line">00000060  00 00 <span class="built_in">df</span> 90 bc a5 10 00  02 00 00 08 00 00 00 00  |................|</span><br><span class="line">logblocks = 57232 <span class="comment"># 96-99, 00 00 df 90, Num of journal blocks</span></span><br><span class="line">versionnum = 0xbca5 <span class="comment">#100-101 File system version and flags</span></span><br><span class="line">sectsize = 4096 <span class="comment">#102-103, 10 00 ,Sector size</span></span><br><span class="line">inodesize = 512 <span class="comment">#104-105, 02 00 ,inode size</span></span><br><span class="line">inopblock = 8   <span class="comment">#106-107, indoes/block, 00 08</span></span><br><span class="line"></span><br><span class="line">                                              <span class="comment">#108</span></span><br><span class="line">00000060  00 00 <span class="built_in">df</span> 90 bc a5 10 00  02 00 00 08 00 00 00 00  |................|</span><br><span class="line">00000070  00 00 00 00 00 00 00 00  0c 0c 09 03 19 00 00 19  |................|</span><br><span class="line">fname = <span class="string">&quot;\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span> <span class="comment">#108-119 file system name, not set</span></span><br><span class="line">                                  <span class="comment">#120</span></span><br><span class="line">00000070  00 00 00 00 00 00 00 00  0c 0c 09 03 19 00 00 19  |................|</span><br><span class="line">blocklog = 12 <span class="comment">#120      log2(block size)           0xc</span></span><br><span class="line">sectlog = 12  <span class="comment">#121      log2(sector size)          0xc</span></span><br><span class="line">inodelog = 9  <span class="comment">#122      log2(inode size)           0x9</span></span><br><span class="line">inopblog = 3  <span class="comment">#123      log2(inode/block)          0x3</span></span><br><span class="line">agblklog = 25 <span class="comment">#124      log2(AG size) rounded up   0x19</span></span><br><span class="line"><span class="comment"># From logstart = 67108871(10) 0x4000007  ## 48-55 bytes First block of journal</span></span><br><span class="line"><span class="comment">#0x4000007 =      10          0 000 000 000 000 000 000 000 111</span></span><br><span class="line"><span class="comment">#AG# in upper 2 bits---/\---22 bits of relative block offset</span></span><br><span class="line"><span class="comment">#10 means beginning of AG 2</span></span><br><span class="line"><span class="comment">#111 means the journal starts at relative block offset 7</span></span><br><span class="line"><span class="comment">#The physical block offset can be calculated as follows</span></span><br><span class="line"><span class="comment">#AG num (2) x  (blocks per ag, #84-87, agblocks = 29303104) + (relative block offset 7)=58606215</span></span><br><span class="line"><span class="comment">#dd if=/dev/sdg1 bs=4096 skip=$((2*29303104 + 4)) count=1 | xxd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#inode addr</span></span><br><span class="line"><span class="comment">#123(3) + #124(25) = 28</span></span><br><span class="line"><span class="comment">#The inode address of the root directory just inode offset 64 from AG 0</span></span><br><span class="line"><span class="comment"># rootino = 96 0x60  ## 56-63 bytes,Root directory&#x27;s inode</span></span><br><span class="line"></span><br><span class="line">rextslog = 0  <span class="comment"># 125      log2(real-time extents)   0</span></span><br><span class="line">inprogress = 0 <span class="comment"># 126      log2(real-time extents)  0</span></span><br><span class="line">imax_pct = 25  <span class="comment"># 127      log2(real-time extents)  0x19</span></span><br><span class="line"></span><br><span class="line">00000080  00 00 00 00 00 00 00 40  00 00 00 00 00 00 00 3b  |.......@.......;|</span><br><span class="line">icount = 128  <span class="comment"># 128-135  Number of allocated inodes , 0x40=64=1000000 2^7=128</span></span><br><span class="line">ifree = 119   <span class="comment"># 136-143  Number of free inodes, 3b=111011, 2^1+2^2+2^0+2^4+2^5+2^6=119</span></span><br><span class="line">??? <span class="comment"># not understand</span></span><br><span class="line"></span><br><span class="line">00000090  00 00 00 00 06 f7 bd 4b  00 00 00 00 00 00 00 00  |.......K........|</span><br><span class="line">fdblocks = 116890690 <span class="comment">#144-151  Number of free blocks</span></span><br><span class="line">frextents = 0        <span class="comment">#152-159  Number of free real-time extents</span></span><br><span class="line"></span><br><span class="line">000000a0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">uquotino = null <span class="comment"># 160-167  User quota inode</span></span><br><span class="line">gquotino = null <span class="comment"># 168-175  Group quota inode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000b0  00 00 00 00 00 00 00 04  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">qflags = 0 <span class="comment">#176-177  Quota flags</span></span><br><span class="line">flags = 0  <span class="comment">#178      Misc flags</span></span><br><span class="line">shared_vn = 0  <span class="comment">#178      Misc flags</span></span><br><span class="line">inoalignmt = 4 <span class="comment">#180-183  Inode alignment (in blocks)</span></span><br><span class="line">unit = 0       <span class="comment">#184-187  RAID unit (in blocks)</span></span><br><span class="line">width = 0      <span class="comment">#188-191  RAID stripe (in blocks)</span></span><br><span class="line"></span><br><span class="line">000000c0  00 0c 10 00 00 00 10 00  00 00 01 8a 00 00 01 8a  |................|</span><br><span class="line">dirblklog = 0    <span class="comment">#192      log2(dir blk allocation granularity)</span></span><br><span class="line">logsectlog = 12  <span class="comment">#193      log2(sector size of externl journal device)</span></span><br><span class="line">logsectsize = 4096 <span class="comment">#194-195  Sector size of external journal device</span></span><br><span class="line">logsunit = 4096  <span class="comment">#196-199  Stripe/unit size of external journal device</span></span><br><span class="line">features2 = 0x18a <span class="comment">#200-203  Additional flags</span></span><br><span class="line">bad_features2 = 0x18a <span class="comment">#204-207  Repeat additional flags (for alignment)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000d0  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 00  |................|</span><br><span class="line">features_compat = 0   <span class="comment">#204-207  Repeat additional flags (for alignment)</span></span><br><span class="line">features_ro_compat = 0 <span class="comment">#212-215  Read-only feature flags</span></span><br><span class="line">features_incompat = 0x1 <span class="comment">#216-219  Read-write incompatibility flags</span></span><br><span class="line">features_log_incompat = 0 <span class="comment">#220-223  Read-write incompat flags for log (unused)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000e0  1f c6 e0 48 00 00 00 00  ff ff ff ff ff ff ff ff  |...H............|</span><br><span class="line">crc = 0x64b05119 (correct)  <span class="comment">#224-227  CRC32 checksum for superblock</span></span><br><span class="line">spino_align = 0  <span class="comment">#228-231  Sparse inode alignment</span></span><br><span class="line">pquotino = null <span class="comment">#232-239  Project quota inode</span></span><br><span class="line"></span><br><span class="line">000000f0  00 00 00 01 00 00 00 90  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">lsn = 0x1000000c8 240-247  Log <span class="built_in">seq</span> number of last superblock update</span><br><span class="line">meta_uuid = 00000000-0000-0000-0000-000000000000 <span class="comment"># 248-263  UUID used if INCOMPAT_META_UUID feature      zeroed</span></span><br><span class="line"></span><br><span class="line">                                  <span class="comment">#264</span></span><br><span class="line">00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">264-271  If INCOMPAT_META_RMAPBT, inode of RM btree   zeroed</span><br></pre></td></tr></table></figure>

<h3 id="superblock"><a href="#superblock" class="headerlink" title="superblock"></a><a target="_blank" rel="noopener" href="https://righteousit.wordpress.com/2018/05/21/xfs-part-1-superblock/">superblock</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">00000000  58 46 53 42 00 00 10 00  00 00 00 00 00 10 00 00  |XFSB............|</span><br><span class="line">0-3      Magic Number                       <span class="string">&quot;XFSB&quot;</span></span><br><span class="line">4-7      Block Size (<span class="keyword">in</span> bytes)              0x1000 = 4096</span><br><span class="line">8-15     Total blocks <span class="keyword">in</span> file system        0x100000 = 1048576 block = 1048576 x 4096 = 4294967296 bytes = blockdev --getsz /dev/loop0 = 8388608 x 512b</span><br><span class="line"></span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">16-23    Num blocks <span class="keyword">in</span> real-time device     zeroed</span><br><span class="line">24-31    Num extents <span class="keyword">in</span> real-time device    zeroed</span><br><span class="line"></span><br><span class="line">00000020  8a b2 ce b5 8d 35 4f 60  98 88 4f 6c 39 7c f7 af  |.....5O`..Ol9|..|</span><br><span class="line">32-47    UUID</span><br><span class="line">uuid = 8ab2ceb5-8d35-4f60-9888-4f6c397cf7af</span><br><span class="line"></span><br><span class="line">00000030  00 00 00 00 00 08 00 04  00 00 00 00 00 00 00 40  |...............@|</span><br><span class="line">48-55    First block of journal             0x800004 = 8388612</span><br><span class="line">The first block of the file system journal is at address 0x800004. Let’s write that out <span class="keyword">in</span> binary showing the AG and relative block offset portions:</span><br><span class="line">0x800004    =   10,00 0000 0000 0000 0000 0100</span><br><span class="line">AG<span class="comment"># in upper 2 bits---/\---22 bits of relative block offset</span></span><br><span class="line">          (AG number) * (blocks per AG) + (relative block offset)</span><br><span class="line">              2(10)   *  (84-87 0x40000) 262144 + 4(100) =  <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/loop0 bs=4096 skip=$((<span class="number">2</span>*<span class="number">262144</span> + <span class="number">4</span>)) count=1 | xxd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">56-63    Root directory<span class="string">&#x27;s inode             0x40 = 64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">00000040  00 00 00 00 00 00 00 41  00 00 00 00 00 00 00 42  |.......A.......B|</span></span><br><span class="line"><span class="string">64-71    Real-time extents bitmap inode     0x41 = 65</span></span><br><span class="line"><span class="string">72-79    Real-time bitmap summary inode     0x42 = 66</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">00000050  00 00 00 01 00 04 00 00  00 00 00 04 00 00 00 00  |................|</span></span><br><span class="line"><span class="string">80-83    Real-time extent size (in blocks)  0x01</span></span><br><span class="line"><span class="string">84-87    AG size (in blocks)                0x40000 = 262144 (c.f. 8-15)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">88-91    Number of AGs                      0x04</span></span><br><span class="line"><span class="string">92-95    Num of real-time bitmap blocks     zeroed</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">00000060  00 00 0a 00 b4 a5 02 00  02 00 00 08 00 00 00 00  |................|</span></span><br><span class="line"><span class="string">96-99    Num of journal blocks              0xa00 = 2560</span></span><br><span class="line"><span class="string">100-101  File system version and flags      0xb4a5 (low nibble is version)</span></span><br><span class="line"><span class="string">102-103  Sector size                        0x200 = 512</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">104-105  Inode size                         0x200 = 512</span></span><br><span class="line"><span class="string">106-107  Inodes/block                       0x08</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">00000070  00 00 00 00 00 00 00 00  0c 09 09 03 12 00 00 19  |................|</span></span><br><span class="line"><span class="string">108-119  File system name                   not set-- zeroed</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">120      log2(block size)                   0x0C (2^^12 = 4096)</span></span><br><span class="line"><span class="string">121      log2(sector size)                  0x09 (2^^9 = 512)</span></span><br><span class="line"><span class="string">122      log2(inode size)                   0x09</span></span><br><span class="line"><span class="string">123      log2(inode/block)                  0x03 (2^^3 = 8 inode/block)</span></span><br><span class="line"><span class="string">124      log2(AG size) rounded up           0x12 (2^^12 = 4096)</span></span><br><span class="line"><span class="string">Inode addressing is similar. However, because we can have multiple inodes per block, the relative portion of the inode address has to be longer. The length of relative inode addresses is the sum of superblock bytes 123 and 124, the log2 value of inodes per block plus the log2 value of blocks per AG.</span></span><br><span class="line"><span class="string">0x3+0x12(3+18=21)</span></span><br><span class="line"><span class="string">$ cp /etc/passwd testdir1/</span></span><br><span class="line"><span class="string">$ ls -i testdir1/passwd </span></span><br><span class="line"><span class="string">$ 73(0x49) testdir1/passwd, 73/8=9, 73%8=1</span></span><br><span class="line"><span class="string">000,0,0000,0000,0000,0100,1001</span></span><br><span class="line"><span class="string">    |---------21 ------------|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ dd if=/dev/loop0 bs=4096 skip=$((0+9)) count=1 2&gt;/dev/null | dd bs=512 skip=1 count=1 2&gt;/dev/null | xxd</span></span><br><span class="line"><span class="string">0000000: 494e 81a4 0302 0000 0000 0000 0000 0000  IN..............</span></span><br><span class="line"><span class="string">                      |</span></span><br><span class="line"><span class="string">                      ------Data fork type flag =2</span></span><br><span class="line"><span class="string">0000010: 0000 0001 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class="line"><span class="string">0000020: 62be 621f 1d0f e306 62be 621f 1d0f e306  b.b.....b.b.....</span></span><br><span class="line"><span class="string">0000030: 62be 621f 1d0f e306 0000 0000 0000 0740  b.b............@</span></span><br><span class="line"><span class="string">0000040: 0000 0000 0000 0001 0000 0000 0000 0001  ................</span></span><br><span class="line"><span class="string">0000050: 0000 0002 0000 0000 0000 0000 23e0 54c0  ............#.T.</span></span><br><span class="line"><span class="string">0000060: ffff ffff 84d1 0583 0000 0000 0000 0007  ................</span></span><br><span class="line"><span class="string">0000070: 0000 0001 0000 177e 0000 0000 0000 0000  .......~........</span></span><br><span class="line"><span class="string">0000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class="line"><span class="string">0000090: 62be 621f 1d0f e306 0000 0000 0000 0049  b.b............I</span></span><br><span class="line"><span class="string">00000a0: 8ab2 ceb5 8d35 4f60 9888 4f6c 397c f7af  .....5O`..Ol9|..</span></span><br><span class="line"><span class="string">00000b0: 0000 0000 0000 0000 0000 0000 a200 0001  ................</span></span><br><span class="line"><span class="string">                                   10100010000;0,0000,0000,0000,0000,0001</span></span><br><span class="line"><span class="string">                                   0000,0000,0000,1010,0010,000;0 0000,0000,0000,0000,0001</span></span><br><span class="line"><span class="string">                                    |          (0x510=1296)               1</span></span><br><span class="line"><span class="string">                                    ---- AG 0 </span></span><br><span class="line"><span class="string">$ dd if=/dev/loop0 bs=4096 skip=$((0*262144+1296)) count=1 2&gt;/dev/null | hexdump -C | head</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">00000000  72 6f 6f 74 3a 78 3a 30  3a 30 3a 72 6f 6f 74 3a  |root:x:0:0:root:|  &lt;---- it &#x27;</span>s the password file</span><br><span class="line">00000010  2f 72 6f 6f 74 3a 2f 62  69 6e 2f 62 61 73 68 0a  |/root:/bin/bash.|</span><br><span class="line">00000020  62 69 6e 3a 78 3a 31 3a  31 3a 62 69 6e 3a 2f 62  |bin:x:1:1:bin:/b|</span><br><span class="line">00000030  69 6e 3a 2f 73 62 69 6e  2f 6e 6f 6c 6f 67 69 6e  |<span class="keyword">in</span>:/sbin/nologin|</span><br><span class="line">00000040  0a 64 61 65 6d 6f 6e 3a  78 3a 32 3a 32 3a 64 61  |.daemon:x:2:2:da|</span><br><span class="line">00000050  65 6d 6f 6e 3a 2f 73 62  69 6e 3a 2f 73 62 69 6e  |emon:/sbin:/sbin|</span><br><span class="line">00000060  2f 6e 6f 6c 6f 67 69 6e  0a 61 64 6d 3a 78 3a 33  |/nologin.adm:x:3|</span><br><span class="line">00000070  3a 34 3a 61 64 6d 3a 2f  76 61 72 2f 61 64 6d 3a  |:4:adm:/var/adm:|</span><br><span class="line">00000080  2f 73 62 69 6e 2f 6e 6f  6c 6f 67 69 6e 0a 6c 70  |/sbin/nologin.lp|</span><br><span class="line">00000090  3a 78 3a 34 3a 37 3a 6c  70 3a 2f 76 61 72 2f 73  |:x:4:7:lp:/var/s|</span><br><span class="line"></span><br><span class="line">                                   </span><br><span class="line">00000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line"></span><br><span class="line">125      log2(real-time extents)            zeroed</span><br><span class="line">126      File system being created flag     zeroed</span><br><span class="line">127      Max inode percentage               0x19 = 25%</span><br><span class="line"></span><br><span class="line">00000080  00 00 00 00 00 00 14 40  00 00 00 00 00 00 00 7b  |.......@.......&#123;|</span><br><span class="line">128-135  Number of allocated inodes         0x1440 = 5184 </span><br><span class="line">136-143  Number of free inodes              0x7b = 123</span><br><span class="line"></span><br><span class="line">00000090  00 00 00 00 00 0f a8 a3  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">144-151  Number of free blocks              0xfa8a3 = 1026211</span><br><span class="line">152-159  Number of free real-time extents   zeroed</span><br><span class="line"></span><br><span class="line">000000a0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">160-167  User quota inode                   -1 (NULL <span class="keyword">in</span> XFS)</span><br><span class="line">168-175  Group quota inode                  -1 (NULL <span class="keyword">in</span> XFS)</span><br><span class="line"></span><br><span class="line">000000b0  00 00 00 00 00 00 00 04  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">176-177  Quota flags                        zero</span><br><span class="line">178      Misc flags                         zero</span><br><span class="line">179      Reserved                           Must be zero</span><br><span class="line">180-183  Inode alignment (<span class="keyword">in</span> blocks)        0x04</span><br><span class="line">184-187  RAID unit (<span class="keyword">in</span> blocks)              zeroed</span><br><span class="line">188-191  RAID stripe (<span class="keyword">in</span> blocks)            zeroed</span><br><span class="line"></span><br><span class="line">000000c0  00 00 00 00 00 00 00 01  00 00 01 8a 00 00 01 8a  |................|</span><br><span class="line">192      log2(<span class="built_in">dir</span> blk allocation granularity)         zero</span><br><span class="line">193      log2(sector size of externl journal device)  zero  </span><br><span class="line">194-195  Sector size of external journal device       zero</span><br><span class="line">196-199  Stripe/unit size of external journal device  0x01</span><br><span class="line">200-203  Additional flags                             0x018A</span><br><span class="line">204-207  Repeat additional flags (<span class="keyword">for</span> alignment)      0x018A</span><br><span class="line"></span><br><span class="line">000000d0  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 00  |................|</span><br><span class="line">/* Version 5 only */</span><br><span class="line">208-211  Read-write feature flags (not used)          zero</span><br><span class="line">212-215  Read-only feature flags                      zero</span><br><span class="line">216-219  Read-write incompatibility flags             0x01</span><br><span class="line">220-223  Read-write incompat flags <span class="keyword">for</span> <span class="built_in">log</span> (unused)   zero</span><br><span class="line"></span><br><span class="line">000000e0  8e 18 bf 13 00 00 00 00  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">224-227  CRC32 checksum <span class="keyword">for</span> superblock                0x8e18bf13</span><br><span class="line">228-231  Sparse inode alignment                       zero</span><br><span class="line">232-239  Project quota inode                          -1</span><br><span class="line"></span><br><span class="line">000000f0  00 00 00 01 00 00 17 72  00 00 00 00 00 00 00 00  |.......r........|</span><br><span class="line">240-247  Log <span class="built_in">seq</span> number of last superblock update     0x100001772</span><br><span class="line">248-263  UUID used <span class="keyword">if</span> INCOMPAT_META_UUID feature      zeroed</span><br><span class="line">264-271  If INCOMPAT_META_RMAPBT, inode of RM btree   zeroed</span><br><span class="line"></span><br><span class="line">00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line">xfs_db -r /dev/loop0</span><br><span class="line">xfs_db&gt; sb 0</span><br><span class="line">xfs_db&gt; p</span><br><span class="line">magicnum = 0x58465342</span><br><span class="line">blocksize = 4096</span><br><span class="line">dblocks = 1048576</span><br><span class="line">rblocks = 0</span><br><span class="line">rextents = 0</span><br><span class="line">uuid = 8ab2ceb5-8d35-4f60-9888-4f6c397cf7af</span><br><span class="line">logstart = 524292</span><br><span class="line">rootino = 64</span><br><span class="line">rbmino = 65</span><br><span class="line">rsumino = 66</span><br><span class="line">rextsize = 1</span><br><span class="line">agblocks = 262144</span><br><span class="line">agcount = 4</span><br><span class="line">rbmblocks = 0</span><br><span class="line">logblocks = 2560</span><br><span class="line">versionnum = 0xb4a5</span><br><span class="line">sectsize = 512</span><br><span class="line">inodesize = 512</span><br><span class="line">inopblock = 8</span><br><span class="line">fname = <span class="string">&quot;\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span></span><br><span class="line">blocklog = 12</span><br><span class="line">sectlog = 9</span><br><span class="line">inodelog = 9</span><br><span class="line">inopblog = 3</span><br><span class="line">agblklog = 18</span><br><span class="line">rextslog = 0</span><br><span class="line">inprogress = 0</span><br><span class="line">imax_pct = 25</span><br><span class="line">icount = 5184</span><br><span class="line">ifree = 123</span><br><span class="line">fdblocks = 1026211</span><br><span class="line">frextents = 0</span><br><span class="line">uquotino = null</span><br><span class="line">gquotino = null</span><br><span class="line">qflags = 0</span><br><span class="line">flags = 0</span><br><span class="line">shared_vn = 0</span><br><span class="line">inoalignmt = 4</span><br><span class="line">unit = 0</span><br><span class="line">width = 0</span><br><span class="line">dirblklog = 0</span><br><span class="line">logsectlog = 0</span><br><span class="line">logsectsize = 0</span><br><span class="line">logsunit = 1</span><br><span class="line">features2 = 0x18a</span><br><span class="line">bad_features2 = 0x18a</span><br><span class="line">features_compat = 0</span><br><span class="line">features_ro_compat = 0</span><br><span class="line">features_incompat = 0x1</span><br><span class="line">features_log_incompat = 0</span><br><span class="line">crc = 0x8e18bf13 (correct)</span><br><span class="line">spino_align = 0</span><br><span class="line">pquotino = null</span><br><span class="line">lsn = 0x100001772</span><br><span class="line">meta_uuid = 00000000-0000-0000-0000-000000000000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="inode"><a href="#inode" class="headerlink" title="inode"></a><a target="_blank" rel="noopener" href="https://righteousit.wordpress.com/2018/05/23/xfs-part-2-inodes/">inode</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"># after del, grep &quot;00 00 03 02 00 00&quot;</span><br><span class="line">                                    ---uid---  ----gid---</span><br><span class="line">                                    |        | |         |</span><br><span class="line">00008600  49 4e 81 a4 03 02 00 00  00 00 00 00 00 00 00 00  |IN..............| &lt;-not removed</span><br><span class="line">00008600  49 4e 00 00 03 02 00 00  00 00 00 00 00 00 00 00  |IN..............| &lt;-removed</span><br><span class="line">magic number: 49 4e = IN(0-1)</span><br><span class="line">File type and mode bits (2-3) = 81 a4 = 1000,000110100100(0644)</span><br><span class="line">                                          |</span><br><span class="line">                                          ----- 8 Regular file;4 Directory;2 Character special device;6 Block special device;1 FIFO;C Socket;A Symlink</span><br><span class="line">Version = 03 = 3 (4)</span><br><span class="line">Data fork type flag = 02 = 2 (5)</span><br><span class="line">v1 inode numlinks field = 00 00 =0 (6-7)</span><br><span class="line">The original XFS inode tracked the number of links as a 16-bit value (bytes 6-7), which is no longer used. Number of links is now tracked as a 32-bit value found in bytes 16-19.</span><br><span class="line"></span><br><span class="line">00008610  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">v2+ number of links = 0 (16-19)</span><br><span class="line">Project ID (low) = 0(20-21)</span><br><span class="line">Project ID (high) = 0(22-23)</span><br><span class="line">pading (must be zero) =0 (24-29)</span><br><span class="line">Increment on flush =0 (30-31)</span><br><span class="line"></span><br><span class="line">00008620  62 bb ec a7 15 69 df 9c  62 bb ea 97 1d ff 60 70  |b....i..b.....`p|</span><br><span class="line">32-35 atime epoch</span><br><span class="line">36-39 atime nanoseconds</span><br><span class="line">40-43    mtime epoch seconds</span><br><span class="line">44-47    mtime nanoseconds</span><br><span class="line"></span><br><span class="line">00008630  62 bb ea 97 1d ff 60 70  00 00 00 00 0d 23 22 45  |b.....`p.....#&quot;E|  &lt;-not removed</span><br><span class="line">00008630  62 bb ec b1 13 08 0a 2f  00 00 00 00 00 00 00 00  |b....../........|  &lt;-removed</span><br><span class="line">48-51    ctime epoch seconds</span><br><span class="line">52-55    ctime nanoseconds    </span><br><span class="line">56-63    File (data fork) size(important)     removed=0, not removed=0d 23 22 45=220406341</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00008640  00 00 00 00 00 00 d2 33  00 00 00 00 00 00 00 01  |.......3........| &lt;-not removed</span><br><span class="line">00008640  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................| &lt;-removed</span><br><span class="line">64-71    Number of blocks in data fork = d233 = 53811</span><br><span class="line">72-75    Extent size hint = 0</span><br><span class="line">76-79    Number of data extents used=1 (not removed) ,removed = 0</span><br><span class="line"></span><br><span class="line">00008650  00 00 00 02 00 00 00 00  00 00 00 00 af 2f 13 c4  |............./..| &lt;- not removed</span><br><span class="line">00008650  00 00 00 02 00 00 00 00  00 00 00 00 af 2f 13 c5  |............./..| &lt;- removed</span><br><span class="line">80-81    Number of extended attribute extents      0</span><br><span class="line">82       Inode offset to xattr (8 byte multiples)  0</span><br><span class="line">83       Extended attribute type flag (see below)  2</span><br><span class="line">84-87    DMAPI event mask                          0</span><br><span class="line"></span><br><span class="line">88-89    DMAPI state                               0</span><br><span class="line">90-91    Flags                                     0 (none set)</span><br><span class="line">92-95    Generation number                         0x af 2f 13 c4(not removed)</span><br><span class="line"></span><br><span class="line">00008660  ff ff ff ff 04 c4 ea be  00 00 00 00 00 00 0d 33  |...............3|</span><br><span class="line">96-99    Next unlinked ptr (if inode unlinked) = -1</span><br><span class="line">/* v3 inodes (v5 file system) have the following fields */</span><br><span class="line">100-103  CRC32 checksum for inode                  0x04c4eabe</span><br><span class="line"></span><br><span class="line">104-111  Number of changes to attributes           0d33=3379</span><br><span class="line"></span><br><span class="line">00008670  00 00 00 01 00 00 00 0e  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">112-119  Log sequence number of last update        0x0001000e</span><br><span class="line"></span><br><span class="line">120-127  Extended flags                            0 (none set)</span><br><span class="line"></span><br><span class="line">00008680  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">128-131  Copy on write extent size hint            0</span><br><span class="line"></span><br><span class="line">132-143  Padding for future use                    0</span><br><span class="line"></span><br><span class="line">00008690  62 bb ea 97 0f 92 c7 78  00 00 00 00 00 00 00 43  |b......x.......C|</span><br><span class="line">144-147  btime epoch seconds                       0x62bbea97</span><br><span class="line">148-151  btime nanoseconds                         0x0f92c778</span><br><span class="line">152-159  inode number of this inode                0x43 = 67 (important, inode number)</span><br><span class="line"></span><br><span class="line">000086a0  8a b2 ce b5 8d 35 4f 60  98 88 4f 6c 39 7c f7 af  |.....5O`..Ol9|..|</span><br><span class="line">160-175  UUID</span><br><span class="line"></span><br><span class="line">The remaining space after the 176 bytes of inode core is used to track the data blocks associated with the file </span><br><span class="line">The data fork type flag in byte 5 and the extended attribute type flag in byte 83 document how this information is organized. The possible values for these fields are:</span><br><span class="line">(bytes 83) = 83 Extended attribute type flag (see below) = 2</span><br><span class="line">   0   Special device file (data type only)</span><br><span class="line">   1   Data is resident (&quot;local&quot;) in the inode (82 bytes, not test, 0x23(doc example = 35 x8b =280)</span><br><span class="line">The data fork starts at byte 176, immediately after the inode core. The start of the extended attribute data is found at an offset from the end of the inode core. This offset is byte 82 of the inode core, and the units are multiples of 8 bytes. In our sample inode, the offset value is 0x23 or 35. Multiplying by 8 gives a byte offset of 280 from the end of the inode core, or 176+280=456 bytes from the beginning of the inode.</span><br><span class="line"></span><br><span class="line">   2   Array of extent structures follows</span><br><span class="line">   3   B+Tree root follows</span><br><span class="line"></span><br><span class="line">an array of 16 byte extent structures starting immediately after the inode core, Bytes 76-79 indicate how many extent structures are in the array(removed=0,not remove=1)</span><br><span class="line">000086b0  00 00 00 00 00 00 00 00  00 00 00 00 02 00 d2 33  |...............3|</span><br><span class="line">000086c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">                                            0000 0010(02) 0000 0000(00) 1101 0010(d2) 0011 0011(33)</span><br><span class="line"></span><br><span class="line">00 00 00 00 00 00 00 00  00 00 00 00=(12x8)=96x0=96-54-1=41</span><br><span class="line">52-41=11-6(0000,00)=5(10000) </span><br><span class="line">the last 21 bit=0,0000,1101,0010,0011,0011(Number of blocks in the extent)=53811=d233, the start block=10000</span><br><span class="line">#And the gz file start block is the  0000,0000,0000,0001,0000</span><br><span class="line">                                      |   |----start block--|     </span><br><span class="line">                                      |</span><br><span class="line">                                      ----AG number, eg: #1100 0000 0100 0000 0111 1001(), if it &#x27;s the 1100=0xc, it means AG=3 in the example, the begin addr = 3xAG size+</span><br><span class="line">                                                                                      Does it split 11,00 ???</span><br><span class="line">*</span><br><span class="line">00010000  1f 8b 08 00 63 ea bb 62  00 03 ec 5c 65 40 5c c9  |....c..b...\e@\.|</span><br><span class="line">00010010  d2 ad be 01 42 88 bb ec  66 33 71 65 98 41 06 c8  |....B...f3qe.A..|</span><br><span class="line">00010020  5a 08 10 42 82 05 89 67  b3 f1 65 23 24 c0 26 59  |Z..B...g..e#$.&amp;Y|</span><br></pre></td></tr></table></figure>
<p>After recovery some gz files, at least the gz padding only 2 bytes or more(“00 00” show in hexdump)     </p>
<h3 id="directory"><a href="#directory" class="headerlink" title="directory"></a><a target="_blank" rel="noopener" href="https://righteousit.wordpress.com/2018/05/25/xfs-part-3-short-form-directories/">directory</a></h3><p>Because only 3 dirs in the xfs system, easy to find it   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">00008600  49 4e 41 ed 03 01 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">                          |</span><br><span class="line">                       1 Data is resident (<span class="string">&quot;local&quot;</span>) <span class="keyword">in</span> the inode</span><br><span class="line">41 ed=100(4 <span class="built_in">dir</span>);000,111,101,101(0755)</span><br><span class="line">00008610  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008620  62 be 62 26 2c 9e c7 90  62 be 96 3e 2a 16 30 77  |b.b&amp;,...b..&gt;*.0w|</span><br><span class="line">00008630  62 be 96 3e 2a 16 30 77  00 00 00 00 00 00 00 82  |b..&gt;*.0w........|</span><br><span class="line">56-63    File (data fork) size                     0x82 = 130</span><br><span class="line">                                                           |</span><br><span class="line"><span class="built_in">ls</span> -<span class="built_in">ls</span>                         -----------------------------</span><br><span class="line">total 244                      |</span><br><span class="line">  0 drwxr-xr-x 2 root root    130 Jul  1 14:37 testdir1 </span><br><span class="line">  4 drwxr-xr-x 2 root root   4096 Jul  1 10:01 testdir2</span><br><span class="line">240 drwxr-xr-x 2 root root 163840 Jul  1 10:01 testdir3</span><br><span class="line"></span><br><span class="line">00008640  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008650  00 00 00 02 00 00 00 00  00 00 00 00 1e 10 <span class="built_in">dd</span> 91  |................|</span><br><span class="line">00008660  ff ff ff ff f5 be 4d 3f  00 00 00 00 00 00 00 11  |......M?........|</span><br><span class="line">00008670  00 00 00 01 00 00 17 85  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008680  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008690  62 be 55 33 1a e7 b7 c7  00 00 00 00 00 00 00 43  |b.U3...........C|</span><br><span class="line"></span><br><span class="line">152-159  inode number of this inode = 00 00 00 00 00 00 00 43    </span><br><span class="line"></span><br><span class="line">000086a0  8a b2 ce b5 8d 35 4f 60  98 88 4f 6c 39 7c f7 af  |.....5O`..Ol9|..|</span><br><span class="line">000086b0  06 00 00 00 00 40 0e 00  60 74 65 73 74 64 69 72  |.....@..`testdir|</span><br><span class="line">176      Number of directory entries                   6</span><br><span class="line">177      Number of <span class="built_in">dir</span> entries needing 64-bit inodes   0 &lt;----0 means 32 bit, no zero means 64 bit</span><br><span class="line">178-181  Inode of parent                               0x00000040  &lt;--- <span class="string">&quot;..&quot;</span></span><br><span class="line">This means the directory data will use 32 bits to store inodes <span class="keyword">in</span> order to save space.</span><br><span class="line"></span><br><span class="line">0e 00 60;74 65 73 74 64 69 72  |.....@..`testdir|</span><br><span class="line">|    |   |-----name---------|</span><br><span class="line">len  |</span><br><span class="line">     --offset 0x0060</span><br><span class="line"></span><br><span class="line">000086c0  5f 66 69 6c 65 5f 30 01  00 00 00 44 0e 00 80 74  |_file_0....D...t|</span><br><span class="line">          |-------name-------| |   |4 or 8----| |     | |--74 is name---|</span><br><span class="line">                               -<span class="built_in">type</span>   |        --len |</span><br><span class="line">                                       |              -----offset 0x0080</span><br><span class="line">                                       |</span><br><span class="line">                                       ---absolute inode addr=0x00000044</span><br><span class="line"><span class="built_in">type</span> 1:Regular file</span><br><span class="line">First we have a single byte <span class="keyword">for</span> the file name length <span class="keyword">in</span> bytes. Like other Unix file systems, there is a 255 character file name <span class="built_in">limit</span></span><br><span class="line">The next two bytes are based on the byte offset the directory entry would have <span class="keyword">if</span> it were a normal XFS directory entry and not packed into a short form directory <span class="keyword">in</span> the inode.</span><br><span class="line"></span><br><span class="line">000086d0  65 73 74 64 69 72 5f 66  69 6c 65 5f 31 01 00 00  |estdir_file_1...|</span><br><span class="line">000086e0  00 45 0e 00 a0 74 65 73  74 64 69 72 5f 66 69 6c  |.E...testdir_fil|</span><br><span class="line">000086f0  65 5f 32 01 00 00 00 46  0e 00 c0 74 65 73 74 64  |e_2....F...testd|</span><br><span class="line">00008700  69 72 5f 66 69 6c 65 5f  33 01 00 00 00 47 0e 00  |ir_file_3....G..|</span><br><span class="line">00008710  e0 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 34 01  |.testdir_file_4.|</span><br><span class="line">00008720  00 00 00 48 06 01 00 70  61 73 73 77 64 01 00 00  |...H...passwd...|</span><br><span class="line">00008730  00 49 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |.I..............|</span><br><span class="line">00008740  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br></pre></td></tr></table></figure>

<p>from 5 to 50 files in this directory</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">00008600  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">                          |</span><br><span class="line">           change to 2   Array of extent structures follows</span><br><span class="line">00008610  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008620  62 c1 30 bd 35 44 <span class="built_in">fc</span> ce  62 c1 30 bc 14 4e cc c7  |b.0.5D..b.0..N..|</span><br><span class="line">00008630  62 c1 30 bc 14 4e cc c7  00 00 00 00 00 00 10 00  |b.0..N..........|</span><br><span class="line">00008640  00 00 00 00 00 00 00 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">                                                    |</span><br><span class="line">                                    76-79    Number of data extents used=1</span><br><span class="line">00008650  00 00 00 02 00 00 00 00  00 00 00 00 1e 10 <span class="built_in">dd</span> 91  |................|</span><br><span class="line">00008660  ff ff ff ff 4d 46 bd 1a  00 00 00 00 00 00 00 47  |....MF.........G|</span><br><span class="line">00008670  00 00 00 01 00 00 17 b1  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008680  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00008690  62 be 55 33 1a e7 b7 c7  00 00 00 00 00 00 00 43  |b.U3...........C|</span><br><span class="line">000086a0  8a b2 ce b5 8d 35 4f 60  98 88 4f 6c 39 7c f7 af  |.....5O`..Ol9|..|</span><br><span class="line">000086b0  00 00 00 00 00 00 00 00  00 00 00 00 a2 20 00 01  |............. ..|</span><br><span class="line">                                                    |</span><br><span class="line">                                                    |</span><br><span class="line">a2 20 00 01=0101,0001,0001(0x511,1279), 0,0000,0000,0000,0000,0001</span><br><span class="line">                                  |            ------------------------------------------------</span><br><span class="line">                                  -------------|                                              |</span><br><span class="line">                                               |                                              |</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/loop0 bs=4096  skip=$((<span class="number">0</span>*<span class="number">262144</span> + <span class="number">1297</span>)) count=1 | hexdump -C                      |</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/loop0 bs=4096  skip=1297 count=1 2&gt; /dev/null | hexdump -C  | <span class="built_in">head</span> -n 40           |</span><br><span class="line">                                                                                              |</span><br><span class="line">00000000  58 44 42 33 e5 b8 37 47  00 00 00 00 00 00 28 88  |XDB3..7G......(.|                |</span><br><span class="line">0-3      Magic number                       XDB3                                              |</span><br><span class="line">4-7      CRC32 checksum                     0xe5b83747                                        |</span><br><span class="line">8-15     Sector offset of this block        0x2888 = 10376, 10376/8=1297-----------------------</span><br><span class="line"></span><br><span class="line">00000010  00 00 00 01 00 00 17 b1  8a b2 ce b5 8d 35 4f 60  |.............5O`|</span><br><span class="line">16-23    Last LSN update                    0x1000017b1</span><br><span class="line">24-39    UUID                               8ab2ce-...-f7af</span><br><span class="line"></span><br><span class="line">00000020  98 88 4f 6c 39 7c f7 af  00 00 00 00 00 00 00 43  |..Ol9|.........C|</span><br><span class="line">24-39    UUID                               8ab2ce-...-f7af</span><br><span class="line"></span><br><span class="line">40-47    inode that points to this block    0x43 = 67 = 01000011 , 67/8=8 67%8=3</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/loop0 bs=4096 skip=$((<span class="number">0</span>*<span class="number">262144</span> + <span class="number">8</span>)) count=1 2&gt;/dev/null | <span class="built_in">dd</span> bs=512 skip=3 count=1 2&gt;/dev/null | hexdump -C</span><br><span class="line">------------ get the parent <span class="built_in">dir</span> inode info</span><br><span class="line">    00000000  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">    00000010  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">    00000020  62 c1 30 bd 35 44 <span class="built_in">fc</span> ce  62 c1 30 bc 14 4e cc c7  |b.0.5D..b.0..N..|</span><br><span class="line">    00000030  62 c1 30 bc 14 4e cc c7  00 00 00 00 00 00 10 00  |b.0..N..........|</span><br><span class="line">    00000040  00 00 00 00 00 00 00 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">    00000050  00 00 00 02 00 00 00 00  00 00 00 00 1e 10 <span class="built_in">dd</span> 91  |................|</span><br><span class="line">    00000060  ff ff ff ff 4d 46 bd 1a  00 00 00 00 00 00 00 47  |....MF.........G|</span><br><span class="line">    00000070  00 00 00 01 00 00 17 b1  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">    00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">    00000090  62 be 55 33 1a e7 b7 c7  00 00 00 00 00 00 00 43  |b.U3...........C|</span><br><span class="line">    000000a0  8a b2 ce b5 8d 35 4f 60  98 88 4f 6c 39 7c f7 af  |.....5O`..Ol9|..|</span><br><span class="line">    000000b0  00 00 00 00 00 00 00 00  00 00 00 00 a2 20 00 01  |............. ..|</span><br><span class="line">    000000c0  5f 66 69 6c 65 5f 30 01  00 00 00 44 0e 00 80 74  |_file_0....D...t|</span><br><span class="line">    000000d0  65 73 74 64 69 72 5f 66  69 6c 65 5f 31 01 00 00  |estdir_file_1...|</span><br><span class="line">    000000e0  00 45 0e 00 a0 74 65 73  74 64 69 72 5f 66 69 6c  |.E...testdir_fil|</span><br><span class="line">    000000f0  65 5f 32 01 00 00 00 46  0e 00 c0 74 65 73 74 64  |e_2....F...testd|</span><br><span class="line">    00000100  69 72 5f 66 69 6c 65 5f  33 01 00 00 00 47 0e 00  |ir_file_3....G..|</span><br><span class="line">    00000110  e0 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 34 01  |.testdir_file_4.|</span><br><span class="line">    00000120  00 00 00 48 06 01 00 70  61 73 73 77 64 01 00 00  |...H...passwd...|</span><br><span class="line">    00000130  00 49 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |.I..............|</span><br><span class="line">    00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">----------------------------------<span class="built_in">dd</span> output------------------------------------------                                              </span><br><span class="line"></span><br><span class="line">00000030  07 78 06 a8 00 00 00 00  00 00 00 00 00 00 00 00  |.x..............|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00000040  00 00 00 00 00 00 00 43  01 2e 02 00 00 00 00 40  |.......C.......@|</span><br><span class="line">00000050  00 00 00 00 00 00 00 40  02 2e 2e 02 00 00 00 50  |.......@.......P|</span><br><span class="line">00000060  00 00 00 00 00 00 00 44  0e 74 65 73 74 64 69 72  |.......D.testdir|</span><br><span class="line">00000070  5f 66 69 6c 65 5f 30 01  00 00 00 00 00 00 00 60  |_file_0........`|</span><br><span class="line">00000080  00 00 00 00 00 00 00 45  0e 74 65 73 74 64 69 72  |.......E.testdir|</span><br><span class="line">00000090  5f 66 69 6c 65 5f 31 01  00 00 00 00 00 00 00 80  |_file_1.........|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 46  0e 74 65 73 74 64 69 72  |.......F.testdir|</span><br><span class="line">000000b0  5f 66 69 6c 65 5f 32 01  00 00 00 00 00 00 00 a0  |_file_2.........|</span><br><span class="line">000000c0  00 00 00 00 00 00 00 47  0e 74 65 73 74 64 69 72  |.......G.testdir|</span><br><span class="line">000000d0  5f 66 69 6c 65 5f 33 01  00 00 00 00 00 00 00 c0  |_file_3.........|</span><br><span class="line">000000e0  00 00 00 00 00 00 00 48  0e 74 65 73 74 64 69 72  |.......H.testdir|</span><br><span class="line">000000f0  5f 66 69 6c 65 5f 34 01  00 00 00 00 00 00 00 e0  |_file_4.........|</span><br><span class="line">00000100  00 00 00 00 00 00 00 49  06 70 61 73 73 77 64 01  |.......I.passwd.|</span><br><span class="line">00000110  00 00 00 00 00 00 01 00  00 00 00 00 00 00 00 4a  |...............J|</span><br><span class="line">00000120  0e 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 35 01  |.testdir_file_5.|</span><br><span class="line">00000130  00 00 00 00 00 00 01 18  00 00 00 00 00 00 00 4b  |...............K|</span><br><span class="line">00000140  0e 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 36 01  |.testdir_file_6.|</span><br><span class="line">00000150  00 00 00 00 00 00 01 38  00 00 00 00 00 00 00 4c  |.......8.......L|</span><br><span class="line">00000160  0e 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 37 01  |.testdir_file_7.|</span><br><span class="line">00000170  00 00 00 00 00 00 01 58  00 00 00 00 00 00 00 4d  |.......X.......M|</span><br><span class="line">00000180  0e 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 38 01  |.testdir_file_8.|</span><br><span class="line">00000190  00 00 00 00 00 00 01 78  00 00 00 00 00 00 00 4e  |.......x.......N|</span><br><span class="line">000001a0  0e 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 39 01  |.testdir_file_9.|</span><br><span class="line">000001b0  00 00 00 00 00 00 01 98  00 00 00 00 00 00 00 4f  |...............O|</span><br><span class="line">000001c0  0f 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 31 30  |.testdir_file_10|</span><br><span class="line">000001d0  01 00 00 00 00 00 01 b8  00 00 00 00 00 00 00 50  |...............P|</span><br><span class="line">000001e0  0f 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 31 31  |.testdir_file_11|</span><br><span class="line">000001f0  01 00 00 00 00 00 01 d8  00 00 00 00 00 00 00 51  |...............Q|</span><br><span class="line">00000200  0f 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 31 32  |.testdir_file_12|</span><br><span class="line"></span><br><span class="line">                                     </span><br><span class="line">00000210  01 00 00 00 00 00 01 f8  00 00 00 00 00 00 00 52  |...............R|</span><br><span class="line">                                   |-----inode 0x52=82------|</span><br><span class="line"><span class="built_in">ls</span> -i testdir_file_13</span><br><span class="line">82 testdir_file_13</span><br><span class="line"></span><br><span class="line">00000220  0f 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 31 33  |.testdir_file_13|</span><br><span class="line">          |  |----------------filename 15-----------------|</span><br><span class="line">          |</span><br><span class="line">   filename length=15</span><br><span class="line"></span><br><span class="line">00000230  01 00 00 00 00 00 02 18  00 00 00 00 00 00 00 53  |...............S|</span><br><span class="line">          |  |--padding--|    |</span><br><span class="line">          |                   |</span><br><span class="line">      file <span class="built_in">type</span>            0x0218=536 (Byte offset of this directory entry)</span><br><span class="line"></span><br><span class="line">00000240  0f 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 31 34  |.testdir_file_14|</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> /mnt/testdir1</span><br><span class="line">passwd           testdir_file_13  testdir_file_19  testdir_file_24  testdir_file_3   testdir_file_35  testdir_file_40  testdir_file_46  testdir_file_51  testdir_file_7</span><br><span class="line">testdir_file_0   testdir_file_14  testdir_file_2   testdir_file_25  testdir_file_30  testdir_file_36  testdir_file_41  testdir_file_47  testdir_file_52  testdir_file_8</span><br><span class="line">testdir_file_1   testdir_file_15  testdir_file_20  testdir_file_26  testdir_file_31  testdir_file_37  testdir_file_42  testdir_file_48  testdir_file_53  testdir_file_9</span><br><span class="line">testdir_file_10  testdir_file_16  testdir_file_21  testdir_file_27  testdir_file_32  testdir_file_38  testdir_file_43  testdir_file_49  testdir_file_54</span><br><span class="line">testdir_file_11  testdir_file_17  testdir_file_22  testdir_file_28  testdir_file_33  testdir_file_39  testdir_file_44  testdir_file_5   testdir_file_55</span><br><span class="line">testdir_file_12  testdir_file_18  testdir_file_23  testdir_file_29  testdir_file_34  testdir_file_4   testdir_file_45  testdir_file_50  testdir_file_6</span><br><span class="line">------------------------------<span class="built_in">dd</span> output----------------------------------------</span><br><span class="line"></span><br><span class="line">000086c0  5f 66 69 6c 65 5f 30 01  00 00 00 44 0e 00 80 74  |_file_0....D...t|</span><br><span class="line">000086d0  65 73 74 64 69 72 5f 66  69 6c 65 5f 31 01 00 00  |estdir_file_1...|</span><br><span class="line">000086e0  00 45 0e 00 a0 74 65 73  74 64 69 72 5f 66 69 6c  |.E...testdir_fil|</span><br><span class="line">000086f0  65 5f 32 01 00 00 00 46  0e 00 c0 74 65 73 74 64  |e_2....F...testd|</span><br><span class="line">00008700  69 72 5f 66 69 6c 65 5f  33 01 00 00 00 47 0e 00  |ir_file_3....G..|</span><br><span class="line">00008710  e0 74 65 73 74 64 69 72  5f 66 69 6c 65 5f 34 01  |.testdir_file_4.|</span><br><span class="line">00008720  00 00 00 48 06 01 00 70  61 73 73 77 64 01 00 00  |...H...passwd...|</span><br><span class="line">00008730  00 49 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |.I..............|</span><br><span class="line">00008740  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br></pre></td></tr></table></figure>

<h3 id="re-test-xfs"><a href="#re-test-xfs" class="headerlink" title="re-test xfs"></a>re-test xfs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">xfs_db&gt; sb</span><br><span class="line">xfs_db&gt; p</span><br><span class="line">magicnum = 0x58465342</span><br><span class="line">blocksize = 4096</span><br><span class="line">dblocks = 414720</span><br><span class="line">rblocks = 0</span><br><span class="line">rextents = 0</span><br><span class="line">uuid = 70463de0-0501-4081-9e24-f0e871918884</span><br><span class="line">logstart = 262150</span><br><span class="line">rootino = 128</span><br><span class="line">rbmino = 129</span><br><span class="line">rsumino = 130</span><br><span class="line">rextsize = 1</span><br><span class="line">agblocks = 103680</span><br><span class="line">agcount = 4</span><br><span class="line">rbmblocks = 0</span><br><span class="line">logblocks = 2560</span><br><span class="line">versionnum = 0xb4a5</span><br><span class="line">sectsize = 512</span><br><span class="line">inodesize = 512</span><br><span class="line">inopblock = 8</span><br><span class="line">fname = <span class="string">&quot;\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span></span><br><span class="line">blocklog = 12</span><br><span class="line">sectlog = 9</span><br><span class="line">inodelog = 9</span><br><span class="line">inopblog = 3</span><br><span class="line">agblklog = 17</span><br><span class="line">rextslog = 0</span><br><span class="line">inprogress = 0</span><br><span class="line">imax_pct = 25</span><br><span class="line">icount = 64</span><br><span class="line">ifree = 61</span><br><span class="line">fdblocks = 412128</span><br><span class="line">frextents = 0</span><br><span class="line">uquotino = null</span><br><span class="line">gquotino = null</span><br><span class="line">qflags = 0</span><br><span class="line">flags = 0</span><br><span class="line">shared_vn = 0</span><br><span class="line">inoalignmt = 8</span><br><span class="line">unit = 0</span><br><span class="line">width = 0</span><br><span class="line">dirblklog = 0</span><br><span class="line">logsectlog = 0</span><br><span class="line">logsectsize = 0</span><br><span class="line">logsunit = 1</span><br><span class="line">features2 = 0x18a</span><br><span class="line">bad_features2 = 0x18a</span><br><span class="line">features_compat = 0</span><br><span class="line">features_ro_compat = 0x5</span><br><span class="line">features_incompat = 0x3</span><br><span class="line">features_log_incompat = 0</span><br><span class="line">crc = 0xa06bbb49 (correct)</span><br><span class="line">spino_align = 4</span><br><span class="line">pquotino = null</span><br><span class="line">lsn = 0x100000008</span><br><span class="line">meta_uuid = 00000000-0000-0000-0000-000000000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># ls -li /mnt/test_dir2/passwd </span></span><br><span class="line">1172197 -rw-r--r-- 1 root root 2613 Jul 10 13:47 /mnt/test_dir2/passwd</span><br><span class="line"><span class="comment"># xfs_db /dev/loop20</span></span><br><span class="line">xfs_db&gt; convert inode 1172197 agno</span><br><span class="line">0x1 (1)</span><br><span class="line">xfs_db&gt; convert inode 1172197 agino</span><br><span class="line">0x1e2e5 (123621)</span><br><span class="line">xfs_db&gt; convert inode 1172197 agblock</span><br><span class="line">0x3c5c (15452)</span><br><span class="line">xfs_db&gt; convert inode 1172197 offset</span><br><span class="line">0x5 (5)</span><br><span class="line"></span><br><span class="line">agblocks = 103680</span><br><span class="line">agcount = 4</span><br><span class="line"></span><br><span class="line"><span class="comment">#inode ---&gt; block</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/loop20 bs=4096 skip=$((<span class="number">1</span>*<span class="number">103680</span> + <span class="number">15452</span>)) count=1 2&gt; /dev/null | <span class="built_in">dd</span> bs=512 skip=5 count=1 2&gt;/dev/null | hexdump -C</span><br><span class="line">00000000  49 4e 81 a4 03 02 00 00  00 00 00 00 00 00 00 00  |IN..............|</span><br><span class="line">00000010  00 00 00 01 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000020  62 ca 67 eb 25 f7 5e e5  62 ca 67 eb 25 f7 5e e5  |b.g.%.^.b.g.%.^.|</span><br><span class="line">00000030  62 ca 67 eb 25 f7 5e e5  00 00 00 00 00 00 0a 35  |b.g.%.^........5|</span><br><span class="line">00000040  00 00 00 00 00 00 00 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">                                                      |</span><br><span class="line">76-79    Number of data extents used=1 (not removed) ,removed = 0</span><br><span class="line"></span><br><span class="line">00000050  00 00 00 02 00 00 00 00  00 00 00 00 16 63 4c 70  |.............cLp|</span><br><span class="line">00000060  ff ff ff ff <span class="built_in">fc</span> 7d ac d2  00 00 00 00 00 00 00 05  |.....&#125;..........|</span><br><span class="line">00000070  00 00 00 01 00 00 00 6b  00 00 00 00 00 00 00 00  |.......k........|</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000090  62 ca 67 eb 25 f7 5e e5  00 00 00 00 00 11 e2 e5  |b.g.%.^.........|</span><br><span class="line">000000a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000000b0  00 00 00 00 00 00 00 00  00 00 00 47 8a 80 00 01  |...........G....|</span><br><span class="line"></span><br><span class="line">                                 478a800001=010,0011,1100,0101,0100; 0,0000,0000,0000,0000,0001 --&gt;  Number of blocks <span class="keyword">in</span> the extent = 1; <span class="built_in">dd</span> count=1</span><br><span class="line">                                             |          |                          </span><br><span class="line">                                             |    0x3c35=15444, the max = 0xffff = 1048575 bytes, looks like it will auto increase, how to increase ???, total 52 bit</span><br><span class="line">                                    010=ag=0x2=1,<span class="keyword">if</span>=1100=0xc=3, ??? don<span class="string">&#x27;t know why 0xc=3 , 0x2=1</span></span><br><span class="line"><span class="string">                                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ dd if=/dev/loop20 bs=4096 skip=$((1*103680+15444)) count=1 2&gt;/dev/null | hexdump -C | head</span></span><br><span class="line"><span class="string">00000000  72 6f 6f 74 3a 78 3a 30  3a 30 3a 72 6f 6f 74 3a  |root:x:0:0:root:|</span></span><br><span class="line"><span class="string">00000010  2f 72 6f 6f 74 3a 2f 62  69 6e 2f 62 61 73 68 0a  |/root:/bin/bash.|</span></span><br><span class="line"><span class="string">00000020  64 61 65 6d 6f 6e 3a 78  3a 31 3a 31 3a 64 61 65  |daemon:x:1:1:dae|</span></span><br><span class="line"><span class="string">00000030  6d 6f 6e 3a 2f 75 73 72  2f 73 62 69 6e 3a 2f 75  |mon:/usr/sbin:/u|</span></span><br><span class="line"><span class="string">00000040  73 72 2f 73 62 69 6e 2f  6e 6f 6c 6f 67 69 6e 0a  |sr/sbin/nologin.|</span></span><br><span class="line"><span class="string">00000050  62 69 6e 3a 78 3a 32 3a  32 3a 62 69 6e 3a 2f 62  |bin:x:2:2:bin:/b|</span></span><br><span class="line"><span class="string">00000060  69 6e 3a 2f 75 73 72 2f  73 62 69 6e 2f 6e 6f 6c  |in:/usr/sbin/nol|</span></span><br><span class="line"><span class="string">00000070  6f 67 69 6e 0a 73 79 73  3a 78 3a 33 3a 33 3a 73  |ogin.sys:x:3:3:s|</span></span><br><span class="line"><span class="string">00000080  79 73 3a 2f 64 65 76 3a  2f 75 73 72 2f 73 62 69  |ys:/dev:/usr/sbi|</span></span><br><span class="line"><span class="string">00000090  6e 2f 6e 6f 6c 6f 67 69  6e 0a 73 79 6e 63 3a 78  |n/nologin.sync:x|</span></span><br></pre></td></tr></table></figure>

<p>next, found the dir meta</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br></pre></td><td class="code"><pre><span class="line"># here is the root meta, only 2 dir in the root, test_dir1 and test_dir2</span><br><span class="line"></span><br><span class="line">00010000  49 4e 41 ed 03 01 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">                          |</span><br><span class="line">                          1 Data is resident (&quot;local&quot;) in the inode</span><br><span class="line">41 ed=100(4 dir);000,111,101,101(0755)</span><br><span class="line"></span><br><span class="line">00010010  00 00 00 04 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00010020  62 ca 66 21 1b 81 0c 30  62 ca 66 20 35 04 91 14  |b.f!...0b.f 5...|</span><br><span class="line">00010030  62 ca 66 20 35 04 91 14  00 00 00 00 00 00 00 28  |b.f 5..........(|</span><br><span class="line">56-63    File (data fork) size                     0x28 = 40</span><br><span class="line">                                                          |</span><br><span class="line">                            -------------------------------</span><br><span class="line">ls -lh /  |grep mnt         |</span><br><span class="line">drwxr-xr-x   4 root root   40 Jul 10 13:39 mnt</span><br><span class="line">df -h /mnt</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/loop20     1.6G  1.2G  437M  73% /mnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00010040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00010050  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00010060  ff ff ff ff 78 a1 e9 4a  00 00 00 00 00 00 00 05  |....x..J........|</span><br><span class="line">00010070  00 00 00 01 00 00 00 0c  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00010080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00010090  62 c9 b6 64 04 8b 35 40  00 00 00 00 00 00 00 80  |b..d..5@........|</span><br><span class="line">152-159  inode number of this inode = 00 00 00 00 00 00 00 80</span><br><span class="line">                                                           |</span><br><span class="line"> ls -li / | grep mnt ;                                     --- 128</span><br><span class="line">    128 drwxr-xr-x   4 root root    40 Jul 10 13:39 mnt</span><br><span class="line"></span><br><span class="line">000100a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000100b0  02 00 00 00 00 80 09 00  60 74 65 73 74 5f 64 69  |........`test_di|</span><br><span class="line">176      Number of directory entries                   2  #only 2 sub dirs in the root</span><br><span class="line">177      Number of dir entries needing 64-bit inodes   0 &lt;----0 means 32 bit, no zero means 64 bit</span><br><span class="line">This means the directory data will use 32 bits to store inodes in order to save space.</span><br><span class="line"></span><br><span class="line">178-181  Inode of parent                               0x00000080  &lt;--- here is root, &quot;..&quot; is itself, only 0x80=128</span><br><span class="line">182 = 0x09 = len</span><br><span class="line">183-184 = 0x0060 = offset</span><br><span class="line">185-193 = 0x74,65,73,74,5f,64,69,72,31 = test_dir1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000100c0  72 31 02 00 00 00 83 09  00 78 74 65 73 74 5f 64  |r1.......xtest_d|</span><br><span class="line">                 | |-4 or 8-|   |      |  |--file name---|</span><br><span class="line">       type 0x2=dir     |       |      --offset 0x0078</span><br><span class="line">                        |       --- len(test_dir2) begining</span><br><span class="line">                        ----absolute inode addr(inode num)=0x00000083 = 131, it&#x27;s the end</span><br><span class="line">                                                              |</span><br><span class="line">$ ls -li /mnt                                                 |</span><br><span class="line">total 8                                                       |</span><br><span class="line">    131 drwxr-xr-x 2 root root  138 Jul 10 13:42 test_dir1----- inode=131</span><br><span class="line">1048704 drwxr-xr-x 2 root root 4096 Jul 10 15:49 test_dir2----------------------------- inode=1048704</span><br><span class="line">                                                                                      |</span><br><span class="line">000100d0  69 72 32 02 00 10 00 80  00 00 00 00 00 00 00 00  |ir2.............|        |</span><br><span class="line">                    | |-4 or 8-|                                                      |</span><br><span class="line">                type=0x2   |                                                          |</span><br><span class="line">                           -----absolute inode addr(inode num)=1048704-----------------</span><br><span class="line">000100e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">here is the test_dir2</span><br><span class="line">xfs_db&gt; convert inode 1048704 agno</span><br><span class="line">0x1 (1)</span><br><span class="line">xfs_db&gt; convert inode 1048704 agblock</span><br><span class="line">0x10 (16)</span><br><span class="line">xfs_db&gt; convert inode 1048704 offset</span><br><span class="line">0x0 (0)</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((1*103680 + 16)) count=1 2&gt;/dev/null | dd bs=512 skip=0 count=1 2&gt;/dev/null | hexdump -C</span><br><span class="line">00000000  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">                         |</span><br><span class="line">                         ---  2   Array of extent structures follows</span><br><span class="line">00000010  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000020  62 ca 84 9c 37 76 f1 0f  62 ca 84 96 21 c4 0b 0f  |b...7v..b...!...|</span><br><span class="line">00000030  62 ca 84 96 21 c4 0b 0f  00 00 00 00 00 00 10 00  |b...!...........|</span><br><span class="line">00000040  00 00 00 00 00 00 00 02  00 00 00 00 00 00 00 02  |................|</span><br><span class="line">00000050  00 00 00 02 00 00 00 00  00 00 00 00 c9 88 9c 01  |................|</span><br><span class="line">00000060  ff ff ff ff a4 de 73 a2  00 00 00 00 00 00 00 69  |......s........i|</span><br><span class="line">00000070  00 00 00 01 00 00 00 7d  00 00 00 00 00 00 00 00  |.......&#125;........|</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000090  62 ca 66 20 35 04 91 14  00 00 00 00 00 10 00 80  |b.f 5...........|</span><br><span class="line">000000a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000000b0  00 00 00 00 00 00 00 00  00 00 00 40 01 e0 00 01  |...........@....|</span><br><span class="line">                              0x4001e00001=010,0000,0000,0000,1111; 0,0000,0000,0000,0000,0001 --&gt; Number of blocks in the extent = 1; dd count=1</span><br><span class="line">                                            |                   |</span><br><span class="line">                                            |                 0xf=15</span><br><span class="line">                                    010=ag=0x2=1,if=1100=0xc=3, ??? don&#x27;t know why 0xc=3 , 0x2=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((1*103680+3)) count=1 2&gt;/dev/null | hexdump -C | head</span><br><span class="line">00000000  49 41 42 33 00 00 00 02  ff ff ff ff ff ff ff ff  |IAB3............|  &lt;----Inode B+tree, v5 only</span><br><span class="line">00000010  00 00 00 00 00 0c a8 18  00 00 00 01 00 00 00 7d  |...............&#125;|</span><br><span class="line">00000020  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">00000030  00 00 00 01 36 c6 21 62  00 00 00 80 00 00 40 00  |....6.!b......@.|</span><br><span class="line">                                        |        |   |  |</span><br><span class="line">                                        |        |   |  ---ir_freecount:0x00</span><br><span class="line">                                        |        | ir_count:0x40=64</span><br><span class="line">                                        |  ir_holemask:0000  </span><br><span class="line">                                ir_startino 0x80=128</span><br><span class="line">recs[1-14] = [startino,holemask,count,freecount,free] 1:[128,0,64,0,0]</span><br><span class="line"></span><br><span class="line">eg: </span><br><span class="line">12:[1024,0,64,25,0xffffff8000000000]</span><br><span class="line">startino为1024，可以推算出其inode存储的block编号为1024/8 = 128，就是说从block编号为128之后连续8个block都会存放inode，共64个inode。</span><br><span class="line"></span><br><span class="line">holemask用掩码的方式表示这个对应的chunk中哪些位置不能分配给inode，掩码为0表示所有chunk空间都可以存放inode。假定这里为0x00ff，表示掩码中低端8位全部为1，对应的表示64个inode中，后32个inode不能使用，只能使用前32个。每个掩码可以管理对应位置的4个inode。</span><br><span class="line"></span><br><span class="line">count就是这个chunk管理的inode个数。</span><br><span class="line"></span><br><span class="line">freecount还剩25个inode空闲。</span><br><span class="line"></span><br><span class="line">free为空闲inode的掩码（位图），0xffffff8000000000表示64位中前25位为1，就是说前25个inode已经被使用了，还剩后39个可以使用。 </span><br><span class="line">                                          |</span><br><span class="line">                1111111111111111111111111000000000000000000000000000000000000000</span><br><span class="line">                |----------25x1---------|--------------39x0--------------------|</span><br><span class="line"></span><br><span class="line">00000040  00 00 00 00 00 00 00 00  00 01 e2 c0 00 00 40 19  |..............@.|</span><br><span class="line">                     |                  |</span><br><span class="line">                     |        ir_startino=0x01e2c0(next)</span><br><span class="line">         |ir_free,free inode mask|</span><br><span class="line">00000050  ff ff ff 80 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000c0  00 00 00 01 00 00 00 00  00 00 00 40 01 c0 00 01  |...........@....|</span><br><span class="line">000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------test another new dir</span><br><span class="line">19510000  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">19510010  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">19510020  62 ca 84 9c 37 76 f1 0f  62 ca 84 96 21 c4 0b 0f  |b...7v..b...!...|</span><br><span class="line">19510030  62 ca 84 96 21 c4 0b 0f  00 00 00 00 00 00 10 00  |b...!...........|</span><br><span class="line">19510040  00 00 00 00 00 00 00 02  00 00 00 00 00 00 00 02  |................|</span><br><span class="line">19510050  00 00 00 02 00 00 00 00  00 00 00 00 c9 88 9c 01  |................|</span><br><span class="line">19510060  ff ff ff ff a4 de 73 a2  00 00 00 00 00 00 00 69  |......s........i|</span><br><span class="line">19510070  00 00 00 01 00 00 00 7d  00 00 00 00 00 00 00 00  |.......&#125;........|</span><br><span class="line">19510080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">19510090  62 ca 66 20 35 04 91 14  00 00 00 00 00 10 00 80  |b.f 5...........|</span><br><span class="line">195100a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">195100b0  00 00 00 00 00 00 00 00  00 00 00 40 01 e0 00 01  |...........@....|</span><br><span class="line">                                                    |</span><br><span class="line">                                   10=0x2=ag=1 ??,0000,0000,0000,1111; 0,0000,0000,0000,0000,0001</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((1*103680+15)) count=1 2&gt;/dev/null | hexdump -C </span><br><span class="line">00000000  58 44 44 33 45 ff 69 3e  00 00 00 00 00 0c a8 78  |XDD3E.i&gt;.......x|</span><br><span class="line">00000010  00 00 00 01 00 00 00 7d  70 46 3d e0 05 01 40 81  |.......&#125;pF=...@.|</span><br><span class="line">00000020  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 10 00 80  |.$..q...........|</span><br><span class="line">00000030  0d 10 02 f0 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000040  00 00 00 00 00 10 00 80  01 2e 02 00 00 00 00 40  |...............@|</span><br><span class="line">00000050  00 00 00 00 00 00 00 80  02 2e 2e 02 00 00 00 50  |...............P|</span><br><span class="line">00000060  00 00 00 00 00 10 00 81  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line">00000070  6c 65 5f 30 2e 67 7a 01  00 00 00 00 00 00 00 60  |le_0.gz........`|</span><br><span class="line">00000080  00 00 00 00 00 10 00 82  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line">00000090  6c 65 5f 31 2e 67 7a 01  00 00 00 00 00 00 00 80  |le_1.gz.........|</span><br><span class="line">000000a0  00 00 00 00 00 10 00 83  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line">000000b0  6c 65 5f 32 2e 67 7a 01  00 00 00 00 00 00 00 a0  |le_2.gz.........|</span><br><span class="line">000000c0  00 00 00 00 00 10 00 84  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line">000000d0  6c 65 5f 33 2e 67 7a 01  00 00 00 00 00 00 00 c0  |le_3.gz.........|</span><br><span class="line">000000e0  00 00 00 00 00 10 00 85  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line">000000f0  6c 65 5f 34 2e 67 7a 01  00 00 00 00 00 00 00 e0  |le_4.gz.........|</span><br><span class="line">00000100  00 00 00 00 00 10 00 86  0e 64 69 72 32 5f 66 69  |.........dir2_fi|</span><br><span class="line"></span><br><span class="line"># search the test_dir3 </span><br><span class="line">00011400  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">00011410  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00011420  62 cd 3e 6b 2d bd 05 e5  62 cd 3e 6a 3a 9c fb fc  |b.&gt;k-...b.&gt;j:...|</span><br><span class="line">00011430  62 cd 3e 6a 3a 9c fb fc  00 00 00 00 00 00 10 00  |b.&gt;j:...........|</span><br><span class="line">00011440  00 00 00 00 00 00 00 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">00011450  00 00 00 02 00 00 00 00  00 00 00 00 6b 6b 22 61  |............kk&quot;a|</span><br><span class="line">00011460  ff ff ff ff ed bb db f7  00 00 00 00 00 00 00 2a  |...............*|</span><br><span class="line">00011470  00 00 00 01 00 00 00 a5  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00011480  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00011490  62 cd 3e 0a 27 54 dd 09  00 00 00 00 00 00 00 8a  |b.&gt;.&#x27;T..........|</span><br><span class="line">000114a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000114b0  00 00 00 00 00 00 00 00  00 00 00 00 01 e0 00 01  |................|</span><br><span class="line">                                                    |</span><br><span class="line">                                    ag=0;1111=0xf;0,0000,0000,0000,0000,0001</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0*103680+15)) count=1 2&gt;/dev/null | hexdump -C | head</span><br><span class="line">00000000  58 44 42 33 8d 34 6b 4a  00 00 00 00 00 00 00 78  |XDB3.4kJ.......x|</span><br><span class="line">00000010  00 00 00 01 00 00 00 a5  70 46 3d e0 05 01 40 81  |........pF=...@.|</span><br><span class="line">00000020  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 00 00 8a  |.$..q...........|</span><br><span class="line"></span><br><span class="line">24-39 UUID=70 46 3d e0 05 01 40 81 9e 24 f0 e8 71 91 88 84----------------------------------------------------------------------</span><br><span class="line">																|</span><br><span class="line">00000030  05 60 09 48 00 00 00 00  00 00 00 00 00 00 00 00  |.`.H............|                                                  |</span><br><span class="line">00000040  00 00 00 00 00 00 00 8a  01 2e 02 00 00 00 00 40  |...............@|                                                  |</span><br><span class="line">00000050  00 00 00 00 00 00 00 80  02 2e 2e 02 00 00 00 50  |...............P|                                                  |</span><br><span class="line">00000060  00 00 00 00 00 00 00 8b  0e 74 65 73 74 5f 64 69  |.........test_di|                                                  |</span><br><span class="line">00000070  72 33 5f 30 2e 67 7a 01  00 00 00 00 00 00 00 60  |r3_0.gz........`|                                                  |</span><br><span class="line">00000080  00 00 00 00 00 00 00 8c  0e 74 65 73 74 5f 64 69  |.........test_di|                                                  |</span><br><span class="line">00000090  72 33 5f 31 2e 67 7a 01  00 00 00 00 00 00 00 80  |r3_1.gz.........|                                                  |</span><br><span class="line">                      </span><br><span class="line">15x4096=61440=0xf000                                                                                                            |</span><br><span class="line">                |</span><br><span class="line">     -----------                                                                                                                |</span><br><span class="line">    |</span><br><span class="line">0000f000  58 44 42 33 8d 34 6b 4a  00 00 00 00 00 00 00 78  |XDB3.4kJ.......x|							|</span><br><span class="line">    |                                                    |</span><br><span class="line">    |                              8-15     Sector offset of this block  0x78=120=1111000 </span><br><span class="line">    |                                       0;00,0000,0000,0000,0000,0111,1000; 120/8=15;120%8=0</span><br><span class="line">     ---------------------------------------</span><br><span class="line">                                            |</span><br><span class="line">dd if=/dev/loop20 bs=4096 skip=$((0*103680+15)) count=1 2&gt;/dev/null | dd bs=512 skip=0 count=1 2&gt; /dev/null | hexdump -C</span><br><span class="line">                                        </span><br><span class="line"></span><br><span class="line">0000f010  00 00 00 01 00 00 00 a5  70 46 3d e0 05 01 40 81  |........pF=...@.|							|</span><br><span class="line">0000f020  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 00 00 8a  |.$..q...........|</span><br><span class="line">                                                         |</span><br><span class="line">                                                        138 drwxr-xr-x 2 root root 4096 Jul 12 17:27 test_dir3			|</span><br><span class="line">                                                     inode to block</span><br><span class="line">                                               138=0x8a= 00;00,0000,0000,0000,0000,1000,1010					|</span><br><span class="line">                                                          |                           |</span><br><span class="line">                                                        ag=0                   138/8=17.25=17; 138%7=2				|</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0*103680+17)) count=1 2&gt;/dev/null | dd bs=512 skip=2 count=1 2&gt; /dev/null | hexdump -C	 </span><br><span class="line">#from XDB3 to INA														|</span><br><span class="line">     00000000  49 4e 41 ed 03 02 00 00  00 00 00 00 00 00 00 00  |INA.............|						|</span><br><span class="line">     00000010  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">     00000020  62 cd 3e 6b 2d bd 05 e5  62 cd 3e 6a 3a 9c fb fc  |b.&gt;k-...b.&gt;j:...|</span><br><span class="line">     00000030  62 cd 3e 6a 3a 9c fb fc  00 00 00 00 00 00 10 00  |b.&gt;j:...........|						|</span><br><span class="line">     00000040  00 00 00 00 00 00 00 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">     00000050  00 00 00 02 00 00 00 00  00 00 00 00 6b 6b 22 61  |............kk&quot;a|</span><br><span class="line">     00000060  ff ff ff ff ed bb db f7  00 00 00 00 00 00 00 2a  |...............*|						|</span><br><span class="line">     00000070  00 00 00 01 00 00 00 a5  00 00 00 00 00 00 00 00  |................|						|</span><br><span class="line">     00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">     00000090  62 cd 3e 0a 27 54 dd 09  00 00 00 00 00 00 00 8a  |b.&gt;.&#x27;T..........|						|</span><br><span class="line">     000000a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|						|</span><br><span class="line">     UUID=70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84 ----------------------------------------------------------------------</span><br><span class="line">     000000b0  00 00 00 00 00 00 00 00  00 00 00 00 01 e0 00 01  |................|</span><br><span class="line">     000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line">0000f030  05 60 09 48 00 00 00 00  00 00 00 00 00 00 00 00  |.`.H............|</span><br><span class="line">Following the header is a “free space” array that consumes 12 bytes, plus 4 bytes of padding to preserve 64-bit alignment</span><br><span class="line">The free space array contains three elements which indicate where the three largest chunks of unused space are located in this directory block. </span><br><span class="line">Each element is a 2 byte offset and a 2 byte length field. </span><br><span class="line">The elements of the array are sorted in descending order by the length of each chunk.</span><br><span class="line"></span><br><span class="line">In this directory block, there is only a single chunk of free space</span><br><span class="line">starting at offset 1376 (0x0560) and having 2376 bytes (0x0948) of space. </span><br><span class="line">The other elements of the free space array are zeroed, indicating no other free space is available.</span><br><span class="line"></span><br><span class="line">0000f040  00 00 00 00 00 00 00 8a  01 2e 02 00 00 00 00 40  |...............@|</span><br><span class="line">The directory entries start at byte 64 (0x040) and can be read sequentially like a typical Unix directory. However, XFS uses a hash-based lookup table, growing up from the bottom of the directory block, for more efficient searching</span><br><span class="line">00000050  00 00 00 00 00 00 00 80  02 2e 2e 02 00 00 00 50  |...............P|</span><br><span class="line">00000060  00 00 00 00 00 00 00 8b  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000070  72 33 5f 30 2e 67 7a 01  00 00 00 00 00 00 00 60  |r3_0.gz........`|</span><br><span class="line">00000080  00 00 00 00 00 00 00 8c  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000090  72 33 5f 31 2e 67 7a 01  00 00 00 00 00 00 00 80  |r3_1.gz.........|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 8d  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000000b0  72 33 5f 32 2e 67 7a 01  00 00 00 00 00 00 00 a0  |r3_2.gz.........|</span><br><span class="line">000000c0  00 00 00 00 00 00 00 8e  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000000d0  72 33 5f 33 2e 67 7a 01  00 00 00 00 00 00 00 c0  |r3_3.gz.........|</span><br><span class="line">000000e0  00 00 00 00 00 00 00 8f  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000000f0  72 33 5f 34 2e 67 7a 01  00 00 00 00 00 00 00 e0  |r3_4.gz.........|</span><br><span class="line">00000100  00 00 00 00 00 00 00 90  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000110  72 33 5f 35 2e 67 7a 01  00 00 00 00 00 00 01 00  |r3_5.gz.........|</span><br><span class="line">00000120  00 00 00 00 00 00 00 91  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000130  72 33 5f 36 2e 67 7a 01  00 00 00 00 00 00 01 20  |r3_6.gz........ |</span><br><span class="line">00000140  00 00 00 00 00 00 00 92  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000150  72 33 5f 37 2e 67 7a 01  00 00 00 00 00 00 01 40  |r3_7.gz........@|</span><br><span class="line">00000160  00 00 00 00 00 00 00 93  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000170  72 33 5f 38 2e 67 7a 01  00 00 00 00 00 00 01 60  |r3_8.gz........`|</span><br><span class="line">00000180  00 00 00 00 00 00 00 94  0e 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000190  72 33 5f 39 2e 67 7a 01  00 00 00 00 00 00 01 80  |r3_9.gz.........|</span><br><span class="line">000001a0  00 00 00 00 00 00 00 95  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000001b0  72 33 5f 31 30 2e 67 7a  01 00 00 00 00 00 01 a0  |r3_10.gz........|</span><br><span class="line">000001c0  00 00 00 00 00 00 00 96  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000001d0  72 33 5f 31 31 2e 67 7a  01 00 00 00 00 00 01 c0  |r3_11.gz........|</span><br><span class="line">000001e0  00 00 00 00 00 00 00 97  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000001f0  72 33 5f 31 32 2e 67 7a  01 00 00 00 00 00 01 e0  |r3_12.gz........|</span><br><span class="line">00000200  00 00 00 00 00 00 00 98  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000210  72 33 5f 31 33 2e 67 7a  01 00 00 00 00 00 02 00  |r3_13.gz........|</span><br><span class="line">00000220  00 00 00 00 00 00 00 99  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000230  72 33 5f 31 34 2e 67 7a  01 00 00 00 00 00 02 20  |r3_14.gz....... |</span><br><span class="line">00000240  00 00 00 00 00 00 00 9a  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000250  72 33 5f 31 35 2e 67 7a  01 00 00 00 00 00 02 40  |r3_15.gz.......@|</span><br><span class="line">00000260  00 00 00 00 00 00 00 9b  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000270  72 33 5f 31 36 2e 67 7a  01 00 00 00 00 00 02 60  |r3_16.gz.......`|</span><br><span class="line">00000280  00 00 00 00 00 00 00 9c  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000290  72 33 5f 31 37 2e 67 7a  01 00 00 00 00 00 02 80  |r3_17.gz........|</span><br><span class="line">000002a0  00 00 00 00 00 00 00 9d  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000002b0  72 33 5f 31 38 2e 67 7a  01 00 00 00 00 00 02 a0  |r3_18.gz........|</span><br><span class="line">000002c0  00 00 00 00 00 00 00 9e  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000002d0  72 33 5f 31 39 2e 67 7a  01 00 00 00 00 00 02 c0  |r3_19.gz........|</span><br><span class="line">000002e0  00 00 00 00 00 00 00 9f  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000002f0  72 33 5f 32 30 2e 67 7a  01 00 00 00 00 00 02 e0  |r3_20.gz........|</span><br><span class="line">00000300  00 00 00 00 00 00 00 a0  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000310  72 33 5f 32 31 2e 67 7a  01 00 00 00 00 00 03 00  |r3_21.gz........|</span><br><span class="line">00000320  00 00 00 00 00 00 00 a1  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000330  72 33 5f 32 32 2e 67 7a  01 00 00 00 00 00 03 20  |r3_22.gz....... |</span><br><span class="line">00000340  00 00 00 00 00 00 00 a2  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000350  72 33 5f 32 33 2e 67 7a  01 00 00 00 00 00 03 40  |r3_23.gz.......@|</span><br><span class="line">00000360  00 00 00 00 00 00 00 a3  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000370  72 33 5f 32 34 2e 67 7a  01 00 00 00 00 00 03 60  |r3_24.gz.......`|</span><br><span class="line">00000380  00 00 00 00 00 00 00 a4  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000390  72 33 5f 32 35 2e 67 7a  01 00 00 00 00 00 03 80  |r3_25.gz........|</span><br><span class="line">000003a0  00 00 00 00 00 00 00 a5  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000003b0  72 33 5f 32 36 2e 67 7a  01 00 00 00 00 00 03 a0  |r3_26.gz........|</span><br><span class="line">000003c0  00 00 00 00 00 00 00 a6  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000003d0  72 33 5f 32 37 2e 67 7a  01 00 00 00 00 00 03 c0  |r3_27.gz........|</span><br><span class="line">000003e0  00 00 00 00 00 00 00 a7  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000003f0  72 33 5f 32 38 2e 67 7a  01 00 00 00 00 00 03 e0  |r3_28.gz........|</span><br><span class="line">00000400  00 00 00 00 00 00 00 a8  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000410  72 33 5f 32 39 2e 67 7a  01 00 00 00 00 00 04 00  |r3_29.gz........|</span><br><span class="line">00000420  00 00 00 00 00 00 00 a9  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000430  72 33 5f 33 30 2e 67 7a  01 00 00 00 00 00 04 20  |r3_30.gz....... |</span><br><span class="line">00000440  00 00 00 00 00 00 00 aa  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000450  72 33 5f 33 31 2e 67 7a  01 00 00 00 00 00 04 40  |r3_31.gz.......@|</span><br><span class="line">00000460  00 00 00 00 00 00 00 ab  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000470  72 33 5f 33 32 2e 67 7a  01 00 00 00 00 00 04 60  |r3_32.gz.......`|</span><br><span class="line">00000480  00 00 00 00 00 00 00 ac  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000490  72 33 5f 33 33 2e 67 7a  01 00 00 00 00 00 04 80  |r3_33.gz........|</span><br><span class="line">000004a0  00 00 00 00 00 00 00 ad  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000004b0  72 33 5f 33 34 2e 67 7a  01 00 00 00 00 00 04 a0  |r3_34.gz........|</span><br><span class="line">000004c0  00 00 00 00 00 00 00 ae  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000004d0  72 33 5f 33 35 2e 67 7a  01 00 00 00 00 00 04 c0  |r3_35.gz........|</span><br><span class="line">000004e0  00 00 00 00 00 00 00 af  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">000004f0  72 33 5f 33 36 2e 67 7a  01 00 00 00 00 00 04 e0  |r3_36.gz........|</span><br><span class="line">00000500  00 00 00 00 00 00 00 b0  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">00000510  72 33 5f 33 37 2e 67 7a  01 00 00 00 00 00 05 00  |r3_37.gz........|</span><br><span class="line">00000520  00 00 00 00 00 00 00 b1  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">begin-&gt;|inode=177=0xb1 of dir3_38| |  |------name--------|</span><br><span class="line">                               name len</span><br><span class="line">00000530  72 33 5f 33 38 2e 67 7a  01 00 00 00 00 00 05 20  |r3_38.gz....... |</span><br><span class="line">xfs_db&gt; hash test_dir3_38.gz        |        |         |   </span><br><span class="line">0x71d1eb20                          |        |         |</span><br><span class="line">                               type--        |         |</span><br><span class="line">                                            Padding    |</span><br><span class="line">begin-&gt; |-inode=178=0xb2 of dir3_39-|                  ----byte offset of this directory entry (0x0520)</span><br><span class="line">00000540  00 00 00 00 00 00 00 b2  0f 74 65 73 74 5f 64 69  |.........test_di|</span><br><span class="line">                                    |</span><br><span class="line">                            file name length=15=0xf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure Connection Failed</span><br><span class="line"></span><br><span class="line">An error occurred during a connection to righteousit.wordpress.com. PR_END_OF_FILE_ERROR</span><br><span class="line"></span><br><span class="line">    The page you are trying to view cannot be shown because the authenticity of the received data could not be verified.</span><br><span class="line">    Please contact the web site owners to inform them of this problem.</span><br><span class="line"></span><br><span class="line">Learn more…</span><br><span class="line">00000550  72 33 5f 33 39 2e 67 7a  01 00 00 00 00 00 05 40  |r3_39.gz.......@|</span><br><span class="line">00000560  ff ff 09 48 00 00 00 00  00 00 00 00 00 00 00 00  |...H............|</span><br><span class="line">                    |</span><br><span class="line">                    |</span><br><span class="line">--------I guess it &#x27;s the last 8 bytes, but I &#x27;m not found the directory entries, only 40 files, not the 0xffff0948</span><br><span class="line"></span><br><span class="line">The last 8 bytes of the directory block are a “tail record” containing two 4 byte values: </span><br><span class="line">the number of directory entries (here is the 0xffff0948) and the number of unused entries (zero) </span><br><span class="line"></span><br><span class="line">Immediately preceding the tail record will be an array of 8 byte records, one record per directory entry (52 records in this case). </span><br><span class="line">Each record contains a hash value computed from the file name, and the offset in the directory block where the directory entry for that file is located. The array is sorted by hash value so that binary search can quickly find the desired record. The offsets are in 8 byte units.</span><br><span class="line"></span><br><span class="line">00000570  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000600</span><br><span class="line"></span><br><span class="line">##inode 177</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 177 agino&quot;</span><br><span class="line">0xb1 (177)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 177 agno&quot;</span><br><span class="line">0x0 (0)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 177 agblock&quot;</span><br><span class="line">0x16 (22)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 177 offset&quot;</span><br><span class="line">0x1 (1)</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 22)) count=1 2&gt; /dev/null | dd bs=512 skip=1 count=1 2&gt;/dev/null | hexdump -C</span><br><span class="line"></span><br><span class="line">00000000  49 4e 81 a4 03 02 00 00  00 00 00 00 00 00 00 00  |IN..............|</span><br><span class="line">00000010  00 00 00 01 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000020  62 ce 62 bb 21 3b 4b ef  62 cd 3e 6a 3a 9c fb fc  |b.b.!;K.b.&gt;j:...|</span><br><span class="line">00000030  62 cd 3e 6a 3a 9c fb fc  00 00 00 00 00 10 00 b2  |b.&gt;j:...........|</span><br><span class="line">00000040  00 00 00 00 00 00 01 01  00 00 00 00 00 00 00 01  |................|</span><br><span class="line">00000050  00 00 00 02 00 00 00 00  00 00 00 00 6a 13 b1 5a  |............j..Z|</span><br><span class="line">00000060  ff ff ff ff b3 ce 51 08  00 00 00 00 00 00 00 06  |......Q.........|</span><br><span class="line">00000070  00 00 00 01 00 00 00 d7  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000090  62 cd 3e 6a 38 b4 b4 a4  00 00 00 00 00 00 00 b1  |b.&gt;j8...........|</span><br><span class="line">000000a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000000b0  00 00 00 00 00 00 00 00  00 00 00 13 44 a0 01 01  |............D...|</span><br><span class="line">                                                    </span><br><span class="line">000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000200</span><br><span class="line"></span><br><span class="line">000000b0  00 00 00 00 00 00 00 00  00 00 00 13 44 a0 01 01  |............D...|</span><br><span class="line"> 0x1344a00101=0001001101000100101000000000000100000001</span><br><span class="line"> 000,1001;1011;0010;0110; 0;0000;0000;0001;0000;0001 --&gt; 100000001 = 257</span><br><span class="line"> 000;1001;1010;0010;0101; 0;0000;0000;0001;0000;0001</span><br><span class="line">                                                1001101100100110=39718</span><br><span class="line">                                   dd if=/dev/loop20 bs=4096 skip=$((0*103680+39461)) count=257 2&gt;/dev/null | hexdump -C | head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@homerl:/home/homerl/Downloads/xfs/xfsinfo# dd if=/dev/loop20 bs=4096  skip=$((0*103680+39461)) count=257 2&gt;/dev/null | hexdump -C | head</span><br><span class="line">00000000  1f 8b 08 00 00 00 00 00  00 03 00 05 80 fa 7f 23  |...............#|</span><br><span class="line">00000010  fd de f3 c8 2c 15 ec 91  98 9d 68 e7 a0 2a f3 5d  |....,.....h..*.]|</span><br><span class="line">00000020  b8 f3 18 c4 e2 28 6c c6  fe 03 36 e4 7d 67 84 2e  |.....(l...6.&#125;g..|</span><br><span class="line">00000030  0d 77 90 de e3 2a e0 7f  f7 1d ec 96 f8 6c 0c e8  |.w...*.......l..|</span><br><span class="line">00000040  aa 7b 3f 45 2f 45 f1 5e  90 1e 29 8b 39 91 91 ec  |.&#123;?E/E.^..).9...|</span><br><span class="line">00000050  d8 d3 48 79 ec a4 db d4  74 d8 55 37 dd 81 57 92  |..Hy....t.U7..W.|</span><br><span class="line">00000060  96 86 b2 fc 64 24 ee bf  18 b2 25 ba e0 eb 48 26  |....d$....%...H&amp;|</span><br><span class="line">00000070  f0 0d 4b 56 eb 49 67 4c  70 48 c0 d7 18 47 e6 b8  |..KV.IgLpH...G..|</span><br><span class="line">00000080  1e d5 95 ab f5 61 6b fe  00 06 08 06 31 29 c3 0d  |.....ak.....1)..|</span><br><span class="line">00000090  32 c0 ff 63 80 f1 09 1c  1e 92 66 9e 28 80 4a 94  |2..c......f.(.J.|</span><br><span class="line">$ cp /mnt/test_dir3/test_dir3_38.gz ./</span><br><span class="line">$ dd if=/dev/loop20 bs=4096 of=test.gz skip=$((0*103680+39461)) count=257 2&gt;/dev/null</span><br><span class="line">$ ls</span><br><span class="line">test_dir3_38.gz  test.gz</span><br><span class="line">$ md5sum test_dir3_38.gz test.gz</span><br><span class="line">c21b7c488fc90f20e4e582d363a91512  test_dir3_38.gz</span><br><span class="line">102ba8e07a5945d75b9bab81e3858a6c  test.gz</span><br><span class="line">$ gzip -d test_dir3_38.gz</span><br><span class="line">$ gzip -d test.gz</span><br><span class="line">$ ls</span><br><span class="line">test  test_dir3_38</span><br><span class="line">$ md5sum test test_dir3_38</span><br><span class="line">a1ed9882061fc7e9fe8ba9793c475913  test</span><br><span class="line">a1ed9882061fc7e9fe8ba9793c475913  test_dir3_38</span><br><span class="line"></span><br><span class="line">here is the 03 02 type, next is the b+ tree</span><br><span class="line"></span><br><span class="line">--------------create test_dir4</span><br><span class="line">$ ls -li /mnt/</span><br><span class="line">total 260</span><br><span class="line">    179 drwxr-xr-x 149 root root   8192 Jul 21 21:23 etc</span><br><span class="line">    131 drwxr-xr-x   2 root root    138 Jul 10 13:42 test_dir1</span><br><span class="line">1048704 drwxr-xr-x   2 root root   4096 Aug  1 12:24 test_dir2</span><br><span class="line">    138 drwxr-xr-x   2 root root   4096 Jul 12 17:27 test_dir3</span><br><span class="line"> 321910 drwxr-xr-x   2 root root 163840 Aug  1 12:28 test_dir4</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 321910 agino&quot;</span><br><span class="line">0x4e976 (321910)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 321910 agno&quot;</span><br><span class="line">0x0 (0)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 321910 agblock&quot;</span><br><span class="line">0x9d2e (40238)</span><br><span class="line">$ xfs_db -r /dev/loop20 -c &quot;convert inode 321910 offset&quot;</span><br><span class="line">0x6 (6)</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 40238)) count=1 2&gt; /dev/null | dd bs=512 skip=6 count=1 2&gt;/dev/null | hexdump -C</span><br><span class="line">00000000  49 4e 41 ed 03 03 00 00  00 00 00 00 00 00 00 00  |INA.............|</span><br><span class="line">                    |-btree-|</span><br><span class="line">00000010  00 00 00 02 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000020  62 e7 56 8f 3b 47 f3 23  62 e7 56 85 25 99 2b b6  |b.V.;G.#b.V.%.+.|</span><br><span class="line">00000030  62 e7 56 85 25 99 2b b6  00 00 00 00 00 02 80 00  |b.V.%.+.........|</span><br><span class="line">00000040  00 00 00 00 00 00 00 3b  00 00 00 00 00 00 00 26  |.......;.......&amp;|</span><br><span class="line">                                              |--The number of extents (bytes 76-79)--| == 0x26 = 38</span><br><span class="line"></span><br><span class="line">00000050  00 00 00 02 00 00 00 00  00 00 00 00 3c af 72 a8  |............&lt;.r.|</span><br><span class="line">00000060  ff ff ff ff f2 78 6d 68  00 00 00 00 00 00 13 91  |.....xmh........|</span><br><span class="line">00000070  00 00 00 01 00 00 30 08  00 00 00 00 00 00 00 00  |......0.........|</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000090  62 e7 54 f1 33 11 00 ea  00 00 00 00 00 04 e9 76  |b.T.3..........v|</span><br><span class="line">000000a0  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">000000b0  00 01 00 01 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">The root of the B+Tree starts at byte offset 176 (0x0B0)</span><br><span class="line">right after the inode core</span><br><span class="line">The first two bytes are the level of this node in the tree</span><br><span class="line">The value 1 indicates that this is an interior node in the tree rather than a leaf node. </span><br><span class="line">The next two bytes are the number of entries in the arrays which track the nodes below us in the tree</span><br><span class="line">there is only one node and one array entry. Four padding bytes are used to maintain 64-bit alignment.</span><br><span class="line"></span><br><span class="line">000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000150  00 00 00 00 00 00 00 00  00 00 ab 2a 00 00 00 00  |...........*....|</span><br><span class="line">                             |--???-I&#x27;m not sure 0xab2a--| 43818</span><br><span class="line">                                                 000;0,0000,1010,1011,0010,1010</span><br><span class="line">                                              relative block 43818 in AG 0-----------------------</span><br><span class="line">                                                                                                |</span><br><span class="line">00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|                  |</span><br><span class="line">*                                                                                               |</span><br><span class="line">00000200                                                                                        |</span><br><span class="line">                                                                                                |</span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 43818)) count=2 2&gt; /dev/null | hexdump -C -------|</span><br><span class="line">                                                           |</span><br><span class="line">                                                           --- just try to get 2 pages, no any envidence</span><br><span class="line">tracks the extents starting from the start of the file (logical offset zero)</span><br><span class="line"></span><br><span class="line">00000000  42 4d 41 33 00 00 00 26  ff ff ff ff ff ff ff ff  |BMA3...&amp;........|</span><br><span class="line">0-3     Magic number                        BMA3</span><br><span class="line">4-5     Level in tree                       0 (leaf node)  </span><br><span class="line">This node is at level zero in the tree, which means it’s a leaf node containing data</span><br><span class="line"></span><br><span class="line">6-7     Number of extents                   0x26=38</span><br><span class="line">In this case the data is extent structures, and there are 38 of them following the header</span><br><span class="line"></span><br><span class="line">8-15    Left sibling pointer                -1 (NULL)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00000010  ff ff ff ff ff ff ff ff  00 00 00 00 00 05 59 50  |..............YP|</span><br><span class="line">16-23   Right sibling pointer               -1 (NULL)</span><br><span class="line">24-31   Sector offset of this block         0x055950 = 350544</span><br><span class="line"></span><br><span class="line">00000020  00 00 00 01 00 00 27 82  70 46 3d e0 05 01 40 81  |......&#x27;.pF=...@.|</span><br><span class="line">32-39   LSN of last update      0x 01 00 00 27 82            </span><br><span class="line"></span><br><span class="line">00000030  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 04 e9 76  |.$..q..........v|</span><br><span class="line">40-55   UUID                                70 46 3d e0 05 01 40 81 9e 24 f0 e8 71 91 88 84</span><br><span class="line">56-63   Inode owner of this block           0x04e976 = 321910 ---------------000;0 ,0100,1110,1001,0111,0110</span><br><span class="line"></span><br><span class="line">xfs_db&gt; inode 321910</span><br><span class="line">xfs_db&gt; addr u3.bmbt.ptrs[1]</span><br><span class="line">xfs_db&gt; p</span><br><span class="line"></span><br><span class="line">magic = 0x424d4133</span><br><span class="line">level = 0</span><br><span class="line">numrecs = 38</span><br><span class="line">leftsib = null</span><br><span class="line">rightsib = null</span><br><span class="line">bno = 350544</span><br><span class="line">lsn = 0x100002782</span><br><span class="line">uuid = 70463de0-0501-4081-9e24-f0e871918884</span><br><span class="line">owner = 321910</span><br><span class="line">crc = 0x934cfa70 (correct)</span><br><span class="line">recs[1-38] = [startoff,startblock,blockcount,extentflag] </span><br><span class="line">startoff:   索引文件逻辑起始块偏移量</span><br><span class="line">startblock: 文件逻辑偏移量对应的磁盘物理起始块</span><br><span class="line">blockcount:  连续块个数</span><br><span class="line">extentflag: extent标志</span><br><span class="line"></span><br><span class="line">1:[0,41554,1,0] </span><br><span class="line">2:[1,41556,3,0] </span><br><span class="line">3:[4,41626,2,0]  # the full page only 4096 by hexdump, blockcount means consecutive ???</span><br><span class="line">dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 41554)) count=1 2&gt; /dev/null | hexdump -C | less</span><br><span class="line">dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 41556)) count=1 2&gt; /dev/null | hexdump -C | less</span><br><span class="line">dd if=/dev/loop20 bs=4096 skip=$((0*103680 + 41626)) count=1 2&gt; /dev/null | hexdump -C | less</span><br><span class="line"></span><br><span class="line">4:[6,41629,3,0] </span><br><span class="line">5:[9,41712,1,0] </span><br><span class="line">6:[10,41714,2,0] </span><br><span class="line">7:[12,41717,2,0] </span><br><span class="line">8:[14,41800,2,0] </span><br><span class="line">9:[16,43728,1,0] </span><br><span class="line">10:[17,43730,2,0] </span><br><span class="line">11:[19,43733,3,0] </span><br><span class="line">12:[22,43817,1,0] </span><br><span class="line">13:[23,43819,1,0] </span><br><span class="line">14:[24,43821,2,0] </span><br><span class="line">15:[26,43904,3,0] </span><br><span class="line">16:[29,43908,2,0] </span><br><span class="line">17:[31,43911,1,0] </span><br><span class="line">18:[32,44000,2,0] </span><br><span class="line">19:[34,44003,2,0] </span><br><span class="line">20:[36,44006,2,0] </span><br><span class="line">21:[38,44097,2,0] </span><br><span class="line">22:[8388608,41555,1,0] </span><br><span class="line">The hash lookup table for this directory is contained in the fifteen blocks starting at logical file offset 8388608. Because the hash lookup table spans multiple blocks, it is also formatted as a B+Tree. The initial block at logical offset 8388608 should be the root of this tree. This block is shown below.</span><br><span class="line"></span><br><span class="line">$ dd if=/dev/loop20 bs=4096 skip=$((0 + 41555)) count=1 2&gt; /dev/null | hexdump -C | less</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  3e be 00 00 0d f2 d3 bd  |........&gt;.......|</span><br><span class="line">0-3      &quot;Forward&quot; pointer                  0</span><br><span class="line">4-7      &quot;Back&quot; pointer                     0</span><br><span class="line">8-9      Magic number                       0x3ebe</span><br><span class="line">10-11    Padding for alignment              zeroed</span><br><span class="line">12-15    CRC32 checksum                     0x0df2d3bd</span><br><span class="line"></span><br><span class="line">00000010  00 00 00 00 00 05 12 98  00 00 00 01 00 00 2e ea  |................|</span><br><span class="line">16-23    Sector offset of this block        0x051298 = 332440</span><br><span class="line">24-31    LSN of last update                 0x0100002eea</span><br><span class="line"></span><br><span class="line">00000020  70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84  |pF=...@..$..q...|</span><br><span class="line">32-47    UUID                               70 46 3d e0 05 01 40 81  9e 24 f0 e8 71 91 88 84</span><br><span class="line"></span><br><span class="line">00000030  00 00 00 00 00 04 e9 76  00 10 00 01 00 00 00 00  |.......v........|</span><br><span class="line">48-55    Parent inode                       0x04e976</span><br><span class="line">56-57    Number of array entries            16</span><br><span class="line">58-59    Level in tree                      01</span><br><span class="line">59-63    Padding for alignment              zeroed</span><br><span class="line"></span><br><span class="line">We confirm this is an interior node of a B+Tree by looking at the “Level in tree” value at bytes 58-59- interior nodes have non-zero values here. </span><br><span class="line">The &#x27;forward&#x27; and &#x27;back&#x27; pointers being zeroed mean there are no other nodes at this level, so we’re sitting at the root of the tree.</span><br><span class="line"></span><br><span class="line">The 16(Number of array entries) other blocks that hold the directory entries are tracked by an array here in the root block. Bytes 56-57 track the size of the array, and the array itself starts at byte 64 (0x40)</span><br><span class="line">Each array entry contains a four byte hash value and a four byte logical block offset. The hash value in each array entry is the largest hash value in the given block</span><br><span class="line"></span><br><span class="line">xfs_db -r /dev/loop20</span><br><span class="line">xfs_db&gt; fsblock 41555</span><br><span class="line">xfs_db&gt; type dir3</span><br><span class="line">xfs_db&gt; p</span><br><span class="line">nhdr.info.hdr.forw = 0</span><br><span class="line">nhdr.info.hdr.back = 0</span><br><span class="line">nhdr.info.hdr.magic = 0x3ebe</span><br><span class="line">nhdr.info.crc = 0xdf2d3bd (correct)</span><br><span class="line">nhdr.info.bno = 332440</span><br><span class="line">nhdr.info.lsn = 0x100002eea</span><br><span class="line">nhdr.info.uuid = 70463de0-0501-4081-9e24-f0e871918884</span><br><span class="line">nhdr.info.owner = 321910</span><br><span class="line">nhdr.count = 16</span><br><span class="line">nhdr.level = 1</span><br><span class="line">nbtree[0-15] = [hashval,before] </span><br><span class="line">0:[0x4502b2bb,8388610] -----8388610=0x800002</span><br><span class="line">1:[0x450370b1,8388609]     |</span><br><span class="line">2:[0x4503f333,8388611]     |</span><br><span class="line">3:[0x81189895,8388612]     |</span><br><span class="line">4:[0x81195a97,8388614]     |</span><br><span class="line">5:[0x811b181b,8388613]     |</span><br><span class="line">6:[0x81581b11,8388615]     |</span><br><span class="line">7:[0x81591b11,8388620]     |</span><br><span class="line">8:[0x8159d893,8388619]     |</span><br><span class="line">9:[0x81781b11,8388621]     |</span><br><span class="line">10:[0x81791b11,8388617]    |</span><br><span class="line">11:[0x8179d893,8388616]    |</span><br><span class="line">12:[0x817b5b15,8388618]    |</span><br><span class="line">13:[0x81b89897,8388622]    |</span><br><span class="line">14:[0x81b95a97,8388624]    |</span><br><span class="line">15:[0xecdab05f,8388623]    |</span><br><span class="line">                           |</span><br><span class="line">                           |</span><br><span class="line">00000040  45 02 b2 bb 00 80 00 02  45 03 70 b1 00 80 00 01  |E.......E.p.....|</span><br><span class="line">              |             |        --------------|</span><br><span class="line">          | hash     | logic block offset|</span><br><span class="line">00000050  45 03 f3 33 00 80 00 03  81 18 98 95 00 80 00 04  |E..3............|</span><br><span class="line">00000060  81 19 5a 97 00 80 00 06  81 1b 18 1b 00 80 00 05  |..Z.............|</span><br><span class="line">00000070  81 58 1b 11 00 80 00 07  81 59 1b 11 00 80 00 0c  |.X.......Y......|</span><br><span class="line">00000080  81 59 d8 93 00 80 00 0b  81 78 1b 11 00 80 00 0d  |.Y.......x......|</span><br><span class="line">00000090  81 79 1b 11 00 80 00 09  81 79 d8 93 00 80 00 08  |.y.......y......|</span><br><span class="line">000000a0  81 7b 5b 15 00 80 00 0a  81 b8 98 97 00 80 00 0e  |.&#123;[.............|</span><br><span class="line">000000b0  81 b9 5a 97 00 80 00 10  ec da b0 5f 00 80 00 0f  |..Z........_....|</span><br><span class="line"></span><br><span class="line">000000c0  06 8a 00 e4 00 00 01 42  06 8a 00 e5 00 00 01 46  |.......B.......F|</span><br><span class="line">000000d0  06 8a 00 e6 00 00 01 4a  06 8a 00 e7 00 00 01 4e  |.......J.......N|</span><br><span class="line">000000e0  06 8a 00 ec 00 00 01 62  06 8a 00 ed 00 00 01 66  |.......b.......f|</span><br><span class="line">000000f0  06 8a 04 60 00 00 00 3a  06 8a 04 61 00 00 00 3e  |...`...:...a...&gt;|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">23:[8388609,41624,2,0] </span><br><span class="line">24:[8388611,41628,1,0] </span><br><span class="line">25:[8388612,41713,1,0] </span><br><span class="line">26:[8388613,41716,1,0] </span><br><span class="line">27:[8388614,41719,1,0] </span><br><span class="line">28:[8388615,43729,1,0] </span><br><span class="line">29:[8388616,43732,1,0] </span><br><span class="line">30:[8388617,43816,1,0] </span><br><span class="line">31:[8388618,43820,1,0] </span><br><span class="line">32:[8388619,43823,1,0] </span><br><span class="line">33:[8388620,43907,1,0] </span><br><span class="line">34:[8388621,43910,1,0] </span><br><span class="line">35:[8388622,44002,1,0] </span><br><span class="line">36:[8388623,44005,1,0] </span><br><span class="line">37:[8388624,44096,1,0] </span><br><span class="line">38:[16777216,41559,1,0]</span><br><span class="line">               |</span><br><span class="line">               --------------------------</span><br><span class="line">                                        |</span><br><span class="line">dd if=/dev/loop20 bs=4096 skip=$((0 + 41559)) count=1 2&gt; /dev/null | hexdump -C</span><br><span class="line"></span><br><span class="line">00000000  58 44 46 33 0d 45 b5 52  00 00 00 00 00 05 12 b8  |XDF3.E.R........|</span><br><span class="line">0-3      Magic number                       XDF3</span><br><span class="line">4-7      CRC32 checksum                     0x0d45b552</span><br><span class="line">8-15     Sector offset of this block        0x0512b8 = 332472</span><br><span class="line">00000010  00 00 00 01 00 00 2f fb  70 46 3d e0 05 01 40 81  |....../.pF=...@.|</span><br><span class="line">16-23    Last LSN update                    0x0100002ffb</span><br><span class="line">00000020  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 04 e9 76  |.$..q..........v|</span><br><span class="line">24-39    UUID                               70 46 3d e0 05 01 40 81 9e 24 f0 e8 71 91 88 84</span><br><span class="line">40-47    Inode that points to this block    0x04e976 = 321910</span><br><span class="line">00000030  00 00 00 00 00 00 00 28  00 00 00 28 00 00 00 00  |.......(...(....|</span><br><span class="line">48-51    Starting block offset              0</span><br><span class="line">52-55    Size of array                      0x28=40</span><br><span class="line">56-59    Array entries used                 0x28=40</span><br><span class="line">60-63    Padding for 64-bit alignment       zeroed</span><br><span class="line"></span><br><span class="line">00000040  00 10 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 05 08  |................|</span><br><span class="line">The last two fields describe an array whose elements correspond to the blocks in the hash lookup table for this directory. The array itself follows immediately after the header as shown above. Each element of the array is a two-byte number representing the largest chunk of free space available in each block. In our example, all of the blocks are full (zero free bytes) except for the last block which has at least a 0x0508 = 1288 byte chunk available.</span><br><span class="line"></span><br><span class="line">00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting at logical offset zero, we have extents 1-21 containing the first 35 blocks of the directory file. This is where the directory entries live</span><br><span class="line">Extents 22-37 starting at logical offset 8388608 (XFS_DIR2_LEAF_OFFSET) contain the hash lookup table for finding directory entries</span><br><span class="line">Because the hash lookup table is large enough to require multiple blocks, the &#x27;tail record&#x27; for the directory moves into its own block tracked by the final extent (extent 38 in our example above).  The logical offset for the tail record is 2*XFS_DIR2_LEAF_OFFSET or 16777216</span><br><span class="line"></span><br><span class="line">00000040  93 4c fa 70 00 00 00 00  00 00 00 00 00 00 00 00  |.L.p............|</span><br><span class="line">                                |</span><br><span class="line">64-67   CRC32 of this block     |           0x934cfa70</span><br><span class="line">68-71   Padding for 64-bit alignment        zeroed</span><br><span class="line"></span><br><span class="line">00000050  00 00 00 14 4a 40 00 01  00 00 00 00 00 00 02 00  |....J@..........|</span><br><span class="line">00000060  00 00 00 14 4a 80 00 03  00 00 00 00 00 00 08 00  |....J...........|</span><br><span class="line">00000070  00 00 00 14 53 40 00 02  00 00 00 00 00 00 0c 00  |....S@..........|</span><br><span class="line">00000080  00 00 00 14 53 a0 00 03  00 00 00 00 00 00 12 00  |....S...........|</span><br><span class="line">00000090  00 00 00 14 5e 00 00 01  00 00 00 00 00 00 14 00  |....^...........|</span><br><span class="line">000000a0  00 00 00 14 5e 40 00 02  00 00 00 00 00 00 18 00  |....^@..........|</span><br><span class="line">000000b0  00 00 00 14 5e a0 00 02  00 00 00 00 00 00 1c 00  |....^...........|</span><br><span class="line">000000c0  00 00 00 14 69 00 00 02  00 00 00 00 00 00 20 00  |....i......... .|</span><br><span class="line">000000d0  00 00 00 15 5a 00 00 01  00 00 00 00 00 00 22 00  |....Z.........&quot;.|</span><br><span class="line">000000e0  00 00 00 15 5a 40 00 02  00 00 00 00 00 00 26 00  |....Z@........&amp;.|</span><br><span class="line">000000f0  00 00 00 15 5a a0 00 03  00 00 00 00 00 00 2c 00  |....Z.........,.|</span><br><span class="line">....</span><br><span class="line">00000250  00 00 00 15 70 60 00 01  00 00 00 01 00 00 1a 00  |....p`..........|</span><br><span class="line">00000260  00 00 00 15 70 c0 00 01  00 00 00 01 00 00 1c 00  |....p...........|</span><br><span class="line">00000270  00 00 00 15 7c 40 00 01  00 00 00 01 00 00 1e 00  |....|@..........|</span><br><span class="line">00000280  00 00 00 15 7c a0 00 01  00 00 00 01 00 00 20 00  |....|......... .|</span><br><span class="line">00000290  00 00 00 15 88 00 00 01  00 00 00 02 00 00 00 00  |................|</span><br><span class="line">000002a0  00 00 00 14 4a e0 00 01  00 00 00 00 00 00 00 00  |....J...........|</span><br><span class="line">000002b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000  58 44 44 33 12 71 02 8f  00 00 00 00 00 05 59 58  |XDD3.q........YX|</span><br><span class="line">00001010  00 00 00 01 00 00 1d 82  70 46 3d e0 05 01 40 81  |........pF=...@.|</span><br><span class="line">00001020  9e 24 f0 e8 71 91 88 84  00 00 00 00 00 04 e9 76  |.$..q..........v|</span><br><span class="line">                                                   |</span><br><span class="line">                                                   ---printf &quot;%d\n&quot; 0x04e976=321910</span><br><span class="line">$ ls -li /mnt/                                                                 |</span><br><span class="line">total 260                                                                      |</span><br><span class="line">    179 drwxr-xr-x 149 root root   8192 Jul 21 21:23 etc                       |</span><br><span class="line">    131 drwxr-xr-x   2 root root    138 Jul 10 13:42 test_dir1                 |</span><br><span class="line">1048704 drwxr-xr-x   2 root root   4096 Aug  1 12:24 test_dir2                 |</span><br><span class="line">    138 drwxr-xr-x   2 root root   4096 Jul 12 17:27 test_dir3                 |</span><br><span class="line"> 321910 drwxr-xr-x   2 root root 163840 Aug  1 12:28 test_dir4 -----------------</span><br><span class="line"></span><br><span class="line">00001030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00001040  00 00 00 00 00 05 5a 4a  0f 72 61 6e 64 5f 66 69  |......ZJ.rand_fi|</span><br><span class="line">00001050  6c 65 73 2e 32 38 39 39  01 00 00 00 00 00 00 40  |les.2899.......@|</span><br><span class="line">00001060  00 00 00 00 00 05 5a 4b  0f 72 61 6e 64 5f 66 69  |......ZK.rand_fi|</span><br><span class="line">00001070  6c 65 73 2e 32 39 30 30  01 00 00 00 00 00 00 60  |les.2900.......`|</span><br><span class="line">00001080  00 00 00 00 00 05 5a 4c  0f 72 61 6e 64 5f 66 69  |......ZL.rand_fi|</span><br><span class="line">00001090  6c 65 73 2e 32 39 30 31  01 00 00 00 00 00 00 80  |les.2901........|</span><br><span class="line">000010a0  00 00 00 00 00 05 5a 4d  0f 72 61 6e 64 5f 66 69  |......ZM.rand_fi|</span><br><span class="line">000010b0  6c 65 73 2e 32 39 30 32  01 00 00 00 00 00 00 a0  |les.2902........|</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#format"><span class="toc-number">1.</span> <span class="toc-text">format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grow"><span class="toc-number">2.</span> <span class="toc-text">Grow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Suspend-file-system"><span class="toc-number">3.</span> <span class="toc-text">Suspend file system</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Quota"><span class="toc-number">4.</span> <span class="toc-text">Quota</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Backup-and-restore"><span class="toc-number">5.</span> <span class="toc-text">Backup and restore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compare-with-ext4"><span class="toc-number">6.</span> <span class="toc-text">Compare with ext4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Defragment"><span class="toc-number">7.</span> <span class="toc-text">Defragment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xfs-admin"><span class="toc-number">8.</span> <span class="toc-text">xfs_admin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Repair"><span class="toc-number">9.</span> <span class="toc-text">Repair</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recover-file"><span class="toc-number">10.</span> <span class="toc-text">Recover file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-estimate"><span class="toc-number"></span> <span class="toc-text">xfs_estimate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-info"><span class="toc-number"></span> <span class="toc-text">xfs_info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-logprint"><span class="toc-number"></span> <span class="toc-text">xfs_logprint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#About-barriers"><span class="toc-number">1.</span> <span class="toc-text">About barriers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-file-block"><span class="toc-number"></span> <span class="toc-text">The file block</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-from-this-article"><span class="toc-number"></span> <span class="toc-text">copy from this article</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#superblock"><span class="toc-number"></span> <span class="toc-text">superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inode"><span class="toc-number"></span> <span class="toc-text">inode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#directory"><span class="toc-number"></span> <span class="toc-text">directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#re-test-xfs"><span class="toc-number"></span> <span class="toc-text">re-test xfs</span></a>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/11/26/xfs/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/11/26/xfs/&text=xfs"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/11/26/xfs/&is_video=false&description=xfs"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=xfs&body=Check out this article: http://example.com/2019/11/26/xfs/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/11/26/xfs/&title=xfs"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/11/26/xfs/&name=xfs&description=&lt;p&gt;&lt;a href=&#34;http://fibrevillage.com/storage&#34;&gt;reference&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;format&#34;&gt;&lt;a href=&#34;#format&#34; class=&#34;headerlink&#34; title=&#34;format&#34;&gt;&lt;/a&gt;format&lt;/h4&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#Warning: AG size is a multiple of stripe width. This can cause performance problems by aligning all AGs on the same disk. To avoid this, run mkfs with an AG size that is one stripe unit smaller, for example xxxxxx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# that means you can&amp;#x27;t set agcount by youself through&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;reference : https://knowledge.autodesk.com/support/flame-products/learn-explore/caas/sfdcarticles/sfdcarticles/Configuring-a-Logical-Volume-for-Flame-Media-Storage-Step-3.html&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#Raid 60  24 HDD ，12HDD/per raid6   （12-2）× 2 ， Raid stripe size 64KB&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.xfs -f -d sunit=64,swidth=$((&lt;span class=&#34;number&#34;&gt;64&lt;/span&gt;*&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;)) /dev/sdxx1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#su: Stripe unit, which is the RAID chunk size, in bytes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#sw: Multiplier of the stripe unit, i.e. number of data disks&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.xfs /dev/device&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs. xfs -d su= 64k,sw= 4 /dev/device&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;su &amp;#x3D; value&lt;br&gt;    Specifies a stripe unit or RAID chunk size. The value must be specified in bytes, with an optional k, m, or g suffix.&lt;br&gt;sw&amp;#x3D; value&lt;br&gt;    Specifies the number of data disks in a RAID device, or the number of stripe units in the stripe.&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/11/26/xfs/&t=xfs"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
