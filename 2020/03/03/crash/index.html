<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="kdump setting123456789kdump.conf  [-c|-l|-p]:      Compress dump data by each page using zlib for -c option, lzo for -l option      or snappy for -p option. A user cannot specify either of these optio">
<meta property="og:type" content="article">
<meta property="og:title" content="crash practice">
<meta property="og:url" content="http://example.com/2020/03/03/crash/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="kdump setting123456789kdump.conf  [-c|-l|-p]:      Compress dump data by each page using zlib for -c option, lzo for -l option      or snappy for -p option. A user cannot specify either of these optio">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-03T14:17:33.000Z">
<meta property="article:modified_time" content="2023-03-07T13:56:11.278Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="trace">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>crash practice</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/03/03/gdb/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2019/12/29/lfs_cmd/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/03/03/crash/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/03/03/crash/&text=crash practice"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/03/03/crash/&is_video=false&description=crash practice"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=crash practice&body=Check out this article: http://example.com/2020/03/03/crash/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/03/03/crash/&name=crash practice&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/03/03/crash/&t=crash practice"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#kdump-setting"><span class="toc-number">1.</span> <span class="toc-text">kdump setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack-order"><span class="toc-number">2.</span> <span class="toc-text">stack order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loading-kernel-module"><span class="toc-number">3.</span> <span class="toc-text">loading kernel module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><span class="toc-number">4.</span> <span class="toc-text">genarate the debuginfo script, not test when compile the linux kernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example1"><span class="toc-number">5.</span> <span class="toc-text">example1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#command"><span class="toc-number">6.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example2-dump-file-content-in-memory"><span class="toc-number">7.</span> <span class="toc-text">example2 dump file content in memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example3-memory-hacking"><span class="toc-number">8.</span> <span class="toc-text">example3 memory hacking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example4"><span class="toc-number">9.</span> <span class="toc-text">example4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example5-trace-the-sock"><span class="toc-number">10.</span> <span class="toc-text">example5 trace the sock</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        crash practice
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-03T14:17:33.000Z" itemprop="datePublished">2020-03-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Debug/">Debug</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/debug/" rel="tag">debug</a>, <a class="tag-link-link" href="/tags/trace/" rel="tag">trace</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="kdump-setting"><a href="#kdump-setting" class="headerlink" title="kdump setting"></a>kdump setting</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kdump.conf</span><br><span class="line">  [-c|-l|-p]:</span><br><span class="line">      Compress dump data by each page using zlib <span class="keyword">for</span> -c option, lzo <span class="keyword">for</span> -l option</span><br><span class="line">      or snappy <span class="keyword">for</span> -p option. A user cannot specify either of these options with</span><br><span class="line">      -E option, because the ELF format does not support compressed data.</span><br><span class="line">      THIS IS ONLY FOR THE CRASH UTILITY.</span><br><span class="line">                             -------------------lzo</span><br><span class="line">                             |</span><br><span class="line">core_collector makedumpfile -l --message-level 1 -d 31</span><br></pre></td></tr></table></figure>

<h3 id="stack-order"><a href="#stack-order" class="headerlink" title="stack order"></a><a target="_blank" rel="noopener" href="https://lore.kernel.org/lkml/6ff7bb3e-917d-121c-1972-7d9ba6139a35@linux.alibaba.com/">stack order</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; bt 323179</span><br><span class="line">PID: 323179  TASK: ffff88459638c040  CPU: 25  COMMAND: <span class="string">&quot;top&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8852a9597c70] schedule at ffffffff8154a640</span></span><br><span class="line"> <span class="comment">#1 [ffff8852a9597d48] rwsem_down_failed_common at ffffffff8154d7d5</span></span><br><span class="line"> <span class="comment">#2 [ffff8852a9597da8] rwsem_down_read_failed at ffffffff8154d966</span></span><br><span class="line"> <span class="comment">#3 [ffff8852a9597de8] call_rwsem_down_read_failed at ffffffff812a8584</span></span><br><span class="line"> <span class="comment">#4 [ffff8852a9597e50] proc_pid_cmdline_read at ffffffff81209888</span></span><br><span class="line"> <span class="comment">#5 [ffff8852a9597ef0] vfs_read at ffffffff8119a455</span></span><br><span class="line"> <span class="comment">#6 [ffff8852a9597f30] sys_read at ffffffff8119a7a1</span></span><br><span class="line"> <span class="comment">#7 [ffff8852a9597f80] system_call_fastpath at ffffffff8100b0d2</span></span><br><span class="line">    RIP: 0000003e42cdb770  RSP: 00007ffc4cb59478  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000000  RBX: ffffffff8100b0d2  RCX: 0000003e42cdb770</span><br><span class="line">    RDX: 00000000000007ff  RSI: 00007ffc4cb59480  RDI: 000000000000000a</span><br><span class="line">    RBP: 0000000000000000   R8: 0000000000000000   R9: 0000003e4340be8e</span><br><span class="line">    R10: 0000000000000000  R11: 0000000000000246  R12: 0000000000000000</span><br><span class="line">    R13: 0000000000000000  R14: 00000000015f0090  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000000  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">ffff8852a9597f80 system_call_fastpath</span><br><span class="line">  ffff8852a9597f30 sys_read</span><br><span class="line">    ffff8852a9597ef0 vfs_read</span><br><span class="line">      ffff8852a9597e50 proc_pid_cmdline_read          &lt;--------- hang       stack = (high addr) ---&gt; (lower addr)</span><br><span class="line">        ffff8852a9597de8 call_rwsem_down_read_failed  &lt;--------- after hang (lower addr)</span><br><span class="line">          ffff8852a9597da8 rwsem_down_read_failed</span><br><span class="line">            ffff8852a9597d48 rwsem_down_failed_common</span><br><span class="line">              ffff8852a9597c70 schedule</span><br></pre></td></tr></table></figure>

<h3 id="loading-kernel-module"><a href="#loading-kernel-module" class="headerlink" title="loading kernel module"></a>loading kernel module</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">$ mod -S /usr/lib/debug/lib/modules/xx.ko</span><br><span class="line"></span><br><span class="line">crash&gt; mod -s i40e /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line">     MODULE       NAME                             SIZE  OBJECT FILE</span><br><span class="line">ffffffffc03b6da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">crash&gt; mod|grep i40e</span><br><span class="line">ffffffffc03b6da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line"></span><br><span class="line">crash&gt; mod -t</span><br><span class="line">NAME         TAINTS</span><br><span class="line">i40e         OE</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /sys/module/nfsd/sections</span><br><span class="line">$ <span class="built_in">cat</span> .text .data .bss</span><br><span class="line">0xffffffffc1422000------------------------------------------------------------------------</span><br><span class="line">0xffffffffc1462000-----------------------------------------------------------------------|---------------------------</span><br><span class="line">0xffffffffc1468040-----------------------------------------------------------------------|--------------------------|-------------------------</span><br><span class="line">                                                                                         |                          |                        |</span><br><span class="line">crash&gt; add-symbol-file /lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko 0xffffffffc1422000 -s .data 0xffffffffc1462000 -s .bss 0xffffffffc1468040</span><br><span class="line"></span><br><span class="line">add symbol table from file <span class="string">&quot;/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc1422000</span><br><span class="line">        .data_addr = 0xffffffffc1462000</span><br><span class="line">        .bss_addr = 0xffffffffc1468040</span><br><span class="line">Reading symbols from /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko...Reading symbols from /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko.debug...done.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#show module info</span></span><br><span class="line">crash&gt; mod |grep -e NAME -e i40e</span><br><span class="line">     MODULE       NAME                             SIZE  OBJECT FILE</span><br><span class="line">ffffffffc0220da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line">     |</span><br><span class="line">     ------------------------------------------------</span><br><span class="line">                                                    |</span><br><span class="line">crash&gt; module.name,version,srcversion,sig_ok ffffffffc0220da0</span><br><span class="line">  name = <span class="string">&quot;i40e\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span></span><br><span class="line">  version = 0xffff8a7184389380 <span class="string">&quot;2.13.10&quot;</span></span><br><span class="line">  srcversion = 0xffff8a7183fc26a0 <span class="string">&quot;597EBD96218776AAA546464&quot;</span></span><br><span class="line">  sig_ok = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">crash&gt; module.version ffffffffc03b6da0</span><br><span class="line">  version = 0xffff986f02be7098 <span class="string">&quot;2.13.10&quot;</span></span><br><span class="line"></span><br><span class="line">[36794.588796] BUG: Bad page state <span class="keyword">in</span> process swapper/7  pfn:137bba</span><br><span class="line">[36794.589974] page:ffffcb3d44deee80 count:-1 mapcount:0 mapping:          (null) index:0x0</span><br><span class="line">[36794.591073] page flags: 0x2fffff00000000()</span><br><span class="line">[36794.592149] page dumped because: nonzero _count</span><br><span class="line">[36794.593218] Modules linked <span class="keyword">in</span>: osp(OE) ofd(OE) lfsck(OE) ost(OE) mgc(OE) osd_ldiskfs(OE) ldiskfs(OE) lquota(OE) fid(OE) fld(OE) ksocklnd(OE) ptlrpc(OE) mbcache jbd2 obdclass(OE) lnet(OE) libcfs(OE) bonding mpt2sas mptctl mptbase dell_rbu dcdbas sunrpc vfat fat iTCO_wdt iTCO_vendor_support zfs(POE) zunicode(POE) zavl(POE) icp(POE) sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr nvme nvme_core joydev zcommon(POE) znvpair(POE) spl(OE) lpc_ich mei_me mei raid0 i2c_i801 ses enclosure sg ioatdma ipmi_si ipmi_devintf ipmi_msghandler acpi_power_meter acpi_pad wmi binfmt_misc ip_tables xfs libcrc32c raid1 sd_mod crc_t10dif crct10dif_generic ast drm_kms_helper syscopyarea sysfillrect</span><br><span class="line">[36794.600275]  sysimgblt fb_sys_fops ttm drm ixgbe mpt3sas ahci igb libahci i40e(OE) raid_class mdio crct10dif_pclmul crct10dif_common libata crc32c_intel ptp drm_panel_orientation_quirks scsi_transport_sas dca i2c_algo_bit pps_core</span><br><span class="line">[36794.603927] CPU: 7 PID: 0 Comm: swapper/7 Kdump: loaded Tainted: P           OE  ------------   3.10.0-1160.2.1.el7_lustre.x86_64 <span class="comment">#1</span></span><br><span class="line">[36794.606340] Hardware name: Supermicro SSG-2028R-DE2CR24L/X10DRS-2U, BIOS 2.1 11/04/2016</span><br><span class="line">[36794.607569] Call Trace:</span><br><span class="line">[36794.608749]  &lt;IRQ&gt;  [&lt;ffffffff94f813c0&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[36794.609958]  [&lt;ffffffff94f7bf7d&gt;] bad_page.part.75+0xdc/0xf9</span><br><span class="line">[36794.611190]  [&lt;ffffffff949c8625&gt;] get_page_from_freelist+0x7a5/0xac0</span><br><span class="line">[36794.612395]  [&lt;ffffffff94e07e29&gt;] ? __domain_mapping+0x209/0x3c0</span><br><span class="line">[36794.613525]  [&lt;ffffffff949c8aa6&gt;] __alloc_pages_nodemask+0x166/0x450</span><br><span class="line">[36794.614737]  [&lt;ffffffffc0380578&gt;] i40e_alloc_rx_buffers+0x158/0x2f0 [i40e]</span><br><span class="line">[36794.615952]  [&lt;ffffffffc0380c8c&gt;] i40e_clean_rx_irq+0x57c/0xb40 [i40e]</span><br><span class="line">[36794.617189]  [&lt;ffffffffc03815a1&gt;] i40e_napi_poll+0x351/0x7a0 [i40e]</span><br><span class="line">[36794.618342]  [&lt;ffffffff94e5561f&gt;] net_rx_action+0x26f/0x390</span><br><span class="line">[36794.619425]  [&lt;ffffffff948a4b95&gt;] __do_softirq+0xf5/0x280</span><br><span class="line">[36794.620544]  [&lt;ffffffff94f974ec&gt;] call_softirq+0x1c/0x30</span><br><span class="line">[36794.621622]  [&lt;ffffffff9482f715&gt;] do_softirq+0x65/0xa0</span><br><span class="line">[36794.622749]  [&lt;ffffffff948a4f15&gt;] irq_exit+0x105/0x110</span><br><span class="line">[36794.623874]  [&lt;ffffffff94f98936&gt;] do_IRQ+0x56/0xf0</span><br><span class="line">[36794.624903]  [&lt;ffffffff94f8a36a&gt;] common_interrupt+0x16a/0x16a</span><br><span class="line">[36794.625943]  &lt;EOI&gt;  [&lt;ffffffff94f897b2&gt;] ? poll_idle+0x92/0xab</span><br><span class="line">[36794.626987]  [&lt;ffffffff94f897bc&gt;] ? poll_idle+0x9c/0xab</span><br><span class="line">[36794.628027]  [&lt;ffffffff94dc71f5&gt;] cpuidle_enter_state+0x45/0xd0</span><br><span class="line">[36794.629035]  [&lt;ffffffff94dc735e&gt;] cpuidle_idle_call+0xde/0x230</span><br><span class="line">[36794.629964]  [&lt;ffffffff94837c8e&gt;] arch_cpu_idle+0xe/0xc0</span><br><span class="line">[36794.630938]  [&lt;ffffffff949011ea&gt;] cpu_startup_entry+0x14a/0x1e0</span><br><span class="line">[36794.631895]  [&lt;ffffffff9485a7f7&gt;] start_secondary+0x1f7/0x270</span><br><span class="line">[36794.632856]  [&lt;ffffffff948000d5&gt;] start_cpu+0x5/0x14</span><br><span class="line">[36794.622749]  [&lt;ffffffff948a4f15&gt;] irq_exit+0x105/0x110</span><br></pre></td></tr></table></figure>



<h3 id="genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><a href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel" class="headerlink" title="genarate the debuginfo script, not test when compile the linux kernel"></a>genarate the debuginfo script, not test when compile the linux kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `find /lib/modules/5.10.41 -name <span class="string">&#x27;*.ko&#x27;</span> -<span class="built_in">print</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        buildid=`eu-readelf -n <span class="variable">$file</span>| grep Build.ID: | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">        <span class="built_in">dir</span>=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c1-2`</span><br><span class="line">        fn=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c3-`</span><br><span class="line">        <span class="built_in">mkdir</span> -p /usr/lib/debug/.build-id/<span class="variable">$dir</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$fn</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$&#123;fn&#125;</span>.debug</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ sudo stap -l <span class="string">&#x27;module(&quot;iwlwifi&quot;).function(&quot;*&quot;)&#x27;</span></span><br><span class="line">module(<span class="string">&quot;iwlwifi&quot;</span>).<span class="keyword">function</span>(<span class="string">&quot;__iwl_crit&quot;</span>)</span><br><span class="line">module(<span class="string">&quot;iwlwifi&quot;</span>).<span class="keyword">function</span>(<span class="string">&quot;__iwl_err&quot;</span>)</span><br><span class="line"></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe begin &#123; log(&quot;hello world&quot;) exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe begin &#123; printf(&quot;hello world\n&quot;); exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe nd_syscall.read &#123; printf(&quot;hello world\n&quot;); exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -vL <span class="string">&#x27;process(&quot;./h264ref&quot;).function(&quot;*&quot;)&#x27;</span></span><br><span class="line">$ sudo stap -v -e <span class="string">&#x27;probe vfs.read &#123;printf(“read performed\n”); exit()&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="example1"><a href="#example1" class="headerlink" title="example1"></a><a target="_blank" rel="noopener" href="https://blogs.oracle.com/linux/post/extracting-kernel-stack-function-arguments-from-linux-x86-64-kernel-crash-dumps">example1</a></h3><ul>
<li><p>用户模式的系统调用依次传递的寄存器为:</p>
<ul>
<li>rdi，rsi，rdx，rcx，r8和r9</li>
</ul>
</li>
<li><p>内核接口的系统调用一次传递的寄存器为:</p>
<ul>
<li>rdi，rsi，rdx，r10，r8和r9</li>
<li>注意这里和用户模式的系统调用只有第4个寄存器不同，其他都相同。</li>
</ul>
</li>
<li><p>系统调用通过syscall指令进入，不像32位下的汇编使用的是int 0x80指令；</p>
</li>
<li><p>系统调用号放在rax寄存器里；</p>
</li>
<li><p>系统调用限制最多6个参数，没有参数直接通过栈传递，原话是:</p>
<ul>
<li>System-calls are limited to six arguments, no argument is passed directly on the stack</li>
</ul>
</li>
<li><p>系统调用的返回结果，也就是syscall指令的返回放在rax寄存器中；</p>
</li>
<li><p>只有整形值和内存型的值可以传递给内核，这个也不十分明白，原话是:</p>
<ul>
<li>Only values of class INTEGER or class MEMORY are passed to the kernel<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">编译连接命令如下：</span><br><span class="line">nasm -f elf64 p.s</span><br><span class="line">ld -o p p.o</span><br><span class="line"></span><br><span class="line">nasm -f elf32 p.s</span><br><span class="line">ld -o p p.o</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nasm -f macho64 p.s</span><br><span class="line">ld -o p p.o</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mov %r12,%rdi:  places the contents of cpu register %r12 into register %rdi, %r12 —&gt; %rdi</p>
</li>
<li><p>mov 0x8(%r14),%rcx</p>
<ul>
<li>takes the value of register %r14, adds 8 to it</li>
<li>takes the result as the address of a memory location, reads the value at that memory location and puts it into register %rcx<ul>
<li>%R14 + 8 (value is the addr of a memory location) —&gt; %rcx</li>
</ul>
</li>
<li>0x8(%r14) &#x3D; %r14+0x8 (indirect addressing mode)<ul>
<li>Both denote the content of memory at address location</li>
</ul>
</li>
</ul>
</li>
<li><p>The calling function might retrieve the values from:</p>
<ul>
<li>Memory</li>
<li>The calling function’s stack, via an offset from the (fixed) base of the stack</li>
<li>Another register, which got its value from one of these above in turnz</li>
</ul>
</li>
<li><p>The called function might save the values it received in the registers</p>
<ul>
<li>Memory</li>
<li>The called function’s stack, via push</li>
<li>Another register, which might itself then be saved in turn</li>
</ul>
</li>
<li><p>Disassemble either or both of</p>
<ul>
<li>The calling function, leading up to the callq instruction, to see from where it obtains the values it passes to the called function in the registers</li>
<li>The called function, to see whether it puts the values from the registers onto its stack, or into memory</li>
</ul>
</li>
<li><p>Inspect those areas (caller&#x2F;callee stack and&#x2F;or memory) to see if the values may be extracted</p>
</li>
<li><p>The 1st argument will be passed in %rdi, %edi, %di or %dil. Note that all the names contain “di”.</p>
</li>
<li><p>For the Linux kernel running on the x86-64 architecture, kernel function arguments are normally passed using 64-bit cpu registers. The first six arguments to a function are passed in the following cpu registers, respectively:</p>
<ul>
<li>x86 64 bit<ul>
<li>1st: %rdi</li>
<li>2nd: %rsi</li>
<li>3rd: %rdx</li>
<li>4th: %rcx</li>
<li>5th: %r8</li>
<li>6th: %r9</li>
</ul>
</li>
<li>32 bit<ul>
<li>1st: %edi</li>
<li>2nd: %esi</li>
<li>3rd: %edx</li>
<li>4th: %ecx</li>
<li>5th: %r8d</li>
<li>6th: %r9d</li>
</ul>
</li>
<li>16 bit<ul>
<li>1st: %di</li>
<li>2nd: %si</li>
<li>3rd: %dx</li>
<li>4th: %cx</li>
<li>5th: %r8w</li>
<li>6th: %r9w</li>
</ul>
</li>
<li>8 bit<ul>
<li>1st: %dil</li>
<li>2nd: %sil</li>
<li>3rd: %dh&#x2F;%dl</li>
<li>4th: %ch&#x2F;%cl</li>
<li>5th: %r8b</li>
<li>6th: %r9b<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#linux/arch/x86/entry/common.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_X86_64</span></span><br><span class="line">                <span class="keyword">if</span> (arch == AUDIT_ARCH_X86_64) &#123;</span><br><span class="line">                        sd.args[<span class="number">0</span>] = regs-&gt;di;</span><br><span class="line">                        sd.args[<span class="number">1</span>] = regs-&gt;si;</span><br><span class="line">                        sd.args[<span class="number">2</span>] = regs-&gt;dx;</span><br><span class="line">                        sd.args[<span class="number">3</span>] = regs-&gt;r10;</span><br><span class="line">                        sd.args[<span class="number">4</span>] = regs-&gt;r8;</span><br><span class="line">                        sd.args[<span class="number">5</span>] = regs-&gt;r9;</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">                &#123;</span><br><span class="line">                        sd.args[<span class="number">0</span>] = regs-&gt;bx;</span><br><span class="line">                        sd.args[<span class="number">1</span>] = regs-&gt;cx;</span><br><span class="line">                        sd.args[<span class="number">2</span>] = regs-&gt;dx;</span><br><span class="line">                        sd.args[<span class="number">3</span>] = regs-&gt;si;</span><br><span class="line">                        sd.args[<span class="number">4</span>] = regs-&gt;di;</span><br><span class="line">                        sd.args[<span class="number">5</span>] = regs-&gt;bp;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Whilst the function is executing, this is stored in the %rbp register, the function’s stack frame base pointer.</p>
</li>
<li><p>-sx tells bt to try to show addresses as as symbol name plus a hex offset</p>
<ul>
<li>bt -sx</li>
</ul>
</li>
<li><p>to see the actual stack content, i.e. the content of the stack frames, for each function call</p>
<ul>
<li>bt -FFsx</li>
<li>-FF tells bt to show all the data for a stack frame, symbolically, with its slab cache name, if appropriate<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   crash7latest&gt; bt -FFsx</span><br><span class="line">       ...</span><br><span class="line">   ffff88180dc37ca8: ***ffff88180dc37d58*** do_last+<span class="number">901</span> &lt;&lt;&lt;------ The <span class="built_in">stack</span> frame of the calling function do_last is shown above</span><br><span class="line">#<span class="number">5</span> [ffff88180dc37cb0] do_last+<span class="number">0x385</span> at ffffffff812140b5           Its <span class="built_in">stack</span> frame base pointer <span class="number">0xffff88180dc37d58</span> appears in two locations, shown highlighted with ***</span><br><span class="line">   ffff88180dc37cb8: <span class="number">0000000000000000</span> <span class="number">0000000000000000</span></span><br><span class="line">   ffff88180dc37cc8: [ffff883f64c7cda0:mnt_cache] [ffff881d4601f740:dentry]</span><br><span class="line">   ffff88180dc37cd8: [ffff881d4603e600:ext3_inode_cache] kmem_cache_alloc+<span class="number">546</span></span><br><span class="line">   ffff88180dc37ce8: [ffff881d4603e600:ext3_inode_cache] [ffff881dfc120000:kmalloc<span class="number">-4096</span>]</span><br><span class="line">   ffff88180dc37cf8: <span class="number">000001000000002</span>a [ffff8817ec6b7600:kmalloc<span class="number">-256</span>]</span><br><span class="line">   ffff88180dc37d08: ffff88180dc37da4 [ffff881d4601f740:dentry]</span><br><span class="line">   ffff88180dc37d18: ffff88180dc37d58 path_init+<span class="number">185</span></span><br><span class="line">   ffff88180dc37d28: ffff88180dc37d58 [ffff8817ec6b7600:kmalloc<span class="number">-256</span>]</span><br><span class="line">   ffff88180dc37d38: ffff88180dc37e08 ffff88180dc37ef4</span><br><span class="line">   ffff88180dc37d48: [ffff881dfc120000:kmalloc<span class="number">-4096</span>] <span class="number">0000000000000041</span></span><br><span class="line">***ffff88180dc37d58***: ffff88180dc37df8 path_openat+<span class="number">128</span></span><br><span class="line">#<span class="number">6</span> [ffff88180dc37d60] path_openat+<span class="number">0x80</span> at ffffffff81214fc0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>The stack frame base pointer, for a function, may be found:</p>
<ul>
<li>As the second-last value in the stack frame above the function (i.e. above in the bt output)</li>
<li>As the location of the second-last value in the stack frame for the function</li>
</ul>
</li>
</ul>
<p>read the function parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; ps | grep UN</span><br><span class="line">  30885  30799   1  ffff8b95709c3180  UN   0.0  109136   1664  <span class="built_in">dd</span></span><br><span class="line">crash&gt; bt 30885</span><br><span class="line">PID: 30885  TASK: ffff8b95709c3180  CPU: 1   COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8b955217b9c8] __schedule at ffffffff90f86c47</span></span><br><span class="line"> <span class="comment">#1 [ffff8b955217ba58] schedule at ffffffff90f87169</span></span><br><span class="line"> <span class="comment">#2 [ffff8b955217ba68] schedule_timeout at ffffffff90f84b98</span></span><br><span class="line"> <span class="comment">#3 [ffff8b955217bb18] io_schedule_timeout at ffffffff90f8683d</span></span><br><span class="line"> <span class="comment">#4 [ffff8b955217bb48] balance_dirty_pages at ffffffff90f7cf90</span></span><br><span class="line"> <span class="comment">#5 [ffff8b955217bc68] balance_dirty_pages_ratelimited at ffffffff909caac7</span></span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write at ffffffff909bd845</span></span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write at ffffffff909c0422</span></span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write at ffffffff90a4d063</span></span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write at ffffffff90a4db50</span></span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write at ffffffff90a4e92f</span></span><br><span class="line"><span class="comment">#12 [ffff8b955217bf50] system_call_fastpath at ffffffff90f93f92</span></span><br><span class="line">    RIP: 00007f9d11d46a00  RSP: 00007ffc357a18b8  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000001  RBX: 0000000000000000  RCX: 00007f9d11d46a00</span><br><span class="line">    RDX: 0000000000100000  RSI: 00007f9d1213b000  RDI: 0000000000000001</span><br><span class="line">    RBP: 0000000000100000   R8: ffffffffffffffff   R9: 0000000000102003</span><br><span class="line">    R10: 00007ffc357a0c60  R11: 0000000000000246  R12: 0000000000100000</span><br><span class="line">    R13: 00007f9d1213b000  R14: 00007f9d1223b000  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000001  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">crash&gt; <span class="built_in">set</span> 30885</span><br><span class="line">    PID: 30885</span><br><span class="line">COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line">   TASK: ffff8b95709c3180  [THREAD_INFO: ffff8b9552178000]</span><br><span class="line">    CPU: 1</span><br><span class="line">  STATE: TASK_UNINTERRUPTIBLE|TASK_WAKEKILL </span><br><span class="line">crash&gt; bt -sxl </span><br><span class="line">PID: 30885  TASK: ffff8b95709c3180  CPU: 1   COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8b955217b9c8] __schedule+0x367 at ffffffff90f86c47</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/sched/core.c: 2596</span><br><span class="line"> <span class="comment">#1 [ffff8b955217ba58] schedule+0x29 at ffffffff90f87169</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/sched/core.c: 3660</span><br><span class="line"> <span class="comment">#2 [ffff8b955217ba68] schedule_timeout+0x168 at ffffffff90f84b98</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/timer.c: 1553</span><br><span class="line"> <span class="comment">#3 [ffff8b955217bb18] io_schedule_timeout+0xad at ffffffff90f8683d</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/arch/x86/include/asm/current.h: 14</span><br><span class="line"> <span class="comment">#4 [ffff8b955217bb48] balance_dirty_pages+0x5be at ffffffff90f7cf90</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/page-writeback.c: 1522</span><br><span class="line"> <span class="comment">#5 [ffff8b955217bc68] balance_dirty_pages_ratelimited+0xe7 at ffffffff909caac7</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/page-writeback.c: 1655</span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write+0x195 at ffffffff909bd845</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/include/linux/sched.h: 3008</span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write+0x1e2 at ffffffff909c0422</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/filemap.c: 3295</span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write+0x94 at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write+0x93 at ffffffff90a4d063</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 492</span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 543</span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write+0x7f at ffffffff90a4e92f</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 593</span><br><span class="line"><span class="comment">#12 [ffff8b955217bf50] system_call_fastpath+0x25 at ffffffff90f93f92</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/arch/x86/kernel/entry_64.S: 511</span><br><span class="line">    RIP: 00007f9d11d46a00  RSP: 00007ffc357a18b8  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000001  RBX: 0000000000000000  RCX: 00007f9d11d46a00</span><br><span class="line">    RDX: 0000000000100000  RSI: 00007f9d1213b000  RDI: 0000000000000001</span><br><span class="line">    RBP: 0000000000100000   R8: ffffffffffffffff   R9: 0000000000102003</span><br><span class="line">    R10: 00007ffc357a0c60  R11: 0000000000000246  R12: 0000000000100000</span><br><span class="line">    R13: 00007f9d1213b000  R14: 00007f9d1223b000  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000001  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">ssize_t vfs_write(struct file *file, const char __user *buf, size_t count, loff_t *pos)</span><br><span class="line">                         |</span><br><span class="line">                         ----first parameter</span><br><span class="line"></span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 543</span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bee0: 0000000000000000 00007f9d1213b000</span><br><span class="line">    ffff8b955217bef0: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bf00: ffff8b955217bf48 sys_write+127</span><br><span class="line">         |</span><br><span class="line">         --------------&gt; found here: the <span class="string">&quot;vfs_write&quot;</span> base pointer(0xffff8b955217bf00), and it contains a pointer to the parent(sys_write) stack frame base pointer (0xffff8b955217bf48)</span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write+0x7f at ffffffff90a4e92f                                              </span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 593</span><br><span class="line">    ffff8b955217bf10: ffff8b955217bf48 000000026bb00000</span><br><span class="line">    ffff8b955217bf20: 0000000053112767 0000000000000000</span><br><span class="line">    ffff8b955217bf30: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bf40: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bf50: system_call_fastpath+37</span><br><span class="line"></span><br><span class="line">crash&gt; dis -rx sys_write+0x7f | <span class="built_in">tail</span></span><br><span class="line">0xffffffff90a4e90c &lt;sys_write+0x5c&gt;:    or     <span class="variable">$0x2</span>,%r12d</span><br><span class="line">0xffffffff90a4e910 &lt;sys_write+0x60&gt;:    callq  0xffffffff90f853b0 &lt;mutex_lock&gt;</span><br><span class="line">0xffffffff90a4e915 &lt;sys_write+0x65&gt;:    mov    0x48(%rbx),%rax</span><br><span class="line">0xffffffff90a4e919 &lt;sys_write+0x69&gt;:    lea    -0x30(%rbp),%rcx</span><br><span class="line">0xffffffff90a4e91d &lt;sys_write+0x6d&gt;:    mov    %r14,%rdx</span><br><span class="line">0xffffffff90a4e920 &lt;sys_write+0x70&gt;:    mov    %r13,%rsi</span><br><span class="line">0xffffffff90a4e923 &lt;sys_write+0x73&gt;:    mov    %rbx,%rdi  &lt;-------------------rbx to rdi</span><br><span class="line">0xffffffff90a4e926 &lt;sys_write+0x76&gt;:    mov    %rax,-0x30(%rbp)</span><br><span class="line">0xffffffff90a4e92a &lt;sys_write+0x7a&gt;:    callq  0xffffffff90a4da90 &lt;vfs_write&gt;</span><br><span class="line">0xffffffff90a4e92f &lt;sys_write+0x7f&gt;:    <span class="built_in">test</span>   %rax,%rax</span><br><span class="line"></span><br><span class="line">crash&gt; dis -x vfs_write | <span class="built_in">head</span></span><br><span class="line">0xffffffff90a4da90 &lt;vfs_write&gt;: nopl   0x0(%rax,%rax,1) [FTRACE NOP]</span><br><span class="line">0xffffffff90a4da95 &lt;vfs_write+0x5&gt;:     push   %rbp</span><br><span class="line">0xffffffff90a4da96 &lt;vfs_write+0x6&gt;:     mov    %rsp,%rbp  </span><br><span class="line">0xffffffff90a4da99 &lt;vfs_write+0x9&gt;:     push   %r15       +1</span><br><span class="line">0xffffffff90a4da9b &lt;vfs_write+0xb&gt;:     push   %r14       +1</span><br><span class="line">0xffffffff90a4da9d &lt;vfs_write+0xd&gt;:     push   %r13       +1</span><br><span class="line">0xffffffff90a4da9f &lt;vfs_write+0xf&gt;:     push   %r12       +1</span><br><span class="line">0xffffffff90a4daa1 &lt;vfs_write+0x11&gt;:    push   %rbx       +1 --------------------------------push rbx(save the old value), here is 5*8</span><br><span class="line">0xffffffff90a4daa2 &lt;vfs_write+0x12&gt;:    mov    %rdi,%rbx  &lt;---move rdi to rbx, px (0xffff8b955217bf00 - 5*8) = <span class="variable">$1</span> = 0xffff8b955217bed8</span><br><span class="line">0xffffffff90a4daa5 &lt;vfs_write+0x15&gt;:    sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"></span><br><span class="line">crash&gt; rd  0xffff8b955217bed8</span><br><span class="line">ffff8b955217bed8:  ffff8b956f4d7b00                    .&#123;Mo....</span><br><span class="line"></span><br><span class="line">crash&gt; bt -FF | grep ffff8b956f4d7b00</span><br><span class="line">    ffff8b955217bcc0: [ffff8b956f4d7b00:kmalloc-256] ffffe5d984745e00</span><br><span class="line">    ffff8b955217bd00: 0000000000000000 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd78: 0000000053112767 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217be08: 0000000000000001 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217beb8: [ffff8b956f4d7b00:kmalloc-256] ffff8b955217bf00</span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">crash&gt; struct -p file.f_op ffff8b956f4d7b00 | grep seek</span><br><span class="line">       llseek = 0xffffffffc09a9860,</span><br><span class="line">crash&gt; struct file.f_path ffff8b956f4d7b00</span><br><span class="line">  f_path = &#123;</span><br><span class="line">    mnt = 0xffff8b947e2ea020,</span><br><span class="line">    dentry = 0xffff8b954ef5f900</span><br><span class="line">  &#125;</span><br><span class="line">crash&gt; dentry.d_name.name 0xffff8b954ef5f900</span><br><span class="line">  d_name.name = 0xffff8b954ef5f938 <span class="string">&quot;test1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the parent path</span></span><br><span class="line">crash&gt; dentry.d_parent 0xffff8b954ef5f900</span><br><span class="line">  d_parent = 0xffff8b9549646780</span><br><span class="line">crash&gt; dentry.d_name.name 0xffff8b9549646780</span><br><span class="line">  d_name.name = 0xffff8b95496467b8 <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#contains the ffff8b956f4d7b00</span></span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write+0x195 at ffffffff909bd845</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/include/linux/sched.h: 3008</span><br><span class="line">    ffff8b955217bc80: .LC4+80          ffff8b955217be40</span><br><span class="line">    ffff8b955217bc90: 000000026bb00000 0000000000001000</span><br><span class="line">    ffff8b955217bca0: [ffff8b95709c3180:task_struct] 000000004ef5f900</span><br><span class="line">    ffff8b955217bcb0: 000000000008f000 0000000000000000</span><br><span class="line">    ffff8b955217bcc0: [ffff8b956f4d7b00:kmalloc-256] ffffe5d984745e00</span><br><span class="line">    ffff8b955217bcd0: .LC4+80          ffff8b955217bdf8</span><br><span class="line">    ffff8b955217bce0: 0000000000000001 000000000008f000</span><br><span class="line">    ffff8b955217bcf0: 0000000000071000 0000000053112767</span><br><span class="line">    ffff8b955217bd00: 0000000000000000 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd10: [ffff8b945d8d0f60:nfs_inode_cache] ffff8b955217be08</span><br><span class="line">    ffff8b955217bd20: ffff8b955217bdf8 ffff8b955217bda8</span><br><span class="line">    ffff8b955217bd30: __generic_file_aio_write+482</span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write+0x1e2 at ffffffff909c0422</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/filemap.c: 3295</span><br><span class="line">    ffff8b955217bd38: 0000000000000000 ffff8b955217bd68</span><br><span class="line">    ffff8b955217bd48: 0000000000100000 000000026bb00000</span><br><span class="line">    ffff8b955217bd58: [ffff8b945d8d0e10:nfs_inode_cache] ffff8b955217be40</span><br><span class="line">    ffff8b955217bd68: 0000000000000001 0000000000100000</span><br><span class="line">    ffff8b955217bd78: 0000000053112767 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd88: [ffff8b945d8d0e10:nfs_inode_cache] 000000026bb00000</span><br><span class="line">    ffff8b955217bd98: ffff8b955217bdf8 ffff8b955217be08</span><br><span class="line">    ffff8b955217bda8: ffff8b955217bde8 nfs_file_write+148</span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write+0x94 at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line">    ffff8b955217bdb8: 0000000000000001 ffff8b955217bf18</span><br><span class="line">    ffff8b955217bdc8: 00007f9d1213b000 ffff8b955217bf18</span><br><span class="line">    ffff8b955217bdd8: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bde8: ffff8b955217bec0 do_sync_write+147</span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write+0x93 at ffffffff90a4d063</span></span><br><span class="line">    ffff8b955217bdf8: 00007f9d1213b000 0000000000100000</span><br><span class="line">    ffff8b955217be08: 0000000000000001 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217be18: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be28: 0000000000000000 [ffff8b95709c3180:task_struct]</span><br><span class="line">    ffff8b955217be38: 0000000000000000 000000026bb00000</span><br><span class="line">    ffff8b955217be48: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be58: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217be68: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217be78: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be88: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be98: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bea8: 0000000000000000 0000000053112767</span><br><span class="line">    ffff8b955217beb8: [ffff8b956f4d7b00:kmalloc-256] ffff8b955217bf00</span><br><span class="line">    ffff8b955217bec8: vfs_write+192</span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bee0: 0000000000000000 00007f9d1213b000</span><br><span class="line">    ffff8b955217bef0: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bf00: ffff8b955217bf48 sys_write+127</span><br></pre></td></tr></table></figure>

<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#show all info if you input the wrong keyword </span></span><br><span class="line"></span><br><span class="line">crash&gt; struct skb_shared_info <span class="built_in">ls</span> | <span class="built_in">head</span></span><br><span class="line">symbol not found: <span class="built_in">ls</span></span><br><span class="line">possible alternatives:</span><br><span class="line">  f760 (d) shadow_tls_desc</span><br><span class="line">  1a540 (d) cpu_worker_pools</span><br><span class="line">  ffffffff9c61b4a0 (t) xen_load_tls</span><br><span class="line">  ffffffff9c6350f0 (T) arch_check_bp_in_kernelspace</span><br><span class="line">  ffffffff9c63c250 (t) set_tls_desc</span><br><span class="line">  ffffffff9c63c6d0 (T) regset_tls_active</span><br><span class="line">  ffffffff9c63c710 (T) regset_tls_get</span><br><span class="line">  ffffffff9c63c860 (T) regset_tls_set</span><br><span class="line">... &lt;-------------- show all</span><br><span class="line"></span><br><span class="line">foreach IN bt</span><br><span class="line">foreach bt -tf</span><br><span class="line">bt -t <span class="variable">$pid</span></span><br><span class="line">bt -l <span class="variable">$pid</span></span><br><span class="line">bt -a</span><br><span class="line">task | grep rsp</span><br><span class="line">rsp0 = 0xx0</span><br><span class="line">rsp = 0xx1</span><br><span class="line">rd <span class="variable">$rsp</span> -e <span class="variable">$rsp0</span> -s</span><br><span class="line">dev == <span class="built_in">cat</span> /proc/ioports /proc/iomem</span><br><span class="line">kem -s</span><br><span class="line">kmem -i</span><br><span class="line">kmem -p</span><br><span class="line">kmem 0x<span class="variable">$addr</span></span><br><span class="line">the addr <span class="keyword">in</span> the [0xxxx] means not release</span><br><span class="line">whatis moduels</span><br><span class="line">list modules</span><br><span class="line">whatis ip_packet_type</span><br><span class="line">struct -o packet_type</span><br><span class="line">list -o 0x30 ip_packet_type</span><br><span class="line">list -o 0x30 ip_packet_type -s packet_type.func</span><br><span class="line">net</span><br><span class="line">struct net_device <span class="variable">$addr</span></span><br><span class="line">runq</span><br><span class="line">    CPU 0 RUNQUEUE: ffff880001cdb460</span><br><span class="line">      CURRENT: PID: 2739   TASK: ffff8800320fa7e0  COMMAND: <span class="string">&quot;bash&quot;</span></span><br><span class="line">      ACTIVE PRIO_ARRAY: ffff880001cdb4d8</span><br><span class="line">         [115] PID: 2739   TASK: ffff8800320fa7e0  COMMAND: <span class="string">&quot;bash&quot;</span></span><br><span class="line">               PID: 1776   TASK: ffff88003217d820  COMMAND: <span class="string">&quot;syslogd&quot;</span></span><br><span class="line">      EXPIRED PRIO_ARRAY: ffff880001cdbdb8</span><br><span class="line">         [no tasks queued]</span><br><span class="line"></span><br><span class="line">    CPU 1 RUNQUEUE: ffff880001ce3460</span><br><span class="line">      CURRENT: PID: 1779   TASK: ffff88003207a860  COMMAND: <span class="string">&quot;klogd&quot;</span></span><br><span class="line">      ACTIVE PRIO_ARRAY: ffff880001ce34d8</span><br><span class="line">         [115] PID: 1779   TASK: ffff88003207a860  COMMAND: <span class="string">&quot;klogd&quot;</span></span><br><span class="line">      EXPIRED PRIO_ARRAY: ffff880001ce3db8</span><br><span class="line">         [no tasks queued]</span><br><span class="line">runq -t</span><br><span class="line">runq -g</span><br><span class="line">runq -g -c3</span><br><span class="line">sig</span><br><span class="line">sig -l = <span class="built_in">kill</span> -l</span><br><span class="line">swap</span><br><span class="line">sym</span><br><span class="line">sym -l = system.map</span><br><span class="line">sys</span><br><span class="line">sys config</span><br><span class="line">task</span><br><span class="line">timer</span><br><span class="line">wr</span><br><span class="line"></span><br><span class="line">rd jiffies_64</span><br><span class="line">wr jiffies_64 10ffc7651</span><br><span class="line">rd jiffies_64</span><br><span class="line">sys</span><br><span class="line"></span><br><span class="line">$ crash -s -i crash_cmd.txt</span><br><span class="line">       |</span><br><span class="line">       ----------- silent mode</span><br></pre></td></tr></table></figure>

<h3 id="example2-dump-file-content-in-memory"><a href="#example2-dump-file-content-in-memory" class="headerlink" title="example2 dump file content in memory"></a><a target="_blank" rel="noopener" href="http://oliveryang.net/2015/07/linux-crash-page-cache-debug/#1-new-page-cache-debug-options">example2 dump file content in memory</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">$ vim anaconda-ks.cfg</span><br><span class="line"><span class="comment">#version=DEVEL</span></span><br><span class="line"><span class="comment"># System authorization information</span></span><br><span class="line">auth --enableshadow --passalgo=sha512</span><br><span class="line"><span class="comment"># Use CDROM installation media</span></span><br><span class="line">cdrom</span><br><span class="line"><span class="comment"># Use graphical install</span></span><br><span class="line">graphical</span><br><span class="line"><span class="comment"># Run the Setup Agent on first boot</span></span><br><span class="line">firstboot --<span class="built_in">enable</span></span><br><span class="line">ignoredisk --only-use=vda</span><br><span class="line"><span class="comment"># Keyboard layouts</span></span><br><span class="line">keyboard --vckeymap=us --xlayouts=<span class="string">&#x27;us&#x27;</span></span><br><span class="line"><span class="comment"># System language</span></span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">....</span><br><span class="line">crash&gt; foreach files -c -R anaconda-ks.cfg</span><br><span class="line">PID: 28525  TASK: ffff9c7890232100  CPU: 1   COMMAND: <span class="string">&quot;vim&quot;</span></span><br><span class="line">ROOT: /    CWD: /root</span><br><span class="line"> FD      INODE          I_MAPPING     NRPAGES TYPE PATH</span><br><span class="line">  4 ffff9c78db8f2a88 ffff9c78db8f2bd8       3 REG  /root/.anaconda-ks.cfg.swp</span><br><span class="line"></span><br><span class="line">crash&gt; files -p ffff9c78db8f2a88</span><br><span class="line">     INODE        NRPAGES</span><br><span class="line">ffff9c78db8f2a88        3</span><br><span class="line"></span><br><span class="line">      PAGE       PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffdb8784317180 10c5c6000 ffff9c78db8f2bd8        0  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7d80 1479f6000 ffff9c78db8f2bd8        1  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7dc0 1479f7000 ffff9c78db8f2bd8        2  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">crash&gt; rd -p -a 1479f7000 4096 | <span class="built_in">tail</span> -12</span><br><span class="line">       1479f7ed6:  keyboard --vckeymap=us --xlayouts=<span class="string">&#x27;us&#x27;</span></span><br><span class="line">       1479f7efd:  <span class="comment"># Keyboard layouts</span></span><br><span class="line">       1479f7f10:  ignoredisk --only-use=vda</span><br><span class="line">       1479f7f2a:  firstboot --<span class="built_in">enable</span></span><br><span class="line">       1479f7f3d:  <span class="comment"># Run the Setup Agent on first boot</span></span><br><span class="line">       1479f7f61:  graphical</span><br><span class="line">       1479f7f6b:  <span class="comment"># Use graphical install</span></span><br><span class="line">       1479f7f83:  cdrom</span><br><span class="line">       1479f7f89:  <span class="comment"># Use CDROM installation media</span></span><br><span class="line">       1479f7fa8:  auth --enableshadow --passalgo=sha512</span><br><span class="line">       1479f7fce:  <span class="comment"># System authorization information</span></span><br><span class="line">       1479f7ff1:  <span class="comment">#version=DEVEL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  show you top 10 page cache consumers</span></span><br><span class="line">$ crash&gt; foreach files -c -R REG | <span class="built_in">sort</span> -k4 -nr | <span class="built_in">head</span> -n10</span><br><span class="line"></span><br><span class="line"><span class="comment"># display the number of pages that are in the page cache</span></span><br><span class="line">$ crash&gt; files -c 28525</span><br><span class="line">PID: 28525  TASK: ffff9c7890232100  CPU: 1   COMMAND: <span class="string">&quot;vim&quot;</span></span><br><span class="line">ROOT: /    CWD: /root</span><br><span class="line"> FD      INODE          I_MAPPING     NRPAGES TYPE PATH</span><br><span class="line">  0 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  1 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  2 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  4 ffff9c78db8f2a88 ffff9c78db8f2bd8       3 REG  /root/.anaconda-ks.cfg.swp</span><br><span class="line"></span><br><span class="line">display all of its pages that are <span class="keyword">in</span> the page cache</span><br><span class="line">$ files -p ffff9c78db8f2a88</span><br><span class="line">     INODE        NRPAGES</span><br><span class="line">ffff9c78db8f2a88        3</span><br><span class="line"></span><br><span class="line">      PAGE       PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffdb8784317180 10c5c6000 ffff9c78db8f2bd8        0  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7d80 1479f6000 ffff9c78db8f2bd8        1  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7dc0 1479f7000 ffff9c78db8f2bd8        2  2 2fffff0000082c referenced,uptodate,lru,private</span><br></pre></td></tr></table></figure>

<h3 id="example3-memory-hacking"><a href="#example3-memory-hacking" class="headerlink" title="example3 memory hacking"></a><a target="_blank" rel="noopener" href="http://oliveryang.net/2017/03/linux-kernel-memory-hacking/">example3 memory hacking</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; wr panic_on_oops 1</span><br><span class="line">wr: cannot write to /dev/crash!</span><br><span class="line"></span><br><span class="line">linux-3.10.0-1127.el7/arch/x86/mm/init.c</span><br><span class="line">/*</span><br><span class="line"> * devmem_is_allowed() checks to see <span class="keyword">if</span> /dev/mem access to a certain address</span><br><span class="line"> * is valid. The argument is a physical page number.</span><br><span class="line"> *</span><br><span class="line"> * On x86, access has to be given to the first megabyte of RAM because that</span><br><span class="line"> * area traditionally contains BIOS code and data regions used by X, dosemu,</span><br><span class="line"> * and similar apps. Since they map the entire memory range, the whole range</span><br><span class="line"> * must be allowed (<span class="keyword">for</span> mapping), but any areas that would otherwise be</span><br><span class="line"> * disallowed are flagged as being <span class="string">&quot;zero filled&quot;</span> instead of rejected.</span><br><span class="line"> * Access has to be given to non-kernel-ram areas as well, these contain the</span><br><span class="line"> * PCI mmio resources as well as potential bios/acpi data regions.</span><br><span class="line"> */</span><br><span class="line">int devmem_is_allowed(unsigned long pagenr)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span> (region_intersects_ram(PFN_PHYS(pagenr), PAGE_SIZE)</span><br><span class="line">                        != REGION_DISJOINT) &#123;</span><br><span class="line">                /* </span><br><span class="line">                 * For disallowed memory regions <span class="keyword">in</span> the low 1MB range,</span><br><span class="line">                 * request that the page be shown as all zeros.</span><br><span class="line">                 */</span><br><span class="line">                <span class="keyword">if</span> (pagenr &lt; 256)</span><br><span class="line">                        <span class="built_in">return</span> 2;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* </span><br><span class="line">         * This must follow RAM <span class="built_in">test</span>, since System RAM is considered a</span><br><span class="line">         * restricted resource under CONFIG_STRICT_IOMEM.</span><br><span class="line">         */</span><br><span class="line">        <span class="keyword">if</span> (iomem_is_exclusive(pagenr &lt;&lt; <span class="string">PAGE_SHIFT)) &#123; </span></span><br><span class="line"><span class="string">                /* Low 1MB bypasses iomem restrictions. */</span></span><br><span class="line"><span class="string">                if (pagenr &lt; 256)</span></span><br><span class="line"><span class="string">                        return 1;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                return 0;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return 1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ crash /dev/mem</span></span><br><span class="line"><span class="string">crash&gt; wr panic_on_oops 1</span></span><br><span class="line"><span class="string">wr: write error: kernel virtual address: ffffffffbae47ed4  type: &quot;write memory&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe kernel.function(&quot;devmem_is_allowed&quot;).return &#123; $return = 1 &#125;&#x27;</span></span><br><span class="line"><span class="string">#### bpftrace -e &#x27;k:devmem_is_allowed &#123;return 1; &#125;&#x27; --unsafe ### bpftrace not work</span></span><br><span class="line"><span class="string">#### btw, if is another kernel module, eg:</span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe module(&quot;ptlrpc&quot;).function(&quot;ptlrpc_expire_one_request&quot;).return &#123; $return = 1 &#125;&#x27;</span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe module(&quot;osc&quot;).function(&quot;osc_enter_cache_try&quot;).return &#123; printf (&quot;return value: %d\n&quot;,$return); &#125;&#x27;</span></span><br><span class="line"><span class="string">$ bpftrace -e &#x27;kretprobe:osc_enter_cache_try &#123; printf(&quot;returned: %d\n&quot;, retval); &#125;&#x27;</span></span><br><span class="line"><span class="string">crash&gt; wr panic_on_oops 0</span></span><br><span class="line"><span class="string">crash&gt; p panic_on_oops</span></span><br><span class="line"><span class="string">panic_on_oops = $1 = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="example4"><a href="#example4" class="headerlink" title="example4"></a>example4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[5257172.312256] BUG: Bad page state in process ksoftirqd/6  pfn:882556</span><br><span class="line">[5257172.314826] page:ffffe28a62095580 count:0 mapcount:-1 mapping:          (null) index:0x0</span><br><span class="line">[5257172.317284] page flags: 0x2fffff00008000(tail)</span><br><span class="line">[5257172.319614] page dumped because: nonzero mapcount</span><br><span class="line">[5257172.418956] Modules linked in: ipmi_poweroff ipmi_watchdog osp(OE) ofd(OE) lfsck(OE) ost(OE) mgc(OE) osd_zfs(OE) lquota(OE) fid(OE) fld(OE) ksocklnd(OE) ptlrpc(OE) obdclass(OE) lnet(OE) libcfs(OE) bonding vfat fat iTCO_wdt iTCO_vendor_support mxm_wmi sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr i2c_i801 lpc_ich mei_me joydev mei ioatdma zfs(POE) zunicode(POE) zavl(POE) icp(POE) zcommon(POE) znvpair(POE) spl(OE) ses enclosure sg ipmi_si ipmi_devintf ipmi_msghandler wmi acpi_power_meter acpi_pad rpcrdma sunrpc ib_isert iscsi_target_mod ib_iser libiscsi scsi_transport_iscsi ib_srpt target_core_mod ib_srp scsi_transport_srp scsi_tgt ib_ipoib rdma_ucm ib_umad rdma_cm ib_cm iw_cm</span><br><span class="line">[5257172.429763]  mlx5_ib ib_uverbs ib_core binfmt_misc ip_tables xfs libcrc32c sd_mod crc_t10dif crct10dif_generic ast i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm ahci mlx5_core drm ixgbe libahci mdio mlxfw crct10dif_pclmul crct10dif_common devlink mpt3sas(OE) libata megaraid_sas crc32c_intel ptp pps_core raid_class drm_panel_orientation_quirks scsi_transport_sas dca</span><br><span class="line">[5257172.437256] CPU: 6 PID: 41 Comm: ksoftirqd/6 Kdump: loaded Tainted: P    B      OE  ------------ T 3.10.0-1160.2.1.el7_lustre.x86_64 #1</span><br><span class="line">[5257172.441017] Hardware name: Supermicro X10DRH/X10DRH-CT, BIOS 3.1 06/18/2018</span><br><span class="line">[5257172.442716] Call Trace:</span><br><span class="line">[5257172.444506]  [&lt;ffffffff963813c0&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[5257172.446313]  [&lt;ffffffff9637bf7d&gt;] bad_page.part.75+0xdc/0xf9</span><br><span class="line">[5257172.448054]  [&lt;ffffffff95dc6b32&gt;] free_pages_prepare+0x1f2/0x210</span><br><span class="line">[5257172.449757]  [&lt;ffffffff95dc6e69&gt;] __free_pages_ok+0x19/0xc0</span><br><span class="line">[5257172.451481]  [&lt;ffffffff95dc6f2b&gt;] free_compound_page+0x1b/0x20</span><br><span class="line">[5257172.453212]  [&lt;ffffffff9637d110&gt;] __put_compound_page+0x25/0x28</span><br><span class="line">[5257172.454879]  [&lt;ffffffff9637d279&gt;] put_compound_page+0x166/0x174</span><br><span class="line">[5257172.456587]  [&lt;ffffffff95dcc1f6&gt;] put_page+0x56/0x60</span><br><span class="line">[5257172.458259]  [&lt;ffffffff9623d67f&gt;] skb_release_data+0x8f/0x150</span><br><span class="line">[5257172.459915]  [&lt;ffffffff9623d764&gt;] skb_release_all+0x24/0x30</span><br><span class="line">[5257172.461531]  [&lt;ffffffff9623dd68&gt;] napi_consume_skb+0xa8/0x100</span><br><span class="line">[5257172.463265]  [&lt;ffffffffc083b87f&gt;] mlx5e_poll_tx_cq+0x1ff/0x590 [mlx5_core]</span><br><span class="line">[5257172.464969]  [&lt;ffffffff95cdab02&gt;] ? default_wake_function+0x12/0x20</span><br><span class="line">[5257172.466692]  [&lt;ffffffff95cc6d3b&gt;] ? autoremove_wake_function+0x2b/0x40</span><br><span class="line">[5257172.468391]  [&lt;ffffffffc084042b&gt;] mlx5e_napi_poll+0x7b/0xd10 [mlx5_core]</span><br><span class="line">[5257172.470088]  [&lt;ffffffff95cd2ba0&gt;] ? task_rq_unlock+0x20/0x20</span><br><span class="line">[5257172.471777]  [&lt;ffffffff9625561f&gt;] net_rx_action+0x26f/0x390</span><br><span class="line">[5257172.473413]  [&lt;ffffffff95ca4b95&gt;] __do_softirq+0xf5/0x280</span><br><span class="line">[5257172.475042]  [&lt;ffffffff95ca4d58&gt;] run_ksoftirqd+0x38/0x50</span><br><span class="line">[5257172.476676]  [&lt;ffffffff95cce674&gt;] smpboot_thread_fn+0x144/0x1a0</span><br><span class="line">[5257172.478371]  [&lt;ffffffff95cce530&gt;] ? lg_double_unlock+0x40/0x40</span><br><span class="line">[5257172.480081]  [&lt;ffffffff95cc5c21&gt;] kthread+0xd1/0xe0</span><br><span class="line">[5257172.481747]  [&lt;ffffffff95cc5b50&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[5257172.483458]  [&lt;ffffffff96393df7&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line"></span><br><span class="line">crash&gt; page.first_page ffffe28a62095580</span><br><span class="line">    first_page = 0xffffe28a62095400</span><br><span class="line">crash&gt; page.flags,slab_cache 0xffffe28a62095400</span><br><span class="line">  flags = 13510794587144192</span><br><span class="line">    slab_cache = 0xffff8e19ffc03200</span><br><span class="line">crash&gt; kmem 0xffff8e19ffc03200</span><br><span class="line">CACHE            NAME                 OBJSIZE  ALLOCATED     TOTAL  SLABS  SSIZE</span><br><span class="line">ffff8e19ffc02000 kmem_cache               216        127       384     12     8k</span><br><span class="line">  SLAB              MEMORY            NODE  TOTAL  ALLOCATED  FREE</span><br><span class="line">  ffffe28a45ff0080  ffff8e19ffc02000     0     32         32     0</span><br><span class="line">  FREE / [ALLOCATED]</span><br><span class="line">  [ffff8e19ffc03200]</span><br><span class="line"></span><br><span class="line">      PAGE         PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffe28a45ff00c0  17fc03000                0        0  0 2fffff00008000 tail</span><br><span class="line">crash&gt; struct kmem_cache.name 0xffff8e19ffc03200</span><br><span class="line">  name = 0xffffffff9668fcb6 &quot;kmalloc-8192&quot;</span><br></pre></td></tr></table></figure>

<h3 id="example5-trace-the-sock"><a href="#example5-trace-the-sock" class="headerlink" title="example5 trace the sock"></a>example5 trace the sock</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">./lnet/include/lnet/lib-types.h</span><br><span class="line">        int                             ln_niinit_self;</span><br><span class="line">        /* LNetNIInit/LNetNIFini counter */</span><br><span class="line">        int                             ln_refcount;</span><br><span class="line">        /* SHUTDOWN/RUNNING/STOPPING */</span><br><span class="line"></span><br><span class="line">$ lctl --net tcp del_peer <span class="variable">$ipaddr</span></span><br><span class="line">lnet/peer.c</span><br><span class="line"> LNetPut</span><br><span class="line">  ksocknal_alloc_tx</span><br><span class="line">   ksocknal_launch_packet</span><br><span class="line"></span><br><span class="line">$ ss -tulpen</span><br><span class="line">udp    UNCONN     0      0                                                             [::]:111                                                                       [::]:*                   <span class="built_in">users</span>:((<span class="string">&quot;rpcbind&quot;</span>,pid=936,fd=9)) ino:16271 sk:ffffa0b3b54a0000 v6only:1 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">tcp    LISTEN     0      127                                                              *:988                                                                          *:*                   ino:389210 sk:ffffa0b43b7e2e80 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">tcp    LISTEN     0      128                                                              *:111                                                                          *:*                   <span class="built_in">users</span>:((<span class="string">&quot;rpcbind&quot;</span>,pid=936,fd=8)) ino:16270 sk:ffffa0b3b5548000 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">$ crash /usr/lib/debug/usr/lib/modules/3.10.0-1160.el7.x86_64/vmlinux</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.__sk_common.skc_num ffffa0b43b7e2e80</span><br><span class="line">  __sk_common.skc_num = 988</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b43b7e2e80</span><br><span class="line">  sk_rcvbuf = 134217728</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.sk_sndbuf ffffa0b43b7e2e80</span><br><span class="line">sk_sndbuf = 134217728</span><br><span class="line">net.ipv4.tcp_rmem = 65536       134217728       268435456</span><br><span class="line">net.ipv4.tcp_wmem = 65536       134217728       268435456</span><br><span class="line"></span><br><span class="line">struct sock.sk_max_ack_backlog ffffa0b43b7e2e80</span><br><span class="line">  sk_max_ack_backlog = 127</span><br><span class="line"></span><br><span class="line">rash&gt; struct sock.sk_max_ack_backlog ffffa0b3b5548000</span><br><span class="line">  sk_max_ack_backlog = 128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.__sk_common.skc_num ffffa0b3b54a0000</span><br><span class="line">  __sk_common.skc_num = 111</span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b3b54a0000</span><br><span class="line">  sk_rcvbuf = 212992</span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b3b54a0000</span><br><span class="line">  sk_rcvbuf = 212992</span><br><span class="line"></span><br><span class="line"><span class="comment">#here is my setting in this kernel, correct</span></span><br><span class="line">net.core.rmem_default = 212992</span><br><span class="line">net.core.rmem_max = 212992</span><br><span class="line">net.core.wmem_default = 212992</span><br><span class="line">net.core.wmem_max = 212992</span><br><span class="line"></span><br><span class="line"><span class="comment">#looks like the ss show the struct sock address</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /proc/net/tcp</span></span><br><span class="line">netstat -wtpeav</span><br></pre></td></tr></table></figure>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#kdump-setting"><span class="toc-number">1.</span> <span class="toc-text">kdump setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack-order"><span class="toc-number">2.</span> <span class="toc-text">stack order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loading-kernel-module"><span class="toc-number">3.</span> <span class="toc-text">loading kernel module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><span class="toc-number">4.</span> <span class="toc-text">genarate the debuginfo script, not test when compile the linux kernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example1"><span class="toc-number">5.</span> <span class="toc-text">example1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#command"><span class="toc-number">6.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example2-dump-file-content-in-memory"><span class="toc-number">7.</span> <span class="toc-text">example2 dump file content in memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example3-memory-hacking"><span class="toc-number">8.</span> <span class="toc-text">example3 memory hacking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example4"><span class="toc-number">9.</span> <span class="toc-text">example4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example5-trace-the-sock"><span class="toc-number">10.</span> <span class="toc-text">example5 trace the sock</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/03/03/crash/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/03/03/crash/&text=crash practice"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/03/03/crash/&is_video=false&description=crash practice"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=crash practice&body=Check out this article: http://example.com/2020/03/03/crash/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/03/03/crash/&name=crash practice&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/03/03/crash/&t=crash practice"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
