<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Kernel function stack frame layout123456789$ crash &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;usr&#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;vmlinux# lower memory addresses[%rsp]                      top of the stack; new items are pushed on top o">
<meta property="og:type" content="article">
<meta property="og:title" content="crash practice">
<meta property="og:url" content="http://example.com/2020/03/03/crash/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Kernel function stack frame layout123456789$ crash &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;usr&#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;vmlinux# lower memory addresses[%rsp]                      top of the stack; new items are pushed on top o">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-03T14:17:33.000Z">
<meta property="article:modified_time" content="2023-03-13T01:59:16.775Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="trace">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>crash practice</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/03/03/gdb/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2019/12/29/lfs_cmd/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/03/03/crash/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/03/03/crash/&text=crash practice"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/03/03/crash/&is_video=false&description=crash practice"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=crash practice&body=Check out this article: http://example.com/2020/03/03/crash/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/03/03/crash/&name=crash practice&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/03/03/crash/&t=crash practice"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-function-stack-frame-layout"><span class="toc-number">1.</span> <span class="toc-text">Kernel function stack frame layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kdump-setting"><span class="toc-number">2.</span> <span class="toc-text">kdump setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack-order"><span class="toc-number">3.</span> <span class="toc-text">stack order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loading-kernel-module"><span class="toc-number">4.</span> <span class="toc-text">loading kernel module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><span class="toc-number">5.</span> <span class="toc-text">genarate the debuginfo script, not test when compile the linux kernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example1"><span class="toc-number">6.</span> <span class="toc-text">example1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#command"><span class="toc-number">7.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example2-dump-file-content-in-memory"><span class="toc-number">8.</span> <span class="toc-text">example2 dump file content in memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example3-memory-hacking"><span class="toc-number">9.</span> <span class="toc-text">example3 memory hacking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example4"><span class="toc-number">10.</span> <span class="toc-text">example4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example5-trace-the-sock"><span class="toc-number">11.</span> <span class="toc-text">example5 trace the sock</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#crash-exmaple"><span class="toc-number">11.1.</span> <span class="toc-text">crash exmaple</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debug-example2"><span class="toc-number">11.2.</span> <span class="toc-text">debug example2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debug-example3"><span class="toc-number">11.3.</span> <span class="toc-text">debug example3</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#show-pr-debug-the-small-write-amplification-with-linux-soft-raid5"><span class="toc-number">11.3.1.</span> <span class="toc-text">show pr_debug, the small write amplification with linux soft raid5</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        crash practice
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-03T14:17:33.000Z" itemprop="datePublished">2020-03-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Debug/">Debug</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/debug/" rel="tag">debug</a>, <a class="tag-link-link" href="/tags/trace/" rel="tag">trace</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Kernel-function-stack-frame-layout"><a href="#Kernel-function-stack-frame-layout" class="headerlink" title="Kernel function stack frame layout"></a>Kernel function stack frame layout</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ crash /usr/lib/debug/usr/lib/modules/$(<span class="built_in">uname</span> -r)/vmlinux</span><br><span class="line"></span><br><span class="line"><span class="comment"># lower memory addresses</span></span><br><span class="line">[%rsp]                      top of the stack; new items are pushed on top of this</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[%rbp]                      base of the stack; fixed. Contains the address of the calling <span class="keyword">function</span><span class="string">&#x27;s stack frame base.</span></span><br><span class="line"><span class="string">&lt;return address&gt;            contains the address of where this function should return to, in the calling function</span></span><br><span class="line"><span class="string"># higher memory addresses</span></span><br></pre></td></tr></table></figure>
<ul>
<li>callq instruction does two things<ul>
<li>Pushes the address of the instruction following the callq instruction onto the stack (still the caller’s stack frame, at this point)<br>This will be the return address for the called function</li>
<li>Jumps to the first instruction in the called function</li>
</ul>
</li>
</ul>
<h3 id="kdump-setting"><a href="#kdump-setting" class="headerlink" title="kdump setting"></a>kdump setting</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kdump.conf</span><br><span class="line">  [-c|-l|-p]:</span><br><span class="line">      Compress dump data by each page using zlib <span class="keyword">for</span> -c option, lzo <span class="keyword">for</span> -l option</span><br><span class="line">      or snappy <span class="keyword">for</span> -p option. A user cannot specify either of these options with</span><br><span class="line">      -E option, because the ELF format does not support compressed data.</span><br><span class="line">      THIS IS ONLY FOR THE CRASH UTILITY.</span><br><span class="line">                             -------------------lzo</span><br><span class="line">                             |</span><br><span class="line">core_collector makedumpfile -l --message-level 1 -d 31</span><br></pre></td></tr></table></figure>

<h3 id="stack-order"><a href="#stack-order" class="headerlink" title="stack order"></a><a target="_blank" rel="noopener" href="https://lore.kernel.org/lkml/6ff7bb3e-917d-121c-1972-7d9ba6139a35@linux.alibaba.com/">stack order</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; bt 323179</span><br><span class="line">PID: 323179  TASK: ffff88459638c040  CPU: 25  COMMAND: <span class="string">&quot;top&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8852a9597c70] schedule at ffffffff8154a640</span></span><br><span class="line"> <span class="comment">#1 [ffff8852a9597d48] rwsem_down_failed_common at ffffffff8154d7d5</span></span><br><span class="line"> <span class="comment">#2 [ffff8852a9597da8] rwsem_down_read_failed at ffffffff8154d966</span></span><br><span class="line"> <span class="comment">#3 [ffff8852a9597de8] call_rwsem_down_read_failed at ffffffff812a8584</span></span><br><span class="line"> <span class="comment">#4 [ffff8852a9597e50] proc_pid_cmdline_read at ffffffff81209888</span></span><br><span class="line"> <span class="comment">#5 [ffff8852a9597ef0] vfs_read at ffffffff8119a455</span></span><br><span class="line"> <span class="comment">#6 [ffff8852a9597f30] sys_read at ffffffff8119a7a1</span></span><br><span class="line"> <span class="comment">#7 [ffff8852a9597f80] system_call_fastpath at ffffffff8100b0d2</span></span><br><span class="line">    RIP: 0000003e42cdb770  RSP: 00007ffc4cb59478  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000000  RBX: ffffffff8100b0d2  RCX: 0000003e42cdb770</span><br><span class="line">    RDX: 00000000000007ff  RSI: 00007ffc4cb59480  RDI: 000000000000000a</span><br><span class="line">    RBP: 0000000000000000   R8: 0000000000000000   R9: 0000003e4340be8e</span><br><span class="line">    R10: 0000000000000000  R11: 0000000000000246  R12: 0000000000000000</span><br><span class="line">    R13: 0000000000000000  R14: 00000000015f0090  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000000  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">ffff8852a9597f80 system_call_fastpath</span><br><span class="line">  ffff8852a9597f30 sys_read</span><br><span class="line">    ffff8852a9597ef0 vfs_read</span><br><span class="line">      ffff8852a9597e50 proc_pid_cmdline_read          &lt;--------- hang       stack = (high addr) ---&gt; (lower addr)</span><br><span class="line">        ffff8852a9597de8 call_rwsem_down_read_failed  &lt;--------- after hang (lower addr)</span><br><span class="line">          ffff8852a9597da8 rwsem_down_read_failed</span><br><span class="line">            ffff8852a9597d48 rwsem_down_failed_common</span><br><span class="line">              ffff8852a9597c70 schedule</span><br></pre></td></tr></table></figure>

<h3 id="loading-kernel-module"><a href="#loading-kernel-module" class="headerlink" title="loading kernel module"></a>loading kernel module</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">$ mod -S /usr/lib/debug/lib/modules/xx.ko</span><br><span class="line"></span><br><span class="line">crash&gt; mod -s i40e /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line">     MODULE       NAME                             SIZE  OBJECT FILE</span><br><span class="line">ffffffffc03b6da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">crash&gt; mod|grep i40e</span><br><span class="line">ffffffffc03b6da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line"></span><br><span class="line">crash&gt; mod -t</span><br><span class="line">NAME         TAINTS</span><br><span class="line">i40e         OE</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /sys/module/nfsd/sections</span><br><span class="line">$ <span class="built_in">cat</span> .text .data .bss</span><br><span class="line">0xffffffffc1422000------------------------------------------------------------------------</span><br><span class="line">0xffffffffc1462000-----------------------------------------------------------------------|---------------------------</span><br><span class="line">0xffffffffc1468040-----------------------------------------------------------------------|--------------------------|-------------------------</span><br><span class="line">                                                                                         |                          |                        |</span><br><span class="line">crash&gt; add-symbol-file /lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko 0xffffffffc1422000 -s .data 0xffffffffc1462000 -s .bss 0xffffffffc1468040</span><br><span class="line"></span><br><span class="line">add symbol table from file <span class="string">&quot;/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc1422000</span><br><span class="line">        .data_addr = 0xffffffffc1462000</span><br><span class="line">        .bss_addr = 0xffffffffc1468040</span><br><span class="line">Reading symbols from /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko...Reading symbols from /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/nfsd/nfsd.ko.debug...done.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#show module info</span></span><br><span class="line">crash&gt; mod |grep -e NAME -e i40e</span><br><span class="line">     MODULE       NAME                             SIZE  OBJECT FILE</span><br><span class="line">ffffffffc0220da0  i40e                           510664  /lib/modules/3.10.0-1160.2.1.el7_lustre.x86_64/updates/drivers/net/ethernet/intel/i40e/i40e.ko</span><br><span class="line">     |</span><br><span class="line">     ------------------------------------------------</span><br><span class="line">                                                    |</span><br><span class="line">crash&gt; module.name,version,srcversion,sig_ok ffffffffc0220da0</span><br><span class="line">  name = <span class="string">&quot;i40e\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span></span><br><span class="line">  version = 0xffff8a7184389380 <span class="string">&quot;2.13.10&quot;</span></span><br><span class="line">  srcversion = 0xffff8a7183fc26a0 <span class="string">&quot;597EBD96218776AAA546464&quot;</span></span><br><span class="line">  sig_ok = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">crash&gt; module.version ffffffffc03b6da0</span><br><span class="line">  version = 0xffff986f02be7098 <span class="string">&quot;2.13.10&quot;</span></span><br><span class="line"></span><br><span class="line">[36794.588796] BUG: Bad page state <span class="keyword">in</span> process swapper/7  pfn:137bba</span><br><span class="line">[36794.589974] page:ffffcb3d44deee80 count:-1 mapcount:0 mapping:          (null) index:0x0</span><br><span class="line">[36794.591073] page flags: 0x2fffff00000000()</span><br><span class="line">[36794.592149] page dumped because: nonzero _count</span><br><span class="line">[36794.593218] Modules linked <span class="keyword">in</span>: osp(OE) ofd(OE) lfsck(OE) ost(OE) mgc(OE) osd_ldiskfs(OE) ldiskfs(OE) lquota(OE) fid(OE) fld(OE) ksocklnd(OE) ptlrpc(OE) mbcache jbd2 obdclass(OE) lnet(OE) libcfs(OE) bonding mpt2sas mptctl mptbase dell_rbu dcdbas sunrpc vfat fat iTCO_wdt iTCO_vendor_support zfs(POE) zunicode(POE) zavl(POE) icp(POE) sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr nvme nvme_core joydev zcommon(POE) znvpair(POE) spl(OE) lpc_ich mei_me mei raid0 i2c_i801 ses enclosure sg ioatdma ipmi_si ipmi_devintf ipmi_msghandler acpi_power_meter acpi_pad wmi binfmt_misc ip_tables xfs libcrc32c raid1 sd_mod crc_t10dif crct10dif_generic ast drm_kms_helper syscopyarea sysfillrect</span><br><span class="line">[36794.600275]  sysimgblt fb_sys_fops ttm drm ixgbe mpt3sas ahci igb libahci i40e(OE) raid_class mdio crct10dif_pclmul crct10dif_common libata crc32c_intel ptp drm_panel_orientation_quirks scsi_transport_sas dca i2c_algo_bit pps_core</span><br><span class="line">[36794.603927] CPU: 7 PID: 0 Comm: swapper/7 Kdump: loaded Tainted: P           OE  ------------   3.10.0-1160.2.1.el7_lustre.x86_64 <span class="comment">#1</span></span><br><span class="line">[36794.606340] Hardware name: Supermicro SSG-2028R-DE2CR24L/X10DRS-2U, BIOS 2.1 11/04/2016</span><br><span class="line">[36794.607569] Call Trace:</span><br><span class="line">[36794.608749]  &lt;IRQ&gt;  [&lt;ffffffff94f813c0&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[36794.609958]  [&lt;ffffffff94f7bf7d&gt;] bad_page.part.75+0xdc/0xf9</span><br><span class="line">[36794.611190]  [&lt;ffffffff949c8625&gt;] get_page_from_freelist+0x7a5/0xac0</span><br><span class="line">[36794.612395]  [&lt;ffffffff94e07e29&gt;] ? __domain_mapping+0x209/0x3c0</span><br><span class="line">[36794.613525]  [&lt;ffffffff949c8aa6&gt;] __alloc_pages_nodemask+0x166/0x450</span><br><span class="line">[36794.614737]  [&lt;ffffffffc0380578&gt;] i40e_alloc_rx_buffers+0x158/0x2f0 [i40e]</span><br><span class="line">[36794.615952]  [&lt;ffffffffc0380c8c&gt;] i40e_clean_rx_irq+0x57c/0xb40 [i40e]</span><br><span class="line">[36794.617189]  [&lt;ffffffffc03815a1&gt;] i40e_napi_poll+0x351/0x7a0 [i40e]</span><br><span class="line">[36794.618342]  [&lt;ffffffff94e5561f&gt;] net_rx_action+0x26f/0x390</span><br><span class="line">[36794.619425]  [&lt;ffffffff948a4b95&gt;] __do_softirq+0xf5/0x280</span><br><span class="line">[36794.620544]  [&lt;ffffffff94f974ec&gt;] call_softirq+0x1c/0x30</span><br><span class="line">[36794.621622]  [&lt;ffffffff9482f715&gt;] do_softirq+0x65/0xa0</span><br><span class="line">[36794.622749]  [&lt;ffffffff948a4f15&gt;] irq_exit+0x105/0x110</span><br><span class="line">[36794.623874]  [&lt;ffffffff94f98936&gt;] do_IRQ+0x56/0xf0</span><br><span class="line">[36794.624903]  [&lt;ffffffff94f8a36a&gt;] common_interrupt+0x16a/0x16a</span><br><span class="line">[36794.625943]  &lt;EOI&gt;  [&lt;ffffffff94f897b2&gt;] ? poll_idle+0x92/0xab</span><br><span class="line">[36794.626987]  [&lt;ffffffff94f897bc&gt;] ? poll_idle+0x9c/0xab</span><br><span class="line">[36794.628027]  [&lt;ffffffff94dc71f5&gt;] cpuidle_enter_state+0x45/0xd0</span><br><span class="line">[36794.629035]  [&lt;ffffffff94dc735e&gt;] cpuidle_idle_call+0xde/0x230</span><br><span class="line">[36794.629964]  [&lt;ffffffff94837c8e&gt;] arch_cpu_idle+0xe/0xc0</span><br><span class="line">[36794.630938]  [&lt;ffffffff949011ea&gt;] cpu_startup_entry+0x14a/0x1e0</span><br><span class="line">[36794.631895]  [&lt;ffffffff9485a7f7&gt;] start_secondary+0x1f7/0x270</span><br><span class="line">[36794.632856]  [&lt;ffffffff948000d5&gt;] start_cpu+0x5/0x14</span><br><span class="line">[36794.622749]  [&lt;ffffffff948a4f15&gt;] irq_exit+0x105/0x110</span><br></pre></td></tr></table></figure>



<h3 id="genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><a href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel" class="headerlink" title="genarate the debuginfo script, not test when compile the linux kernel"></a>genarate the debuginfo script, not test when compile the linux kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `find /lib/modules/5.10.41 -name <span class="string">&#x27;*.ko&#x27;</span> -<span class="built_in">print</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        buildid=`eu-readelf -n <span class="variable">$file</span>| grep Build.ID: | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">        <span class="built_in">dir</span>=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c1-2`</span><br><span class="line">        fn=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c3-`</span><br><span class="line">        <span class="built_in">mkdir</span> -p /usr/lib/debug/.build-id/<span class="variable">$dir</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$fn</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$&#123;fn&#125;</span>.debug</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ sudo stap -l <span class="string">&#x27;module(&quot;iwlwifi&quot;).function(&quot;*&quot;)&#x27;</span></span><br><span class="line">module(<span class="string">&quot;iwlwifi&quot;</span>).<span class="keyword">function</span>(<span class="string">&quot;__iwl_crit&quot;</span>)</span><br><span class="line">module(<span class="string">&quot;iwlwifi&quot;</span>).<span class="keyword">function</span>(<span class="string">&quot;__iwl_err&quot;</span>)</span><br><span class="line"></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe begin &#123; log(&quot;hello world&quot;) exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe begin &#123; printf(&quot;hello world\n&quot;); exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -ve <span class="string">&#x27;probe nd_syscall.read &#123; printf(&quot;hello world\n&quot;); exit() &#125;&#x27;</span></span><br><span class="line">$ sudo stap -vL <span class="string">&#x27;process(&quot;./h264ref&quot;).function(&quot;*&quot;)&#x27;</span></span><br><span class="line">$ sudo stap -v -e <span class="string">&#x27;probe vfs.read &#123;printf(“read performed\n”); exit()&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="example1"><a href="#example1" class="headerlink" title="example1"></a><a target="_blank" rel="noopener" href="https://blogs.oracle.com/linux/post/extracting-kernel-stack-function-arguments-from-linux-x86-64-kernel-crash-dumps">example1</a></h3><ul>
<li><p>用户模式的系统调用依次传递的寄存器为:</p>
<ul>
<li>rdi，rsi，rdx，rcx，r8和r9</li>
</ul>
</li>
<li><p>内核接口的系统调用一次传递的寄存器为:</p>
<ul>
<li>rdi，rsi，rdx，r10，r8和r9</li>
<li>注意这里和用户模式的系统调用只有第4个寄存器不同，其他都相同。</li>
</ul>
</li>
<li><p>系统调用通过syscall指令进入，不像32位下的汇编使用的是int 0x80指令；</p>
</li>
<li><p>系统调用号放在rax寄存器里；</p>
</li>
<li><p>系统调用限制最多6个参数，没有参数直接通过栈传递，原话是:</p>
<ul>
<li>System-calls are limited to six arguments, no argument is passed directly on the stack</li>
</ul>
</li>
<li><p>系统调用的返回结果，也就是syscall指令的返回放在rax寄存器中；</p>
</li>
<li><p>只有整形值和内存型的值可以传递给内核，这个也不十分明白，原话是:</p>
<ul>
<li>Only values of class INTEGER or class MEMORY are passed to the kernel<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">编译连接命令如下：</span><br><span class="line">nasm -f elf64 p.s</span><br><span class="line">ld -o p p.o</span><br><span class="line"></span><br><span class="line">nasm -f elf32 p.s</span><br><span class="line">ld -o p p.o</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nasm -f macho64 p.s</span><br><span class="line">ld -o p p.o</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mov %r12,%rdi:  places the contents of cpu register %r12 into register %rdi, %r12 —&gt; %rdi</p>
</li>
<li><p>mov 0x8(%r14),%rcx</p>
<ul>
<li>takes the value of register %r14, adds 8 to it</li>
<li>takes the result as the address of a memory location, reads the value at that memory location and puts it into register %rcx<ul>
<li>%R14 + 8 (value is the addr of a memory location) —&gt; %rcx</li>
</ul>
</li>
<li>0x8(%r14) &#x3D; %r14+0x8 (indirect addressing mode)<ul>
<li>Both denote the content of memory at address location</li>
</ul>
</li>
</ul>
</li>
<li><p>The calling function might retrieve the values from:</p>
<ul>
<li>Memory</li>
<li>The calling function’s stack, via an offset from the (fixed) base of the stack</li>
<li>Another register, which got its value from one of these above in turnz</li>
</ul>
</li>
<li><p>The called function might save the values it received in the registers</p>
<ul>
<li>Memory</li>
<li>The called function’s stack, via push</li>
<li>Another register, which might itself then be saved in turn</li>
</ul>
</li>
<li><p>Disassemble either or both of</p>
<ul>
<li>The calling function, leading up to the callq instruction, to see from where it obtains the values it passes to the called function in the registers</li>
<li>The called function, to see whether it puts the values from the registers onto its stack, or into memory</li>
</ul>
</li>
<li><p>Inspect those areas (caller&#x2F;callee stack and&#x2F;or memory) to see if the values may be extracted</p>
</li>
<li><p>The 1st argument will be passed in %rdi, %edi, %di or %dil. Note that all the names contain “di”.</p>
</li>
<li><p>For the Linux kernel running on the x86-64 architecture, kernel function arguments are normally passed using 64-bit cpu registers. The first six arguments to a function are passed in the following cpu registers, respectively:</p>
<ul>
<li>x86 64 bit<ul>
<li>1st: %rdi</li>
<li>2nd: %rsi</li>
<li>3rd: %rdx</li>
<li>4th: %rcx</li>
<li>5th: %r8</li>
<li>6th: %r9</li>
</ul>
</li>
<li>32 bit<ul>
<li>1st: %edi</li>
<li>2nd: %esi</li>
<li>3rd: %edx</li>
<li>4th: %ecx</li>
<li>5th: %r8d</li>
<li>6th: %r9d</li>
</ul>
</li>
<li>16 bit<ul>
<li>1st: %di</li>
<li>2nd: %si</li>
<li>3rd: %dx</li>
<li>4th: %cx</li>
<li>5th: %r8w</li>
<li>6th: %r9w</li>
</ul>
</li>
<li>8 bit<ul>
<li>1st: %dil</li>
<li>2nd: %sil</li>
<li>3rd: %dh&#x2F;%dl</li>
<li>4th: %ch&#x2F;%cl</li>
<li>5th: %r8b</li>
<li>6th: %r9b<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#linux/arch/x86/entry/common.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_X86_64</span></span><br><span class="line">                <span class="keyword">if</span> (arch == AUDIT_ARCH_X86_64) &#123;</span><br><span class="line">                        sd.args[<span class="number">0</span>] = regs-&gt;di;</span><br><span class="line">                        sd.args[<span class="number">1</span>] = regs-&gt;si;</span><br><span class="line">                        sd.args[<span class="number">2</span>] = regs-&gt;dx;</span><br><span class="line">                        sd.args[<span class="number">3</span>] = regs-&gt;r10;</span><br><span class="line">                        sd.args[<span class="number">4</span>] = regs-&gt;r8;</span><br><span class="line">                        sd.args[<span class="number">5</span>] = regs-&gt;r9;</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">                &#123;</span><br><span class="line">                        sd.args[<span class="number">0</span>] = regs-&gt;bx;</span><br><span class="line">                        sd.args[<span class="number">1</span>] = regs-&gt;cx;</span><br><span class="line">                        sd.args[<span class="number">2</span>] = regs-&gt;dx;</span><br><span class="line">                        sd.args[<span class="number">3</span>] = regs-&gt;si;</span><br><span class="line">                        sd.args[<span class="number">4</span>] = regs-&gt;di;</span><br><span class="line">                        sd.args[<span class="number">5</span>] = regs-&gt;bp;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Whilst the function is executing, this is stored in the %rbp register, the function’s stack frame base pointer.</p>
</li>
<li><p>-sx tells bt to try to show addresses as as symbol name plus a hex offset</p>
<ul>
<li>bt -sx</li>
</ul>
</li>
<li><p>to see the actual stack content, i.e. the content of the stack frames, for each function call</p>
<ul>
<li>bt -FFsx</li>
<li>-FF tells bt to show all the data for a stack frame, symbolically, with its slab cache name, if appropriate<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   crash7latest&gt; bt -FFsx</span><br><span class="line">       ...</span><br><span class="line">   ffff88180dc37ca8: ***ffff88180dc37d58*** do_last+<span class="number">901</span> &lt;&lt;&lt;------ The <span class="built_in">stack</span> frame of the calling function do_last is shown above</span><br><span class="line">#<span class="number">5</span> [ffff88180dc37cb0] do_last+<span class="number">0x385</span> at ffffffff812140b5           Its <span class="built_in">stack</span> frame base pointer <span class="number">0xffff88180dc37d58</span> appears in two locations, shown highlighted with ***</span><br><span class="line">   ffff88180dc37cb8: <span class="number">0000000000000000</span> <span class="number">0000000000000000</span></span><br><span class="line">   ffff88180dc37cc8: [ffff883f64c7cda0:mnt_cache] [ffff881d4601f740:dentry]</span><br><span class="line">   ffff88180dc37cd8: [ffff881d4603e600:ext3_inode_cache] kmem_cache_alloc+<span class="number">546</span></span><br><span class="line">   ffff88180dc37ce8: [ffff881d4603e600:ext3_inode_cache] [ffff881dfc120000:kmalloc<span class="number">-4096</span>]</span><br><span class="line">   ffff88180dc37cf8: <span class="number">000001000000002</span>a [ffff8817ec6b7600:kmalloc<span class="number">-256</span>]</span><br><span class="line">   ffff88180dc37d08: ffff88180dc37da4 [ffff881d4601f740:dentry]</span><br><span class="line">   ffff88180dc37d18: ffff88180dc37d58 path_init+<span class="number">185</span></span><br><span class="line">   ffff88180dc37d28: ffff88180dc37d58 [ffff8817ec6b7600:kmalloc<span class="number">-256</span>]</span><br><span class="line">   ffff88180dc37d38: ffff88180dc37e08 ffff88180dc37ef4</span><br><span class="line">   ffff88180dc37d48: [ffff881dfc120000:kmalloc<span class="number">-4096</span>] <span class="number">0000000000000041</span></span><br><span class="line">***ffff88180dc37d58***: ffff88180dc37df8 path_openat+<span class="number">128</span></span><br><span class="line">#<span class="number">6</span> [ffff88180dc37d60] path_openat+<span class="number">0x80</span> at ffffffff81214fc0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>The stack frame base pointer, for a function, may be found:</p>
<ul>
<li>As the second-last value in the stack frame above the function (i.e. above in the bt output)</li>
<li>As the location of the second-last value in the stack frame for the function</li>
</ul>
</li>
</ul>
<p>read the function parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; ps | grep UN</span><br><span class="line">  30885  30799   1  ffff8b95709c3180  UN   0.0  109136   1664  <span class="built_in">dd</span></span><br><span class="line">crash&gt; bt 30885</span><br><span class="line">PID: 30885  TASK: ffff8b95709c3180  CPU: 1   COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8b955217b9c8] __schedule at ffffffff90f86c47</span></span><br><span class="line"> <span class="comment">#1 [ffff8b955217ba58] schedule at ffffffff90f87169</span></span><br><span class="line"> <span class="comment">#2 [ffff8b955217ba68] schedule_timeout at ffffffff90f84b98</span></span><br><span class="line"> <span class="comment">#3 [ffff8b955217bb18] io_schedule_timeout at ffffffff90f8683d</span></span><br><span class="line"> <span class="comment">#4 [ffff8b955217bb48] balance_dirty_pages at ffffffff90f7cf90</span></span><br><span class="line"> <span class="comment">#5 [ffff8b955217bc68] balance_dirty_pages_ratelimited at ffffffff909caac7</span></span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write at ffffffff909bd845</span></span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write at ffffffff909c0422</span></span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write at ffffffff90a4d063</span></span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write at ffffffff90a4db50</span></span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write at ffffffff90a4e92f</span></span><br><span class="line"><span class="comment">#12 [ffff8b955217bf50] system_call_fastpath at ffffffff90f93f92</span></span><br><span class="line">    RIP: 00007f9d11d46a00  RSP: 00007ffc357a18b8  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000001  RBX: 0000000000000000  RCX: 00007f9d11d46a00</span><br><span class="line">    RDX: 0000000000100000  RSI: 00007f9d1213b000  RDI: 0000000000000001</span><br><span class="line">    RBP: 0000000000100000   R8: ffffffffffffffff   R9: 0000000000102003</span><br><span class="line">    R10: 00007ffc357a0c60  R11: 0000000000000246  R12: 0000000000100000</span><br><span class="line">    R13: 00007f9d1213b000  R14: 00007f9d1223b000  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000001  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">crash&gt; <span class="built_in">set</span> 30885</span><br><span class="line">    PID: 30885</span><br><span class="line">COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line">   TASK: ffff8b95709c3180  [THREAD_INFO: ffff8b9552178000]</span><br><span class="line">    CPU: 1</span><br><span class="line">  STATE: TASK_UNINTERRUPTIBLE|TASK_WAKEKILL </span><br><span class="line">crash&gt; bt -sxl </span><br><span class="line">PID: 30885  TASK: ffff8b95709c3180  CPU: 1   COMMAND: <span class="string">&quot;dd&quot;</span></span><br><span class="line"> <span class="comment">#0 [ffff8b955217b9c8] __schedule+0x367 at ffffffff90f86c47</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/sched/core.c: 2596</span><br><span class="line"> <span class="comment">#1 [ffff8b955217ba58] schedule+0x29 at ffffffff90f87169</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/sched/core.c: 3660</span><br><span class="line"> <span class="comment">#2 [ffff8b955217ba68] schedule_timeout+0x168 at ffffffff90f84b98</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/kernel/timer.c: 1553</span><br><span class="line"> <span class="comment">#3 [ffff8b955217bb18] io_schedule_timeout+0xad at ffffffff90f8683d</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/arch/x86/include/asm/current.h: 14</span><br><span class="line"> <span class="comment">#4 [ffff8b955217bb48] balance_dirty_pages+0x5be at ffffffff90f7cf90</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/page-writeback.c: 1522</span><br><span class="line"> <span class="comment">#5 [ffff8b955217bc68] balance_dirty_pages_ratelimited+0xe7 at ffffffff909caac7</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/page-writeback.c: 1655</span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write+0x195 at ffffffff909bd845</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/include/linux/sched.h: 3008</span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write+0x1e2 at ffffffff909c0422</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/filemap.c: 3295</span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write+0x94 at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write+0x93 at ffffffff90a4d063</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 492</span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 543</span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write+0x7f at ffffffff90a4e92f</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 593</span><br><span class="line"><span class="comment">#12 [ffff8b955217bf50] system_call_fastpath+0x25 at ffffffff90f93f92</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/arch/x86/kernel/entry_64.S: 511</span><br><span class="line">    RIP: 00007f9d11d46a00  RSP: 00007ffc357a18b8  RFLAGS: 00000246</span><br><span class="line">    RAX: 0000000000000001  RBX: 0000000000000000  RCX: 00007f9d11d46a00</span><br><span class="line">    RDX: 0000000000100000  RSI: 00007f9d1213b000  RDI: 0000000000000001</span><br><span class="line">    RBP: 0000000000100000   R8: ffffffffffffffff   R9: 0000000000102003</span><br><span class="line">    R10: 00007ffc357a0c60  R11: 0000000000000246  R12: 0000000000100000</span><br><span class="line">    R13: 00007f9d1213b000  R14: 00007f9d1223b000  R15: 0000000000000000</span><br><span class="line">    ORIG_RAX: 0000000000000001  CS: 0033  SS: 002b</span><br><span class="line"></span><br><span class="line">ssize_t vfs_write(struct file *file, const char __user *buf, size_t count, loff_t *pos)</span><br><span class="line">                         |</span><br><span class="line">                         ----first parameter</span><br><span class="line"></span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 543</span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bee0: 0000000000000000 00007f9d1213b000</span><br><span class="line">    ffff8b955217bef0: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bf00: ffff8b955217bf48 sys_write+127</span><br><span class="line">         |</span><br><span class="line">         --------------&gt; found here: the <span class="string">&quot;vfs_write&quot;</span> base pointer(0xffff8b955217bf00), and it contains a pointer to the parent(sys_write) stack frame base pointer (0xffff8b955217bf48)</span><br><span class="line"><span class="comment">#11 [ffff8b955217bf08] sys_write+0x7f at ffffffff90a4e92f                                              </span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/fs/read_write.c: 593</span><br><span class="line">    ffff8b955217bf10: ffff8b955217bf48 000000026bb00000</span><br><span class="line">    ffff8b955217bf20: 0000000053112767 0000000000000000</span><br><span class="line">    ffff8b955217bf30: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bf40: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bf50: system_call_fastpath+37</span><br><span class="line"></span><br><span class="line">crash&gt; dis -rx sys_write+0x7f | <span class="built_in">tail</span></span><br><span class="line">0xffffffff90a4e90c &lt;sys_write+0x5c&gt;:    or     <span class="variable">$0x2</span>,%r12d</span><br><span class="line">0xffffffff90a4e910 &lt;sys_write+0x60&gt;:    callq  0xffffffff90f853b0 &lt;mutex_lock&gt;</span><br><span class="line">0xffffffff90a4e915 &lt;sys_write+0x65&gt;:    mov    0x48(%rbx),%rax</span><br><span class="line">0xffffffff90a4e919 &lt;sys_write+0x69&gt;:    lea    -0x30(%rbp),%rcx</span><br><span class="line">0xffffffff90a4e91d &lt;sys_write+0x6d&gt;:    mov    %r14,%rdx</span><br><span class="line">0xffffffff90a4e920 &lt;sys_write+0x70&gt;:    mov    %r13,%rsi</span><br><span class="line">0xffffffff90a4e923 &lt;sys_write+0x73&gt;:    mov    %rbx,%rdi  &lt;-------------------rbx to rdi</span><br><span class="line">0xffffffff90a4e926 &lt;sys_write+0x76&gt;:    mov    %rax,-0x30(%rbp)</span><br><span class="line">0xffffffff90a4e92a &lt;sys_write+0x7a&gt;:    callq  0xffffffff90a4da90 &lt;vfs_write&gt;</span><br><span class="line">0xffffffff90a4e92f &lt;sys_write+0x7f&gt;:    <span class="built_in">test</span>   %rax,%rax</span><br><span class="line"></span><br><span class="line">crash&gt; dis -x vfs_write | <span class="built_in">head</span></span><br><span class="line">0xffffffff90a4da90 &lt;vfs_write&gt;: nopl   0x0(%rax,%rax,1) [FTRACE NOP]</span><br><span class="line">0xffffffff90a4da95 &lt;vfs_write+0x5&gt;:     push   %rbp</span><br><span class="line">0xffffffff90a4da96 &lt;vfs_write+0x6&gt;:     mov    %rsp,%rbp  </span><br><span class="line">0xffffffff90a4da99 &lt;vfs_write+0x9&gt;:     push   %r15       +1</span><br><span class="line">0xffffffff90a4da9b &lt;vfs_write+0xb&gt;:     push   %r14       +1</span><br><span class="line">0xffffffff90a4da9d &lt;vfs_write+0xd&gt;:     push   %r13       +1</span><br><span class="line">0xffffffff90a4da9f &lt;vfs_write+0xf&gt;:     push   %r12       +1</span><br><span class="line">0xffffffff90a4daa1 &lt;vfs_write+0x11&gt;:    push   %rbx       +1 --------------------------------push rbx(save the old value), here is 5*8</span><br><span class="line">0xffffffff90a4daa2 &lt;vfs_write+0x12&gt;:    mov    %rdi,%rbx  &lt;---move rdi to rbx, px (0xffff8b955217bf00 - 5*8) = <span class="variable">$1</span> = 0xffff8b955217bed8</span><br><span class="line">0xffffffff90a4daa5 &lt;vfs_write+0x15&gt;:    sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"></span><br><span class="line">crash&gt; rd  0xffff8b955217bed8</span><br><span class="line">ffff8b955217bed8:  ffff8b956f4d7b00                    .&#123;Mo....</span><br><span class="line"></span><br><span class="line">crash&gt; bt -FF | grep ffff8b956f4d7b00</span><br><span class="line">    ffff8b955217bcc0: [ffff8b956f4d7b00:kmalloc-256] ffffe5d984745e00</span><br><span class="line">    ffff8b955217bd00: 0000000000000000 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd78: 0000000053112767 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217be08: 0000000000000001 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217beb8: [ffff8b956f4d7b00:kmalloc-256] ffff8b955217bf00</span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">crash&gt; struct -p file.f_op ffff8b956f4d7b00 | grep seek</span><br><span class="line">       llseek = 0xffffffffc09a9860,</span><br><span class="line">crash&gt; struct file.f_path ffff8b956f4d7b00</span><br><span class="line">  f_path = &#123;</span><br><span class="line">    mnt = 0xffff8b947e2ea020,</span><br><span class="line">    dentry = 0xffff8b954ef5f900</span><br><span class="line">  &#125;</span><br><span class="line">crash&gt; dentry.d_name.name 0xffff8b954ef5f900</span><br><span class="line">  d_name.name = 0xffff8b954ef5f938 <span class="string">&quot;test1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the parent path</span></span><br><span class="line">crash&gt; dentry.d_parent 0xffff8b954ef5f900</span><br><span class="line">  d_parent = 0xffff8b9549646780</span><br><span class="line">crash&gt; dentry.d_name.name 0xffff8b9549646780</span><br><span class="line">  d_name.name = 0xffff8b95496467b8 <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#contains the ffff8b956f4d7b00</span></span><br><span class="line"> <span class="comment">#6 [ffff8b955217bc78] generic_file_buffered_write+0x195 at ffffffff909bd845</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/include/linux/sched.h: 3008</span><br><span class="line">    ffff8b955217bc80: .LC4+80          ffff8b955217be40</span><br><span class="line">    ffff8b955217bc90: 000000026bb00000 0000000000001000</span><br><span class="line">    ffff8b955217bca0: [ffff8b95709c3180:task_struct] 000000004ef5f900</span><br><span class="line">    ffff8b955217bcb0: 000000000008f000 0000000000000000</span><br><span class="line">    ffff8b955217bcc0: [ffff8b956f4d7b00:kmalloc-256] ffffe5d984745e00</span><br><span class="line">    ffff8b955217bcd0: .LC4+80          ffff8b955217bdf8</span><br><span class="line">    ffff8b955217bce0: 0000000000000001 000000000008f000</span><br><span class="line">    ffff8b955217bcf0: 0000000000071000 0000000053112767</span><br><span class="line">    ffff8b955217bd00: 0000000000000000 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd10: [ffff8b945d8d0f60:nfs_inode_cache] ffff8b955217be08</span><br><span class="line">    ffff8b955217bd20: ffff8b955217bdf8 ffff8b955217bda8</span><br><span class="line">    ffff8b955217bd30: __generic_file_aio_write+482</span><br><span class="line"> <span class="comment">#7 [ffff8b955217bd30] __generic_file_aio_write+0x1e2 at ffffffff909c0422</span></span><br><span class="line">    /usr/src/debug/kernel-3.10.0-1160.el7/linux-3.10.0-1160.el7.x86_64/mm/filemap.c: 3295</span><br><span class="line">    ffff8b955217bd38: 0000000000000000 ffff8b955217bd68</span><br><span class="line">    ffff8b955217bd48: 0000000000100000 000000026bb00000</span><br><span class="line">    ffff8b955217bd58: [ffff8b945d8d0e10:nfs_inode_cache] ffff8b955217be40</span><br><span class="line">    ffff8b955217bd68: 0000000000000001 0000000000100000</span><br><span class="line">    ffff8b955217bd78: 0000000053112767 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bd88: [ffff8b945d8d0e10:nfs_inode_cache] 000000026bb00000</span><br><span class="line">    ffff8b955217bd98: ffff8b955217bdf8 ffff8b955217be08</span><br><span class="line">    ffff8b955217bda8: ffff8b955217bde8 nfs_file_write+148</span><br><span class="line"> <span class="comment">#8 [ffff8b955217bdb0] nfs_file_write+0x94 at ffffffffc09aa0e4 [nfs]</span></span><br><span class="line">    ffff8b955217bdb8: 0000000000000001 ffff8b955217bf18</span><br><span class="line">    ffff8b955217bdc8: 00007f9d1213b000 ffff8b955217bf18</span><br><span class="line">    ffff8b955217bdd8: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bde8: ffff8b955217bec0 do_sync_write+147</span><br><span class="line"> <span class="comment">#9 [ffff8b955217bdf0] do_sync_write+0x93 at ffffffff90a4d063</span></span><br><span class="line">    ffff8b955217bdf8: 00007f9d1213b000 0000000000100000</span><br><span class="line">    ffff8b955217be08: 0000000000000001 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217be18: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be28: 0000000000000000 [ffff8b95709c3180:task_struct]</span><br><span class="line">    ffff8b955217be38: 0000000000000000 000000026bb00000</span><br><span class="line">    ffff8b955217be48: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be58: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217be68: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217be78: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be88: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217be98: 0000000000000000 0000000000000000</span><br><span class="line">    ffff8b955217bea8: 0000000000000000 0000000053112767</span><br><span class="line">    ffff8b955217beb8: [ffff8b956f4d7b00:kmalloc-256] ffff8b955217bf00</span><br><span class="line">    ffff8b955217bec8: vfs_write+192</span><br><span class="line"><span class="comment">#10 [ffff8b955217bec8] vfs_write+0xc0 at ffffffff90a4db50</span></span><br><span class="line">    ffff8b955217bed0: ffff8b955217bf00 [ffff8b956f4d7b00:kmalloc-256]</span><br><span class="line">    ffff8b955217bee0: 0000000000000000 00007f9d1213b000</span><br><span class="line">    ffff8b955217bef0: 0000000000100000 0000000000000000</span><br><span class="line">    ffff8b955217bf00: ffff8b955217bf48 sys_write+127</span><br></pre></td></tr></table></figure>

<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#show all info if you input the wrong keyword </span></span><br><span class="line"></span><br><span class="line">crash&gt; struct skb_shared_info <span class="built_in">ls</span> | <span class="built_in">head</span></span><br><span class="line">symbol not found: <span class="built_in">ls</span></span><br><span class="line">possible alternatives:</span><br><span class="line">  f760 (d) shadow_tls_desc</span><br><span class="line">  1a540 (d) cpu_worker_pools</span><br><span class="line">  ffffffff9c61b4a0 (t) xen_load_tls</span><br><span class="line">  ffffffff9c6350f0 (T) arch_check_bp_in_kernelspace</span><br><span class="line">  ffffffff9c63c250 (t) set_tls_desc</span><br><span class="line">  ffffffff9c63c6d0 (T) regset_tls_active</span><br><span class="line">  ffffffff9c63c710 (T) regset_tls_get</span><br><span class="line">  ffffffff9c63c860 (T) regset_tls_set</span><br><span class="line">... &lt;-------------- show all</span><br><span class="line"></span><br><span class="line">foreach IN bt</span><br><span class="line">foreach bt -tf</span><br><span class="line">bt -t <span class="variable">$pid</span></span><br><span class="line">bt -l <span class="variable">$pid</span></span><br><span class="line">bt -a</span><br><span class="line">task | grep rsp</span><br><span class="line">rsp0 = 0xx0</span><br><span class="line">rsp = 0xx1</span><br><span class="line">rd <span class="variable">$rsp</span> -e <span class="variable">$rsp0</span> -s</span><br><span class="line">dev == <span class="built_in">cat</span> /proc/ioports /proc/iomem</span><br><span class="line">kem -s</span><br><span class="line">kmem -i</span><br><span class="line">kmem -p</span><br><span class="line">kmem 0x<span class="variable">$addr</span></span><br><span class="line">the addr <span class="keyword">in</span> the [0xxxx] means not release</span><br><span class="line">whatis moduels</span><br><span class="line">list modules</span><br><span class="line">whatis ip_packet_type</span><br><span class="line">struct -o packet_type</span><br><span class="line">list -o 0x30 ip_packet_type</span><br><span class="line">list -o 0x30 ip_packet_type -s packet_type.func</span><br><span class="line">net</span><br><span class="line">struct net_device <span class="variable">$addr</span></span><br><span class="line">runq</span><br><span class="line">    CPU 0 RUNQUEUE: ffff880001cdb460</span><br><span class="line">      CURRENT: PID: 2739   TASK: ffff8800320fa7e0  COMMAND: <span class="string">&quot;bash&quot;</span></span><br><span class="line">      ACTIVE PRIO_ARRAY: ffff880001cdb4d8</span><br><span class="line">         [115] PID: 2739   TASK: ffff8800320fa7e0  COMMAND: <span class="string">&quot;bash&quot;</span></span><br><span class="line">               PID: 1776   TASK: ffff88003217d820  COMMAND: <span class="string">&quot;syslogd&quot;</span></span><br><span class="line">      EXPIRED PRIO_ARRAY: ffff880001cdbdb8</span><br><span class="line">         [no tasks queued]</span><br><span class="line"></span><br><span class="line">    CPU 1 RUNQUEUE: ffff880001ce3460</span><br><span class="line">      CURRENT: PID: 1779   TASK: ffff88003207a860  COMMAND: <span class="string">&quot;klogd&quot;</span></span><br><span class="line">      ACTIVE PRIO_ARRAY: ffff880001ce34d8</span><br><span class="line">         [115] PID: 1779   TASK: ffff88003207a860  COMMAND: <span class="string">&quot;klogd&quot;</span></span><br><span class="line">      EXPIRED PRIO_ARRAY: ffff880001ce3db8</span><br><span class="line">         [no tasks queued]</span><br><span class="line">runq -t</span><br><span class="line">runq -g</span><br><span class="line">runq -g -c3</span><br><span class="line">sig</span><br><span class="line">sig -l = <span class="built_in">kill</span> -l</span><br><span class="line">swap</span><br><span class="line">sym</span><br><span class="line">sym -l = system.map</span><br><span class="line">sys</span><br><span class="line">sys config</span><br><span class="line">task</span><br><span class="line">timer</span><br><span class="line">wr</span><br><span class="line"></span><br><span class="line">rd jiffies_64</span><br><span class="line">wr jiffies_64 10ffc7651</span><br><span class="line">rd jiffies_64</span><br><span class="line">sys</span><br><span class="line"></span><br><span class="line">$ crash -s -i crash_cmd.txt</span><br><span class="line">       |</span><br><span class="line">       ----------- silent mode</span><br></pre></td></tr></table></figure>

<h3 id="example2-dump-file-content-in-memory"><a href="#example2-dump-file-content-in-memory" class="headerlink" title="example2 dump file content in memory"></a><a target="_blank" rel="noopener" href="http://oliveryang.net/2015/07/linux-crash-page-cache-debug/#1-new-page-cache-debug-options">example2 dump file content in memory</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">$ vim anaconda-ks.cfg</span><br><span class="line"><span class="comment">#version=DEVEL</span></span><br><span class="line"><span class="comment"># System authorization information</span></span><br><span class="line">auth --enableshadow --passalgo=sha512</span><br><span class="line"><span class="comment"># Use CDROM installation media</span></span><br><span class="line">cdrom</span><br><span class="line"><span class="comment"># Use graphical install</span></span><br><span class="line">graphical</span><br><span class="line"><span class="comment"># Run the Setup Agent on first boot</span></span><br><span class="line">firstboot --<span class="built_in">enable</span></span><br><span class="line">ignoredisk --only-use=vda</span><br><span class="line"><span class="comment"># Keyboard layouts</span></span><br><span class="line">keyboard --vckeymap=us --xlayouts=<span class="string">&#x27;us&#x27;</span></span><br><span class="line"><span class="comment"># System language</span></span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">....</span><br><span class="line">crash&gt; foreach files -c -R anaconda-ks.cfg</span><br><span class="line">PID: 28525  TASK: ffff9c7890232100  CPU: 1   COMMAND: <span class="string">&quot;vim&quot;</span></span><br><span class="line">ROOT: /    CWD: /root</span><br><span class="line"> FD      INODE          I_MAPPING     NRPAGES TYPE PATH</span><br><span class="line">  4 ffff9c78db8f2a88 ffff9c78db8f2bd8       3 REG  /root/.anaconda-ks.cfg.swp</span><br><span class="line"></span><br><span class="line">crash&gt; files -p ffff9c78db8f2a88</span><br><span class="line">     INODE        NRPAGES</span><br><span class="line">ffff9c78db8f2a88        3</span><br><span class="line"></span><br><span class="line">      PAGE       PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffdb8784317180 10c5c6000 ffff9c78db8f2bd8        0  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7d80 1479f6000 ffff9c78db8f2bd8        1  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7dc0 1479f7000 ffff9c78db8f2bd8        2  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">crash&gt; rd -p -a 1479f7000 4096 | <span class="built_in">tail</span> -12</span><br><span class="line">       1479f7ed6:  keyboard --vckeymap=us --xlayouts=<span class="string">&#x27;us&#x27;</span></span><br><span class="line">       1479f7efd:  <span class="comment"># Keyboard layouts</span></span><br><span class="line">       1479f7f10:  ignoredisk --only-use=vda</span><br><span class="line">       1479f7f2a:  firstboot --<span class="built_in">enable</span></span><br><span class="line">       1479f7f3d:  <span class="comment"># Run the Setup Agent on first boot</span></span><br><span class="line">       1479f7f61:  graphical</span><br><span class="line">       1479f7f6b:  <span class="comment"># Use graphical install</span></span><br><span class="line">       1479f7f83:  cdrom</span><br><span class="line">       1479f7f89:  <span class="comment"># Use CDROM installation media</span></span><br><span class="line">       1479f7fa8:  auth --enableshadow --passalgo=sha512</span><br><span class="line">       1479f7fce:  <span class="comment"># System authorization information</span></span><br><span class="line">       1479f7ff1:  <span class="comment">#version=DEVEL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  show you top 10 page cache consumers</span></span><br><span class="line">$ crash&gt; foreach files -c -R REG | <span class="built_in">sort</span> -k4 -nr | <span class="built_in">head</span> -n10</span><br><span class="line"></span><br><span class="line"><span class="comment"># display the number of pages that are in the page cache</span></span><br><span class="line">$ crash&gt; files -c 28525</span><br><span class="line">PID: 28525  TASK: ffff9c7890232100  CPU: 1   COMMAND: <span class="string">&quot;vim&quot;</span></span><br><span class="line">ROOT: /    CWD: /root</span><br><span class="line"> FD      INODE          I_MAPPING     NRPAGES TYPE PATH</span><br><span class="line">  0 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  1 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  2 ffff9c78ee33b390 ffff9c78ee33b4e0       0 CHR  /dev/pts/2</span><br><span class="line">  4 ffff9c78db8f2a88 ffff9c78db8f2bd8       3 REG  /root/.anaconda-ks.cfg.swp</span><br><span class="line"></span><br><span class="line">display all of its pages that are <span class="keyword">in</span> the page cache</span><br><span class="line">$ files -p ffff9c78db8f2a88</span><br><span class="line">     INODE        NRPAGES</span><br><span class="line">ffff9c78db8f2a88        3</span><br><span class="line"></span><br><span class="line">      PAGE       PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffdb8784317180 10c5c6000 ffff9c78db8f2bd8        0  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7d80 1479f6000 ffff9c78db8f2bd8        1  2 2fffff0000082c referenced,uptodate,lru,private</span><br><span class="line">ffffdb87851e7dc0 1479f7000 ffff9c78db8f2bd8        2  2 2fffff0000082c referenced,uptodate,lru,private</span><br></pre></td></tr></table></figure>

<h3 id="example3-memory-hacking"><a href="#example3-memory-hacking" class="headerlink" title="example3 memory hacking"></a><a target="_blank" rel="noopener" href="http://oliveryang.net/2017/03/linux-kernel-memory-hacking/">example3 memory hacking</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; wr panic_on_oops 1</span><br><span class="line">wr: cannot write to /dev/crash!</span><br><span class="line"></span><br><span class="line">linux-3.10.0-1127.el7/arch/x86/mm/init.c</span><br><span class="line">/*</span><br><span class="line"> * devmem_is_allowed() checks to see <span class="keyword">if</span> /dev/mem access to a certain address</span><br><span class="line"> * is valid. The argument is a physical page number.</span><br><span class="line"> *</span><br><span class="line"> * On x86, access has to be given to the first megabyte of RAM because that</span><br><span class="line"> * area traditionally contains BIOS code and data regions used by X, dosemu,</span><br><span class="line"> * and similar apps. Since they map the entire memory range, the whole range</span><br><span class="line"> * must be allowed (<span class="keyword">for</span> mapping), but any areas that would otherwise be</span><br><span class="line"> * disallowed are flagged as being <span class="string">&quot;zero filled&quot;</span> instead of rejected.</span><br><span class="line"> * Access has to be given to non-kernel-ram areas as well, these contain the</span><br><span class="line"> * PCI mmio resources as well as potential bios/acpi data regions.</span><br><span class="line"> */</span><br><span class="line">int devmem_is_allowed(unsigned long pagenr)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span> (region_intersects_ram(PFN_PHYS(pagenr), PAGE_SIZE)</span><br><span class="line">                        != REGION_DISJOINT) &#123;</span><br><span class="line">                /* </span><br><span class="line">                 * For disallowed memory regions <span class="keyword">in</span> the low 1MB range,</span><br><span class="line">                 * request that the page be shown as all zeros.</span><br><span class="line">                 */</span><br><span class="line">                <span class="keyword">if</span> (pagenr &lt; 256)</span><br><span class="line">                        <span class="built_in">return</span> 2;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* </span><br><span class="line">         * This must follow RAM <span class="built_in">test</span>, since System RAM is considered a</span><br><span class="line">         * restricted resource under CONFIG_STRICT_IOMEM.</span><br><span class="line">         */</span><br><span class="line">        <span class="keyword">if</span> (iomem_is_exclusive(pagenr &lt;&lt; <span class="string">PAGE_SHIFT)) &#123; </span></span><br><span class="line"><span class="string">                /* Low 1MB bypasses iomem restrictions. */</span></span><br><span class="line"><span class="string">                if (pagenr &lt; 256)</span></span><br><span class="line"><span class="string">                        return 1;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                return 0;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return 1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ crash /dev/mem</span></span><br><span class="line"><span class="string">crash&gt; wr panic_on_oops 1</span></span><br><span class="line"><span class="string">wr: write error: kernel virtual address: ffffffffbae47ed4  type: &quot;write memory&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe kernel.function(&quot;devmem_is_allowed&quot;).return &#123; $return = 1 &#125;&#x27;</span></span><br><span class="line"><span class="string">#### bpftrace -e &#x27;k:devmem_is_allowed &#123;return 1; &#125;&#x27; --unsafe ### bpftrace not work</span></span><br><span class="line"><span class="string">#### btw, if is another kernel module, eg:</span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe module(&quot;ptlrpc&quot;).function(&quot;ptlrpc_expire_one_request&quot;).return &#123; $return = 1 &#125;&#x27;</span></span><br><span class="line"><span class="string">$ stap -g -e &#x27;probe module(&quot;osc&quot;).function(&quot;osc_enter_cache_try&quot;).return &#123; printf (&quot;return value: %d\n&quot;,$return); &#125;&#x27;</span></span><br><span class="line"><span class="string">$ bpftrace -e &#x27;kretprobe:osc_enter_cache_try &#123; printf(&quot;returned: %d\n&quot;, retval); &#125;&#x27;</span></span><br><span class="line"><span class="string">crash&gt; wr panic_on_oops 0</span></span><br><span class="line"><span class="string">crash&gt; p panic_on_oops</span></span><br><span class="line"><span class="string">panic_on_oops = $1 = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="example4"><a href="#example4" class="headerlink" title="example4"></a>example4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[5257172.312256] BUG: Bad page state in process ksoftirqd/6  pfn:882556</span><br><span class="line">[5257172.314826] page:ffffe28a62095580 count:0 mapcount:-1 mapping:          (null) index:0x0</span><br><span class="line">[5257172.317284] page flags: 0x2fffff00008000(tail)</span><br><span class="line">[5257172.319614] page dumped because: nonzero mapcount</span><br><span class="line">[5257172.418956] Modules linked in: ipmi_poweroff ipmi_watchdog osp(OE) ofd(OE) lfsck(OE) ost(OE) mgc(OE) osd_zfs(OE) lquota(OE) fid(OE) fld(OE) ksocklnd(OE) ptlrpc(OE) obdclass(OE) lnet(OE) libcfs(OE) bonding vfat fat iTCO_wdt iTCO_vendor_support mxm_wmi sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr i2c_i801 lpc_ich mei_me joydev mei ioatdma zfs(POE) zunicode(POE) zavl(POE) icp(POE) zcommon(POE) znvpair(POE) spl(OE) ses enclosure sg ipmi_si ipmi_devintf ipmi_msghandler wmi acpi_power_meter acpi_pad rpcrdma sunrpc ib_isert iscsi_target_mod ib_iser libiscsi scsi_transport_iscsi ib_srpt target_core_mod ib_srp scsi_transport_srp scsi_tgt ib_ipoib rdma_ucm ib_umad rdma_cm ib_cm iw_cm</span><br><span class="line">[5257172.429763]  mlx5_ib ib_uverbs ib_core binfmt_misc ip_tables xfs libcrc32c sd_mod crc_t10dif crct10dif_generic ast i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm ahci mlx5_core drm ixgbe libahci mdio mlxfw crct10dif_pclmul crct10dif_common devlink mpt3sas(OE) libata megaraid_sas crc32c_intel ptp pps_core raid_class drm_panel_orientation_quirks scsi_transport_sas dca</span><br><span class="line">[5257172.437256] CPU: 6 PID: 41 Comm: ksoftirqd/6 Kdump: loaded Tainted: P    B      OE  ------------ T 3.10.0-1160.2.1.el7_lustre.x86_64 #1</span><br><span class="line">[5257172.441017] Hardware name: Supermicro X10DRH/X10DRH-CT, BIOS 3.1 06/18/2018</span><br><span class="line">[5257172.442716] Call Trace:</span><br><span class="line">[5257172.444506]  [&lt;ffffffff963813c0&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[5257172.446313]  [&lt;ffffffff9637bf7d&gt;] bad_page.part.75+0xdc/0xf9</span><br><span class="line">[5257172.448054]  [&lt;ffffffff95dc6b32&gt;] free_pages_prepare+0x1f2/0x210</span><br><span class="line">[5257172.449757]  [&lt;ffffffff95dc6e69&gt;] __free_pages_ok+0x19/0xc0</span><br><span class="line">[5257172.451481]  [&lt;ffffffff95dc6f2b&gt;] free_compound_page+0x1b/0x20</span><br><span class="line">[5257172.453212]  [&lt;ffffffff9637d110&gt;] __put_compound_page+0x25/0x28</span><br><span class="line">[5257172.454879]  [&lt;ffffffff9637d279&gt;] put_compound_page+0x166/0x174</span><br><span class="line">[5257172.456587]  [&lt;ffffffff95dcc1f6&gt;] put_page+0x56/0x60</span><br><span class="line">[5257172.458259]  [&lt;ffffffff9623d67f&gt;] skb_release_data+0x8f/0x150</span><br><span class="line">[5257172.459915]  [&lt;ffffffff9623d764&gt;] skb_release_all+0x24/0x30</span><br><span class="line">[5257172.461531]  [&lt;ffffffff9623dd68&gt;] napi_consume_skb+0xa8/0x100</span><br><span class="line">[5257172.463265]  [&lt;ffffffffc083b87f&gt;] mlx5e_poll_tx_cq+0x1ff/0x590 [mlx5_core]</span><br><span class="line">[5257172.464969]  [&lt;ffffffff95cdab02&gt;] ? default_wake_function+0x12/0x20</span><br><span class="line">[5257172.466692]  [&lt;ffffffff95cc6d3b&gt;] ? autoremove_wake_function+0x2b/0x40</span><br><span class="line">[5257172.468391]  [&lt;ffffffffc084042b&gt;] mlx5e_napi_poll+0x7b/0xd10 [mlx5_core]</span><br><span class="line">[5257172.470088]  [&lt;ffffffff95cd2ba0&gt;] ? task_rq_unlock+0x20/0x20</span><br><span class="line">[5257172.471777]  [&lt;ffffffff9625561f&gt;] net_rx_action+0x26f/0x390</span><br><span class="line">[5257172.473413]  [&lt;ffffffff95ca4b95&gt;] __do_softirq+0xf5/0x280</span><br><span class="line">[5257172.475042]  [&lt;ffffffff95ca4d58&gt;] run_ksoftirqd+0x38/0x50</span><br><span class="line">[5257172.476676]  [&lt;ffffffff95cce674&gt;] smpboot_thread_fn+0x144/0x1a0</span><br><span class="line">[5257172.478371]  [&lt;ffffffff95cce530&gt;] ? lg_double_unlock+0x40/0x40</span><br><span class="line">[5257172.480081]  [&lt;ffffffff95cc5c21&gt;] kthread+0xd1/0xe0</span><br><span class="line">[5257172.481747]  [&lt;ffffffff95cc5b50&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[5257172.483458]  [&lt;ffffffff96393df7&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line"></span><br><span class="line">crash&gt; page.first_page ffffe28a62095580</span><br><span class="line">    first_page = 0xffffe28a62095400</span><br><span class="line">crash&gt; page.flags,slab_cache 0xffffe28a62095400</span><br><span class="line">  flags = 13510794587144192</span><br><span class="line">    slab_cache = 0xffff8e19ffc03200</span><br><span class="line">crash&gt; kmem 0xffff8e19ffc03200</span><br><span class="line">CACHE            NAME                 OBJSIZE  ALLOCATED     TOTAL  SLABS  SSIZE</span><br><span class="line">ffff8e19ffc02000 kmem_cache               216        127       384     12     8k</span><br><span class="line">  SLAB              MEMORY            NODE  TOTAL  ALLOCATED  FREE</span><br><span class="line">  ffffe28a45ff0080  ffff8e19ffc02000     0     32         32     0</span><br><span class="line">  FREE / [ALLOCATED]</span><br><span class="line">  [ffff8e19ffc03200]</span><br><span class="line"></span><br><span class="line">      PAGE         PHYSICAL      MAPPING       INDEX CNT FLAGS</span><br><span class="line">ffffe28a45ff00c0  17fc03000                0        0  0 2fffff00008000 tail</span><br><span class="line">crash&gt; struct kmem_cache.name 0xffff8e19ffc03200</span><br><span class="line">  name = 0xffffffff9668fcb6 &quot;kmalloc-8192&quot;</span><br></pre></td></tr></table></figure>

<h3 id="example5-trace-the-sock"><a href="#example5-trace-the-sock" class="headerlink" title="example5 trace the sock"></a>example5 trace the sock</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">./lnet/include/lnet/lib-types.h</span><br><span class="line">        int                             ln_niinit_self;</span><br><span class="line">        /* LNetNIInit/LNetNIFini counter */</span><br><span class="line">        int                             ln_refcount;</span><br><span class="line">        /* SHUTDOWN/RUNNING/STOPPING */</span><br><span class="line"></span><br><span class="line">$ lctl --net tcp del_peer <span class="variable">$ipaddr</span></span><br><span class="line">lnet/peer.c</span><br><span class="line"> LNetPut</span><br><span class="line">  ksocknal_alloc_tx</span><br><span class="line">   ksocknal_launch_packet</span><br><span class="line"></span><br><span class="line">$ ss -tulpen</span><br><span class="line">udp    UNCONN     0      0                                                             [::]:111                                                                       [::]:*                   <span class="built_in">users</span>:((<span class="string">&quot;rpcbind&quot;</span>,pid=936,fd=9)) ino:16271 sk:ffffa0b3b54a0000 v6only:1 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">tcp    LISTEN     0      127                                                              *:988                                                                          *:*                   ino:389210 sk:ffffa0b43b7e2e80 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">tcp    LISTEN     0      128                                                              *:111                                                                          *:*                   <span class="built_in">users</span>:((<span class="string">&quot;rpcbind&quot;</span>,pid=936,fd=8)) ino:16270 sk:ffffa0b3b5548000 &lt;-&gt;</span><br><span class="line"></span><br><span class="line">$ crash /usr/lib/debug/usr/lib/modules/3.10.0-1160.el7.x86_64/vmlinux</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.__sk_common.skc_num ffffa0b43b7e2e80</span><br><span class="line">  __sk_common.skc_num = 988</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b43b7e2e80</span><br><span class="line">  sk_rcvbuf = 134217728</span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.sk_sndbuf ffffa0b43b7e2e80</span><br><span class="line">sk_sndbuf = 134217728</span><br><span class="line">net.ipv4.tcp_rmem = 65536       134217728       268435456</span><br><span class="line">net.ipv4.tcp_wmem = 65536       134217728       268435456</span><br><span class="line"></span><br><span class="line">struct sock.sk_max_ack_backlog ffffa0b43b7e2e80</span><br><span class="line">  sk_max_ack_backlog = 127</span><br><span class="line"></span><br><span class="line">rash&gt; struct sock.sk_max_ack_backlog ffffa0b3b5548000</span><br><span class="line">  sk_max_ack_backlog = 128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">crash&gt; struct sock.__sk_common.skc_num ffffa0b3b54a0000</span><br><span class="line">  __sk_common.skc_num = 111</span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b3b54a0000</span><br><span class="line">  sk_rcvbuf = 212992</span><br><span class="line">crash&gt; struct sock.sk_rcvbuf ffffa0b3b54a0000</span><br><span class="line">  sk_rcvbuf = 212992</span><br><span class="line"></span><br><span class="line"><span class="comment">#here is my setting in this kernel, correct</span></span><br><span class="line">net.core.rmem_default = 212992</span><br><span class="line">net.core.rmem_max = 212992</span><br><span class="line">net.core.wmem_default = 212992</span><br><span class="line">net.core.wmem_max = 212992</span><br><span class="line"></span><br><span class="line"><span class="comment">#looks like the ss show the struct sock address</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /proc/net/tcp</span></span><br><span class="line">netstat -wtpeav</span><br></pre></td></tr></table></figure>

<h4 id="crash-exmaple"><a href="#crash-exmaple" class="headerlink" title="crash exmaple"></a>crash exmaple</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">crash /usr/lib/debug/lib/modules/3.10.0-1127.el7.x86_64/vmlinux</span><br><span class="line"></span><br><span class="line">crash 7.2.3-10.el7</span><br><span class="line">GNU gdb (GDB) 7.6</span><br><span class="line">please <span class="built_in">wait</span>... (patching 87167 gdb minimal_symbol values)</span><br><span class="line">      KERNEL: /usr/lib/debug/lib/modules/3.10.0-1127.el7.x86_64/vmlinux</span><br><span class="line">    DUMPFILE: /dev/crash</span><br><span class="line">        CPUS: 4</span><br><span class="line">        DATE: Sun Dec 20 10:11:56 2020</span><br><span class="line">      UPTIME: 3 days, 07:23:40</span><br><span class="line">LOAD AVERAGE: 0.22, 0.07, 0.06</span><br><span class="line">       TASKS: 156</span><br><span class="line">    NODENAME: centos7-test</span><br><span class="line">     RELEASE: 3.10.0-1127.el7.x86_64</span><br><span class="line">     VERSION: <span class="comment">#1 SMP Tue Mar 31 23:36:51 UTC 2020</span></span><br><span class="line">     MACHINE: x86_64  (2394 Mhz)</span><br><span class="line">      MEMORY: 8.1 GB</span><br><span class="line">         PID: 10155</span><br><span class="line">     COMMAND: <span class="string">&quot;crash&quot;</span></span><br><span class="line">        TASK: ffff8e8038748000  [THREAD_INFO: ffff8e7eb7154000]</span><br><span class="line">         CPU: 1</span><br><span class="line">       STATE: TASK_RUNNING (ACTIVE)</span><br><span class="line"></span><br><span class="line">crash&gt;</span><br><span class="line">crash&gt; *buffer_head</span><br><span class="line">struct buffer_head &#123;</span><br><span class="line">    unsigned long b_state;</span><br><span class="line">    struct buffer_head *b_this_page;</span><br><span class="line">    struct page *b_page;</span><br><span class="line">    sector_t b_blocknr;</span><br><span class="line">    size_t b_size;</span><br><span class="line">    char *b_data;</span><br><span class="line">    struct block_device *b_bdev;</span><br><span class="line">    bh_end_io_t *b_end_io;</span><br><span class="line">    void *b_private;</span><br><span class="line">    struct list_head b_assoc_buffers;</span><br><span class="line">    struct address_space *b_assoc_map;</span><br><span class="line">    atomic_t b_count;</span><br><span class="line">&#125;</span><br><span class="line">SIZE: 104</span><br><span class="line">crash&gt; struct cpu</span><br><span class="line">struct cpu &#123;</span><br><span class="line">    int node_id;</span><br><span class="line">    int hotpluggable;</span><br><span class="line">    struct device dev;</span><br><span class="line">&#125;</span><br><span class="line">SIZE: 680</span><br><span class="line">crash&gt; struct sym jiffies</span><br><span class="line">struct: invalid data structure reference: sym</span><br><span class="line">crash&gt;</span><br><span class="line">crash&gt; sym jiffies</span><br><span class="line">ffffffff8856c000 (D) jiffies</span><br><span class="line">crash&gt;</span><br><span class="line">crash&gt; files</span><br><span class="line">PID: 10155  TASK: ffff8e8038748000  CPU: 3   COMMAND: <span class="string">&quot;crash&quot;</span></span><br><span class="line">ROOT: /    CWD: /root</span><br><span class="line"> FD       FILE            DENTRY           INODE       TYPE PATH</span><br><span class="line">  0 ffff8e803b102b00 ffff8e7ea61bb480 ffff8e7ea61b5bc0 CHR  /dev/pts/0</span><br><span class="line">  1 ffff8e803b102b00 ffff8e7ea61bb480 ffff8e7ea61b5bc0 CHR  /dev/pts/0</span><br><span class="line">  2 ffff8e803b102b00 ffff8e7ea61bb480 ffff8e7ea61b5bc0 CHR  /dev/pts/0</span><br><span class="line">  3 ffff8e7e364f2f00 ffff8e7f7f827240 ffff8e8044570850 CHR  /dev/null</span><br><span class="line">  4 ffff8e803684e100 ffff8e7f7f834180 ffff8e8038ab9ae8 CHR  /dev/crash</span><br><span class="line">  5 ffff8e803684ec00 ffff8e800c25d180 ffff8e800c2d9400 REG  /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/vmlinux</span><br><span class="line">  6 ffff8e803aa2ac00 ffff8e800c3e6480 ffff8e800c37a9a0 FIFO</span><br><span class="line">  7 ffff8e803aa2a800 ffff8e800c3e6480 ffff8e800c37a9a0 FIFO</span><br><span class="line">  8 ffff8e803b102500 ffff8e800ead1300 ffff8e80029917c0 REG  /tmp/tmpfpagMdU</span><br><span class="line"> 10 ffff8e80445c4000 ffff8e7ea6199180 ffff8e800c37b090 FIFO</span><br><span class="line">crash&gt; struct dentry.d_inode,d_name ffff8e800ead1300</span><br><span class="line">  d_inode = 0xffff8e80029917c0</span><br><span class="line">  d_name = &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">hash</span> = 1385601899,</span><br><span class="line">        len = 10</span><br><span class="line">      &#125;,</span><br><span class="line">      hash_len = 44335274859</span><br><span class="line">    &#125;,</span><br><span class="line">    name = 0xffff8e800ead1338 <span class="string">&quot;tmpfpagMdU&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">crash&gt;  rd -8 0xffff8e800ead1338 20</span><br><span class="line">ffff8e800ead1338:  74 6d 70 66 70 61 67 4d 64 55 00 63 74 00 0a 0a   tmpfpagMdU.ct...</span><br><span class="line">ffff8e800ead1348:  0a 0a 0a 0a</span><br><span class="line"></span><br><span class="line">crash&gt; mod -s sunrpc /lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko</span><br><span class="line">     MODULE       NAME                            SIZE  OBJECT FILE</span><br><span class="line">ffffffffc0b51300  sunrpc                        358543  /lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko</span><br><span class="line"></span><br><span class="line">crash&gt; dmesg</span><br><span class="line">...</span><br><span class="line">[&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">crash&gt; add-symbol-file/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko 0xffffffffc0bf9000</span><br><span class="line">add symbol table from file <span class="string">&quot;/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc0bf9000</span><br><span class="line">Reading symbols from /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko...Reading symbols from /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko.debug...done.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">crash&gt; gdb list *xprt_transmit+0x6c</span><br><span class="line">0xffffffffc0bff38c is <span class="keyword">in</span> xprt_transmit (net/sunrpc/xprt.c:1024).</span><br><span class="line">1019                    &#125;</span><br><span class="line">1020            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!req-&gt;rq_bytes_sent)</span><br><span class="line">1021                    <span class="built_in">return</span>;</span><br><span class="line">1022</span><br><span class="line">1023            connect_cookie = xprt-&gt;connect_cookie;</span><br><span class="line">1024            status = xprt-&gt;ops-&gt;send_request(task);</span><br><span class="line">1025            trace_xprt_transmit(xprt, req-&gt;rq_xid, status);</span><br><span class="line">1026            <span class="keyword">if</span> (status != 0) &#123;</span><br><span class="line">1027                    task-&gt;tk_status = status;</span><br><span class="line">1028                    <span class="built_in">return</span>;</span><br><span class="line"></span><br><span class="line">crash&gt; dis -r xprt_transmit+0x6c</span><br><span class="line">0xffffffffc0b9c320 &lt;xprt_transmit&gt;:     nopl   0x0(%rax,%rax,1) [FTRACE NOP]</span><br><span class="line">0xffffffffc0b9c325 &lt;xprt_transmit+5&gt;:   push   %rbp</span><br><span class="line">0xffffffffc0b9c326 &lt;xprt_transmit+6&gt;:   mov    %rsp,%rbp</span><br><span class="line">0xffffffffc0b9c329 &lt;xprt_transmit+9&gt;:   push   %r15</span><br><span class="line">0xffffffffc0b9c32b &lt;xprt_transmit+11&gt;:  push   %r14</span><br><span class="line">0xffffffffc0b9c32d &lt;xprt_transmit+13&gt;:  mov    %rdi,%r14</span><br><span class="line">0xffffffffc0b9c330 &lt;xprt_transmit+16&gt;:  push   %r13</span><br><span class="line">0xffffffffc0b9c332 &lt;xprt_transmit+18&gt;:  push   %r12</span><br><span class="line">0xffffffffc0b9c334 &lt;xprt_transmit+20&gt;:  push   %rbx</span><br><span class="line">0xffffffffc0b9c335 &lt;xprt_transmit+21&gt;:  sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line">0xffffffffc0b9c339 &lt;xprt_transmit+25&gt;:  testb  <span class="variable">$0x1</span>,0x38f0c(%rip)        <span class="comment"># 0xffffffffc0bd524c</span></span><br><span class="line">0xffffffffc0b9c340 &lt;xprt_transmit+32&gt;:  mov    0xb8(%rdi),%r12</span><br><span class="line">0xffffffffc0b9c347 &lt;xprt_transmit+39&gt;:  mov    (%r12),%r15</span><br><span class="line">0xffffffffc0b9c34b &lt;xprt_transmit+43&gt;:  jne    0xffffffffc0b9c63a &lt;xprt_transmit+794&gt;</span><br><span class="line">0xffffffffc0b9c351 &lt;xprt_transmit+49&gt;:  cmpq   <span class="variable">$0x0</span>,0xf0(%r12)</span><br><span class="line">0xffffffffc0b9c35a &lt;xprt_transmit+58&gt;:  jne    0xffffffffc0b9c3b8 &lt;xprt_transmit+152&gt;</span><br><span class="line">0xffffffffc0b9c35c &lt;xprt_transmit+60&gt;:  lea    0xb8(%r12),%rbx</span><br><span class="line">0xffffffffc0b9c364 &lt;xprt_transmit+68&gt;:  cmp    0xb8(%r12),%rbx</span><br><span class="line">0xffffffffc0b9c36c &lt;xprt_transmit+76&gt;:  je     0xffffffffc0b9c510 &lt;xprt_transmit+496&gt;</span><br><span class="line">0xffffffffc0b9c372 &lt;xprt_transmit+82&gt;:  mov    0x440(%r15),%eax</span><br><span class="line">0xffffffffc0b9c379 &lt;xprt_transmit+89&gt;:  mov    %r14,%rdi</span><br><span class="line">0xffffffffc0b9c37c &lt;xprt_transmit+92&gt;:  mov    %eax,-0x30(%rbp)</span><br><span class="line">0xffffffffc0b9c37f &lt;xprt_transmit+95&gt;:  mov    0x8(%r15),%rax</span><br><span class="line">0xffffffffc0b9c383 &lt;xprt_transmit+99&gt;:  mov    0x50(%rax),%rax</span><br><span class="line">0xffffffffc0b9c387 &lt;xprt_transmit+103&gt;: callq  0xffffffffa5f96410 &lt;__x86_indirect_thunk_rax&gt;</span><br><span class="line">0xffffffffc0b9c38c &lt;xprt_transmit+108&gt;: mov    %eax,%ebx</span><br><span class="line"></span><br><span class="line">crash&gt; sym 0xffffffffc0b9c510</span><br><span class="line">ffffffffc0b9c510 (t) xprt_transmit+496 [sunrpc]</span><br><span class="line"></span><br><span class="line">crash&gt; whatis xprt_transmit</span><br><span class="line">void xprt_transmit(struct rpc_task *);</span><br><span class="line"></span><br><span class="line">crash&gt; whatis __x86_indirect_thunk_rax</span><br><span class="line">&lt;text variable, no debug info&gt; __x86_indirect_thunk_rax;</span><br></pre></td></tr></table></figure>

<p>——— re-run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line">[Wed Dec 23 22:03:22 2020] Modules linked <span class="keyword">in</span>: rpcsec_gss_krb5 auth_rpcgss nfsv4 dns_resolver nfs lockd grace fscache dell_rbu bonding sunrpc iTCO_wdt iTCO_vendor_support mxm_wmi dcdbas vfat fat sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr joydev lpc_ich sg mei_me mei ipmi_si ipmi_devintf ipmi_msghandler wmi acpi_power_meter binfmt_misc ip_tables xfs sr_mod cdrom sd_mod crc_t10dif crct10dif_generic mgag200 i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm bnx2x ahci drm mpt3sas crct10dif_pclmul crct10dif_common crc32c_intel libahci megaraid_sas mdio libata raid_class ptp drm_panel_orientation_quirks scsi_transport_sas pps_core libcrc32c</span><br><span class="line">[Wed Dec 23 22:03:22 2020] CPU: 6 PID: 70273 Comm: kworker/u434:1 Kdump: loaded Tainted: G             L ------------ T 3.10.0-1127.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Wed Dec 23 22:03:22 2020] Hardware name: Dell Inc. PowerEdge R630/0CNCJW, BIOS 2.11.0 11/02/2019</span><br><span class="line">[Wed Dec 23 22:03:22 2020] Workqueue: rpciod rpc_async_schedule [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:22 2020] task: ffff8ebe3a03e2a0 ti: ffff8ebe1e180000 task.ti: ffff8ebe1e180000</span><br><span class="line">[Wed Dec 23 22:03:22 2020] RIP: 0010:[&lt;ffffffffc0b97de0&gt;]  [&lt;ffffffffc0b97de0&gt;] call_transmit+0x0/0x2c0 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:22 2020] RSP: 0018:ffff8ebe1e183da8  EFLAGS: 00000282</span><br><span class="line">[Wed Dec 23 22:03:22 2020] RAX: 0000000000000005 RBX: ffff8ebe1e183d38 RCX: 00000000ffffffe0</span><br><span class="line">[Wed Dec 23 22:03:22 2020] RDX: ffff8ebe3155b05c RSI: ffff8ebe1e183cb0 RDI: ffff8ece3a176100</span><br><span class="line">[Wed Dec 23 22:03:22 2020] RBP: ffff8ebe1e183e08 R08: ffff8ebe3af63b08 R09: 0000000000000001</span><br><span class="line">[Wed Dec 23 22:03:22 2020] R10: ffff8ebe1e183d00 R11: ffff8ebe1e183c88 R12: 0000000000000010</span><br><span class="line">[Wed Dec 23 22:03:22 2020] R13: ffffffffa5c6911b R14: ffff8ebe3155b084 R15: ffff8ece3a176100</span><br><span class="line">[Wed Dec 23 22:03:22 2020] FS:  0000000000000000(0000) GS:ffff8ebe3e2c0000(0000) knlGS:0000000000000000</span><br><span class="line">[Wed Dec 23 22:03:22 2020] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[Wed Dec 23 22:03:22 2020] CR2: 00007f9186d4dc70 CR3: 000000028aa10000 CR4: 00000000001607e0</span><br><span class="line">[Wed Dec 23 22:03:22 2020] Call Trace:</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffc0ba51c9&gt;] ? __rpc_execute+0x99/0x420 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa6385922&gt;] ? __schedule+0x402/0x840</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffc0ba5562&gt;] rpc_async_schedule+0x12/0x20 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cbe6bf&gt;] process_one_work+0x17f/0x440</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cbf7d6&gt;] worker_thread+0x126/0x3c0</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cbf6b0&gt;] ? manage_workers.isra.26+0x2a0/0x2a0</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cc6691&gt;] kthread+0xd1/0xe0</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa6392d37&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line">[Wed Dec 23 22:03:22 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:03:22 2020] Code: 00 48 c7 c7 60 57 bc c0 48 8b b0 90 05 00 00 31 c0 e8 8d 18 7e e5 41 b8 f3 ff ff ff e9 ee fa ff ff 66 2e 0f 1f 84 00 00 00 00 00 &lt;0f&gt; 1f 44 00 00 55 f6 05 5f d4 03 00 02 48 89 e5 41 56 41 55 41</span><br><span class="line">[Wed Dec 23 22:03:50 2020] NMI watchdog: BUG: soft lockup - CPU<span class="comment">#6 stuck for 22s! [kworker/u434:1:70273]</span></span><br><span class="line">[Wed Dec 23 22:03:50 2020] Modules linked <span class="keyword">in</span>: rpcsec_gss_krb5 auth_rpcgss nfsv4 dns_resolver nfs lockd grace fscache dell_rbu bonding sunrpc iTCO_wdt iTCO_vendor_support mxm_wmi dcdbas vfat fat sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr joydev lpc_ich sg mei_me mei ipmi_si ipmi_devintf ipmi_msghandler wmi acpi_power_meter binfmt_misc ip_tables xfs sr_mod cdrom sd_mod crc_t10dif crct10dif_generic mgag200 i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm bnx2x ahci drm mpt3sas crct10dif_pclmul crct10dif_common crc32c_intel libahci megaraid_sas mdio libata raid_class ptp drm_panel_orientation_quirks scsi_transport_sas pps_core libcrc32c</span><br><span class="line">[Wed Dec 23 22:03:50 2020] CPU: 6 PID: 70273 Comm: kworker/u434:1 Kdump: loaded Tainted: G             L ------------ T 3.10.0-1127.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Wed Dec 23 22:03:50 2020] Hardware name: Dell Inc. PowerEdge R630/0CNCJW, BIOS 2.11.0 11/02/2019</span><br><span class="line">[Wed Dec 23 22:03:50 2020] Workqueue: rpciod rpc_async_schedule [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020] task: ffff8ebe3a03e2a0 ti: ffff8ebe1e180000 task.ti: ffff8ebe1e180000</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RIP: 0010:[&lt;ffffffffa638ce89&gt;]  [&lt;ffffffffa638ce89&gt;] kprobe_ftrace_handler+0x69/0x120</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RSP: 0018:ffff8ebe1e183c10  EFLAGS: 00000282</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RAX: 0000000000000001 RBX: 0000000000000004 RCX: ffffffffc0b9fc55</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RDX: 0000000000000001 RSI: ffffffffffffffe0 RDI: 0000000000000282</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RBP: ffff8ebe1e183c40 R08: 00000000359c2550 R09: 000000000000001f</span><br><span class="line">[Wed Dec 23 22:03:50 2020] R10: 00000000359c2550 R11: ffff8ebe1e183c88 R12: ffff8ebe3155b05c</span><br><span class="line">[Wed Dec 23 22:03:50 2020] R13: ffff8ebe3155b058 R14: ffff8ebe3af63b08 R15: 0000000000000001</span><br><span class="line">[Wed Dec 23 22:03:50 2020] FS:  0000000000000000(0000) GS:ffff8ebe3e2c0000(0000) knlGS:0000000000000000</span><br><span class="line">[Wed Dec 23 22:03:50 2020] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[Wed Dec 23 22:03:50 2020] CR2: 00007f9186d4dc70 CR3: 000000028aa10000 CR4: 00000000001607e0</span><br><span class="line">[Wed Dec 23 22:03:50 2020] Call Trace:</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b9fc50&gt;] ? xs_tcp_write_space+0x70/0x70 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5d62634&gt;] ftrace_ops_list_func+0xf4/0x120</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa6396b14&gt;] ftrace_regs_call+0x5/0x81</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5c6911b&gt;] ? arch_unoptimize_kprobes+0xdb/0xdb</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b97fb0&gt;] call_transmit+0x1d0/0x2c0 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0ba51c9&gt;] __rpc_execute+0x99/0x420 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa6385922&gt;] ? __schedule+0x402/0x840</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffc0ba5562&gt;] rpc_async_schedule+0x12/0x20 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cbe6bf&gt;] process_one_work+0x17f/0x440</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cbf7d6&gt;] worker_thread+0x126/0x3c0</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cbf6b0&gt;] ? manage_workers.isra.26+0x2a0/0x2a0</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cc6691&gt;] kthread+0xd1/0xe0</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa6392d37&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line">[Wed Dec 23 22:03:50 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:03:50 2020] Code: 75 24 49 c7 c6 a0 33 01 00 65 4c 03 35 71 43 c8 59 65 48 8b 05 51 66 c8 59 48 85 c0 74 24 4c 89 e7 e8 5c 37 00 00 48 89 <span class="built_in">df</span> 57 9d &lt;0f&gt; 1f 44 00 00 48 83 c4 08 5b 41 5c 41 5d 41 5e 41 5f 5d c3 0f</span><br><span class="line">[Wed Dec 23 22:04:02 2020] INFO: rcu_sched self-detected stall on CPU &#123; 6&#125;  (t=600013 jiffies g=238339 c=238338 q=49819)</span><br><span class="line">[Wed Dec 23 22:04:02 2020] Task dump <span class="keyword">for</span> CPU 6:</span><br><span class="line">[Wed Dec 23 22:04:02 2020] kworker/u434:1  R  running task        0 70273      2 0x00000088</span><br><span class="line">[Wed Dec 23 22:04:02 2020] Workqueue: rpciod rpc_async_schedule [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020] Call Trace:</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  &lt;IRQ&gt;  [&lt;ffffffffa5cdab18&gt;] sched_show_task+0xa8/0x110</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cde919&gt;] dump_cpu_task+0x39/0x70</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d58b90&gt;] rcu_dump_cpu_stacks+0x90/0xd0</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d5c252&gt;] rcu_check_callbacks+0x442/0x730</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d10ae0&gt;] ? tick_sched_do_timer+0x50/0x50</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5caf9d6&gt;] update_process_times+0x46/0x80</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d10850&gt;] tick_sched_handle+0x30/0x70</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d10b19&gt;] tick_sched_timer+0x39/0x80</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5ccaa8e&gt;] __hrtimer_run_queues+0x10e/0x270</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5ccafef&gt;] hrtimer_interrupt+0xaf/0x1d0</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc51&gt;] ? xs_tcp_send_request+0x1/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5c5caeb&gt;] local_apic_timer_interrupt+0x3b/0x60</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa63979c3&gt;] smp_apic_timer_interrupt+0x43/0x60</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa6393efa&gt;] apic_timer_interrupt+0x16a/0x170</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  &lt;EOI&gt;  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa638ce89&gt;] ? kprobe_ftrace_handler+0x69/0x120</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc50&gt;] ? xs_tcp_write_space+0x70/0x70 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5d62634&gt;] ftrace_ops_list_func+0xf4/0x120</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa6396b14&gt;] ftrace_regs_call+0x5/0x81</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5c6911b&gt;] ? arch_unoptimize_kprobes+0xdb/0xdb</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b97fb0&gt;] call_transmit+0x1d0/0x2c0 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0ba51c9&gt;] __rpc_execute+0x99/0x420 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa6385922&gt;] ? __schedule+0x402/0x840</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0ba5562&gt;] rpc_async_schedule+0x12/0x20 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cbe6bf&gt;] process_one_work+0x17f/0x440</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cbf7d6&gt;] worker_thread+0x126/0x3c0</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cbf6b0&gt;] ? manage_workers.isra.26+0x2a0/0x2a0</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cc6691&gt;] kthread+0xd1/0xe0</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa6392d37&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:04:30 2020] NMI watchdog: BUG: soft lockup - CPU<span class="comment">#6 stuck for 23s! [kworker/u434:1:70273]</span></span><br><span class="line">[Wed Dec 23 22:04:30 2020] Modules linked <span class="keyword">in</span>: rpcsec_gss_krb5 auth_rpcgss nfsv4 dns_resolver nfs lockd grace fscache dell_rbu bonding sunrpc iTCO_wdt iTCO_vendor_support mxm_wmi dcdbas vfat fat sb_edac intel_powerclamp coretemp intel_rapl iosf_mbi kvm_intel kvm irqbypass crc32_pclmul ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr joydev lpc_ich sg mei_me mei ipmi_si ipmi_devintf ipmi_msghandler wmi acpi_power_meter binfmt_misc ip_tables xfs sr_mod cdrom sd_mod crc_t10dif crct10dif_generic mgag200 i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm bnx2x ahci drm mpt3sas crct10dif_pclmul crct10dif_common crc32c_intel libahci megaraid_sas mdio libata raid_class ptp drm_panel_orientation_quirks scsi_transport_sas pps_core libcrc32c</span><br><span class="line">[Wed Dec 23 22:04:30 2020] CPU: 6 PID: 70273 Comm: kworker/u434:1 Kdump: loaded Tainted: G             L ------------ T 3.10.0-1127.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Wed Dec 23 22:04:30 2020] Hardware name: Dell Inc. PowerEdge R630/0CNCJW, BIOS 2.11.0 11/02/2019</span><br><span class="line">[Wed Dec 23 22:04:30 2020] Workqueue: rpciod rpc_async_schedule [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020] task: ffff8ebe3a03e2a0 ti: ffff8ebe1e180000 task.ti: ffff8ebe1e180000</span><br><span class="line">[Wed Dec 23 22:04:30 2020] RIP: 0010:[&lt;ffffffffa638ce92&gt;]  [&lt;ffffffffa638ce92&gt;] kprobe_ftrace_handler+0x72/0x120</span><br><span class="line">[Wed Dec 23 22:04:30 2020] RSP: 0018:ffff8ebe1e183c18  EFLAGS: 00000286</span><br><span class="line">[Wed Dec 23 22:04:30 2020] RAX: 0000000000000001 RBX: ffff8ebe3af63b08 RCX: ffffffffc0b9fc55</span><br><span class="line">[Wed Dec 23 22:04:30 2020] RDX: 0000000000000001 RSI: ffffffffffffffe0 RDI: 0000000000000282</span><br><span class="line">[Wed Dec 23 22:04:30 2020] RBP: ffff8ebe1e183c40 R08: 000000003968f6f0 R09: 000000000000001f</span><br><span class="line">[Wed Dec 23 22:04:30 2020] R10: 000000003968f6f0 R11: ffff8ebe1e183c88 R12: ffff8ebe1e183d00</span><br><span class="line">[Wed Dec 23 22:04:30 2020] R13: ffff8ebe1e183c88 R14: ffff8ebe3af63b08 R15: ffff8ebe1e183c00</span><br><span class="line">[Wed Dec 23 22:04:30 2020] FS:  0000000000000000(0000) GS:ffff8ebe3e2c0000(0000) knlGS:0000000000000000</span><br><span class="line">[Wed Dec 23 22:04:30 2020] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[Wed Dec 23 22:04:30 2020] CR2: 00007f9186d4dc70 CR3: 000000028aa10000 CR4: 00000000001607e0</span><br><span class="line">[Wed Dec 23 22:04:30 2020] Call Trace:</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b9fc50&gt;] ? xs_tcp_write_space+0x70/0x70 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5d62634&gt;] ftrace_ops_list_func+0xf4/0x120</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa6396b14&gt;] ftrace_regs_call+0x5/0x81</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5c6911b&gt;] ? arch_unoptimize_kprobes+0xdb/0xdb</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b9c38c&gt;] ? xprt_transmit+0x6c/0x360 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b97fb0&gt;] call_transmit+0x1d0/0x2c0 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0b97de0&gt;] ? call_decode+0x880/0x880 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0ba51c9&gt;] __rpc_execute+0x99/0x420 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa6385922&gt;] ? __schedule+0x402/0x840</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffc0ba5562&gt;] rpc_async_schedule+0x12/0x20 [sunrpc]</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cbe6bf&gt;] process_one_work+0x17f/0x440</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cbf7d6&gt;] worker_thread+0x126/0x3c0</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cbf6b0&gt;] ? manage_workers.isra.26+0x2a0/0x2a0</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cc6691&gt;] kthread+0xd1/0xe0</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa6392d37&gt;] ret_from_fork_nospec_begin+0x21/0x21</span><br><span class="line">[Wed Dec 23 22:04:30 2020]  [&lt;ffffffffa5cc65c0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Wed Dec 23 22:04:30 2020] Code: 65 4c 03 35 71 43 c8 59 65 48 8b 05 51 66 c8 59 48 85 c0 74 24 4c 89 e7 e8 5c 37 00 00 48 89 <span class="built_in">df</span> 57 9d 0f 1f 44 00 00 48 83 c4 08 &lt;5b&gt; 41 5c 41 5d 41 5e 41 5f 5d c3 0f 1f 00 49 83 c5 01 49 8b 8f</span><br><span class="line"></span><br><span class="line"><span class="comment">## loading external kernel module</span></span><br><span class="line">crash&gt; add-symbol-file /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko 0xffffffffc0bf9000</span><br><span class="line">add symbol table from file <span class="string">&quot;/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc0bf9000</span><br><span class="line">Reading symbols from /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko...Reading symbols from /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko.debug...done.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">or you could</span><br><span class="line"></span><br><span class="line">crash&gt; mod -s sunrpc /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko</span><br><span class="line">     MODULE       NAME                            SIZE  OBJECT FILE</span><br><span class="line">ffffffffc0bd2300  sunrpc                        358543  /usr/lib/modules/3.10.0-1127.el7.x86_64/kernel/net/sunrpc/sunrpc.ko</span><br><span class="line"></span><br><span class="line"><span class="comment">### crash run script</span></span><br><span class="line">crash&gt; &lt; /tmp/test.sh</span><br><span class="line"></span><br><span class="line">crash&gt; struct -o rpc_task</span><br><span class="line">struct rpc_task &#123;</span><br><span class="line">    [0] atomic_t tk_count;</span><br><span class="line">    [4] int tk_status;</span><br><span class="line">    [8] struct list_head tk_task;</span><br><span class="line">   [24] void (*tk_callback)(struct rpc_task *);</span><br><span class="line">   [32] void (*tk_action)(struct rpc_task *);</span><br><span class="line">   [40] unsigned long tk_timeout;</span><br><span class="line">   [48] unsigned long tk_runstate;</span><br><span class="line">   [56] struct rpc_wait_queue *tk_waitqueue;</span><br><span class="line">        union &#123;</span><br><span class="line">            struct work_struct tk_work;</span><br><span class="line">            struct rpc_wait tk_wait;</span><br><span class="line">   [64] &#125; u;</span><br><span class="line">  [120] struct rpc_message tk_msg;</span><br><span class="line">  [152] void *tk_calldata;</span><br><span class="line">  [160] const struct rpc_call_ops *tk_ops;</span><br><span class="line">  [168] struct rpc_clnt *tk_client;</span><br><span class="line">  [176] struct rpc_xprt *tk_xprt;</span><br><span class="line">  [184] struct rpc_rqst *tk_rqstp;</span><br><span class="line">  [192] struct workqueue_struct *tk_workqueue;</span><br><span class="line">  [200] ktime_t tk_start;</span><br><span class="line">  [208] pid_t tk_owner;</span><br><span class="line">  [212] unsigned short tk_flags;</span><br><span class="line">  [214] unsigned short tk_timeouts;</span><br><span class="line">  [216] unsigned short tk_pid;</span><br><span class="line">  [218] unsigned char tk_priority : 2;</span><br><span class="line">  [218] unsigned char tk_garb_retry : 2;</span><br><span class="line">  [218] unsigned char tk_cred_retry : 2;</span><br><span class="line">  [218] unsigned char tk_rebind_retry : 2;</span><br><span class="line">&#125;</span><br><span class="line">SIZE: 224</span><br><span class="line"></span><br><span class="line">crash&gt; kmem -s</span><br><span class="line">CACHE            NAME                 OBJSIZE  ALLOCATED     TOTAL  SLABS  SSIZE</span><br><span class="line">ffff8ece2ef38300 nfs_direct_cache         352          0         0      0    16k</span><br><span class="line">ffff8ece2ef38200 nfs_commit_data          696          4        46      1    32k</span><br><span class="line">ffff8ece2ef38100 nfs_read_data            888         32       216      6    32k</span><br><span class="line">ffff8ece2ef38000 nfs_inode_cache         1040        180       279      9    32k</span><br><span class="line"></span><br><span class="line">crash&gt; kmem -S nfs_inode_cache</span><br><span class="line"></span><br><span class="line">[Wed Dec 23 22:03:50 2020] Workqueue: rpciod rpc_async_schedule [sunrpc]</span><br><span class="line">[Wed Dec 23 22:03:50 2020] task: ffff8ebe3a03e2a0 ti: ffff8ebe1e180000 task.ti: ffff8ebe1e180000</span><br><span class="line">[Wed Dec 23 22:03:50 2020] RIP: 0010:[&lt;ffffffffa638ce89&gt;]  [&lt;ffffffffa638ce89&gt;] kprobe_ftrace_handler+0x69/0x120</span><br><span class="line"></span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa6393efa&gt;] apic_timer_interrupt+0x16a/0x170</span><br><span class="line">[Wed Dec 23 22:04:02 2020]  &lt;EOI&gt;  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc] <span class="comment">## got bad value</span></span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffa638ce89&gt;] ? kprobe_ftrace_handler+0x69/0x120 <span class="comment">## insert the error</span></span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc55&gt;] ? xs_tcp_send_request+0x5/0x230 [sunrpc]  <span class="comment">## the normal return</span></span><br><span class="line">[Wed Dec 23 22:04:02 2020]  [&lt;ffffffffc0b9fc50&gt;] ? xs_tcp_write_space+0x70/0x70 [sunrpc]</span><br><span class="line"></span><br><span class="line"><span class="comment">#linux-3.10.0-1127.el7/tools/include/uapi/asm-generic/errno-base.h</span></span><br><span class="line"><span class="comment">#cat linux-3.10.0-1127.el7/tools/include/uapi/asm-generic/errno.h</span></span><br><span class="line"></span><br><span class="line">1.   Reserve an RPC call slot</span><br><span class="line">static void call_reserve(struct rpc_task *task)</span><br><span class="line">1b.  Grok the result of xprt_reserve() ,what is xprt_reserve() ? net/sunrpc/xprt.c: * xprt_reserve - allocate an RPC request slot</span><br><span class="line">     void xprt_reserve(struct rpc_task *task)</span><br><span class="line">static void call_reserveresult(struct rpc_task *task)</span><br><span class="line">1c.  Retry reserving an RPC call slot</span><br><span class="line">static void call_retry_reserve(struct rpc_task *task)</span><br><span class="line">2.   Bind and/or refresh the credentials</span><br><span class="line">   static void call_refresh(struct rpc_task *task)</span><br><span class="line">2a.  Process the results of a credential refresh</span><br><span class="line">   static void call_refreshresult(struct rpc_task *task)</span><br><span class="line">2b.  Allocate the buffer. For details, see sched.c:rpc_malloc. (Note: buffer memory is freed <span class="keyword">in</span> xprt_release).</span><br><span class="line">   static void call_allocate(struct rpc_task *task)</span><br><span class="line">3.   Encode arguments of an RPC call</span><br><span class="line">        static void rpc_xdr_encode(struct rpc_task *task)</span><br><span class="line">4.   Get the server port number <span class="keyword">if</span> not yet <span class="built_in">set</span></span><br><span class="line">            static void call_bind(struct rpc_task *task)</span><br><span class="line">4a.  Sort out <span class="built_in">bind</span> result</span><br><span class="line">            static void call_bind_status(struct rpc_task *task)</span><br><span class="line">4b.  Connect to the RPC server</span><br><span class="line">            static void call_connect(struct rpc_task *task)</span><br><span class="line">4c.  Sort out connect result</span><br><span class="line">            static void call_connect_status(struct rpc_task *task)</span><br><span class="line">5.   Transmit the RPC request, and <span class="built_in">wait</span> <span class="keyword">for</span> reply</span><br><span class="line">                static void call_transmit(struct rpc_task *task)</span><br><span class="line">5a.  Handle cleanup after a transmission</span><br><span class="line">                static void call_transmit_status(struct rpc_task *task)</span><br><span class="line">5b.  Send the backchannel RPC reply.  On error, drop the reply.  In addition, disconnect on connectivity errors.</span><br><span class="line">                static void call_bc_transmit(struct rpc_task *task)</span><br><span class="line">6.   Sort out the RPC call status</span><br><span class="line">                    static void call_status(struct rpc_task *task)</span><br><span class="line">6a.  Handle RPC <span class="built_in">timeout</span>, We <span class="keyword">do</span> not release the request slot, so we keep using the</span><br><span class="line">     same XID <span class="keyword">for</span> all retransmits.</span><br><span class="line">                    static void call_timeout(struct rpc_task *task)</span><br><span class="line">7.   Decode the RPC reply</span><br><span class="line">                        static void call_decode(struct rpc_task *task)</span><br><span class="line"></span><br><span class="line">   - rpc_async_schedule                                                                                                                       ▒</span><br><span class="line">      - 91.95% __rpc_execute                                                                                                                  ▒</span><br><span class="line">         - 83.19% call_transmit                                                                                                               ◆</span><br><span class="line">            - 41.82% xprt_transmit                                                                                                            ▒</span><br><span class="line">               - 35.74% xs_tcp_send_request                                                                                                   ▒</span><br><span class="line">                  - 32.08% xs_sendpages                                                                                                       ▒</span><br><span class="line">                     - 29.48% xs_send_kvec                                                                                                    ▒</span><br><span class="line">                        - 26.45% kernel_sendmsg                                                                                               ▒</span><br><span class="line">                           - 24.08% sock_sendmsg                                                                                              ▒</span><br><span class="line">                              - 16.47% inet_sendmsg                                                                                           ▒</span><br><span class="line">                                 - 14.92% tcp_sendmsg                                                                                         ▒</span><br><span class="line">                                      4.27% _raw_spin_lock_bh                                                                                 ▒</span><br><span class="line">                                    - 3.51% release_sock                                                                                      ▒</span><br><span class="line">                                       - 1.64% _raw_spin_unlock_bh                                                                            ▒</span><br><span class="line">                                            __local_bh_enable_ip                                                                              ▒</span><br><span class="line">                                    - 2.14% lock_sock_nested                                                                                  ▒</span><br><span class="line">                                       - 1.71% local_bh_enable                                                                                ▒</span><br><span class="line">                                            1.60% __local_bh_enable_ip</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="debug-example2"><a href="#debug-example2" class="headerlink" title="debug example2"></a>debug example2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">struct tcp_info &#123;</span><br><span class="line">    __u8 tcpi_state;</span><br><span class="line">    __u8 tcpi_ca_state;</span><br><span class="line">    __u8 tcpi_retransmits;</span><br><span class="line">    __u8 tcpi_probes;</span><br><span class="line">    __u8 tcpi_backoff;</span><br><span class="line">    __u8 tcpi_options;</span><br><span class="line">    __u8 tcpi_snd_wscale : 4;</span><br><span class="line">    __u8 tcpi_rcv_wscale : 4;</span><br><span class="line">    __u32 tcpi_rto;</span><br><span class="line">    __u32 tcpi_ato;</span><br><span class="line">    __u32 tcpi_snd_mss;</span><br><span class="line">    __u32 tcpi_rcv_mss;</span><br><span class="line">    __u32 tcpi_unacked;</span><br><span class="line">    __u32 tcpi_sacked;</span><br><span class="line">    __u32 tcpi_lost;</span><br><span class="line">    __u32 tcpi_retrans;</span><br><span class="line">    __u32 tcpi_fackets;</span><br><span class="line">    __u32 tcpi_last_data_sent;</span><br><span class="line">    __u32 tcpi_last_ack_sent;</span><br><span class="line">    __u32 tcpi_last_data_recv;</span><br><span class="line">    __u32 tcpi_last_ack_recv;</span><br><span class="line">    __u32 tcpi_pmtu;</span><br><span class="line">    __u32 tcpi_rcv_ssthresh;</span><br><span class="line">    __u32 tcpi_rtt;</span><br><span class="line">    __u32 tcpi_rttvar;</span><br><span class="line">    __u32 tcpi_snd_ssthresh;</span><br><span class="line">    __u32 tcpi_snd_cwnd;</span><br><span class="line">    __u32 tcpi_advmss;</span><br><span class="line">    __u32 tcpi_reordering;</span><br><span class="line">    __u32 tcpi_rcv_rtt;</span><br><span class="line">    __u32 tcpi_rcv_space;</span><br><span class="line">    __u32 tcpi_total_retrans;</span><br><span class="line">    __u64 tcpi_pacing_rate;</span><br><span class="line">    __u64 tcpi_max_pacing_rate;</span><br><span class="line">    __u64 tcpi_bytes_acked;</span><br><span class="line">    __u64 tcpi_bytes_received;</span><br><span class="line">    __u32 tcpi_segs_out;</span><br><span class="line">    __u32 tcpi_segs_in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ crash&gt; struct irqaction</span><br><span class="line">struct irqaction &#123;</span><br><span class="line">    irq_handler_t handler;</span><br><span class="line">    void *dev_id;</span><br><span class="line">    void *percpu_dev_id;</span><br><span class="line">    struct irqaction *next;</span><br><span class="line">    irq_handler_t thread_fn;</span><br><span class="line">    struct task_struct *thread;</span><br><span class="line">    unsigned int irq;</span><br><span class="line">    unsigned int flags;</span><br><span class="line">    unsigned long thread_flags;</span><br><span class="line">    unsigned long thread_mask;</span><br><span class="line">    const char *name;</span><br><span class="line">    struct proc_dir_entry *<span class="built_in">dir</span>;</span><br><span class="line">&#125;</span><br><span class="line">SIZE: 128</span><br><span class="line"></span><br><span class="line">(gdb) <span class="built_in">print</span> (int)&amp;((struct irqaction *)0)-&gt;name</span><br><span class="line"><span class="variable">$1</span> = 72</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span>  &gt; /sys/kernel/debug/tracing/kprobe_events</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;r:myprobe __free_irq +72($retval):string&#x27;</span> &gt; /sys/kernel/debug/tracing/kprobe_events</span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/debug/tracing/kprobe_events</span><br><span class="line">r:kprobes/myprobe __free_irq arg1=+72(<span class="variable">$retval</span>):string</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/events/kprobes/myprobe/enable</span><br><span class="line">$ <span class="built_in">echo</span> &gt; /sys/kernel/debug/tracing/trace</span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/debug/tracing/events/kprobes/myprobe/format</span><br><span class="line">name: myprobe</span><br><span class="line">ID: 1685</span><br><span class="line">format:</span><br><span class="line">        field:unsigned short common_type;       offset:0;       size:2; signed:0;</span><br><span class="line">        field:unsigned char common_flags;       offset:2;       size:1; signed:0;</span><br><span class="line">        field:unsigned char common_preempt_count;       offset:3;       size:1; signed:0;</span><br><span class="line">        field:int common_pid;   offset:4;       size:4; signed:1;</span><br><span class="line"></span><br><span class="line">        field:unsigned long __probe_func;       offset:8;       size:8; signed:0;</span><br><span class="line">        field:unsigned long __probe_ret_ip;     offset:16;      size:8; signed:0;</span><br><span class="line">        field:u64 arg1; offset:24;      size:8; signed:0;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">fmt</span>: <span class="string">&quot;(%lx &lt;- %lx) arg1=0x%Lx&quot;</span>, REC-&gt;__probe_func, REC-&gt;__probe_ret_ip, REC-&gt;arg1</span><br><span class="line"></span><br><span class="line">$ ifconfig em3 down ; ifconfig em3 up</span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/debug/tracing/trace</span><br><span class="line"><span class="comment"># tracer: nop</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># entries-in-buffer/entries-written: 9/9   #P:24</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#                              _-----=&gt; irqs-off</span></span><br><span class="line"><span class="comment">#                             / _----=&gt; need-resched</span></span><br><span class="line"><span class="comment">#                            | / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="comment">#                            || / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="comment">#                            ||| /     delay</span></span><br><span class="line"><span class="comment">#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></span><br><span class="line"><span class="comment">#              | |       |   ||||       |         |</span></span><br><span class="line">        ifconfig-25429 [009] d... 539865.798024: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=<span class="string">&quot;&quot;</span></span><br><span class="line">        ifconfig-25429 [009] d... 539865.798027: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=<span class="string">&quot;/4���&quot;</span></span><br><span class="line">        ifconfig-25429 [009] d... 539865.798030: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=<span class="string">&quot;X/4����b&quot;</span><span class="string">&#x27;���&quot;</span></span><br><span class="line"><span class="string">        ifconfig-25429 [009] d... 539865.798032: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=&quot;�/4����b&quot;&#x27;</span>���<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-25429 [009] d... 539865.798034: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=&quot;</span>/4���<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-25429 [009] d... 539865.798036: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=&quot;</span></span><br><span class="line">                                                                                                   /4�����W/���<span class="string">&quot;</span></span><br><span class="line"><span class="string">/4�����W/���&quot;</span>fig-25429 [009] d... 539865.798039: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=<span class="string">&quot;X</span></span><br><span class="line"><span class="string">        ifconfig-25429 [009] d... 539865.798041: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=&quot;</span>�/4���@�W/���<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-25429 [009] d... 539865.798043: myprobe: (free_irq+0x39/0x90 &lt;- __free_irq) arg1=&quot;</span>�/4���<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># return free_irq(const char *devname; return devname;) better than __free_irq</span></span><br><span class="line"><span class="string">$ echo &#x27;r:myprobe free_irq +0(<span class="variable">$retval</span>):string&#x27; &gt; /sys/kernel/debug/tracing/kprobe_events</span></span><br><span class="line"><span class="string">$ echo 1 &gt; /sys/kernel/debug/tracing/events/kprobes/myprobe/enable</span></span><br><span class="line"><span class="string">$ echo &gt; /sys/kernel/debug/tracing/trace</span></span><br><span class="line"><span class="string">$ ifconfig em3 down; ifconfig em3 up</span></span><br><span class="line"><span class="string">$ cat /sys/kernel/debug/tracing/trace</span></span><br><span class="line"><span class="string"># tracer: nop</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># entries-in-buffer/entries-written: 9/9   #P:24</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">#                              _-----=&gt; irqs-off</span></span><br><span class="line"><span class="string">#                             / _----=&gt; need-resched</span></span><br><span class="line"><span class="string">#                            | / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="string">#                            || / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="string">#                            ||| /     delay</span></span><br><span class="line"><span class="string">#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></span><br><span class="line"><span class="string">#              | |       |   ||||       |         |</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481195: myprobe: (bnx2x_free_msix_irqs.part.68+0xdd/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481197: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-0<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481199: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-1<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481202: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-2<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481204: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-3<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481206: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-4<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481208: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-5<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481210: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-6<span class="string">&quot;</span></span><br><span class="line"><span class="string">        ifconfig-27232 [000] d... 541007.481212: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=&quot;</span>em3-fp-7<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### if I don &#x27;t convert to string</span></span><br><span class="line"><span class="string"># tracer: nop</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># entries-in-buffer/entries-written: 9/9   #P:24</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">#                              _-----=&gt; irqs-off</span></span><br><span class="line"><span class="string">#                             / _----=&gt; need-resched</span></span><br><span class="line"><span class="string">#                            | / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="string">#                            || / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="string">#                            ||| /     delay</span></span><br><span class="line"><span class="string">#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></span><br><span class="line"><span class="string">#              | |       |   ||||       |         |</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630316: myprobe: (bnx2x_free_msix_irqs.part.68+0xdd/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342d4000</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630321: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0218</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630324: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0458</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630327: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0698</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630330: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f08d8</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630333: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0b18</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630335: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0d58</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630338: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f0f98</span></span><br><span class="line"><span class="string">        ifconfig-27486 [001] d... 541302.630341: myprobe: (bnx2x_free_msix_irqs.part.68+0xa9/0x1a0 [bnx2x] &lt;- free_irq) arg1=0xffff9717342f11d8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### ??? the question, How could I print the name from the hex addr ?</span></span><br><span class="line"><span class="string">crash&gt; kmem 0xffff9717342d4000</span></span><br><span class="line"><span class="string">      PAGE         PHYSICAL      MAPPING       INDEX CNT FLAGS</span></span><br><span class="line"><span class="string">ffffd92440d0b500 10342d4000                0        0  1 2fffff00004000 head</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">crash&gt; struct irqaction 0xffff9717342d4000</span></span><br><span class="line"><span class="string">struct irqaction &#123;</span></span><br><span class="line"><span class="string">  handler = 0x336d65,</span></span><br><span class="line"><span class="string">  dev_id = 0x0,</span></span><br><span class="line"><span class="string">  percpu_dev_id = 0x0,</span></span><br><span class="line"><span class="string">  next = 0xffff9717389a8010,</span></span><br><span class="line"><span class="string">  thread_fn = 0x0,</span></span><br><span class="line"><span class="string">  thread = 0x937fffff,</span></span><br><span class="line"><span class="string">  irq = 2466250752,</span></span><br><span class="line"><span class="string">  flags = 0,</span></span><br><span class="line"><span class="string">  thread_flags = 2466250752,</span></span><br><span class="line"><span class="string">  thread_mask = 100,</span></span><br><span class="line"><span class="string">  name = 0x3 &lt;Address 0x3 out of bounds&gt;,</span></span><br><span class="line"><span class="string">  dir = 0xffff971734360050</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>


<h4 id="debug-example3"><a href="#debug-example3" class="headerlink" title="debug example3"></a>debug example3</h4><h5 id="show-pr-debug-the-small-write-amplification-with-linux-soft-raid5"><a href="#show-pr-debug-the-small-write-amplification-with-linux-soft-raid5" class="headerlink" title="show pr_debug, the small write amplification with linux soft raid5"></a>show pr_debug, the small write amplification with linux soft raid5</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">$ grep -Ei <span class="string">&#x27;CONFIG_DEBUG_FS|CONFIG_DYNAMIC_DEBUG&#x27;</span> /boot/config<span class="number">-3.10</span><span class="number">.0</span><span class="number">-1062.18</span><span class="number">.1</span>.el7.x86_64</span><br><span class="line">CONFIG_DEBUG_FS=y</span><br><span class="line">CONFIG_DYNAMIC_DEBUG=y</span><br><span class="line"></span><br><span class="line">$ cat /proc/mdstat</span><br><span class="line">Personalities : [raid6] [raid5] [raid4]</span><br><span class="line">md127 : active raid5 nvme0n1p3[<span class="number">3</span>] nvme0n1p1[<span class="number">0</span>] nvme0n1p2[<span class="number">1</span>]</span><br><span class="line">      <span class="number">390344704</span> blocks super <span class="number">1.2</span> level <span class="number">5</span>, <span class="number">32</span>k chunk, algorithm <span class="number">2</span> [<span class="number">3</span>/<span class="number">3</span>] [UUU]</span><br><span class="line"></span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line"></span><br><span class="line">$ cat fio.cfg</span><br><span class="line">[global]</span><br><span class="line">rw=randwrite</span><br><span class="line">ioengine=sync</span><br><span class="line">size=<span class="number">8</span>G</span><br><span class="line">numjobs=<span class="number">32</span></span><br><span class="line">group_reporting</span><br><span class="line">exitall</span><br><span class="line">time_based</span><br><span class="line">runtime=<span class="number">3600</span></span><br><span class="line">direct=<span class="number">1</span></span><br><span class="line">bssplit=<span class="number">8</span>K/<span class="number">100</span></span><br><span class="line">[rw]</span><br><span class="line">directory=/mnt</span><br><span class="line"></span><br><span class="line">                                                       ------------why read ?</span><br><span class="line">                                                       |</span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle|</span><br><span class="line">           <span class="number">0.36</span>    <span class="number">0.00</span>    <span class="number">4.42</span>   <span class="number">73.21</span>    <span class="number">0.00</span>   <span class="number">22.02</span>|</span><br><span class="line">                                                       |</span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">nvme0n1       <span class="number">47036.00</span>     <span class="number">0.00</span> <span class="number">47051.00</span> <span class="number">188169.00</span>   <span class="number">367.54</span>   <span class="number">735.04</span>     <span class="number">9.60</span>    <span class="number">39.26</span>    <span class="number">0.17</span>    <span class="number">0.55</span>    <span class="number">0.07</span>   <span class="number">0.00</span>  <span class="number">99.95</span></span><br><span class="line">nvme0n1p1     <span class="number">15598.00</span>     <span class="number">0.00</span> <span class="number">15602.50</span> <span class="number">62886.50</span>   <span class="number">121.88</span>   <span class="number">245.65</span>     <span class="number">9.59</span>    <span class="number">13.31</span>    <span class="number">0.17</span>    <span class="number">0.55</span>    <span class="number">0.08</span>   <span class="number">0.01</span> <span class="number">100.00</span></span><br><span class="line">nvme0n1p2     <span class="number">15752.50</span>     <span class="number">0.00</span> <span class="number">15755.00</span> <span class="number">62576.00</span>   <span class="number">123.08</span>   <span class="number">244.44</span>     <span class="number">9.61</span>    <span class="number">13.19</span>    <span class="number">0.17</span>    <span class="number">0.54</span>    <span class="number">0.08</span>   <span class="number">0.01</span> <span class="number">100.00</span></span><br><span class="line">nvme0n1p3     <span class="number">15685.50</span>     <span class="number">0.00</span> <span class="number">15691.50</span> <span class="number">62705.50</span>   <span class="number">122.57</span>   <span class="number">244.94</span>     <span class="number">9.60</span>    <span class="number">12.95</span>    <span class="number">0.17</span>    <span class="number">0.55</span>    <span class="number">0.07</span>   <span class="number">0.01</span> <span class="number">100.00</span></span><br><span class="line"></span><br><span class="line">$ bpftrace -e <span class="string">&#x27;kprobe:md* &#123;&#123;@[probe] = count()&#125; &#125;&#x27;</span></span><br><span class="line">@[kprobe:md_write_start]: <span class="number">425895</span></span><br><span class="line">@[kprobe:md_make_request]: <span class="number">430225</span></span><br><span class="line">@[kprobe:md_handle_request]: <span class="number">430950</span></span><br><span class="line">@[kprobe:md_write_inc]: <span class="number">851009</span></span><br><span class="line">@[kprobe:md_mergeable_bvec]: <span class="number">859830</span></span><br><span class="line">@[kprobe:md_write_end]: <span class="number">1278241</span></span><br><span class="line">@[kprobe:md_check_recovery]: <span class="number">1758916</span></span><br><span class="line">@[kprobe:md_wakeup_thread]: <span class="number">4295662</span></span><br><span class="line"></span><br><span class="line">Got the high latency by ftrace</span><br><span class="line">  <span class="number">12</span>)               |      handle_stripe [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |        analyse_stripe [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.022</span> us    |          r5l_log_disk_error [raid456]();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.390</span> us    |        &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.021</span> us    |        r5c_finish_stripe_write_out [raid456]();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.020</span> us    |        r5c_is_writeback [raid456]();</span><br><span class="line">  <span class="number">12</span>)               |        handle_stripe_dirtying [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |          schedule_reconstruction [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.147</span> us    |            r5c_release_extra_page [raid456]();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.437</span> us    |          &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.739</span> us    |        &#125;</span><br><span class="line">  <span class="number">12</span>)               |        raid_run_ops [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.022</span> us    |          _raw_spin_lock_irq();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.020</span> us    |          r5c_is_writeback [raid456]();</span><br><span class="line">  <span class="number">12</span>)               |          async_copy_data.isra<span class="number">.47</span> [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |            async_memcpy [async_memcpy]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |              __async_tx_find_channel [async_tx]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.022</span> us    |                dma_find_channel();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.260</span> us    |              &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.021</span> us    |              async_tx_quiesce [async_tx]();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.021</span> us    |              dmaengine_unmap_put();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">1.790</span> us    |            &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">2.071</span> us    |          &#125;</span><br><span class="line">  <span class="number">12</span>)               |          async_xor [async_xor]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |            __async_tx_find_channel [async_tx]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.023</span> us    |              dma_find_channel();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.262</span> us    |            &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.021</span> us    |            async_tx_quiesce [async_tx]();</span><br><span class="line">  <span class="number">12</span>)               |            xor_blocks [xor]() &#123;</span><br><span class="line">  <span class="number">12</span>)               |              xor_avx_3 [xor]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.021</span> us    |                irq_fpu_usable();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.039</span> us    |                __kernel_fpu_begin();</span><br><span class="line">  <span class="number">12</span>)               |                __kernel_fpu_end() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.057</span> us    |                  math_state_restore();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.291</span> us    |                &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">1.882</span> us    |              &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">2.137</span> us    |            &#125;</span><br><span class="line">  <span class="number">12</span>)               |            ops_complete_reconstruct [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.031</span> us    |              raid5_release_stripe [raid456]();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.323</span> us    |            &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">4.343</span> us    |          &#125;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">7.464</span> us    |        &#125;</span><br><span class="line">  <span class="number">12</span>)               |        ops_run_io [raid456]() &#123;</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.023</span> us    |          _cond_resched();</span><br><span class="line">  <span class="number">12</span>)   <span class="number">0.329</span> us    |        &#125;</span><br><span class="line">  <span class="number">12</span>) + <span class="number">10.398</span> us   |      &#125;</span><br><span class="line"></span><br><span class="line">#<span class="meta"># it <span class="string">&#x27;s nvme dev, handle_stripe has the highest latency except some system default calls</span></span></span><br><span class="line"><span class="string"><span class="meta">  12) + 10.330 us   |      &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">  12) + 10.340 us   |      &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">  12)   9.921 us    |      &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">  12) + 10.057 us   |      &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">  12) + 10.239 us   |      &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo 8 4 1 7 &gt; /proc/sys/kernel/printk</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo -n &quot;file raid5.c +p&quot; &gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta">or</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo -n &quot;file raid5.c +pmflt&quot; &gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta">$ dmesg | grep &quot;Read_old block&quot; -B 4 -A 4 </span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">### disable</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo -n &#x27;</span>file raid5.c -p<span class="string">&#x27; &gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo -n &quot;file raid5.c -pmflt&quot; &gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">### single func</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo &quot;func handle_stripe_dirtying +p&quot; &gt;&gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta">$ echo &quot;func handle_stripe_dirtying -p&quot; &gt;&gt; /sys/kernel/debug/dynamic_debug/control</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6491.600465] for sector 224878608 state 0x2041, rmw=2 rcw=0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6491.600939] for sector 224878616 state 0x2041, rmw=2 rcw=0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6491.601260] for sector 149425888 state 0x2041, rmw=2 rcw=0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6491.601584] for sector 149425896 state 0x2041, rmw=2 rcw=0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.311915] for sector 195169064 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.312323] Read_old block 2 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.312671] for sector 195169072 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.313044] Read_old block 2 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.313381] for sector 195169080 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.313719] Read_old block 2 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.314060] for sector 195169088 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 6496.314416] Read_old block 2 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">--</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266077] &lt;intr&gt; raid456:raid5_end_write_request:2636: end_write_request 123139960/0, count 2, uptodate: 1.</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266080] [4448] raid456:analyse_stripe:4403: check 0: state 0x0 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266082] [4448] raid456:handle_stripe:4749: locked=0 uptodate=0 to_read=0 to_write=1 failed=0 failed_num=-1,-1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266084] [4448] raid456:handle_stripe_dirtying:3919: for sector 275011528 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266086] [4448] raid456:handle_stripe_dirtying:3996: Read_old block 2 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266088] [4448] raid456:ops_run_io:1111: ops_run_io: for 275011528 schedule op 0 on disc 2</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266091] [4448] raid456:handle_stripe:4717: handling stripe 214788240, state=0x2041 cnt=1, pd_idx=0, qd_idx=-1</span></span></span><br><span class="line"><span class="string"><span class="meta">               , check:0, reconstruct:5</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266093] [4448] raid456:analyse_stripe:4403: check 2: state 0x11 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">--</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266269] [4448] raid456:analyse_stripe:4403: check 1: state 0x8 read           (null) write ffff928df71d5900 written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266271] [4448] raid456:analyse_stripe:4403: check 0: state 0x0 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266273] [4448] raid456:handle_stripe:4749: locked=0 uptodate=0 to_read=0 to_write=1 failed=0 failed_num=-1,-1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266275] [4448] raid456:handle_stripe_dirtying:3919: for sector 72429152 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266277] [4448] raid456:handle_stripe_dirtying:3996: Read_old block 0 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266279] [4448] raid456:ops_run_io:1111: ops_run_io: for 72429152 schedule op 0 on disc 0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266283] [4448] raid456:handle_stripe:4717: handling stripe 72429160, state=0x41 cnt=1, pd_idx=2, qd_idx=-1</span></span></span><br><span class="line"><span class="string"><span class="meta">               , check:0, reconstruct:0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266285] [4448] raid456:analyse_stripe:4403: check 2: state 0x0 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">--</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266291] &lt;intr&gt; raid456:raid5_end_write_request:2636: end_write_request 224927640/0, count 1, uptodate: 1.</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266293] [4448] raid456:analyse_stripe:4403: check 0: state 0x0 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266296] [4448] raid456:handle_stripe:4749: locked=0 uptodate=0 to_read=0 to_write=1 failed=0 failed_num=-1,-1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266298] [4448] raid456:handle_stripe_dirtying:3919: for sector 72429160 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266300] [4448] raid456:handle_stripe_dirtying:3996: Read_old block 0 for Reconstruct</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266302] [4448] raid456:ops_run_io:1111: ops_run_io: for 72429160 schedule op 0 on disc 0</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266305] [4448] raid456:handle_stripe:4717: handling stripe 104667968, state=0x2041 cnt=1, pd_idx=0, qd_idx=-1</span></span></span><br><span class="line"><span class="string"><span class="meta">               , check:0, reconstruct:5</span></span></span><br><span class="line"><span class="string"><span class="meta">[ 1795.266307] [4448] raid456:analyse_stripe:4403: check 2: state 0x11 read           (null) write           (null) written           (null)</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">### linux-3.10.0-1127.el7/drivers/md/raid5.c</span></span></span><br><span class="line"><span class="string"><span class="meta">        //raid456:handle_stripe_dirtying:3919: for sector 72429160 state 0x41, rmw=2 rcw=1</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">        if ((rcw &lt; rmw || (rcw == rmw &amp;&amp; conf-&gt;rmw_level != PARITY_PREFER_RMW)) &amp;&amp; rcw &gt; 0) &#123;</span></span></span><br><span class="line"><span class="string"><span class="meta">                /* want reconstruct write, but need to get some data */</span></span></span><br><span class="line"><span class="string"><span class="meta">                int qread =0;</span></span></span><br><span class="line"><span class="string"><span class="meta">                rcw = 0;</span></span></span><br><span class="line"><span class="string"><span class="meta">                for (i = disks; i--; ) &#123;</span></span></span><br><span class="line"><span class="string"><span class="meta">                        struct r5dev *dev = &amp;sh-&gt;dev[i];</span></span></span><br><span class="line"><span class="string"><span class="meta">                        if (!test_bit(R5_OVERWRITE, &amp;dev-&gt;flags) &amp;&amp;</span></span></span><br><span class="line"><span class="string"><span class="meta">                            i != sh-&gt;pd_idx &amp;&amp; i != sh-&gt;qd_idx &amp;&amp;</span></span></span><br><span class="line"><span class="string"><span class="meta">                            !test_bit(R5_LOCKED, &amp;dev-&gt;flags) &amp;&amp;</span></span></span><br><span class="line"><span class="string"><span class="meta">                            !(test_bit(R5_UPTODATE, &amp;dev-&gt;flags) ||</span></span></span><br><span class="line"><span class="string"><span class="meta">                              test_bit(R5_Wantcompute, &amp;dev-&gt;flags))) &#123;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                rcw++;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                if (test_bit(R5_Insync, &amp;dev-&gt;flags) &amp;&amp;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                    test_bit(STRIPE_PREREAD_ACTIVE,</span></span></span><br><span class="line"><span class="string"><span class="meta">                                             &amp;sh-&gt;state)) &#123;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        pr_debug(&quot;Read_old block &quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                                &quot;%d for Reconstruct\n&quot;, i);</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        set_bit(R5_LOCKED, &amp;dev-&gt;flags);</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        set_bit(R5_Wantread, &amp;dev-&gt;flags);</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        s-&gt;locked++;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        qread++;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                &#125; else &#123;</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        set_bit(STRIPE_DELAYED, &amp;sh-&gt;state);</span></span></span><br><span class="line"><span class="string"><span class="meta">                                        set_bit(STRIPE_HANDLE, &amp;sh-&gt;state);</span></span></span><br><span class="line"><span class="string"><span class="meta">                                &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">                        &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">                &#125;</span></span></span><br><span class="line"><span class="string"><span class="meta">                if (rcw &amp;&amp; conf-&gt;mddev-&gt;queue)</span></span></span><br><span class="line"><span class="string"><span class="meta">                        blk_add_trace_msg(conf-&gt;mddev-&gt;queue, &quot;raid5 rcw %llu %d %d %d&quot;,</span></span></span><br><span class="line"><span class="string"><span class="meta">                                          (unsigned long long)sh-&gt;sector,</span></span></span><br><span class="line"><span class="string"><span class="meta">                                          rcw, qread, test_bit(STRIPE_DELAYED, &amp;sh-&gt;state));</span></span></span><br><span class="line"><span class="string"><span class="meta">        &#125;</span></span></span><br></pre></td></tr></table></figure>


  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-function-stack-frame-layout"><span class="toc-number">1.</span> <span class="toc-text">Kernel function stack frame layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kdump-setting"><span class="toc-number">2.</span> <span class="toc-text">kdump setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack-order"><span class="toc-number">3.</span> <span class="toc-text">stack order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loading-kernel-module"><span class="toc-number">4.</span> <span class="toc-text">loading kernel module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genarate-the-debuginfo-script-not-test-when-compile-the-linux-kernel"><span class="toc-number">5.</span> <span class="toc-text">genarate the debuginfo script, not test when compile the linux kernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example1"><span class="toc-number">6.</span> <span class="toc-text">example1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#command"><span class="toc-number">7.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example2-dump-file-content-in-memory"><span class="toc-number">8.</span> <span class="toc-text">example2 dump file content in memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example3-memory-hacking"><span class="toc-number">9.</span> <span class="toc-text">example3 memory hacking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example4"><span class="toc-number">10.</span> <span class="toc-text">example4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example5-trace-the-sock"><span class="toc-number">11.</span> <span class="toc-text">example5 trace the sock</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#crash-exmaple"><span class="toc-number">11.1.</span> <span class="toc-text">crash exmaple</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debug-example2"><span class="toc-number">11.2.</span> <span class="toc-text">debug example2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debug-example3"><span class="toc-number">11.3.</span> <span class="toc-text">debug example3</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#show-pr-debug-the-small-write-amplification-with-linux-soft-raid5"><span class="toc-number">11.3.1.</span> <span class="toc-text">show pr_debug, the small write amplification with linux soft raid5</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/03/03/crash/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/03/03/crash/&text=crash practice"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/03/03/crash/&is_video=false&description=crash practice"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=crash practice&body=Check out this article: http://example.com/2020/03/03/crash/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/03/03/crash/&title=crash practice"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/03/03/crash/&name=crash practice&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/03/03/crash/&t=crash practice"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
