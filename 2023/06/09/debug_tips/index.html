<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="crashmemoryslub debug12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394">
<meta property="og:type" content="article">
<meta property="og:title" content="debug tips">
<meta property="og:url" content="http://example.com/2023/06/09/debug_tips/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="crashmemoryslub debug12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-06-09T05:46:07.000Z">
<meta property="article:modified_time" content="2024-03-05T03:45:11.366Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="trace">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>debug tips</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/08/01/podman/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/20/expect/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/06/09/debug_tips/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/06/09/debug_tips/&text=debug tips"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/06/09/debug_tips/&is_video=false&description=debug tips"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=debug tips&body=Check out this article: http://example.com/2023/06/09/debug_tips/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/06/09/debug_tips/&name=debug tips&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/06/09/debug_tips/&t=debug tips"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#crash"><span class="toc-number">1.</span> <span class="toc-text">crash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#memory"><span class="toc-number">1.1.</span> <span class="toc-text">memory</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#slub-debug"><span class="toc-number">1.1.1.</span> <span class="toc-text">slub debug</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#crash-sort-slab"><span class="toc-number">1.1.2.</span> <span class="toc-text">crash sort slab</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#user-space-test-code"><span class="toc-number">1.1.3.</span> <span class="toc-text">[user space test code]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kprobe-test-code"><span class="toc-number">1.1.4.</span> <span class="toc-text">kprobe test code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assemble"><span class="toc-number">2.</span> <span class="toc-text">Assemble</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-assert"><span class="toc-number">3.</span> <span class="toc-text">c++ assert</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        debug tips
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-06-09T05:46:07.000Z" itemprop="datePublished">2023-06-09</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Debug/">Debug</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/debug/" rel="tag">debug</a>, <a class="tag-link-link" href="/tags/trace/" rel="tag">trace</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="crash"><a href="#crash" class="headerlink" title="crash"></a>crash</h3><h4 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h4><h5 id="slub-debug"><a href="#slub-debug" class="headerlink" title="slub debug"></a>slub debug</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;slub_debug=U,kmalloc-*,filp log_buf_len=32M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">slub_debug=F              # Enables sanity checks for all slabs.</span></span><br><span class="line"><span class="string">slub_debug=FZUP,dentry    # Enables noted debugging for just the dentry slab cache</span></span><br><span class="line"><span class="string">slub_debug=U,kmalloc-*,filp    # Enables user tracking for all slab caches whose name begins with &#x27;</span>kmalloc<span class="string">&#x27; and the file pointer slab cache</span></span><br><span class="line"><span class="string">#https://access.redhat.com/solutions/5577011</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cd /usr/src/debug/kernel-4.18.0-425.13.1.el8_7/linux-4.18.0-425.13.1.el8_7.x86_64/tools/vm</span></span><br><span class="line"><span class="string">$ ls page_owner_sort.c  slabinfo.c</span></span><br><span class="line"><span class="string">$ gcc slabinfo.c -g -o slabinfo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#run the test to trigger the bug</span></span><br><span class="line"><span class="string">#-v|--validate          Validate slabs</span></span><br><span class="line"><span class="string">$ slabtop -v</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#dmesg show the errors</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:36 2023] SLUB: kmalloc-1k 476 slabs counted but counter=477</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:36 2023] SLUB: kmalloc-1k 459 slabs counted but counter=460</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:36 2023] SLUB: kmalloc-1k 1181 slabs counted but counter=1182</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:36 2023] SLUB: kmalloc-2k 835 slabs counted but counter=836</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] =============================================================================</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] BUG skbuff_fclone_cache (Not tainted): Wrong object count. Counter is 18 but counted were 19</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] Disabling lock debugging due to kernel taint</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] Slab 0xffffe09ccb79c400 objects=56 used=1 fp=0xffff8cc49e710d80 flags=0x17ffffc0010201(locked|slab|head|node=0|zone=2|lastcpupid=0x1fffff)</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] CPU: 22 PID: 931139 Comm: slabinfo Kdump: loaded Tainted: G    B             5.10.0-136.34.0.110.oe2203sp1.x86_64 #1</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] Hardware name: Supermicro Super Server/H12SSW-NT, BIOS 2.4 04/13/2022</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] Call Trace:</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  dump_stack+0x57/0x6e</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  slab_err+0x95/0xbe</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  ? unfreeze_partials+0x166/0x1a0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  on_freelist.cold+0x5b/0x123</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  validate_slab+0x5c/0x150</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  validate_slab_node+0x46/0xd0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  validate_store+0x6b/0xa0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  slab_attr_store+0x20/0x40</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  kernfs_fop_write_iter+0x128/0x1c0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  new_sync_write+0x113/0x1b0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  vfs_write+0x1b7/0x250</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  ksys_write+0x5f/0xe0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  do_syscall_64+0x40/0x80</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023]  entry_SYSCALL_64_after_hwframe+0x61/0xc6</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] RIP: 0033:0x7f58d7c33c37</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] Code: 0f 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b7 0f 1f 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 01 00 00 00 0f 05 &lt;48&gt; 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 48 89 54 24 18 48 89 74 24</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] RSP: 002b:00007ffd064de378 EFLAGS: 00000246 ORIG_RAX: 0000000000000001</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] RAX: ffffffffffffffda RBX: 0000000000000002 RCX: 00007f58d7c33c37</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] RDX: 0000000000000002 RSI: 000000000202db40 RDI: 0000000000000003</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] RBP: 000000000202db40 R08: 000000000202db40 R09: 0000000000400000</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] R10: 00007f58d7d29250 R11: 0000000000000246 R12: 0000000000000002</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] R13: 0000000002035b80 R14: 0000000000000002 R15: 00007f58d7d297a0</span></span><br><span class="line"><span class="string">[Wed Jun  7 15:32:41 2023] FIX skbuff_fclone_cache: Object count adjusted.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ while :; do cat /proc/slabinfo | awk &#x27;</span>&#123;<span class="built_in">printf</span> <span class="string">&quot;  %6i MB %s \n&quot;</span>,<span class="variable">$6</span>*<span class="variable">$15</span>/256,<span class="variable">$1</span>&#125;<span class="string">&#x27; | sort -nrk1 | head; sleep 5; date ; done </span></span><br><span class="line"><span class="string">Mon Jun 12 11:36:32 AM CST 2023</span></span><br><span class="line"><span class="string">    5997 MB kernfs_node_cache </span></span><br><span class="line"><span class="string">    2990 MB kmalloc-64 </span></span><br><span class="line"><span class="string">     453 MB radix_tree_node </span></span><br><span class="line"><span class="string">     386 MB sock_inode_cache </span></span><br><span class="line"><span class="string">     373 MB kmalloc-8 </span></span><br><span class="line"><span class="string">     351 MB RAW </span></span><br><span class="line"><span class="string">     208 MB RAWv6 </span></span><br><span class="line"><span class="string">      86 MB proc_inode_cache </span></span><br><span class="line"><span class="string">      60 MB kmalloc-1k </span></span><br><span class="line"><span class="string">      55 MB ext4_inode_cache </span></span><br><span class="line"><span class="string">Mon Jun 12 11:36:37 AM CST 2023</span></span><br><span class="line"><span class="string">    7469 MB kernfs_node_cache </span></span><br><span class="line"><span class="string">    3723 MB kmalloc-64 </span></span><br><span class="line"><span class="string">     560 MB radix_tree_node </span></span><br><span class="line"><span class="string">     465 MB kmalloc-8 </span></span><br><span class="line"><span class="string">     386 MB sock_inode_cache </span></span><br><span class="line"><span class="string">     351 MB RAW </span></span><br><span class="line"><span class="string">     208 MB RAWv6 </span></span><br><span class="line"><span class="string">      85 MB proc_inode_cache </span></span><br><span class="line"><span class="string">      60 MB kmalloc-1k </span></span><br><span class="line"><span class="string">      58 MB kmalloc-4k </span></span><br><span class="line"><span class="string">Mon Jun 12 11:36:42 AM CST 2023</span></span><br><span class="line"><span class="string">    8967 MB kernfs_node_cache </span></span><br><span class="line"><span class="string">    4472 MB kmalloc-64 </span></span><br><span class="line"><span class="string">     669 MB radix_tree_node </span></span><br><span class="line"><span class="string">     559 MB kmalloc-8 </span></span><br><span class="line"><span class="string">     386 MB sock_inode_cache </span></span><br><span class="line"><span class="string">     351 MB RAW </span></span><br><span class="line"><span class="string">     208 MB RAWv6 </span></span><br><span class="line"><span class="string">      83 MB proc_inode_cache </span></span><br><span class="line"><span class="string">      63 MB kmalloc-4k </span></span><br><span class="line"><span class="string">      59 MB kmalloc-1k </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cat test.stp </span></span><br><span class="line"><span class="string">#!/usr/bin/stap</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">global slab_alloc_stack</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">probe kernel.function(&quot;kmem_cache_alloc&quot;) </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    slab_alloc_stack[execname(),kernel_string($s-&gt;name),backtrace()] &lt;&lt;&lt; $s-&gt;size</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">probe timer.s($1)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    foreach ([proc,slub,bt] in slab_alloc_stack- limit $2) &#123;</span></span><br><span class="line"><span class="string">        printf(&quot;Proc:%s Slub:%s Count:%d Sum:%d\n&quot;, proc,slub,@count(slab_alloc_stack[proc,slub,bt]), @sum(slab_alloc_stack[proc,slub,bt]))</span></span><br><span class="line"><span class="string">        print_syms(bt)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    exit()</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ stap -g -d kernel --suppress-time-limits ./test.stp 5 10</span></span><br><span class="line"><span class="string">WARNING: Missing unwind data for a module, rerun with &#x27;</span>stap -d kernel<span class="string">&#x27;</span></span><br><span class="line"><span class="string">WARNING: too many pending (warning) messages</span></span><br><span class="line"><span class="string">Proc:stress-ng Slub:vm_area_struct Count:281204 Sum:65239328 </span></span><br><span class="line"><span class="string"> 0xffffffffaa14b5b0 : kmem_cache_alloc+0x0/0x410 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee49e1 : vm_area_dup+0x21/0xa0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee4ce0 : dup_mmap+0x280/0x520 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee5039 : dup_mm+0xb9/0x170 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee6690 : copy_process+0x1080/0x15e0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee6d6b : kernel_clone+0x9b/0x2f0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee7025 : __se_sys_clone+0x65/0x90 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa89c730 : do_syscall_64+0x40/0x80 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaaa00099 : entry_SYSCALL_64_after_hwframe+0x61/0xc6 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaaa00099 : entry_SYSCALL_64_after_hwframe+0x61/0xc6 [kernel]</span></span><br><span class="line"><span class="string">Proc:stress-ng Slub:anon_vma_chain Count:211816 Sum:13556224</span></span><br><span class="line"><span class="string"> 0xffffffffaa14b5b0 : kmem_cache_alloc+0x0/0x410 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa1089e9 : anon_vma_clone+0x69/0x200 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa108bb3 : anon_vma_fork+0x33/0x170 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee4d32 : dup_mmap+0x2d2/0x520 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee5039 : dup_mm+0xb9/0x170 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee6690 : copy_process+0x1080/0x15e0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee6d6b : kernel_clone+0x9b/0x2f0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee7025 : __se_sys_clone+0x65/0x90 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa89c730 : do_syscall_64+0x40/0x80 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaaa00099 : entry_SYSCALL_64_after_hwframe+0x61/0xc6 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaaa00099 : entry_SYSCALL_64_after_hwframe+0x61/0xc6 [kernel]</span></span><br><span class="line"><span class="string">Proc:stress-ng Slub:kernfs_node_cache Count:198001 Sum:25344128 &lt;-----------------kernfs_node_cache exhaust the memory when I sort with the /proc/slabinfo </span></span><br><span class="line"><span class="string"> 0xffffffffaa14b5b0 : kmem_cache_alloc+0x0/0x410 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa230c0e : __kernfs_new_node+0x5e/0x1d0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa231d63 : kernfs_new_node+0x33/0x60 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa233b05 : __kernfs_create_file+0x25/0xc0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa2347b6 : sysfs_add_file_mode_ns+0x86/0x180 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa2354ad : create_files+0x8d/0x1f0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa23578f : internal_create_group+0x17f/0x1f0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffc0e2a8bd : 0xffffffffc0e2a8bd</span></span><br><span class="line"><span class="string"> 0xffffffffc0e2a8bd : 0xffffffffc0e2a8bd</span></span><br><span class="line"><span class="string"> 0xffffffffc0e2ade2 : 0xffffffffc0e2ade2</span></span><br><span class="line"><span class="string"> 0xffffffffc0e2da8b : 0xffffffffc0e2da8b</span></span><br><span class="line"><span class="string"> 0xffffffffc0e2f278 : 0xffffffffc0e2f278</span></span><br><span class="line"><span class="string"> 0xffffffffaa68cbbe : ops_init+0x5e/0xa0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa68d5e5 : setup_net+0xd5/0x240 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa68e992 : copy_net_ns+0x122/0x230 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9f118e3 : create_new_namespaces+0x113/0x2b0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9f120d5 : unshare_nsproxy_namespaces+0x55/0xb0 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee75d0 : ksys_unshare+0x1a0/0x370 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffa9ee77ae : __x64_sys_unshare+0xe/0x20 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaa89c730 : do_syscall_64+0x40/0x80 [kernel]</span></span><br><span class="line"><span class="string"> 0xffffffffaaa00099 : entry_SYSCALL_64_after_hwframe+0x61/0xc6 [kernel]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./slabinfo -h</span></span><br><span class="line"><span class="string">slabinfo 4/15/2011. (c) 2007 sgi/(c) 2011 Linux Foundation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">slabinfo [-ahnpvtsz] [-d debugopts] [slab-regexp]</span></span><br><span class="line"><span class="string">-a|--aliases           Show aliases</span></span><br><span class="line"><span class="string">-A|--activity          Most active slabs first</span></span><br><span class="line"><span class="string">-d&lt;options&gt;|--debug=&lt;options&gt; Set/Clear Debug options</span></span><br><span class="line"><span class="string">-D|--display-active    Switch line format to activity</span></span><br><span class="line"><span class="string">-e|--empty             Show empty slabs</span></span><br><span class="line"><span class="string">-f|--first-alias       Show first alias</span></span><br><span class="line"><span class="string">-h|--help              Show usage information</span></span><br><span class="line"><span class="string">-i|--inverted          Inverted list</span></span><br><span class="line"><span class="string">-l|--slabs             Show slabs</span></span><br><span class="line"><span class="string">-n|--numa              Show NUMA information</span></span><br><span class="line"><span class="string">-o|--ops		Show kmem_cache_ops</span></span><br><span class="line"><span class="string">-s|--shrink            Shrink slabs</span></span><br><span class="line"><span class="string">-r|--report		Detailed report on single slabs</span></span><br><span class="line"><span class="string">-S|--Size              Sort by size</span></span><br><span class="line"><span class="string">-t|--tracking          Show alloc/free information</span></span><br><span class="line"><span class="string">-T|--Totals            Show summary information</span></span><br><span class="line"><span class="string">-v|--validate          Validate slabs</span></span><br><span class="line"><span class="string">-z|--zero              Include empty slabs</span></span><br><span class="line"><span class="string">-1|--1ref              Single reference</span></span><br><span class="line"><span class="string">-N|--lines=K           Show the first K slabs</span></span><br><span class="line"><span class="string">-L|--Loss              Sort by loss</span></span><br><span class="line"><span class="string">-X|--Xtotals           Show extended summary information</span></span><br><span class="line"><span class="string">-B|--Bytes             Show size in bytes</span></span><br><span class="line"><span class="string">-U|--Unreclaim		Show unreclaimable slabs only</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Valid debug options (FZPUT may be combined)</span></span><br><span class="line"><span class="string">a / A          Switch on all debug options (=FZUP)</span></span><br><span class="line"><span class="string">-              Switch off all debug options</span></span><br><span class="line"><span class="string">f / F          Sanity Checks (SLAB_CONSISTENCY_CHECKS)</span></span><br><span class="line"><span class="string">z / Z          Redzoning</span></span><br><span class="line"><span class="string">p / P          Poisoning</span></span><br><span class="line"><span class="string">u / U          Tracking</span></span><br><span class="line"><span class="string">t / T          Tracing</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./slabinfo -a</span></span><br><span class="line"><span class="string">$ ./slabinfo -A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./slabinfo -T</span></span><br><span class="line"><span class="string">Slabcache Totals</span></span><br><span class="line"><span class="string">----------------</span></span><br><span class="line"><span class="string">Slabcaches :             237   Aliases  :           0-&gt;0    Active:    134</span></span><br><span class="line"><span class="string">Memory used:          109.3M   # Loss   :            6.6M   MRatio:     6%</span></span><br><span class="line"><span class="string"># Objects  :          358.9K   # PartObj:           15.7K   ORatio:     4%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Per Cache         Average              Min              Max            Total</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">#Objects             2.6K                1            68.0K           358.9K</span></span><br><span class="line"><span class="string">#Slabs                 87                1             3.2K            11.7K</span></span><br><span class="line"><span class="string">#PartSlab               6                0               80              812</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./slabinfo -S</span></span><br><span class="line"><span class="string">Name                   Objects Objsize           Space Slabs/Part/Cpu  O/S O %Fr %Ef Flg</span></span><br><span class="line"><span class="string">ext4_inode_cache         27615    1160           32.4M       990/10/0   28 3   1  98 a</span></span><br><span class="line"><span class="string">inode_cache              23642     648           16.1M        985/1/1   24 2   0  94 a</span></span><br><span class="line"><span class="string">dentry                   67985     192           13.3M     3241/23/10   21 0   0  98 a</span></span><br><span class="line"><span class="string">buffer_head              47870     104            5.2M      1270/80/0   39 0   6  95 a</span></span><br><span class="line"><span class="string">radix_tree_node           7566     576            4.6M       281/37/0   28 2  13  94 a</span></span><br><span class="line"><span class="string">kmalloc-4k                 959    4096            4.0M        123/7/0    8 3   5  97 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./slabinfo -t</span></span><br><span class="line"><span class="string">Acpi-Namespace: Kernel object allocation</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="string">No Data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Acpi-Namespace: Kernel object freeing</span></span><br><span class="line"><span class="string">------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">No Data</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>If you want get the process name, please enable the <a target="_blank" rel="noopener" href="http://www.wowotech.net/memory_management/424.html">KASAN</a> for trace  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> kasan_multi_shot</span><br><span class="line">                  [KNL] Enforce KASAN (Kernel Address Sanitizer) to <span class="built_in">print</span></span><br><span class="line">                  report on every invalid memory access. Without this </span><br><span class="line">                  parameter KASAN will <span class="built_in">print</span> report only <span class="keyword">for</span> the first</span><br><span class="line">                  invalid access.</span><br><span class="line"></span><br><span class="line"> sysctl -w kernel.panic_on_oops=1</span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;slub_debug=U,kmalloc-*,filp kasan_multi_shot log_buf_len=32M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># re-compile the kernel </span></span><br><span class="line"><span class="string">https://www.kernel.org/doc/html/v4.18/dev-tools/kasan.html</span></span><br><span class="line"><span class="string">CONFIG_SLUB_DEBUG=y</span></span><br><span class="line"><span class="string">CONFIG_KASAN=y</span></span><br></pre></td></tr></table></figure>
<p>slub test slub_debug&#x3D;U,kmalloc-*,filp  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;linux/init.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;linux/module.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;linux/slab.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define DEBUG_DEFAULT_FLAGS (SLAB_CONSISTENCY_CHECKS | SLAB_RED_ZONE | \</span></span><br><span class="line">                             SLAB_POISON | SLAB_STORE_USER)</span><br><span class="line"></span><br><span class="line">static struct kmem_cache *cache_a;</span><br><span class="line">struct slub_test &#123;</span><br><span class="line">    char name[64];</span><br><span class="line">&#125;;</span><br><span class="line">struct slub_test *allocated;</span><br><span class="line"></span><br><span class="line">static int slab_test_init(void)</span><br><span class="line">&#123;</span><br><span class="line">    cache_a = kmem_cache_create(<span class="string">&quot;SLUB-TEST&quot;</span>, sizeof (struct slub_test), </span><br><span class="line">                                 0, DEBUG_DEFAULT_FLAGS , NULL);                                  </span><br><span class="line">    allocated = kmem_cache_alloc(cache_a, GFP_KERNEL);</span><br><span class="line">    memset(allocated, 0x20, 80);  // 80 &gt; 64, overflow </span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void slab_test_exit(void)</span><br><span class="line">&#123; </span><br><span class="line">    kmem_cache_free(cache_a, allocated);</span><br><span class="line">    kmem_cache_destroy(cache_a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(slab_test_init);</span><br><span class="line">module_exit(slab_test_exit);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ slabinfo -v</span><br><span class="line">$ dmesg </span><br><span class="line">[  143.190792] =============================================================================</span><br><span class="line">[  143.190817] BUG SLUB-TEST (Tainted: P           OE  ------------  ): Redzone overwritten</span><br><span class="line">[  143.190835] -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[  143.190858] INFO: 0xffff8ed127f16048-0xffff8ed127f1604f. First byte 0x20 instead of 0xcc</span><br><span class="line">[  143.190879] INFO: Allocated <span class="keyword">in</span> slab_test_init+0x38/0x80 [kmem_cache_free] age=6928 cpu=0 pid=1532</span><br><span class="line">[  143.190902] 	__slab_alloc+0x40/0x5c</span><br><span class="line">[  143.190914] 	kmem_cache_alloc+0x19b/0x1f0</span><br><span class="line">[  143.190925] 	slab_test_init+0x38/0x80 [kmem_cache_free]</span><br><span class="line">[  143.190938] 	do_one_initcall+0xba/0x240</span><br><span class="line">[  143.190950] 	load_module+0x271a/0x2bb0</span><br><span class="line">[  143.190961] 	SyS_finit_module+0xa6/0xd0</span><br><span class="line">[  143.190973] 	system_call_fastpath+0x25/0x2a</span><br><span class="line">[  143.190984] INFO: Slab 0xffffe7da499fc580 objects=20 used=1 fp=0xffff8ed127f17db8 flags=0x2fffff00004081</span><br><span class="line">[  143.191005] INFO: Object 0xffff8ed127f16008 @offset=8 fp=0x2020202020202020</span><br><span class="line"></span><br><span class="line">[  143.191025] Redzone ffff8ed127f16000: cc cc cc cc cc cc cc cc                          ........</span><br><span class="line">[  143.191044] Object ffff8ed127f16008: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[  143.191065] Object ffff8ed127f16018: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[  143.191086] Object ffff8ed127f16028: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[  143.191106] Object ffff8ed127f16038: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    </span><br><span class="line">[  143.191127] Redzone ffff8ed127f16048: 20 20 20 20 20 20 20 20                          &lt;-------------------------------0x48-0x08=0x40=64, and redzone has been override</span><br><span class="line">[  143.191146] Padding ffff8ed127f16188: 5a 5a 5a 5a 5a 5a 5a 5a                          ZZZZZZZZ</span><br><span class="line">[  143.191175] CPU: 1 PID: 1543 Comm: slabinfo Kdump: loaded Tainted: P    B      OE  ------------   3.10.0-1160.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[  143.191199] Hardware name: Red Hat KVM/RHEL, BIOS 1.16.0-4.el9 04/01/2014</span><br><span class="line">[  143.191215] Call Trace:</span><br><span class="line">[  143.191225]  [&lt;ffffffffb4781340&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[  143.191240]  [&lt;ffffffffb42238b1&gt;] print_trailer+0x161/0x280</span><br><span class="line">[  143.191254]  [&lt;ffffffffb4223b3f&gt;] check_bytes_and_report+0xcf/0x110</span><br><span class="line">[  143.191269]  [&lt;ffffffffb42246cd&gt;] check_object+0x1dd/0x2a0</span><br><span class="line">[  143.191284]  [&lt;ffffffffb422518b&gt;] validate_slab+0x19b/0x1f0</span><br><span class="line">[  143.191297]  [&lt;ffffffffb4229046&gt;] validate_store+0x116/0x290</span><br><span class="line">[  143.191311]  [&lt;ffffffffb4222dee&gt;] slab_attr_store+0x3e/0x120</span><br><span class="line">[  143.191327]  [&lt;ffffffffb42db0b2&gt;] sysfs_kf_write+0x42/0x50</span><br><span class="line">[  143.191340]  [&lt;ffffffffb42da69b&gt;] kernfs_fop_write+0xeb/0x160</span><br><span class="line">[  143.191356]  [&lt;ffffffffb424db50&gt;] vfs_write+0xc0/0x1f0</span><br><span class="line">[  143.191369]  [&lt;ffffffffb424e92f&gt;] SyS_write+0x7f/0xf0</span><br><span class="line">[  143.191383]  [&lt;ffffffffb4793f92&gt;] system_call_fastpath+0x25/0x2a</span><br><span class="line">[  143.191398] FIX SLUB-TEST: Restoring 0xffff8ed127f16048-0xffff8ed127f1604f=0xcc</span><br><span class="line"></span><br><span class="line">modify memset after free</span><br><span class="line">static int slab_test_init(void)</span><br><span class="line">&#123;</span><br><span class="line">    cache_a = kmem_cache_create(<span class="string">&quot;SLUB-TEST&quot;</span>, sizeof (struct slub_test),</span><br><span class="line">                                 0, DEBUG_DEFAULT_FLAGS , NULL);</span><br><span class="line">    allocated = kmem_cache_alloc(cache_a, GFP_KERNEL);</span><br><span class="line">    kfree(allocated);</span><br><span class="line">    memset(allocated, 0x20, 80);  // 80 &gt; 64, overflow </span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:51 2023] kmem_cache_free: module verification failed: signature and/or required key missing - tainting kernel</span><br><span class="line">[Mon Jun 12 16:33:56 2023] =============================================================================</span><br><span class="line">[Mon Jun 12 16:33:56 2023] BUG SLUB-TEST (Tainted: P           OE  ------------  ): Freechain corrupt</span><br><span class="line">[Mon Jun 12 16:33:56 2023] -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Allocated <span class="keyword">in</span> slab_test_init+0x38/0x90 [kmem_cache_free] age=5615 cpu=0 pid=2255</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	__slab_alloc+0x40/0x5c</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	kmem_cache_alloc+0x19b/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	slab_test_init+0x38/0x90 [kmem_cache_free]</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	do_one_initcall+0xba/0x240</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	load_module+0x271a/0x2bb0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	SyS_finit_module+0xa6/0xd0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Freed <span class="keyword">in</span> slab_test_init+0x47/0x90 [kmem_cache_free] age=5615 cpu=0 pid=2255</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	kfree+0x106/0x140</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	slab_test_init+0x47/0x90 [kmem_cache_free]</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	do_one_initcall+0xba/0x240</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	load_module+0x271a/0x2bb0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	SyS_finit_module+0xa6/0xd0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Slab 0xffffd823c99b4980 objects=20 used=0 fp=0xffff97dca6d26008 flags=0x2fffff00004081</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Object 0xffff97dca6d26008 @offset=8 fp=0x2020202020202020</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:56 2023] Redzone ffff97dca6d26000: bb bb bb bb bb bb bb bb                          ........</span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26008: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26018: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26028: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26038: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Redzone ffff97dca6d26048: 20 20 20 20 20 20 20 20                                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Padding ffff97dca6d26188: 5a 5a 5a 5a 5a 5a 5a 5a                          ZZZZZZZZ</span><br><span class="line">[Mon Jun 12 16:33:56 2023] CPU: 0 PID: 2264 Comm: slabinfo Kdump: loaded Tainted: P    B      OE  ------------   3.10.0-1160.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Mon Jun 12 16:33:56 2023] Hardware name: Red Hat KVM/RHEL, BIOS 1.16.0-4.el9 04/01/2014</span><br><span class="line">[Mon Jun 12 16:33:56 2023] Call Trace:</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82381340&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e238b1&gt;] print_trailer+0x161/0x280</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e2420f&gt;] on_freelist+0xff/0x270</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e2503d&gt;] validate_slab+0x4d/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e29046&gt;] validate_store+0x116/0x290</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e22dee&gt;] slab_attr_store+0x3e/0x120</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81edb0b2&gt;] sysfs_kf_write+0x42/0x50</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81eda69b&gt;] kernfs_fop_write+0xeb/0x160</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4db50&gt;] vfs_write+0xc0/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4e92f&gt;] SyS_write+0x7f/0xf0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82393f92&gt;] system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] =============================================================================</span><br><span class="line">[Mon Jun 12 16:33:56 2023] BUG SLUB-TEST (Tainted: P    B      OE  ------------  ): Wrong object count. Counter is 0 but counted were 19</span><br><span class="line">[Mon Jun 12 16:33:56 2023] -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Slab 0xffffd823c99b4980 objects=20 used=0 fp=0xffff97dca6d26008 flags=0x2fffff00004081</span><br><span class="line">[Mon Jun 12 16:33:56 2023] CPU: 0 PID: 2264 Comm: slabinfo Kdump: loaded Tainted: P    B      OE  ------------   3.10.0-1160.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Mon Jun 12 16:33:56 2023] Hardware name: Red Hat KVM/RHEL, BIOS 1.16.0-4.el9 04/01/2014</span><br><span class="line">[Mon Jun 12 16:33:56 2023] Call Trace:</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82381340&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e23ea4&gt;] slab_err+0xb4/0xe0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81c30a1e&gt;] ? show_stack+0x4e/0x60</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e238b1&gt;] ? print_trailer+0x161/0x280</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e242d5&gt;] on_freelist+0x1c5/0x270</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e2503d&gt;] validate_slab+0x4d/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e29046&gt;] validate_store+0x116/0x290</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e22dee&gt;] slab_attr_store+0x3e/0x120</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81edb0b2&gt;] sysfs_kf_write+0x42/0x50</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81eda69b&gt;] kernfs_fop_write+0xeb/0x160</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4db50&gt;] vfs_write+0xc0/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4e92f&gt;] SyS_write+0x7f/0xf0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82393f92&gt;] system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] FIX SLUB-TEST: Object count adjusted.</span><br><span class="line">[Mon Jun 12 16:33:56 2023] =============================================================================</span><br><span class="line">[Mon Jun 12 16:33:56 2023] BUG SLUB-TEST (Tainted: P    B      OE  ------------  ): Redzone overwritten</span><br><span class="line">[Mon Jun 12 16:33:56 2023] -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: 0xffff97dca6d26048-0xffff97dca6d2604f. First byte 0x20 instead of 0xbb</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Allocated <span class="keyword">in</span> slab_test_init+0x38/0x90 [kmem_cache_free] age=5630 cpu=0 pid=2255</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	__slab_alloc+0x40/0x5c</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	kmem_cache_alloc+0x19b/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	slab_test_init+0x38/0x90 [kmem_cache_free]</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	do_one_initcall+0xba/0x240</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	load_module+0x271a/0x2bb0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	SyS_finit_module+0xa6/0xd0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Freed <span class="keyword">in</span> slab_test_init+0x47/0x90 [kmem_cache_free] age=5634 cpu=0 pid=2255</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	kfree+0x106/0x140</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	slab_test_init+0x47/0x90 [kmem_cache_free]</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	do_one_initcall+0xba/0x240</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	load_module+0x271a/0x2bb0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	SyS_finit_module+0xa6/0xd0</span><br><span class="line">[Mon Jun 12 16:33:56 2023] 	system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Slab 0xffffd823c99b4980 objects=20 used=19 fp=0xffff97dca6d26008 flags=0x2fffff00004081</span><br><span class="line">[Mon Jun 12 16:33:56 2023] INFO: Object 0xffff97dca6d26008 @offset=8 fp=0x          (null)</span><br><span class="line"></span><br><span class="line">[Mon Jun 12 16:33:56 2023] Redzone ffff97dca6d26000: bb bb bb bb bb bb bb bb                          ........</span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26008: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26018: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26028: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Object ffff97dca6d26038: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Redzone ffff97dca6d26048: 20 20 20 20 20 20 20 20                                  </span><br><span class="line">[Mon Jun 12 16:33:56 2023] Padding ffff97dca6d26188: 5a 5a 5a 5a 5a 5a 5a 5a                          ZZZZZZZZ</span><br><span class="line">[Mon Jun 12 16:33:56 2023] CPU: 0 PID: 2264 Comm: slabinfo Kdump: loaded Tainted: P    B      OE  ------------   3.10.0-1160.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">[Mon Jun 12 16:33:56 2023] Hardware name: Red Hat KVM/RHEL, BIOS 1.16.0-4.el9 04/01/2014</span><br><span class="line">[Mon Jun 12 16:33:56 2023] Call Trace:</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82381340&gt;] dump_stack+0x19/0x1b</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e238b1&gt;] print_trailer+0x161/0x280</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e23b3f&gt;] check_bytes_and_report+0xcf/0x110</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e246cd&gt;] check_object+0x1dd/0x2a0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e25103&gt;] validate_slab+0x113/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e29046&gt;] validate_store+0x116/0x290</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e22dee&gt;] slab_attr_store+0x3e/0x120</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81edb0b2&gt;] sysfs_kf_write+0x42/0x50</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81eda69b&gt;] kernfs_fop_write+0xeb/0x160</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4db50&gt;] vfs_write+0xc0/0x1f0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff81e4e92f&gt;] SyS_write+0x7f/0xf0</span><br><span class="line">[Mon Jun 12 16:33:56 2023]  [&lt;ffffffff82393f92&gt;] system_call_fastpath+0x25/0x2a</span><br><span class="line">[Mon Jun 12 16:33:56 2023] FIX SLUB-TEST: Restoring 0xffff97dca6d26048-0xffff97dca6d2604f=0xbb</span><br></pre></td></tr></table></figure>
<h5 id="crash-sort-slab"><a href="#crash-sort-slab" class="headerlink" title="crash sort slab"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/5953221">crash sort slab</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; </span><br><span class="line"></span><br><span class="line">crash&gt; kmem -s | awk <span class="string">&#x27;&#123;print $NF, $(NF-1) * $(NF-2)&quot;k&quot;&#125;&#x27;</span> | <span class="built_in">sort</span> -nrk2 | column -t | <span class="built_in">head</span> -n10</span><br><span class="line">kmalloc-64               116830700k    &lt;&lt;&lt;---</span><br><span class="line">kmalloc-16               66074912k     &lt;&lt;&lt;----</span><br><span class="line">kmalloc-32               6157892k</span><br><span class="line">acfs_buffer_cache_512    102624k</span><br><span class="line">kmalloc-4096             55488k</span><br><span class="line">radix_tree_node          42960k</span><br><span class="line">acfs_ofsbuf_cache        28312k</span><br><span class="line">kmalloc-256              23256k</span><br><span class="line">odlm_lkb_cache           23144k</span><br><span class="line">kernfs_node_cache        19176k</span><br><span class="line"></span><br><span class="line">crash&gt; kmem -S kmalloc-64 | grep <span class="string">&#x27;\[ffff.*\]&#x27;</span> | sed -e <span class="string">&#x27;s/\[//g&#x27;</span> -e <span class="string">&#x27;s/\]//g&#x27;</span> &gt; allocated_kmalloc64</span><br><span class="line">crash&gt; rd &lt; allocated_kmalloc64 8 | grep -Eo <span class="string">&#x27;ffffffff........&#x27;</span> | grep -v <span class="string">&#x27; &#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | <span class="built_in">head</span></span><br><span class="line">    436 ffffffffc0bdef90</span><br><span class="line">    106 ffffffffffffffff</span><br><span class="line">     40 ffffffffc0ababe3</span><br><span class="line">     21 ffffffff00000015</span><br><span class="line">     19 ffffffffc0be4980</span><br><span class="line">     19 ffffffffc0be48c8</span><br><span class="line">     13 ffffffffc024fe40</span><br><span class="line">      9 ffffffffc05a65ae</span><br><span class="line">      7 ffffffff00000000</span><br><span class="line">      5 ffffffff83a2ee60</span><br><span class="line"></span><br><span class="line">crash&gt; sym ffffffffc0bdef90</span><br><span class="line">ffffffffc0bdef90 (r) .LC0+16376 [falcon_lsm_serviceable] &lt;---The <span class="string">&quot;falcon_lsm_serviceable&quot;</span> is requesting the memory by using kmalloc-64 and kmalloc-16 slab objects</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">PID: 1254427  TASK: ffff8e993f8a8000  CPU: 22  COMMAND: <span class="string">&quot;stress-ng&quot;</span></span><br><span class="line"> <span class="comment">#0 [fffffe7dd9f33bb0] panic at ffffffffb7657b33</span></span><br><span class="line"> <span class="comment">#1 [fffffe7dd9f33c38] watchdog_hardlockup_check at ffffffffb7661291</span></span><br><span class="line"> <span class="comment">#2 [fffffe7dd9f33c48] __perf_event_overflow at ffffffffb6e88752</span></span><br><span class="line"> <span class="comment">#3 [fffffe7dd9f33c78] x86_pmu_handle_irq at ffffffffb6c0704c</span></span><br><span class="line"> <span class="comment">#4 [fffffe7dd9f33e18] amd_pmu_handle_irq at ffffffffb6c08c7c</span></span><br><span class="line"> <span class="comment">#5 [fffffe7dd9f33e38] perf_event_nmi_handler at ffffffffb6c05258</span></span><br><span class="line"> <span class="comment">#6 [fffffe7dd9f33e58] nmi_handle at ffffffffb6c29da8</span></span><br><span class="line"> <span class="comment">#7 [fffffe7dd9f33ea0] default_do_nmi at ffffffffb769ddd2</span></span><br><span class="line"> <span class="comment">#8 [fffffe7dd9f33ec8] exc_nmi at ffffffffb769dff3</span></span><br><span class="line"> <span class="comment">#9 [fffffe7dd9f33ef0] end_repeat_nmi at ffffffffb7801508</span></span><br><span class="line">    [exception RIP: deactivate_slab+250]</span><br><span class="line">    RIP: ffffffffb6f4885a  RSP: ffffaa64d9d77aa0  RFLAGS: 00000082</span><br><span class="line">    RAX: 000000000000000f  RBX: ffff8eadd1aa5fc0  RCX: ffff8eadd1aa5840</span><br><span class="line">    RDX: ffff8eadd1aa5c40  RSI: 000000008678fce3  RDI: ffff8eadd1aa5000</span><br><span class="line">    RBP: ffffaa64d9d77b70   R8: 0000000000000001   R9: 0000000000000020</span><br><span class="line">    R10: 0000000000000000  R11: 000000000003b7d0  R12: fffffb226046a940</span><br><span class="line">    R13: ffff8eadd1aa51c0  R14: ffff8e76c0044640  R15: 000000008678fce2</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018</span><br><span class="line">--- &lt;NMI exception stack&gt; ---</span><br><span class="line"><span class="comment">#10 [ffffaa64d9d77aa0] deactivate_slab at ffffffffb6f4885a</span></span><br><span class="line"><span class="comment">#11 [ffffaa64d9d77b78] ___slab_alloc at ffffffffb6f49927</span></span><br><span class="line"><span class="comment">#12 [ffffaa64d9d77c10] kmem_cache_alloc_trace at ffffffffb6f4b268</span></span><br><span class="line"><span class="comment">#13 [ffffaa64d9d77c50] alloc_group_attrs at ffffffffc0d9ef6a [ib_core]</span></span><br><span class="line"><span class="comment">#14 [ffffaa64d9d77c90] add_port at ffffffffc0d9f671 [ib_core]</span></span><br><span class="line"><span class="comment">#15 [ffffaa64d9d77d40] ib_setup_port_attrs at ffffffffc0d9fde2 [ib_core]</span></span><br><span class="line"><span class="comment">#16 [ffffaa64d9d77d68] add_one_compat_dev at ffffffffc0da2a8b [ib_core]</span></span><br><span class="line"><span class="comment">#17 [ffffaa64d9d77da0] rdma_dev_init_net at ffffffffc0da4278 [ib_core]</span></span><br><span class="line"><span class="comment">#18 [ffffaa64d9d77dd8] ops_init at ffffffffb748cbbe</span></span><br><span class="line"><span class="comment">#19 [ffffaa64d9d77e00] setup_net at ffffffffb748d5e5</span></span><br><span class="line"><span class="comment">#20 [ffffaa64d9d77e50] copy_net_ns at ffffffffb748e992</span></span><br><span class="line"><span class="comment">#21 [ffffaa64d9d77e88] create_new_namespaces at ffffffffb6d118e3</span></span><br><span class="line"><span class="comment">#22 [ffffaa64d9d77eb8] unshare_nsproxy_namespaces at ffffffffb6d120d5</span></span><br><span class="line"></span><br><span class="line">rash&gt; dis -lr deactivate_slab+250</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 2188</span><br><span class="line">0xffffffffb6f48760 &lt;deactivate_slab&gt;:   nopl   0x0(%rax,%rax,1) [FTRACE NOP]</span><br><span class="line">0xffffffffb6f48765 &lt;deactivate_slab+5&gt;: push   %rbp</span><br><span class="line">0xffffffffb6f48766 &lt;deactivate_slab+6&gt;: mov    %rsp,%rbp</span><br><span class="line">0xffffffffb6f48769 &lt;deactivate_slab+9&gt;: push   %r15</span><br><span class="line">0xffffffffb6f4876b &lt;deactivate_slab+11&gt;:        push   %r14</span><br><span class="line">0xffffffffb6f4876d &lt;deactivate_slab+13&gt;:        mov    %rdi,%r14</span><br><span class="line">0xffffffffb6f48770 &lt;deactivate_slab+16&gt;:        push   %r13</span><br><span class="line">0xffffffffb6f48772 &lt;deactivate_slab+18&gt;:        push   %r12</span><br><span class="line">0xffffffffb6f48774 &lt;deactivate_slab+20&gt;:        mov    %rsi,%r12</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slab.h: 557</span><br><span class="line">0xffffffffb6f48777 &lt;deactivate_slab+23&gt;:        push   %rbx</span><br><span class="line">0xffffffffb6f48778 &lt;deactivate_slab+24&gt;:        and    <span class="variable">$0xfffffffffffffff0</span>,%rsp</span><br><span class="line">0xffffffffb6f4877c &lt;deactivate_slab+28&gt;:        sub    <span class="variable">$0xa0</span>,%rsp</span><br><span class="line">0xffffffffb6f48783 &lt;deactivate_slab+35&gt;:        mov    (%rsi),%rax</span><br><span class="line">0xffffffffb6f48786 &lt;deactivate_slab+38&gt;:        mov    %rdx,0x58(%rsp)</span><br><span class="line">0xffffffffb6f4878b &lt;deactivate_slab+43&gt;:        shr    <span class="variable">$0x36</span>,%rax</span><br><span class="line">0xffffffffb6f4878f &lt;deactivate_slab+47&gt;:        cmpq   <span class="variable">$0x1</span>,0x20(%rsi)</span><br><span class="line">0xffffffffb6f48794 &lt;deactivate_slab+52&gt;:        mov    %rcx,0x40(%rsp)</span><br><span class="line">0xffffffffb6f48799 &lt;deactivate_slab+57&gt;:        mov    0xf0(%rdi,%rax,8),%rax</span><br><span class="line">0xffffffffb6f487a1 &lt;deactivate_slab+65&gt;:        mov    %rax,0x48(%rsp)</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 2198</span><br><span class="line">0xffffffffb6f487a6 &lt;deactivate_slab+70&gt;:        mov    <span class="variable">$0xf</span>,%eax</span><br><span class="line">0xffffffffb6f487ab &lt;deactivate_slab+75&gt;:        sbb    <span class="variable">$0xffffffff</span>,%eax</span><br><span class="line">0xffffffffb6f487ae &lt;deactivate_slab+78&gt;:        mov    %eax,0x50(%rsp)</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 2209</span><br><span class="line">0xffffffffb6f487b2 &lt;deactivate_slab+82&gt;:        <span class="built_in">test</span>   %rdx,%rdx</span><br><span class="line">0xffffffffb6f487b5 &lt;deactivate_slab+85&gt;:        je     0xffffffffb6f48cd6 &lt;deactivate_slab+1398&gt;</span><br><span class="line">0xffffffffb6f487bb &lt;deactivate_slab+91&gt;:        mov    0x8(%rdi),%r10d</span><br><span class="line">0xffffffffb6f487bf &lt;deactivate_slab+95&gt;:        mov    0x28(%rdi),%r9d</span><br><span class="line">0xffffffffb6f487c3 &lt;deactivate_slab+99&gt;:        mov    %rsi,%rdi</span><br><span class="line">0xffffffffb6f487c6 &lt;deactivate_slab+102&gt;:       mov    %rdx,%r13</span><br><span class="line">0xffffffffb6f487c9 &lt;deactivate_slab+105&gt;:       sub    0x10ad610(%rip),%rdi        <span class="comment"># 0xffffffffb7ff5de0</span></span><br><span class="line">0xffffffffb6f487d0 &lt;deactivate_slab+112&gt;:       mov    <span class="variable">$0x1</span>,%esi</span><br><span class="line">0xffffffffb6f487d5 &lt;deactivate_slab+117&gt;:       xor    %ebx,%ebx</span><br><span class="line">0xffffffffb6f487d7 &lt;deactivate_slab+119&gt;:       mov    %r10d,%r8d</span><br><span class="line">0xffffffffb6f487da &lt;deactivate_slab+122&gt;:       sar    <span class="variable">$0x6</span>,%rdi</span><br><span class="line">0xffffffffb6f487de &lt;deactivate_slab+126&gt;:       and    <span class="variable">$0x400</span>,%r10d</span><br><span class="line">0xffffffffb6f487e5 &lt;deactivate_slab+133&gt;:       shr    <span class="variable">$0x8</span>,%r8d</span><br><span class="line">0xffffffffb6f487e9 &lt;deactivate_slab+137&gt;:       shl    <span class="variable">$0xc</span>,%rdi</span><br><span class="line">0xffffffffb6f487ed &lt;deactivate_slab+141&gt;:       add    0x10ad5fc(%rip),%rdi        <span class="comment"># 0xffffffffb7ff5df0</span></span><br><span class="line">0xffffffffb6f487f4 &lt;deactivate_slab+148&gt;:       xor    <span class="variable">$0x1</span>,%r8d</span><br><span class="line">0xffffffffb6f487f8 &lt;deactivate_slab+152&gt;:       and    <span class="variable">$0x1</span>,%r8d</span><br><span class="line">0xffffffffb6f487fc &lt;deactivate_slab+156&gt;:       jmp    0xffffffffb6f48855 &lt;deactivate_slab+245&gt;</span><br><span class="line">0xffffffffb6f487fe &lt;deactivate_slab+158&gt;:       <span class="built_in">test</span>   %r8b,%r8b</span><br><span class="line">0xffffffffb6f48801 &lt;deactivate_slab+161&gt;:       jne    0xffffffffb6f48863 &lt;deactivate_slab+259&gt;</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 552</span><br><span class="line">0xffffffffb6f48803 &lt;deactivate_slab+163&gt;:       mov    %rcx,%rax</span><br><span class="line">0xffffffffb6f48806 &lt;deactivate_slab+166&gt;:       <span class="built_in">test</span>   %r10d,%r10d</span><br><span class="line">0xffffffffb6f48809 &lt;deactivate_slab+169&gt;:       je     0xffffffffb6f48812 &lt;deactivate_slab+178&gt;</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 504</span><br><span class="line">0xffffffffb6f4880b &lt;deactivate_slab+171&gt;:       mov    0x58(%r14),%edx</span><br><span class="line">0xffffffffb6f4880f &lt;deactivate_slab+175&gt;:       sub    %rdx,%rax</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 553</span><br><span class="line">0xffffffffb6f48812 &lt;deactivate_slab+178&gt;:       cmp    %rax,%rdi</span><br><span class="line">0xffffffffb6f48815 &lt;deactivate_slab+181&gt;:       ja     0xffffffffb7665ed8 &lt;deactivate_slab.cold&gt;</span><br><span class="line">0xffffffffb6f4881b &lt;deactivate_slab+187&gt;:       movzwl 0x2a(%r12),%edx </span><br><span class="line">0xffffffffb6f48821 &lt;deactivate_slab+193&gt;:       mov    0x18(%r14),%r11d</span><br><span class="line">0xffffffffb6f48825 &lt;deactivate_slab+197&gt;:       and    <span class="variable">$0x7fff</span>,%edx</span><br><span class="line">0xffffffffb6f4882b &lt;deactivate_slab+203&gt;:       imul   %r11d,%edx</span><br><span class="line">0xffffffffb6f4882f &lt;deactivate_slab+207&gt;:       add    %rdi,%rdx</span><br><span class="line">0xffffffffb6f48832 &lt;deactivate_slab+210&gt;:       cmp    %rdx,%rax</span><br><span class="line">0xffffffffb6f48835 &lt;deactivate_slab+213&gt;:       jae    0xffffffffb7665ed8 &lt;deactivate_slab.cold&gt;</span><br><span class="line">0xffffffffb6f4883b &lt;deactivate_slab+219&gt;:       sub    %rdi,%rax</span><br><span class="line">0xffffffffb6f4883e &lt;deactivate_slab+222&gt;:       cqto   </span><br><span class="line">0xffffffffb6f48840 &lt;deactivate_slab+224&gt;:       idiv   %r11</span><br><span class="line">0xffffffffb6f48843 &lt;deactivate_slab+227&gt;:       <span class="built_in">test</span>   %rdx,%rdx</span><br><span class="line">0xffffffffb6f48846 &lt;deactivate_slab+230&gt;:       jne    0xffffffffb7665ed8 &lt;deactivate_slab.cold&gt;</span><br><span class="line">0xffffffffb6f4884c &lt;deactivate_slab+236&gt;:       mov    %r13,%rbx</span><br><span class="line">0xffffffffb6f4884f &lt;deactivate_slab+239&gt;:       add    <span class="variable">$0x1</span>,%esi</span><br><span class="line">0xffffffffb6f48852 &lt;deactivate_slab+242&gt;:       mov    %rcx,%r13</span><br><span class="line">0xffffffffb6f48855 &lt;deactivate_slab+245&gt;:       mov    0x0(%r13,%r9,1),%rcx</span><br><span class="line">0xffffffffb6f4885a &lt;deactivate_slab+250&gt;:       lea    -0x1(%rsi),%r15d</span><br><span class="line"></span><br><span class="line">crash&gt; dis -l deactivate_slab+250</span><br><span class="line">/usr/src/debug/kernel-5.10.0-136.34.0.110.oe2203sp1.x86_64/linux-5.10.0-136.34.0.110.oe2203sp1.x86_64/mm/slub.c: 553</span><br><span class="line">0xffffffffb6f4885a &lt;deactivate_slab+250&gt;:       lea    -0x1(%rsi),%r15d</span><br><span class="line"></span><br><span class="line">/* Verify that a pointer has an address that is valid within a slab page */</span><br><span class="line">static inline int check_valid_pointer(struct kmem_cache *s,</span><br><span class="line">                                struct page *page, void *object)</span><br><span class="line">&#123;</span><br><span class="line">        void *base;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!object)</span><br><span class="line">                <span class="built_in">return</span> 1;</span><br><span class="line"></span><br><span class="line">        base = page_address(page);</span><br><span class="line">        object = kasan_reset_tag(object);</span><br><span class="line">        object = restore_red_left(s, object);</span><br><span class="line">        <span class="keyword">if</span> (object &lt; base || object &gt;= base + page-&gt;objects * s-&gt;size ||         &lt;-------mm/slub.c: 553</span><br><span class="line">                (object - base) % s-&gt;size) &#123;</span><br><span class="line">                <span class="built_in">return</span> 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0xffffffffb6f4881b &lt;deactivate_slab+187&gt;:       movzwl 0x2a(%r12),%edx</span><br><span class="line">0xffffffffb6f48821 &lt;deactivate_slab+193&gt;:       mov    0x18(%r14),%r11d</span><br><span class="line"></span><br><span class="line">crash&gt; struct -ox page | grep 2a</span><br><span class="line">  [0x2a]                 unsigned int objects : 15;</span><br><span class="line">crash&gt; struct -ox kmem_cache | grep 0x18</span><br><span class="line">    [0x18] unsigned int size;</span><br><span class="line"></span><br><span class="line"><span class="comment">#it means r12 store the address of the struct page</span></span><br><span class="line"><span class="comment">#and r14 store the address of the struct kmem_cache</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#9 [fffffe7dd9f33ef0] end_repeat_nmi at ffffffffb7801508</span></span><br><span class="line">    [exception RIP: deactivate_slab+250]</span><br><span class="line">    RIP: ffffffffb6f4885a  RSP: ffffaa64d9d77aa0  RFLAGS: 00000082</span><br><span class="line">    RAX: 000000000000000f  RBX: ffff8eadd1aa5fc0  RCX: ffff8eadd1aa5840</span><br><span class="line">    RDX: ffff8eadd1aa5c40  RSI: 000000008678fce3  RDI: ffff8eadd1aa5000</span><br><span class="line">    RBP: ffffaa64d9d77b70   R8: 0000000000000001   R9: 0000000000000020</span><br><span class="line">    R10: 0000000000000000  R11: 000000000003b7d0  R12: fffffb226046a940</span><br><span class="line">    R13: ffff8eadd1aa51c0  R14: ffff8e76c0044640  R15: 000000008678fce2</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018</span><br><span class="line">--- &lt;NMI exception stack&gt; ---</span><br><span class="line"><span class="comment">#10 [ffffaa64d9d77aa0] deactivate_slab at ffffffffb6f4885a</span></span><br><span class="line"></span><br><span class="line">crash&gt; struct kmem_cache.size ffff8e76c0044640</span><br><span class="line">  size = 64</span><br><span class="line">crash&gt; struct page.objects fffffb226046a940</span><br><span class="line">          objects = 64</span><br><span class="line"></span><br><span class="line">crash&gt; kmem -S ffff8e76c0044640</span><br><span class="line">CACHE             OBJSIZE  ALLOCATED     TOTAL  SLABS  SSIZE  NAME</span><br><span class="line">kmem: kmalloc-64: slab: fffffb226046a940 duplicate freelist object: ffff8eadd1aa5c40   &lt;---- duplicate freelist object</span><br><span class="line">ffff8e76c0044640       64  1077222738  1077225600  16831650     4k  kmalloc-64</span><br><span class="line">CPU 0 KMEM_CACHE_CPU:</span><br><span class="line">  ffff8e7deee3a0a0</span><br><span class="line">CPU 0 SLAB:</span><br><span class="line">  SLAB              MEMORY            NODE  TOTAL  ALLOCATED  FREE</span><br><span class="line">  fffffb2254be8580  ffff8eaaefa16000     6     64         28    36</span><br><span class="line">  FREE / [ALLOCATED]</span><br><span class="line">   ffff8eaaefa16000  (cpu 0 cache)</span><br><span class="line">  [ffff8eaaefa16040]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="user-space-test-code"><a href="#user-space-test-code" class="headerlink" title="[user space test code]"></a>[user space test code]</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">    p = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="number">1</span>*<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; first free\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; first free done\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; second free\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; second free done\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="kprobe-test-code"><a href="#kprobe-test-code" class="headerlink" title="kprobe test code"></a><a target="_blank" rel="noopener" href="https://adtxl.com/index.php/archives/160.html">kprobe test code</a></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">$ cat slub_double_free.c</span><br><span class="line"><span class="comment">// slub_double_free.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *buf;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">create_slub_error</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    buf = kmalloc(<span class="number">32</span>, GFP_KERNEL);</span><br><span class="line">    <span class="keyword">if</span> (buf) &#123;</span><br><span class="line">        <span class="comment">// double free</span></span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0x55</span>, <span class="number">32</span>);</span><br><span class="line">        kfree(buf);</span><br><span class="line">        printk(<span class="string">&quot;figo: double free test\n&quot;</span>);</span><br><span class="line">        kfree(buf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">my_test2_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;figo: my module init \n&quot;</span>);</span><br><span class="line">    create_slub_error();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">my_test2_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;goodbye \n&quot;</span>);</span><br><span class="line">    kfree(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">module_init(my_test2_init);</span><br><span class="line">module_exit(my_test2_exit);</span><br><span class="line">   </span><br><span class="line">$ cat slub_out_bounds.c</span><br><span class="line"><span class="comment">// slub_out_bounds.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *buf;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">create_slub_error</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    buf = kmalloc(<span class="number">32</span>, GFP_KERNEL);</span><br><span class="line">    <span class="keyword">if</span> (buf) &#123;</span><br><span class="line">        <span class="comment">// out-of-bounds</span></span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0x55</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">my_test1_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;figo: my module init \n&quot;</span>);</span><br><span class="line">    create_slub_error();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">my_test1_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;goodbye \n&quot;</span>);</span><br><span class="line">    kfree(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">module_init(my_test1_init);</span><br><span class="line">module_exit(my_test1_exit);</span><br><span class="line"></span><br><span class="line">$ cat slub_use_after_free.c</span><br><span class="line"><span class="comment">// slub_use_after_free.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *buf;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">create_slub_error</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    buf = kmalloc(<span class="number">32</span>, GFP_KERNEL);</span><br><span class="line">    <span class="keyword">if</span> (buf) &#123;</span><br><span class="line">        <span class="comment">// use after free</span></span><br><span class="line">        kfree(buf);</span><br><span class="line">        printk(<span class="string">&quot;figo:access free memory \n&quot;</span>);</span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0x55</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">my_test3_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;figo: my module init \n&quot;</span>);</span><br><span class="line">    create_slub_error();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">my_test3_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;goodbye \n&quot;</span>);</span><br><span class="line">    kfree(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">module_init(my_test3_init);</span><br><span class="line">module_exit(my_test3_exit);</span><br><span class="line"></span><br><span class="line">$ cat Makefile </span><br><span class="line">obj-m += slub_out_bounds.o slab_double_free.o slub_use_after_free.o</span><br><span class="line">KDIR := /usr/src/kernels/$(shell uname -r)</span><br><span class="line">all:</span><br><span class="line">	make -C $(KDIR) M=$(PWD) modules </span><br><span class="line">clean:</span><br><span class="line">	rm -f *.ko *.o *.mod.o *.mod.c .*.cmd *.symvers  modul*</span><br><span class="line"></span><br><span class="line">$ make clean</span><br><span class="line">rm -f *.ko *.o *.mod.o *.mod.c .*.cmd *.symvers  modul*</span><br><span class="line"></span><br><span class="line">$ make </span><br><span class="line">make -C /usr/src/kernels/<span class="number">4.18</span><span class="number">.0</span><span class="number">-425.13</span><span class="number">.1</span>.el8_7.x86_64 M=/root/slub_test modules </span><br><span class="line">make[<span class="number">1</span>]: Entering directory <span class="string">&#x27;/usr/src/kernels/4.18.0-425.13.1.el8_7.x86_64&#x27;</span></span><br><span class="line">  CC [M]  /root/slub_test/slub_out_bounds.o</span><br><span class="line">  CC [M]  /root/slub_test/slab_double_free.o</span><br><span class="line">  CC [M]  /root/slub_test/slub_use_after_free.o</span><br><span class="line">  Building modules, stage <span class="number">2.</span></span><br><span class="line">  MODPOST <span class="number">3</span> modules</span><br><span class="line">  CC      /root/slub_test/slab_double_free.mod.o</span><br><span class="line">  LD [M]  /root/slub_test/slab_double_free.ko</span><br><span class="line">  CC      /root/slub_test/slub_out_bounds.mod.o</span><br><span class="line">  LD [M]  /root/slub_test/slub_out_bounds.ko</span><br><span class="line">  CC      /root/slub_test/slub_use_after_free.mod.o</span><br><span class="line">  LD [M]  /root/slub_test/slub_use_after_free.ko</span><br><span class="line">make[<span class="number">1</span>]: Leaving directory <span class="string">&#x27;/usr/src/kernels/4.18.0-425.13.1.el8_7.x86_64&#x27;</span></span><br><span class="line"></span><br><span class="line">$ ls -l</span><br><span class="line">total <span class="number">1484</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">215</span> Jun  <span class="number">9</span> <span class="number">09</span>:<span class="number">24</span> Makefile</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">131</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> modules.order</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root      <span class="number">0</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> Module.symvers</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">665</span> Jun  <span class="number">8</span> <span class="number">14</span>:<span class="number">06</span> slab_double_free.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">241960</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slab_double_free.ko</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">968</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slab_double_free.mod.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">119272</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slab_double_free.mod.o</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">124240</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slab_double_free.o</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">598</span> Jun  <span class="number">8</span> <span class="number">14</span>:<span class="number">04</span> slub_out_bounds.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">241784</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_out_bounds.ko</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">968</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_out_bounds.mod.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">119272</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_out_bounds.mod.o</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">124040</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_out_bounds.o</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">652</span> Jun  <span class="number">8</span> <span class="number">14</span>:<span class="number">07</span> slub_use_after_free.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">241880</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_use_after_free.ko</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">968</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_use_after_free.mod.c</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">119280</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_use_after_free.mod.o</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">124120</span> Jun  <span class="number">9</span> <span class="number">15</span>:<span class="number">48</span> slub_use_after_free.o</span><br><span class="line"></span><br><span class="line">$ insmod slab_double_free.ko</span><br></pre></td></tr></table></figure>

<h3 id="Assemble"><a href="#Assemble" class="headerlink" title="Assemble"></a><a target="_blank" rel="noopener" href="https://cxd2014.github.io/2019/12/12/objdump/">Assemble</a></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -Sd main &gt; txt.txt</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Add</span><span class="params">(<span class="type">int</span> *<span class="built_in">array</span>, <span class="type">int</span> n)</span>&#123;</span><br><span class="line">  <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; n; ++i) t += <span class="built_in">array</span>[i];</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> num = <span class="number">10</span>;</span><br><span class="line">  <span class="type">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">  <span class="type">int</span> sum = Add(a, <span class="number">5</span>);</span><br><span class="line">  sum = sum + num;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000400710</span> &lt;_Z3AddPii&gt;:</span><br><span class="line"></span><br><span class="line">  <span class="number">400710</span>: 	push   %rbp             <span class="comment">// 将 rbp 的值压入栈中，保存上一个栈帧地址</span></span><br><span class="line">  <span class="number">400711</span>: 	mov    %rsp,%rbp        <span class="comment">// 将 rbp 赋值为 rsp，设置main函数的栈帧基址</span></span><br><span class="line">  <span class="number">400714</span>: 	mov    %rdi,<span class="number">-0x18</span>(%rbp) <span class="comment">// 将两个参数放到栈上</span></span><br><span class="line">  <span class="number">400718</span>: 	mov    %esi,<span class="number">-0x1c</span>(%rbp)</span><br><span class="line">  <span class="number">40071b</span>: 	movl   $<span class="number">0x0</span>,<span class="number">-0x4</span>(%rbp)  <span class="comment">// 在栈上初始化变量 t 为 0</span></span><br><span class="line">  <span class="number">400722</span>: 	movl   $<span class="number">0x0</span>,<span class="number">-0x8</span>(%rbp)         <span class="comment">// 在栈上初始化变量 i 为 0</span></span><br><span class="line">  <span class="number">400729</span>: 	jmp    <span class="number">400748</span> &lt;_Z3AddPii+<span class="number">0x38</span>&gt; <span class="comment">// 跳转到地址 400748 处</span></span><br><span class="line">  <span class="number">40072b</span>: 	mov    <span class="number">-0x8</span>(%rbp),%eax         <span class="comment">// 将变量 i 放到 eax 中</span></span><br><span class="line">  <span class="number">40072</span>e: 	cltq   </span><br><span class="line">  <span class="number">400730</span>: 	lea    <span class="number">0x0</span>(,%rax,<span class="number">4</span>),%rdx       <span class="comment">// rdx = rax * 4，因为 eax 是 rax 的低32位，eax的值是变量 i，所以这里 rdx = i * 4</span></span><br><span class="line">  <span class="number">400737</span>:</span><br><span class="line">  <span class="number">400738</span>: 	mov    <span class="number">-0x18</span>(%rbp),%rax         <span class="comment">// 将第一个参数数组 array 的地址放到 rax</span></span><br><span class="line">  <span class="number">40073</span>c: 	add    %rdx,%rax                <span class="comment">// 加上地址偏移 rdx</span></span><br><span class="line">  <span class="number">40073f</span>: 	mov    (%rax),%eax              <span class="comment">// 将 rax 中的地址所指向的值放到 eax 中，取数组中的元素</span></span><br><span class="line">  <span class="number">400741</span>: 	add    %eax,<span class="number">-0x4</span>(%rbp)          <span class="comment">// 将变量 t 加上 eax 中的值并放在 t 上</span></span><br><span class="line">  <span class="number">400744</span>: 	addl   $<span class="number">0x1</span>,<span class="number">-0x8</span>(%rbp)          <span class="comment">// 将变量 i 加 1 </span></span><br><span class="line">  <span class="number">400748</span>: 	mov    <span class="number">-0x8</span>(%rbp),%eax          <span class="comment">// 将变量 i 放到 eax 中</span></span><br><span class="line">  <span class="number">40074b</span>: 	cmp    <span class="number">-0x1c</span>(%rbp),%eax         <span class="comment">// 比较变量 i 和传递进来的第二个参数 5 </span></span><br><span class="line">  <span class="number">40074</span>e: 	jl     <span class="number">40072b</span> &lt;_Z3AddPii+<span class="number">0x1b</span>&gt;  <span class="comment">// 如果小于，则跳转到地址 40072b 处</span></span><br><span class="line">  <span class="number">400750</span>: 	mov    <span class="number">-0x4</span>(%rbp),%eax          <span class="comment">// 将返回值 t 放到 eax</span></span><br><span class="line">  <span class="number">400753</span>: 	pop    %rbp                     <span class="comment">// 从栈中弹出上一个栈帧的值到 rbp</span></span><br><span class="line">  <span class="number">400754</span>: 	retq                            <span class="comment">// 函数返回，retq指令会从栈中弹出返回地址到指令指针寄存器 rip 中</span></span><br><span class="line"></span><br><span class="line"><span class="number">0000000000400755</span> &lt;main&gt;:</span><br><span class="line"></span><br><span class="line">  <span class="number">400755</span>: 	push   %rbp             <span class="comment">// 将 rbp 的值压入栈中，保存上一个栈帧地址</span></span><br><span class="line">  <span class="number">400756</span>: 	mov    %rsp,%rbp        <span class="comment">// 将 rbp 赋值为 rsp，设置main函数的栈帧基址</span></span><br><span class="line">  <span class="number">400759</span>: 	sub    $<span class="number">0x20</span>,%rsp       <span class="comment">// 将 rsp 的值减去 0x20，使 rsp 下移到 rbp - 0x20 的位置，分配栈空间</span></span><br><span class="line">  <span class="number">40075</span>d: 	movl   $<span class="number">0x1</span>,<span class="number">-0x20</span>(%rbp) <span class="comment">// 将 1 存放到 rbp - 0x20 的位置</span></span><br><span class="line">  <span class="number">400764</span>: 	movl   $<span class="number">0x2</span>,<span class="number">-0x1c</span>(%rbp) <span class="comment">// 依次存放其他值</span></span><br><span class="line">  <span class="number">40076b</span>: 	movl   $<span class="number">0x3</span>,<span class="number">-0x18</span>(%rbp)</span><br><span class="line">  <span class="number">400772</span>: 	movl   $<span class="number">0x4</span>,<span class="number">-0x14</span>(%rbp)</span><br><span class="line">  <span class="number">400779</span>: 	movl   $<span class="number">0x5</span>,<span class="number">-0x10</span>(%rbp)</span><br><span class="line">  <span class="number">400780</span>: 	lea    <span class="number">-0x20</span>(%rbp),%rax   <span class="comment">// 将 rbp - 0x20 的地址存放到 rax ，也就是数组的首地址</span></span><br><span class="line">  <span class="number">400784</span>: 	mov    $<span class="number">0x5</span>,%esi          <span class="comment">// 将 0x5 放到 esi</span></span><br><span class="line">  <span class="number">400789</span>: 	mov    %rax,%rdi          <span class="comment">// 将 rax 中的值放到 rdi，两个传递参数准备就绪</span></span><br><span class="line">  <span class="number">40078</span>c: 	callq  <span class="number">400710</span> &lt;_Z3AddPii&gt; <span class="comment">// 调用 Add 函数，callq指令会先将返回地址（下一条指令执行的地址：400791）压入到栈中，然后跳转</span></span><br><span class="line">  <span class="number">400791</span>: 	mov    %eax,<span class="number">-0x4</span>(%rbp)    <span class="comment">// Add 函数返回后从这里继续执行，先将函数返回值放到栈中，相当于给变量 sum 赋值</span></span><br><span class="line">  <span class="number">400794</span>: 	mov    <span class="number">0x2008aa</span>(%rip),%eax        # <span class="number">601044</span> &lt;_ZZ4mainE3num&gt; <span class="comment">// 将静态变量 num 的值放到 eax</span></span><br><span class="line">  <span class="number">40079</span>a: 	add    %eax,<span class="number">-0x4</span>(%rbp)    <span class="comment">// 将 eax 和变量 sum 相加，并存放到 sum 中</span></span><br><span class="line">  <span class="number">40079</span>d: 	mov    <span class="number">-0x4</span>(%rbp),%eax    <span class="comment">// 将 sum 作为返回值放到 eax</span></span><br><span class="line">  <span class="number">4007</span>a0: 	leaveq                    <span class="comment">// 将 rsp 指向 rbp，然后弹出栈上保存的上一个栈帧的地址到 rbp </span></span><br><span class="line">  <span class="number">4007</span>a1: 	retq                      <span class="comment">// 函数返回，retq指令会从栈中弹出返回地址到指令指针寄存器 rip 中</span></span><br></pre></td></tr></table></figure>

<h3 id="c-assert"><a href="#c-assert" class="headerlink" title="c++ assert"></a><a target="_blank" rel="noopener" href="https://groups.google.com/g/pongba/c/rhudsPIaREI/m/OENMVTFqIA8J">c++ assert</a></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Float3 <span class="title function_">Normalize</span><span class="params">(Float3 r)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">float</span> length = r.x * r.x + r.y * r.y + r.z * r.z;</span><br><span class="line">   assert(length &gt; <span class="number">0</span>);</span><br><span class="line">   <span class="keyword">return</span> r / <span class="built_in">sqrt</span>(length);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">这个是fail tolerant版本</span><br><span class="line">Float3 <span class="title function_">Normalize</span><span class="params">(Float3 r)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">float</span> length = r.x * r.x + r.y * r.y + r.z * r.z;</span><br><span class="line">   <span class="keyword">if</span>(length == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> Float3(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">     <span class="keyword">return</span> r / <span class="built_in">sqrt</span>(length);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#crash"><span class="toc-number">1.</span> <span class="toc-text">crash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#memory"><span class="toc-number">1.1.</span> <span class="toc-text">memory</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#slub-debug"><span class="toc-number">1.1.1.</span> <span class="toc-text">slub debug</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#crash-sort-slab"><span class="toc-number">1.1.2.</span> <span class="toc-text">crash sort slab</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#user-space-test-code"><span class="toc-number">1.1.3.</span> <span class="toc-text">[user space test code]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kprobe-test-code"><span class="toc-number">1.1.4.</span> <span class="toc-text">kprobe test code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assemble"><span class="toc-number">2.</span> <span class="toc-text">Assemble</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-assert"><span class="toc-number">3.</span> <span class="toc-text">c++ assert</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/06/09/debug_tips/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/06/09/debug_tips/&text=debug tips"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/06/09/debug_tips/&is_video=false&description=debug tips"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=debug tips&body=Check out this article: http://example.com/2023/06/09/debug_tips/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/06/09/debug_tips/&title=debug tips"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/06/09/debug_tips/&name=debug tips&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/06/09/debug_tips/&t=debug tips"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
