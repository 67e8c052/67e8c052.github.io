<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="nvme features NVMe® Cross Namespace Copy Technology NVMe Cross Namespace Copy (CNC) functionality copies data across multiple storage volumes (i.e., NVMe namespaces), enabling more flexibility across">
<meta property="og:type" content="article">
<meta property="og:title" content="NVME">
<meta property="og:url" content="http://example.com/2022/11/13/nvme/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="nvme features NVMe® Cross Namespace Copy Technology NVMe Cross Namespace Copy (CNC) functionality copies data across multiple storage volumes (i.e., NVMe namespaces), enabling more flexibility across">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-13T13:38:29.000Z">
<meta property="article:modified_time" content="2023-12-20T06:11:07.773Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="nvme">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>NVME</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/11/13/scsi/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/13/cpu/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/13/nvme/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/13/nvme/&text=NVME"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/13/nvme/&is_video=false&description=NVME"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=NVME&body=Check out this article: http://example.com/2022/11/13/nvme/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/13/nvme/&name=NVME&description=&lt;h3 id=&#34;nvme-features&#34;&gt;&lt;a href=&#34;#nvme-features&#34; class=&#34;headerlink&#34; title=&#34;nvme features&#34;&gt;&lt;/a&gt;nvme features&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;NVMe® Cross Namespace Copy Technology&lt;ul&gt;
&lt;li&gt;NVMe Cross Namespace Copy (CNC) functionality copies data across multiple storage volumes (i.e., NVMe namespaces), enabling more flexibility across an entire SSD or storage system without resorting to host-based copy&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ nvme version&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme version 2.2.1 (git 2.2.1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;libnvme version 1.2 (git 1.2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;nvme-detach-and-attach-hotplugging&#34;&gt;&lt;a href=&#34;#nvme-detach-and-attach-hotplugging&#34; class=&#34;headerlink&#34; title=&#34;nvme detach and attach; hotplugging&#34;&gt;&lt;/a&gt;&lt;a href=&#34;https://community.intel.com/t5/Intel-NUCs/NVMe-Hotplugging/m-p/1261165&#34;&gt;nvme detach and attach; hotplugging&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://access.redhat.com/solutions/3998121&#34;&gt;grub setting&lt;/a&gt;   &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#HOT swapping with the NVMe devices&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#el7/el8/el9 hot swap NVME not auto discover in the AMD mainboard, add this parameters, it &amp;#x27;s worked for the hot swap nvme dev &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ grubby --update-kernel=ALL --args=&lt;span class=&#34;string&#34;&gt;&amp;#x27;pciehp.pciehp_debug=y pci=realloc=on pcie_ports=native&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$  nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt; /sys/class/nvme/nvme0/address&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;0000:41:00.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ lspci | grep 41:00.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41:00.0 Non-Volatile memory controller: DapuStor Corporation NVMe SSD Controller DP600&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt; /sys/bus/pci/devices/0000\:41\:00.0/remove&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---no output---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#if not hot plugout, it &amp;#x27;s ok, I plugout from server, it &amp;#x27;s not working&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt; /sys/bus/pci/rescan&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;single-port-or-worked-in-single-port&#34;&gt;&lt;a href=&#34;#single-port-or-worked-in-single-port&#34; class=&#34;headerlink&#34; title=&#34;single port or worked in single port&#34;&gt;&lt;/a&gt;single port or worked in single port&lt;/h4&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$  nvme id-ctrl /dev/nvme0n1 -H |grep cmic -A 4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cmic      : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [3:3] : 0	ANA not supported&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [2:2] : 0	PCI&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [1:1] : 0	Single Controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [0:0] : 0	Single Port&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ lspci -vvv -s 41:00.0 | grep gt -i&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCap:	Port &lt;span class=&#34;comment&#34;&gt;#0, Speed 16GT/s, Width x4, ASPM not supported&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkSta:	Speed 16GT/s (ok), Width x4 (ok)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCap2: Supported Link Speeds: 2.5-16GT/s, Crosslink+ Retimer+ 2Retimers+ DRS+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCtl2: Target Link Speed: 16GT/s, EnterCompliance- SpeedDis-&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	Capabilities: [198 v1] Physical Layer 16.0 GT/s &amp;lt;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;setting&#34;&gt;&lt;a href=&#34;#setting&#34; class=&#34;headerlink&#34; title=&#34;setting&#34;&gt;&lt;/a&gt;setting&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#the default is noop&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; nvme_device &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; /sys/block/nvme*; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; noop &amp;gt; &lt;span class=&#34;variable&#34;&gt;$nvme_device&lt;/span&gt;/queue/scheduler&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#not test, default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; nvme_device &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; /sys/block/nvme*; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 512 &amp;gt; &lt;span class=&#34;variable&#34;&gt;$nvme_device&lt;/span&gt;/queue/nr_requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;nvme-help&#34;&gt;&lt;a href=&#34;#nvme-help&#34; class=&#34;headerlink&#34; title=&#34;nvme help&#34;&gt;&lt;/a&gt;nvme help&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ nvme intel endurance-log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ERROR: Invalid sub-command &lt;span class=&#34;string&#34;&gt;&amp;#x27;endurance-log&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; plugin intel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-2.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;usage: nvme &amp;lt;&lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt;&amp;gt; [&amp;lt;device&amp;gt;] [&amp;lt;args&amp;gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;lt;device&amp;gt;&amp;#x27;&lt;/span&gt; may be either an NVMe character device (ex: /dev/nvme0), an&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme block device (ex: /dev/nvme0n1), or a mctp address &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; the form&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mctp:&amp;lt;net&amp;gt;,&amp;lt;eid&amp;gt;[:ctrl-id]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The following are all implemented sub-commands:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list                         List all NVMe devices and namespaces on machine&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-subsys                  List nvme subsystems&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ctrl                      Send NVMe Identify Controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns                        Send NVMe Identify Namespace, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns-granularity            Send NVMe Identify Namespace Granularity List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns-lba-format             Send NVMe Identify Namespace &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; the specified LBA Format index, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-ns                      Send NVMe Identify List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-ctrl                    Send NVMe Identify Controller List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvm-id-ctrl                  Send NVMe Identify Controller NVM Command Set, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvme-show-regs - Reads and shows the defined NVMe controller registers &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; NVMe over PCIe or the controller properties &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; NVMe over Fabrics.  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;See &lt;span class=&#34;string&#34;&gt;&amp;#x27;nvme help &amp;lt;command&amp;gt;&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; more information on a specific &lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The following are all installed plugin extensions:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ocp             OCP cloud SSD extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  zns             Zoned Namespace Command Set&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ymtc            Ymtc vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  wdc             Western Digital vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  virtium         Virtium vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  transcend       Transcend vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  toshiba         Toshiba NVME plugin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  solidigm        Solidigm vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  shannon         Shannon vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  seagate         Seagate vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sfx             ScaleFlux vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvidia          NVIDIA vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  netapp          NetApp vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  micron          Micron vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  memblaze        Memblaze vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  innogrit        innogrit vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  intel           Intel vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  huawei          Huawei vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  dera            Dera vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  dell            DELL vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  amzn            Amazon vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list-subsys&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys0 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ134102RX4P0VGN  INTEL SSDPE2KX040T8                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme0 pcie 0000:41:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys1 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ135402294P0VGN  INTEL SSDPE2KX040T8                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme1 pcie 0000:43:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys2 - NQN=nqn.2014.08.org.nvmexpress:144d144dS481NC0R916614      SAMSUNG MZQLB3T8HALS-00003              &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme2 pcie 0000:45:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys3 - NQN=nqn.2021-02.com.siliconmotion:1cb01cb0SX23725P8070265     SHANNON P8G6400&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme3 pcie 0000:47:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys4 - NQN=nqn.2014-08.org.nvmexpress:5f54e23544580edb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme4 rdma traddr=10.53.129.69 trsvcid=4421 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme5 rdma traddr=10.53.129.68 trsvcid=4421 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#enable multipath&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$cat&lt;/span&gt; /etc/modprobe.d/nvme_core.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;options nvme_core multipath=Y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;###set to local kernel, or you could not set it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cp&lt;/span&gt; /boot/initramfs-$(&lt;span class=&#34;built_in&#34;&gt;uname&lt;/span&gt; -r).img /boot/initramfs-$(&lt;span class=&#34;built_in&#34;&gt;uname&lt;/span&gt; -r).bak.$(&lt;span class=&#34;built_in&#34;&gt;date&lt;/span&gt; +%m-%d-%H%M%S).img&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dracut --force --verbose&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ the_controller_id=4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;round-robin&amp;quot;&lt;/span&gt; &amp;gt; /sys/class/nvme-subsystem/nvme-subsys&lt;span class=&#34;variable&#34;&gt;$&amp;#123;the_controller_id&amp;#125;&lt;/span&gt;/iopolicy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;NVME-SSD-device-info&#34;&gt;&lt;a href=&#34;#NVME-SSD-device-info&#34; class=&#34;headerlink&#34; title=&#34;NVME SSD device info&#34;&gt;&lt;/a&gt;NVME SSD device info&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;NAND P&amp;#x2F;E Cycles &amp;#x3D; amount of program &amp;#x2F; erase cycles NAND can do before wearing out&lt;br&gt;  - WAF &amp;#x3D; NAND writes &amp;#x2F; host writes&lt;/li&gt;
&lt;li&gt;TBW or PBW – amount of host writes to SSD before wearing out&lt;br&gt;  - TBW &amp;#x3D; drive capacity * cycles &amp;#x2F; WAF&lt;/li&gt;
&lt;li&gt;DWPD (drive writes per day): amount of data you can write to device each day of the warranty (typically 5 years) without wearing out&lt;br&gt;  - DWPD &amp;#x3D; TBW&amp;#x2F;365&amp;#x2F;5&amp;#x2F;drive capacity&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Create partition smaller than total user capacity of SSD&lt;/li&gt;
&lt;li&gt;Limit max LBA of drive through vendor specific tools&lt;/li&gt;
&lt;li&gt;Create a namespace smaller than total user capacity&lt;/li&gt;
&lt;li&gt;Limit application use to smaller LBA range&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;https://events.static.linuxfound.org/sites/events/files/slides/lemoal-nvme-polling-vault-2017-final_0.pdf&#34;&gt;nvme hybird polling&lt;/a&gt;&lt;br&gt;I&amp;#x2F;O models&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;IRQ vs polling&lt;br&gt;  - NVM is coming ! Is this relevant ?&lt;br&gt;  - Linux implementation&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Block Layer and NVMe driver&lt;br&gt;  - Evaluation Results&lt;br&gt;  - Classic polling vs Hybrid polling&lt;br&gt;  - Impact of process scheduling&lt;br&gt;  - Comparison with user level drivers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Implemented by blk_mq_poll&lt;br&gt;  - block-mq enabled devices only&lt;br&gt;  - Device queue flagged with “poll enabled”&lt;br&gt;          - Can be controlled through sysfs&lt;br&gt;          - Enabled by default for devices supporting it, e.g. NVMe&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# To enable it, you echo 1 to /sys/block/&amp;lt;dev&amp;gt;/queue/io_poll.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt;  /sys/block/nvme0n1/queue/io_poll&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt;  /sys/block/nvme0n1/queue/io_poll&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Polling is tried for any block I&amp;#x2F;O belonging to a high-priority I&amp;#x2F;O context (IOCB_HIPRI)&lt;/li&gt;
&lt;li&gt;IRQs are NOT disabled&lt;br&gt;  - ISR is still executed as the device signals completions&lt;br&gt;  - But ISR sees a completion slot already processed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;6us average latency with IRQ, 4.5us with polling&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;25% lower latency with polling&lt;/li&gt;
&lt;li&gt;166 KIOPS vs 222 KIOPS&lt;/li&gt;
&lt;li&gt;&lt;code&gt;But 100% load on the polling CPU&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Only 32% CPU load with IRQ model&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adaptive hybrid polling gives the same average latency of 4.5us as classic polling&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;But with only 58% CPU load&lt;/li&gt;
&lt;li&gt;32% with IRQ model&lt;/li&gt;
&lt;li&gt;Fixed time polling allows controlling the CPU vs latency trade-off&lt;/li&gt;
&lt;li&gt;IRQ like average latency and CPU load for high polling delay&lt;/li&gt;
&lt;li&gt;Better use the IRQ model&lt;/li&gt;
&lt;li&gt;Lower CPU loads with a small average latency degradation achieved with intermediate polling delay&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;If I use NVME, if you have the top CPU, you could enable the polling, if not , irq is the better choice&lt;/code&gt;&lt;br&gt;dm-stripe&amp;#x2F;dm-linear support I&amp;#x2F;O polling&lt;br&gt;&lt;a href=&#34;https://developer.aliyun.com/article/783641&#34;&gt;Compare with blktrace d2c%&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt; /sys/block/nvme0n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# -1 class polling (default)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 0 means adaptive hybird polling&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 &amp;gt; /sys/block/nvme0n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;|&amp;lt;------------------------Application&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Perecived&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;I/O&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;latency---------------------------------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;IRQ&lt;/span&gt;      &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt;             &lt;span class=&#34;string&#34;&gt;sleep&lt;/span&gt;            &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                                            &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;(wake)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                               &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ISR&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;-------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                               &lt;span class=&#34;string&#34;&gt;|(IRQ)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                    &lt;span class=&#34;string&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;execution-----------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Polling&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;    &lt;span class=&#34;string&#34;&gt;Are&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;you&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;?&lt;/span&gt;    &lt;span class=&#34;string&#34;&gt;BIO_stack&amp;lt;-------Gain-------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                 &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;                                           command execution&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Hybrid&lt;/span&gt;   &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;sleep&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cs&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;done?&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&amp;lt;-------Gain-------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                     &lt;span class=&#34;string&#34;&gt;|(wake)|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                      &lt;span class=&#34;string&#34;&gt;Timer&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IRQ&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;--&amp;gt;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ISR&lt;/span&gt;     &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                     &lt;span class=&#34;string&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;execution&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;If you need the high throughput, should be disable poll&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;### BIOS setting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PCIe Maximum Payload &lt;span class=&#34;built_in&#34;&gt;set&lt;/span&gt; to 256b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PCIe Maximum Read Request &lt;span class=&#34;built_in&#34;&gt;set&lt;/span&gt; to 4096b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ tuned-adm profile througput-performance&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- Throughput&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - Scheduler quantum (default 4/10 ms,-&amp;gt; 10/15 ms)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel.sched_min_granularity_ns=10000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel_sched_wakeup _granularity_ns = 15000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - Weight &lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; on how often to migrate - 5ms -&amp;gt; 50ms&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel.sched_migration_cost_ns=50000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ modprobe -r nvme &amp;amp;&amp;amp; modprobe nvme poll_queues=36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 | &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /sys/block/nvme*n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 | &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /sys/block/nvme*n1/queue/iostats&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;nvme-interface-nvme-port&#34;&gt;&lt;a href=&#34;#nvme-interface-nvme-port&#34; class=&#34;headerlink&#34; title=&#34;nvme interface&amp;#x2F;nvme port&#34;&gt;&lt;/a&gt;&lt;a href=&#34;https://www.snia.org/forums/cmsi/knowledge/formfactors&#34;&gt;nvme interface&amp;#x2F;nvme port&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;EDSFF  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;E1.L 9.5mm&lt;ul&gt;
&lt;li&gt;w up to 25W - 38.4mm, l 318.75mm, Thickness 9.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.L 18mm&lt;ul&gt;
&lt;li&gt;w up to 40W - 38.4mm, l 318.75mm, Thickness 18mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S&lt;ul&gt;
&lt;li&gt;E1.S 5.9mm&lt;ul&gt;
&lt;li&gt;w 31.5mm, l 111.49mm,Thickness 5.9mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S 8mm heat spreader&lt;ul&gt;
&lt;li&gt;w 31.5mm. l 111.49mm, Thickness 8.01mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Symmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 9.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Asymmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 15mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Asymmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 25mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;EDSFF E3.S and E3.L, 2U 40+ E3.S&amp;#x2F;L dev&lt;ul&gt;
&lt;li&gt;E3.S&lt;ul&gt;
&lt;li&gt;h 76mm, l 112.75mm, w 7.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.S 2T&lt;ul&gt;
&lt;li&gt;h 76mm, l 112.75mm, w 16.8mm, up to 40w (pcie g5x4)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.L&lt;ul&gt;
&lt;li&gt;h 76mm, l 142.2mm, w 7.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.L 2T&lt;ul&gt;
&lt;li&gt;h 76mm, l 142.2mm, w 16.8mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;M.2&lt;ul&gt;
&lt;li&gt;16.15 x 20.15 x 1.3  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 30.15 x 2.23  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 80.15 x 2.23  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 110.15 x 3.88  W x L x H&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;U.2&lt;ul&gt;
&lt;li&gt;7mm&lt;ul&gt;
&lt;li&gt;69.85 x 100 x 7 W x L x H&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;15mm&lt;ul&gt;
&lt;li&gt;69.85 x 100 x 15&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;AIC&lt;ul&gt;
&lt;li&gt;Full Height&lt;ul&gt;
&lt;li&gt;6.6 in&amp;#x2F;167 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Half Height&lt;ul&gt;
&lt;li&gt;4.3 in&amp;#x2F; 111 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Low Profile&lt;ul&gt;
&lt;li&gt;2.5 in&amp;#x2F;64 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Full Length&lt;ul&gt;
&lt;li&gt;12.2 in&amp;#x2F;312 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Half Length&lt;ul&gt;
&lt;li&gt;6.6 in&amp;#x2F;167 mm"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/13/nvme/&t=NVME"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-features"><span class="toc-number">1.</span> <span class="toc-text">nvme features</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-detach-and-attach-hotplugging"><span class="toc-number">2.</span> <span class="toc-text">nvme detach and attach; hotplugging</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#single-port-or-worked-in-single-port"><span class="toc-number">2.1.</span> <span class="toc-text">single port or worked in single port</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setting"><span class="toc-number">3.</span> <span class="toc-text">setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-help"><span class="toc-number">4.</span> <span class="toc-text">nvme help</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVME-SSD-device-info"><span class="toc-number">5.</span> <span class="toc-text">NVME SSD device info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-interface-nvme-port"><span class="toc-number">6.</span> <span class="toc-text">nvme interface&#x2F;nvme port</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#why-EBOF"><span class="toc-number">6.1.</span> <span class="toc-text">why EBOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVME-persist-reservation"><span class="toc-number">6.2.</span> <span class="toc-text">NVME persist reservation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVME-PI"><span class="toc-number">6.3.</span> <span class="toc-text">NVME PI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#show-err-count"><span class="toc-number">6.4.</span> <span class="toc-text">show err count</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-the-nvme-device"><span class="toc-number">6.5.</span> <span class="toc-text">delete the nvme device</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isdct-show-all-info"><span class="toc-number">6.6.</span> <span class="toc-text">isdct show all info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-write-cache"><span class="toc-number">6.7.</span> <span class="toc-text">Enable write cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trim-feature"><span class="toc-number">6.8.</span> <span class="toc-text">Trim feature</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Intel-ssd-secure-erase"><span class="toc-number">6.9.</span> <span class="toc-text">Intel ssd secure erase</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-optimization"><span class="toc-number">6.10.</span> <span class="toc-text">Software optimization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create-mdraid-for-nvme-ssd"><span class="toc-number">6.11.</span> <span class="toc-text">create mdraid for nvme ssd</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVME-power-save-cause-controller-reset"><span class="toc-number">7.</span> <span class="toc-text">NVME power save cause controller reset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Read-data-from-the-device"><span class="toc-number">8.</span> <span class="toc-text">Read data from the device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#connect-and-disconnect"><span class="toc-number">9.</span> <span class="toc-text">connect and disconnect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-and-write"><span class="toc-number">10.</span> <span class="toc-text">read and write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#self-test"><span class="toc-number">11.</span> <span class="toc-text">self test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-firmware"><span class="toc-number">12.</span> <span class="toc-text">upgrade firmware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detach-namespaces"><span class="toc-number">13.</span> <span class="toc-text">detach namespaces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#power-off-power-on-the-nvme-ctrl-in-the-linux-nvme-driver"><span class="toc-number">14.</span> <span class="toc-text">power off &#x2F; power on the nvme ctrl in the linux nvme driver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-over-fabrics"><span class="toc-number">15.</span> <span class="toc-text">nvme over fabrics</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#why"><span class="toc-number">15.1.</span> <span class="toc-text">why</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#topic"><span class="toc-number">16.</span> <span class="toc-text">topic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#local-nvme-is-ok"><span class="toc-number">16.1.</span> <span class="toc-text">local nvme is ok</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spdk-show-the-osq-lock"><span class="toc-number">16.2.</span> <span class="toc-text">spdk show the osq_lock</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        NVME
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-13T13:38:29.000Z" itemprop="datePublished">2022-11-13</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/nvme/">nvme</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/nvme/" rel="tag">nvme</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="nvme-features"><a href="#nvme-features" class="headerlink" title="nvme features"></a>nvme features</h3><ul>
<li>NVMe® Cross Namespace Copy Technology<ul>
<li>NVMe Cross Namespace Copy (CNC) functionality copies data across multiple storage volumes (i.e., NVMe namespaces), enabling more flexibility across an entire SSD or storage system without resorting to host-based copy<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nvme version</span><br><span class="line">nvme version 2.2.1 (git 2.2.1)</span><br><span class="line">libnvme version 1.2 (git 1.2)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="nvme-detach-and-attach-hotplugging"><a href="#nvme-detach-and-attach-hotplugging" class="headerlink" title="nvme detach and attach; hotplugging"></a><a target="_blank" rel="noopener" href="https://community.intel.com/t5/Intel-NUCs/NVMe-Hotplugging/m-p/1261165">nvme detach and attach; hotplugging</a></h3><p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/3998121">grub setting</a>   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HOT swapping with the NVMe devices</span></span><br><span class="line"><span class="comment">#el7/el8/el9 hot swap NVME not auto discover in the AMD mainboard, add this parameters, it &#x27;s worked for the hot swap nvme dev </span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;pciehp.pciehp_debug=y pci=realloc=on pcie_ports=native&#x27;</span></span><br><span class="line"></span><br><span class="line">$  nvme list</span><br><span class="line">Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  </span><br><span class="line">--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /sys/class/nvme/nvme0/address</span><br><span class="line">0000:41:00.0</span><br><span class="line"></span><br><span class="line">$ lspci | grep 41:00.0</span><br><span class="line">41:00.0 Non-Volatile memory controller: DapuStor Corporation NVMe SSD Controller DP600</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/devices/0000\:41\:00.0/remove</span><br><span class="line"></span><br><span class="line">$ nvme list</span><br><span class="line">---no output---</span><br><span class="line"></span><br><span class="line"><span class="comment">#if not hot plugout, it &#x27;s ok, I plugout from server, it &#x27;s not working</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/rescan</span><br><span class="line">$ nvme list</span><br><span class="line">Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  </span><br><span class="line">--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100</span><br></pre></td></tr></table></figure>

<h4 id="single-port-or-worked-in-single-port"><a href="#single-port-or-worked-in-single-port" class="headerlink" title="single port or worked in single port"></a>single port or worked in single port</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$  nvme id-ctrl /dev/nvme0n1 -H |grep cmic -A 4</span><br><span class="line">cmic      : 0</span><br><span class="line">  [3:3] : 0	ANA not supported</span><br><span class="line">  [2:2] : 0	PCI</span><br><span class="line">  [1:1] : 0	Single Controller</span><br><span class="line">  [0:0] : 0	Single Port</span><br><span class="line"></span><br><span class="line">$ lspci -vvv -s 41:00.0 | grep gt -i</span><br><span class="line">		LnkCap:	Port <span class="comment">#0, Speed 16GT/s, Width x4, ASPM not supported</span></span><br><span class="line">		LnkSta:	Speed 16GT/s (ok), Width x4 (ok)</span><br><span class="line">		LnkCap2: Supported Link Speeds: 2.5-16GT/s, Crosslink+ Retimer+ 2Retimers+ DRS+</span><br><span class="line">		LnkCtl2: Target Link Speed: 16GT/s, EnterCompliance- SpeedDis-</span><br><span class="line">	Capabilities: [198 v1] Physical Layer 16.0 GT/s &lt;?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="setting"><a href="#setting" class="headerlink" title="setting"></a>setting</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#the default is noop</span></span><br><span class="line">$ <span class="keyword">for</span> nvme_device <span class="keyword">in</span> /sys/block/nvme*; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> noop &gt; <span class="variable">$nvme_device</span>/queue/scheduler</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#not test, default</span></span><br><span class="line">$ <span class="keyword">for</span> nvme_device <span class="keyword">in</span> /sys/block/nvme*; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> 512 &gt; <span class="variable">$nvme_device</span>/queue/nr_requests</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="nvme-help"><a href="#nvme-help" class="headerlink" title="nvme help"></a>nvme help</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ nvme intel endurance-log</span><br><span class="line">ERROR: Invalid sub-command <span class="string">&#x27;endurance-log&#x27;</span> <span class="keyword">for</span> plugin intel</span><br><span class="line">nvme-2.2.1</span><br><span class="line">usage: nvme &lt;<span class="built_in">command</span>&gt; [&lt;device&gt;] [&lt;args&gt;]</span><br><span class="line"></span><br><span class="line">The <span class="string">&#x27;&lt;device&gt;&#x27;</span> may be either an NVMe character device (ex: /dev/nvme0), an</span><br><span class="line">nvme block device (ex: /dev/nvme0n1), or a mctp address <span class="keyword">in</span> the form</span><br><span class="line">mctp:&lt;net&gt;,&lt;eid&gt;[:ctrl-id]</span><br><span class="line"></span><br><span class="line">The following are all implemented sub-commands:</span><br><span class="line">  list                         List all NVMe devices and namespaces on machine</span><br><span class="line">  list-subsys                  List nvme subsystems</span><br><span class="line">  id-ctrl                      Send NVMe Identify Controller</span><br><span class="line">  id-ns                        Send NVMe Identify Namespace, display structure</span><br><span class="line">  id-ns-granularity            Send NVMe Identify Namespace Granularity List, display structure</span><br><span class="line">  id-ns-lba-format             Send NVMe Identify Namespace <span class="keyword">for</span> the specified LBA Format index, display structure</span><br><span class="line">  list-ns                      Send NVMe Identify List, display structure</span><br><span class="line">  list-ctrl                    Send NVMe Identify Controller List, display structure</span><br><span class="line">  nvm-id-ctrl                  Send NVMe Identify Controller NVM Command Set, display structure</span><br><span class="line">  nvme-show-regs - Reads and shows the defined NVMe controller registers <span class="keyword">for</span> NVMe over PCIe or the controller properties <span class="keyword">for</span> NVMe over Fabrics.  </span><br><span class="line">.......</span><br><span class="line">See <span class="string">&#x27;nvme help &lt;command&gt;&#x27;</span> <span class="keyword">for</span> more information on a specific <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">The following are all installed plugin extensions:</span><br><span class="line">  ocp             OCP cloud SSD extensions</span><br><span class="line">  zns             Zoned Namespace Command Set</span><br><span class="line">  ymtc            Ymtc vendor specific extensions</span><br><span class="line">  wdc             Western Digital vendor specific extensions</span><br><span class="line">  virtium         Virtium vendor specific extensions</span><br><span class="line">  transcend       Transcend vendor specific extensions</span><br><span class="line">  toshiba         Toshiba NVME plugin</span><br><span class="line">  solidigm        Solidigm vendor specific extensions</span><br><span class="line">  shannon         Shannon vendor specific extensions</span><br><span class="line">  seagate         Seagate vendor specific extensions</span><br><span class="line">  sfx             ScaleFlux vendor specific extensions</span><br><span class="line">  nvidia          NVIDIA vendor specific extensions</span><br><span class="line">  netapp          NetApp vendor specific extensions</span><br><span class="line">  micron          Micron vendor specific extensions</span><br><span class="line">  memblaze        Memblaze vendor specific extensions</span><br><span class="line">  innogrit        innogrit vendor specific extensions</span><br><span class="line">  intel           Intel vendor specific extensions</span><br><span class="line">  huawei          Huawei vendor specific extensions</span><br><span class="line">  dera            Dera vendor specific extensions</span><br><span class="line">  dell            DELL vendor specific extensions</span><br><span class="line">  amzn            Amazon vendor specific extensions</span><br><span class="line"></span><br><span class="line">$ nvme list-subsys</span><br><span class="line">nvme-subsys0 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ134102RX4P0VGN  INTEL SSDPE2KX040T8                     </span><br><span class="line">\</span><br><span class="line"> +- nvme0 pcie 0000:41:00.0 live </span><br><span class="line">nvme-subsys1 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ135402294P0VGN  INTEL SSDPE2KX040T8                     </span><br><span class="line">\</span><br><span class="line"> +- nvme1 pcie 0000:43:00.0 live </span><br><span class="line">nvme-subsys2 - NQN=nqn.2014.08.org.nvmexpress:144d144dS481NC0R916614      SAMSUNG MZQLB3T8HALS-00003              </span><br><span class="line">\</span><br><span class="line"> +- nvme2 pcie 0000:45:00.0 live </span><br><span class="line">nvme-subsys3 - NQN=nqn.2021-02.com.siliconmotion:1cb01cb0SX23725P8070265     SHANNON P8G6400</span><br><span class="line">\</span><br><span class="line"> +- nvme3 pcie 0000:47:00.0 live </span><br><span class="line">nvme-subsys4 - NQN=nqn.2014-08.org.nvmexpress:5f54e23544580edb</span><br><span class="line">\</span><br><span class="line"> +- nvme4 rdma traddr=10.53.129.69 trsvcid=4421 live </span><br><span class="line"> +- nvme5 rdma traddr=10.53.129.68 trsvcid=4421 live </span><br><span class="line"></span><br><span class="line"><span class="comment">#enable multipath</span></span><br><span class="line"><span class="variable">$cat</span> /etc/modprobe.d/nvme_core.conf</span><br><span class="line">options nvme_core multipath=Y</span><br><span class="line"></span><br><span class="line"><span class="comment">###set to local kernel, or you could not set it</span></span><br><span class="line">$ <span class="built_in">cp</span> /boot/initramfs-$(<span class="built_in">uname</span> -r).img /boot/initramfs-$(<span class="built_in">uname</span> -r).bak.$(<span class="built_in">date</span> +%m-%d-%H%M%S).img</span><br><span class="line">$ dracut --force --verbose</span><br><span class="line"></span><br><span class="line">$ the_controller_id=4</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;round-robin&quot;</span> &gt; /sys/class/nvme-subsystem/nvme-subsys<span class="variable">$&#123;the_controller_id&#125;</span>/iopolicy</span><br></pre></td></tr></table></figure>

<h3 id="NVME-SSD-device-info"><a href="#NVME-SSD-device-info" class="headerlink" title="NVME SSD device info"></a>NVME SSD device info</h3><ul>
<li>NAND P&#x2F;E Cycles &#x3D; amount of program &#x2F; erase cycles NAND can do before wearing out<br>  - WAF &#x3D; NAND writes &#x2F; host writes</li>
<li>TBW or PBW – amount of host writes to SSD before wearing out<br>  - TBW &#x3D; drive capacity * cycles &#x2F; WAF</li>
<li>DWPD (drive writes per day): amount of data you can write to device each day of the warranty (typically 5 years) without wearing out<br>  - DWPD &#x3D; TBW&#x2F;365&#x2F;5&#x2F;drive capacity</li>
</ul>
<ol>
<li>Create partition smaller than total user capacity of SSD</li>
<li>Limit max LBA of drive through vendor specific tools</li>
<li>Create a namespace smaller than total user capacity</li>
<li>Limit application use to smaller LBA range</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://events.static.linuxfound.org/sites/events/files/slides/lemoal-nvme-polling-vault-2017-final_0.pdf">nvme hybird polling</a><br>I&#x2F;O models</p>
<ul>
<li><p>IRQ vs polling<br>  - NVM is coming ! Is this relevant ?<br>  - Linux implementation</p>
</li>
<li><p>Block Layer and NVMe driver<br>  - Evaluation Results<br>  - Classic polling vs Hybrid polling<br>  - Impact of process scheduling<br>  - Comparison with user level drivers</p>
</li>
<li><p>Implemented by blk_mq_poll<br>  - block-mq enabled devices only<br>  - Device queue flagged with “poll enabled”<br>          - Can be controlled through sysfs<br>          - Enabled by default for devices supporting it, e.g. NVMe</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># To enable it, you echo 1 to /sys/block/&lt;dev&gt;/queue/io_poll.</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt;  /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">$ <span class="built_in">cat</span>  /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li>Polling is tried for any block I&#x2F;O belonging to a high-priority I&#x2F;O context (IOCB_HIPRI)</li>
<li>IRQs are NOT disabled<br>  - ISR is still executed as the device signals completions<br>  - But ISR sees a completion slot already processed</li>
</ul>
<p>6us average latency with IRQ, 4.5us with polling</p>
<ul>
<li>25% lower latency with polling</li>
<li>166 KIOPS vs 222 KIOPS</li>
<li><code>But 100% load on the polling CPU</code></li>
<li>Only 32% CPU load with IRQ model</li>
</ul>
<p>Adaptive hybrid polling gives the same average latency of 4.5us as classic polling</p>
<ul>
<li>But with only 58% CPU load</li>
<li>32% with IRQ model</li>
<li>Fixed time polling allows controlling the CPU vs latency trade-off</li>
<li>IRQ like average latency and CPU load for high polling delay</li>
<li>Better use the IRQ model</li>
<li>Lower CPU loads with a small average latency degradation achieved with intermediate polling delay</li>
</ul>
<p><code>If I use NVME, if you have the top CPU, you could enable the polling, if not , irq is the better choice</code><br>dm-stripe&#x2F;dm-linear support I&#x2F;O polling<br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/783641">Compare with blktrace d2c%</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /sys/block/nvme0n1/queue/io_poll_delay</span><br><span class="line">-1</span><br><span class="line"><span class="comment"># -1 class polling (default)</span></span><br><span class="line"><span class="comment"># 0 means adaptive hybird polling</span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; /sys/block/nvme0n1/queue/io_poll_delay</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">|&lt;------------------------Application</span> <span class="string">Perecived</span> <span class="string">I/O</span> <span class="string">latency---------------------------------&gt;|</span></span><br><span class="line"><span class="string">IRQ</span>      <span class="string">syscall</span>  <span class="string">BIO_stack</span>  <span class="string">Device_driver</span>  <span class="string">CS</span>             <span class="string">sleep</span>            <span class="string">CS</span>  <span class="string">BIO_stack</span></span><br><span class="line">                                                                            <span class="string">|</span> <span class="string">(wake)</span></span><br><span class="line">                                                               <span class="string">CS</span> <span class="string">ISR</span> <span class="string">-------</span></span><br><span class="line">                                                               <span class="string">|(IRQ)</span></span><br><span class="line">                                    <span class="string">command</span> <span class="string">execution-----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">Polling</span>  <span class="string">syscall</span>  <span class="string">BIO_stack</span>  <span class="string">Device_driver</span>    <span class="string">Are</span> <span class="string">you</span> <span class="string">done</span> <span class="string">?</span>    <span class="string">BIO_stack&lt;-------Gain-------&gt;|</span></span><br><span class="line">                                                 <span class="string">|</span></span><br><span class="line"><span class="string">                                           command execution</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hybrid</span>   <span class="string">syscall</span>  <span class="string">BIO_stack</span>  <span class="string">Device_driver</span>  <span class="string">cs</span> <span class="string">sleep</span> <span class="string">cs</span>  <span class="string">done?</span>  <span class="string">BIO_stack&lt;-------Gain-------&gt;|</span></span><br><span class="line">                                                     <span class="string">|(wake)|</span></span><br><span class="line">                                      <span class="string">Timer</span> <span class="string">IRQ</span> <span class="string">--&gt;</span> <span class="string">ISR</span>     <span class="string">|</span></span><br><span class="line">                                                     <span class="string">command</span> <span class="string">execution</span></span><br></pre></td></tr></table></figure>

<p>If you need the high throughput, should be disable poll</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### BIOS setting</span></span><br><span class="line">PCIe Maximum Payload <span class="built_in">set</span> to 256b</span><br><span class="line">PCIe Maximum Read Request <span class="built_in">set</span> to 4096b</span><br><span class="line"></span><br><span class="line">$ tuned-adm profile througput-performance</span><br><span class="line">- Throughput</span><br><span class="line">  - Scheduler quantum (default 4/10 ms,-&gt; 10/15 ms)</span><br><span class="line">    - kernel.sched_min_granularity_ns=10000000</span><br><span class="line">    - kernel_sched_wakeup _granularity_ns = 15000000</span><br><span class="line">  - Weight <span class="keyword">function</span> on how often to migrate - 5ms -&gt; 50ms</span><br><span class="line">    - kernel.sched_migration_cost_ns=50000000</span><br><span class="line"></span><br><span class="line">$ modprobe -r nvme &amp;&amp; modprobe nvme poll_queues=36</span><br><span class="line">$ <span class="built_in">echo</span> 0 | <span class="built_in">tee</span> /sys/block/nvme*n1/queue/io_poll_delay</span><br><span class="line">$ <span class="built_in">echo</span> 0 | <span class="built_in">tee</span> /sys/block/nvme*n1/queue/iostats</span><br></pre></td></tr></table></figure>



<h3 id="nvme-interface-nvme-port"><a href="#nvme-interface-nvme-port" class="headerlink" title="nvme interface&#x2F;nvme port"></a><a target="_blank" rel="noopener" href="https://www.snia.org/forums/cmsi/knowledge/formfactors">nvme interface&#x2F;nvme port</a></h3><p>EDSFF  </p>
<ul>
<li>E1.L 9.5mm<ul>
<li>w up to 25W - 38.4mm, l 318.75mm, Thickness 9.5mm</li>
</ul>
</li>
<li>E1.L 18mm<ul>
<li>w up to 40W - 38.4mm, l 318.75mm, Thickness 18mm</li>
</ul>
</li>
<li>E1.S<ul>
<li>E1.S 5.9mm<ul>
<li>w 31.5mm, l 111.49mm,Thickness 5.9mm</li>
</ul>
</li>
<li>E1.S 8mm heat spreader<ul>
<li>w 31.5mm. l 111.49mm, Thickness 8.01mm</li>
</ul>
</li>
<li>E1.S Symmetric Enclosure<ul>
<li>w33.75mm, l 118.75mm, 9.5mm</li>
</ul>
</li>
<li>E1.S Asymmetric Enclosure<ul>
<li>w33.75mm, l 118.75mm, 15mm</li>
</ul>
</li>
<li>E1.S Asymmetric Enclosure<ul>
<li>w33.75mm, l 118.75mm, 25mm</li>
</ul>
</li>
</ul>
</li>
<li>EDSFF E3.S and E3.L, 2U 40+ E3.S&#x2F;L dev<ul>
<li>E3.S<ul>
<li>h 76mm, l 112.75mm, w 7.5mm</li>
</ul>
</li>
<li>E3.S 2T<ul>
<li>h 76mm, l 112.75mm, w 16.8mm, up to 40w (pcie g5x4)</li>
</ul>
</li>
<li>E3.L<ul>
<li>h 76mm, l 142.2mm, w 7.5mm</li>
</ul>
</li>
<li>E3.L 2T<ul>
<li>h 76mm, l 142.2mm, w 16.8mm</li>
</ul>
</li>
</ul>
</li>
<li>M.2<ul>
<li>16.15 x 20.15 x 1.3  W x L x H</li>
<li>22.15 x 30.15 x 2.23  W x L x H</li>
<li>22.15 x 80.15 x 2.23  W x L x H</li>
<li>22.15 x 110.15 x 3.88  W x L x H</li>
</ul>
</li>
<li>U.2<ul>
<li>7mm<ul>
<li>69.85 x 100 x 7 W x L x H</li>
</ul>
</li>
<li>15mm<ul>
<li>69.85 x 100 x 15</li>
</ul>
</li>
</ul>
</li>
<li>AIC<ul>
<li>Full Height<ul>
<li>6.6 in&#x2F;167 mm</li>
</ul>
</li>
<li>Half Height<ul>
<li>4.3 in&#x2F; 111 mm</li>
</ul>
</li>
<li>Low Profile<ul>
<li>2.5 in&#x2F;64 mm</li>
</ul>
</li>
<li>Full Length<ul>
<li>12.2 in&#x2F;312 mm</li>
</ul>
</li>
<li>Half Length<ul>
<li>6.6 in&#x2F;167 mm<span id="more"></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="why-EBOF"><a href="#why-EBOF" class="headerlink" title="why EBOF"></a><a target="_blank" rel="noopener" href="https://www.snia.org/sites/default/files/ESF/SNIA-Ethernet-SSDs-Final.pdf">why EBOF</a></h4><p>The JBOF bottleneck limit by CPU and NIC of the controller<br>The EBOF use Ethernet switch replace CPU subsystem and SAS switch ,the Ethernet switch are simple, easy to scalable.  </p>
<h4 id="NVME-persist-reservation"><a href="#NVME-persist-reservation" class="headerlink" title="NVME persist reservation"></a><a target="_blank" rel="noopener" href="https://blogs.vmware.com/virtualblocks/2018/08/20/nvme-over-fabrics-part-two/">NVME persist reservation</a></h4><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nvme-reservations.html">Requirements</a></p>
<ul>
<li>SUSE Linux Enterprise 12 SP3 and later</li>
<li>RHEL 8.3 and later</li>
<li>Amazon Linux 2 and later<ul>
<li>Write Exclusive Reservation</li>
<li>Exclusive Access Reservation</li>
<li>Write Exclusive - Registrants Only Reservation</li>
<li>Exclusive Access - Registrants Only Reservation</li>
<li>Write Exclusive - All Registrants Reservation</li>
<li>Exclusive Access - All Registrants Reservation<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ nvme amzn id-ctrl /dev/nvme1n1 -H</span><br><span class="line">...</span><br><span class="line">oncs      : 0</span><br><span class="line">  [8:8] : 0	Copy Not Supported</span><br><span class="line">  [7:7] : 0	Verify Not Supported</span><br><span class="line">  [6:6] : 0	Timestamp Not Supported</span><br><span class="line">  [5:5] : 0	Reservations Not Supported</span><br><span class="line">  [4:4] : 0	Save and Select Not Supported</span><br><span class="line">  [3:3] : 0	Write Zeroes Not Supported</span><br><span class="line">  [2:2] : 0	Data Set Management Not Supported</span><br><span class="line">  [1:1] : 0	Write Uncorrectable Not Supported</span><br><span class="line">  [0:0] : 0	Compare Not Supported</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ nvme resv-register -n 1 --crkey=0x0 --nrkey=0xa1 --rrega=0 /dev/nvme1n1</span><br><span class="line">NVMe status: INVALID_OPCODE: The associated <span class="built_in">command</span> opcode field is not valid(0x2001)</span><br><span class="line">https://repost.aws/questions/QUghbLTngoQQqXVvEosZEoug/can-i-use-nvme-reservation-on-a-multi-attach-enabled-volume</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="NVME-PI"><a href="#NVME-PI" class="headerlink" title="NVME PI"></a>NVME PI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line">$ nvme id-ns -H /dev/nvme0n1</span><br><span class="line">NVME Identify Namespace 1:</span><br><span class="line">nsze    : 0x2baa5cd0</span><br><span class="line">ncap    : 0x2baa5cd0</span><br><span class="line">nuse    : 0x2baa5cd0</span><br><span class="line">nsfeat  : 0</span><br><span class="line">  [2:2] : 0     Deallocated or Unwritten Logical Block error Not Supported</span><br><span class="line">  [1:1] : 0     Namespace uses AWUN, AWUPF, and ACWU</span><br><span class="line">  [0:0] : 0     Thin Provisioning Not Supported</span><br><span class="line"></span><br><span class="line">nlbaf   : 6</span><br><span class="line">flbas   : 0</span><br><span class="line">  [4:4] : 0     Metadata Transferred <span class="keyword">in</span> Separate Contiguous Buffer</span><br><span class="line">  [3:0] : 0     Current LBA Format Selected</span><br><span class="line"></span><br><span class="line">mc      : 0x1</span><br><span class="line">  [1:1] : 0     Metadata Pointer Not Supported</span><br><span class="line">  [0:0] : 0x1   Metadata as Part of Extended Data LBA Supported</span><br><span class="line"></span><br><span class="line">dpc     : 0x11</span><br><span class="line">  [4:4] : 0x1   Protection Information Transferred as Last 8 Bytes of Metadata Supported  &lt;-----------here</span><br><span class="line">  [3:3] : 0     Protection Information Transferred as First 8 Bytes of Metadata Not Supported</span><br><span class="line">  [2:2] : 0     Protection Information Type 3 Not Supported</span><br><span class="line">  [1:1] : 0     Protection Information Type 2 Not Supported</span><br><span class="line">  [0:0] : 0x1   Protection Information Type 1 Supported</span><br><span class="line"></span><br><span class="line">dps     : 0</span><br><span class="line">  [3:3] : 0     Protection Information is Transferred as Last 8 Bytes of Metadata</span><br><span class="line">  [2:0] : 0     Protection Information Disabled</span><br><span class="line"></span><br><span class="line">nmic    : 0</span><br><span class="line">  [0:0] : 0     Namespace Multipath Not Capable</span><br><span class="line"></span><br><span class="line">rescap  : 0</span><br><span class="line">  [6:6] : 0     Exclusive Access - All Registrants Not Supported</span><br><span class="line">  [5:5] : 0     Write Exclusive - All Registrants Not Supported</span><br><span class="line">  [4:4] : 0     Exclusive Access - Registrants Only Not Supported</span><br><span class="line">  [3:3] : 0     Write Exclusive - Registrants Only Not Supported</span><br><span class="line">  [2:2] : 0     Exclusive Access Not Supported</span><br><span class="line">  [1:1] : 0     Write Exclusive Not Supported</span><br><span class="line">  [0:0] : 0     Persist Through Power Loss Not Supported</span><br><span class="line"></span><br><span class="line">fpi     : 0</span><br><span class="line">  [7:7] : 0     Format Progress Indicator Not Supported</span><br><span class="line"></span><br><span class="line">dlfeat  : 0</span><br><span class="line">  [4:4] : 0     Guard Field of Deallocated Logical Blocks is <span class="built_in">set</span> to 0xFFFF</span><br><span class="line">  [3:3] : 0     Deallocate Bit <span class="keyword">in</span> the Write Zeroes Command is Not Supported</span><br><span class="line">  [2:0] : 0     Bytes Read From a Deallocated Logical Block and its Metadata are Not Reported</span><br><span class="line"></span><br><span class="line">nawun   : 0</span><br><span class="line">nawupf  : 0</span><br><span class="line">nacwu   : 0</span><br><span class="line">nabsn   : 0</span><br><span class="line">nabo    : 0</span><br><span class="line">nabspf  : 0</span><br><span class="line">noiob   : 0</span><br><span class="line">nvmcap  : 0</span><br><span class="line">nsattr  : 0</span><br><span class="line">nvmsetid: 0</span><br><span class="line">anagrpid: 0</span><br><span class="line">endgid  : 0</span><br><span class="line">nguid   : 00000000000000000000000000000000</span><br><span class="line">eui64   : 5cd2e4e419330100</span><br><span class="line">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (<span class="keyword">in</span> use)</span><br><span class="line">LBA Format  1 : Metadata Size: 8   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good</span><br><span class="line">LBA Format  2 : Metadata Size: 16  bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good</span><br><span class="line">LBA Format  3 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best</span><br><span class="line">LBA Format  4 : Metadata Size: 8   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best &lt;----- format --lbaf=4</span><br><span class="line">LBA Format  5 : Metadata Size: 64  bytes - Data Size: 4096 bytes - Relative Performance: 0 Best</span><br><span class="line">LBA Format  6 : Metadata Size: 128 bytes - Data Size: 4096 bytes - Relative Performance: 0 Best</span><br><span class="line"></span><br><span class="line">nvme id-ns -H /dev/nvme0n1</span><br><span class="line">NVME Identify Namespace 1:</span><br><span class="line">nsze    : 0x2e93432b0</span><br><span class="line">ncap    : 0x2e93432b0</span><br><span class="line">nuse    : 0x2e93432b0</span><br><span class="line">nsfeat  : 0x12</span><br><span class="line">  [4:4] : 0x1	NPWG, NPWA, NPDG, NPDA, and NOWS are Supported</span><br><span class="line">  [3:3] : 0	NGUID and EUI64 fields <span class="keyword">if</span> non-zero, Reused</span><br><span class="line">  [2:2] : 0	Deallocated or Unwritten Logical Block error Not Supported</span><br><span class="line">  [1:1] : 0x1	Namespace uses NAWUN, NAWUPF, and NACWU</span><br><span class="line">  [0:0] : 0	Thin Provisioning Not Supported</span><br><span class="line"></span><br><span class="line">nlbaf   : 3</span><br><span class="line">flbas   : 0</span><br><span class="line">  [4:4] : 0	Metadata Transferred <span class="keyword">in</span> Separate Contiguous Buffer</span><br><span class="line">  [3:0] : 0	Current LBA Format Selected</span><br><span class="line"></span><br><span class="line">mc      : 0x1</span><br><span class="line">  [1:1] : 0	Metadata Pointer Not Supported</span><br><span class="line">  [0:0] : 0x1	Metadata as Part of Extended Data LBA Supported</span><br><span class="line"></span><br><span class="line">dpc     : 0x1f</span><br><span class="line">  [4:4] : 0x1	Protection Information Transferred as Last 8 Bytes of Metadata Supported</span><br><span class="line">  [3:3] : 0x1	Protection Information Transferred as First 8 Bytes of Metadata Supported</span><br><span class="line">  [2:2] : 0x1	Protection Information Type 3 Supported</span><br><span class="line">  [1:1] : 0x1	Protection Information Type 2 Supported</span><br><span class="line">  [0:0] : 0x1	Protection Information Type 1 Supported</span><br><span class="line"></span><br><span class="line">dps     : 0</span><br><span class="line">  [3:3] : 0	Protection Information is Transferred as Last 8 Bytes of Metadata</span><br><span class="line">  [2:0] : 0	Protection Information Disabled</span><br><span class="line"></span><br><span class="line">nmic    : 0</span><br><span class="line">  [0:0] : 0	Namespace Multipath Not Capable</span><br><span class="line"></span><br><span class="line">rescap  : 0</span><br><span class="line">  [7:7] : 0	Ignore Existing Key - Used as defined <span class="keyword">in</span> revision 1.2.1 or earlier</span><br><span class="line">  [6:6] : 0	Exclusive Access - All Registrants Not Supported</span><br><span class="line">  [5:5] : 0	Write Exclusive - All Registrants Not Supported</span><br><span class="line">  [4:4] : 0	Exclusive Access - Registrants Only Not Supported</span><br><span class="line">  [3:3] : 0	Write Exclusive - Registrants Only Not Supported</span><br><span class="line">  [2:2] : 0	Exclusive Access Not Supported</span><br><span class="line">  [1:1] : 0	Write Exclusive Not Supported</span><br><span class="line">  [0:0] : 0	Persist Through Power Loss Not Supported</span><br><span class="line"></span><br><span class="line">fpi     : 0</span><br><span class="line">  [7:7] : 0	Format Progress Indicator Not Supported</span><br><span class="line"></span><br><span class="line">dlfeat  : 9</span><br><span class="line">  [4:4] : 0	Guard Field of Deallocated Logical Blocks is <span class="built_in">set</span> to 0xFFFF</span><br><span class="line">  [3:3] : 0x1	Deallocate Bit <span class="keyword">in</span> the Write Zeroes Command is Supported</span><br><span class="line">  [2:0] : 0x1	Bytes Read From a Deallocated Logical Block and its Metadata are 0x00</span><br><span class="line"></span><br><span class="line">nawun   : 511</span><br><span class="line">nawupf  : 7</span><br><span class="line">nacwu   : 0</span><br><span class="line">nabsn   : 511</span><br><span class="line">nabo    : 0</span><br><span class="line">nabspf  : 0</span><br><span class="line">noiob   : 0</span><br><span class="line">nvmcap  : 6401252745216</span><br><span class="line">npwg    : 511</span><br><span class="line">npwa    : 7</span><br><span class="line">npdg    : 511</span><br><span class="line">npda    : 7</span><br><span class="line">nows    : 511</span><br><span class="line">mssrl   : 0</span><br><span class="line">mcl     : 0</span><br><span class="line">msrc    : 0</span><br><span class="line">anagrpid: 0</span><br><span class="line">nsattr	: 0</span><br><span class="line">nvmsetid: 0</span><br><span class="line">endgid  : 0</span><br><span class="line">nguid   : 544365da10002cc144365d1fe4160001</span><br><span class="line">eui64   : 44365d0002cc1421</span><br><span class="line">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0 Best (<span class="keyword">in</span> use)</span><br><span class="line">LBA Format  1 : Metadata Size: 8   bytes - Data Size: 512 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  2 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  3 : Metadata Size: 8   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line"></span><br><span class="line"><span class="comment">#T10 pi t10 pi</span></span><br><span class="line">$ nvme id-ns -H /dev/nvme0n1 | grep -E <span class="string">&#x27;Protection|LBA Format  &#x27;</span></span><br><span class="line">  [4:4] : 0x1	Protection Information Transferred as Last 8 Bytes of Metadata Supported</span><br><span class="line">  [3:3] : 0	Protection Information Transferred as First 8 Bytes of Metadata Not Supported</span><br><span class="line">  [2:2] : 0	Protection Information Type 3 Not Supported</span><br><span class="line">  [1:1] : 0	Protection Information Type 2 Not Supported</span><br><span class="line">  [0:0] : 0x1	Protection Information Type 1 Supported</span><br><span class="line">  [3:3] : 0	Protection Information is Transferred as Last 8 Bytes of Metadata</span><br><span class="line">  [2:0] : 0	Protection Information Disabled</span><br><span class="line"></span><br><span class="line">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (<span class="keyword">in</span> use)</span><br><span class="line">LBA Format  1 : Metadata Size: 8   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good </span><br><span class="line">LBA Format  2 : Metadata Size: 16  bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good </span><br><span class="line">LBA Format  3 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  4 : Metadata Size: 8   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  5 : Metadata Size: 64  bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  6 : Metadata Size: 128 bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line"></span><br><span class="line"><span class="comment">#test</span></span><br><span class="line">$ nvme format --lbaf=3 -f /dev/nvme1n1</span><br><span class="line">Success formatting namespace:1</span><br><span class="line"></span><br><span class="line">$ nvme id-ns -H /dev/nvme1n1 | grep -E <span class="string">&#x27;Protection|LBA Format  &#x27;</span></span><br><span class="line">  [4:4] : 0x1	Protection Information Transferred as Last 8 Bytes of Metadata Supported</span><br><span class="line">  [3:3] : 0x1	Protection Information Transferred as First 8 Bytes of Metadata Supported</span><br><span class="line">  [2:2] : 0x1	Protection Information Type 3 Supported</span><br><span class="line">  [1:1] : 0x1	Protection Information Type 2 Supported</span><br><span class="line">  [0:0] : 0x1	Protection Information Type 1 Supported</span><br><span class="line">  [3:3] : 0	Protection Information is Transferred as Last 8 Bytes of Metadata</span><br><span class="line">  [2:0] : 0	Protection Information Disabled</span><br><span class="line">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x1 Better </span><br><span class="line">LBA Format  1 : Metadata Size: 8   bytes - Data Size: 512 bytes - Relative Performance: 0x3 Degraded </span><br><span class="line">LBA Format  2 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best </span><br><span class="line">LBA Format  3 : Metadata Size: 8   bytes - Data Size: 4096 bytes - Relative Performance: 0x2 Good (<span class="keyword">in</span> use)</span><br><span class="line"></span><br><span class="line">LBA format 3 not support T10-pi nop</span><br><span class="line">[Tue Mar 28 13:04:51 2023] LustreError: 2754:0:(osd_handler.c:2447:osd_conf_get()) MGS: unsupported T10PI <span class="built_in">type</span> <span class="string">&#x27;nop&#x27;</span></span><br><span class="line">[Tue Mar 28 13:04:51 2023] LustreError: 2757:0:(osd_handler.c:2447:osd_conf_get()) tfs6-OST0000: unsupported T10PI <span class="built_in">type</span> <span class="string">&#x27;nop&#x27;</span></span><br><span class="line">[Tue Mar 28 13:05:45 2023] LustreError: 3281:0:(osd_handler.c:2447:osd_conf_get()) tfs6-MDT0000: unsupported T10PI <span class="built_in">type</span> <span class="string">&#x27;nop&#x27;</span></span><br><span class="line"></span><br><span class="line">If use will trigger the strange block dev BUG</span><br><span class="line"></span><br><span class="line">LOAD AVERAGE: 70.84, 47.06, 37.55</span><br><span class="line">       TASKS: 1381</span><br><span class="line">    NODENAME: test-node-6336</span><br><span class="line">     RELEASE: 4.18.0-425.3.1.el8_lustre.x86_64</span><br><span class="line">     VERSION: <span class="comment">#1 SMP Wed Jan 11 23:55:00 UTC 2023</span></span><br><span class="line">     MACHINE: x86_64  (2400 Mhz)</span><br><span class="line">      MEMORY: 255.6 GB</span><br><span class="line">       PANIC: <span class="string">&quot;Kernel panic - not syncing: System is deadlocked on memory&quot;</span></span><br><span class="line">         PID: 4666</span><br><span class="line">     COMMAND: <span class="string">&quot;ll_ost_io01_038&quot;</span></span><br><span class="line">        TASK: ff26de951a0c0000  [THREAD_INFO: ff26de951a0c0000]</span><br><span class="line">         CPU: 15</span><br><span class="line">       STATE: TASK_RUNNING (PANIC)</span><br><span class="line"></span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] biovec-128              7692KB       7852KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] biovec-64               5696KB       5888KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] biovec-16               1416KB       1416KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] bio_integrity_payload  244966217KB  244966232KB &lt;------ looks like mem leak</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] khugepaged_mm_slot        185KB        185KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] uid_cache                 86KB         86KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] dmaengine-unmap-256         30KB         30KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] dmaengine-unmap-128         31KB         31KB</span><br><span class="line">[Tue Mar 28 12:08:02 CST 2023] dmaengine-unmap-16          7KB          7KB</span><br><span class="line"></span><br><span class="line">crash&gt; rd ff26de951a0c0000 256 -S</span><br><span class="line">ff26de951a0c0000:  0000000080004088 0000000000000000 </span><br><span class="line">ff26de951a0c0010:  0000000000000000 ff6a8addfb090000 </span><br><span class="line">ff26de951a0c0020:  0020804100000001 0000000000000000 </span><br><span class="line">ff26de951a0c0030:  0000000000000000 0000000f00000001 </span><br><span class="line">ff26de951a0c0040:  0000000000000008 00000001009332d9 </span><br><span class="line">ff26de951a0c0050:  [task_struct]    0000000f00000011 </span><br><span class="line">ff26de951a0c0060:  0000007800000001 0000007800000078 </span><br><span class="line">ff26de951a0c0070:  0000000000000000 fair_sched_class </span><br><span class="line">ff26de951a0c0080:  0000000000100000 0000000000400000 </span><br><span class="line">ff26de951a0c0090:  0000000000000000 [task_struct]    </span><br><span class="line">ff26de951a0c00a0:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c00b0:  [task_struct]    [task_struct]    </span><br><span class="line">ff26de951a0c00c0:  0000000000000001 000008bf76b8f125 </span><br><span class="line">ff26de951a0c00d0:  00000022e3f2ce97 00000079d33a2899 </span><br><span class="line">ff26de951a0c00e0:  00000022e181c9dd 0000000000138a65 </span><br><span class="line">........</span><br><span class="line">ff26de951a0c02d0:  [task_struct]    0000000000000000 </span><br><span class="line">ff26de951a0c02e0:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c02f0:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0300:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0310:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0320:  0000000000000000 [task_struct]    </span><br><span class="line">ff26de951a0c0330:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0340:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0350:  dl_task_timer    ff26deadbb39cf80 </span><br><span class="line">ff26de951a0c0360:  0000000001000000 0000000000000000 </span><br><span class="line">ff26de951a0c0370:  0000000000000000 [task_struct]    </span><br><span class="line">ff26de951a0c0380:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c0390:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c03a0:  inactive_task_timer ff26deadbb39cf80 </span><br><span class="line">ff26de951a0c03b0:  0000000001000000 0000000000000000 </span><br><span class="line">ff26de951a0c03c0:  0000000000000000 0000000000000000 </span><br><span class="line">ff26de951a0c03d0:  0000000000000000 0000000000000018 </span><br><span class="line">ff26de951a0c03e0:  0000fff000fff000 [bio_integrity_payload] </span><br><span class="line">ff26de951a0c03f0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0400:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0410:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0420:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0430:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0440:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0450:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0460:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0470:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0480:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0490:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04a0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04b0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04c0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04d0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04e0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c04f0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0500:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0510:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0520:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c0530:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">....</span><br><span class="line">ff26de951a0c07c0:  [bio_integrity_payload] [bio_integrity_payload]</span><br><span class="line">ff26de951a0c07d0:  [bio_integrity_payload] [bio_integrity_payload] </span><br><span class="line">ff26de951a0c07e0:  000000000035734b 0000001fdd08dddf </span><br><span class="line">ff26de951a0c07f0:  0000090bfe4be993 0000000000000000 </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="show-err-count"><a href="#show-err-count" class="headerlink" title="show err count"></a><a target="_blank" rel="noopener" href="https://www.percona.com/blog/using-nvme-command-line-tools-to-check-nvme-flash-health/">show err count</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">$ nvme smart-log /dev/nvme2</span><br><span class="line">$ nvme error-log /dev/nvme2</span><br><span class="line">$ nvme smart-log-add /dev/nvme2</span><br><span class="line">Additional Smart Log <span class="keyword">for</span> NVME device:nvme0 namespace-id:ffffffff</span><br><span class="line">key                               normalized raw</span><br><span class="line">program_fail_count              : 100%       0</span><br><span class="line">erase_fail_count                : 100%       0</span><br><span class="line">wear_leveling                   :  62%       min: 1114, max: 1161, avg: 1134</span><br><span class="line">end_to_end_error_detection_count: 100%       0</span><br><span class="line">crc_error_count                 : 100%       0</span><br><span class="line">timed_workload_media_wear       : 100%       37.941%</span><br><span class="line">timed_workload_host_reads       : 100%       51%</span><br><span class="line">timed_workload_timer            : 100%       446008 min</span><br><span class="line">thermal_throttle_status         : 100%       0%, cnt: 0</span><br><span class="line">retry_buffer_overflow_count     : 100%       0</span><br><span class="line">pll_lock_loss_count             : 100%       0</span><br><span class="line">nand_bytes_written              : 100%       sectors: 16185227</span><br><span class="line">host_bytes_written              : 100%       sectors: 6405605</span><br><span class="line"></span><br><span class="line">$ nvme lnvm smart-log-add /dev/nvme0n1</span><br><span class="line">$ nvme intel smart-log-add /dev/nvme0n1</span><br><span class="line">Additional Smart Log <span class="keyword">for</span> NVME device:nvme0 namespace-id:ffffffff</span><br><span class="line">ID             KEY                                 Normalized     Raw</span><br><span class="line">0xab    program_fail_count                             100         4</span><br><span class="line">0xac    erase_fail_count                               100         0</span><br><span class="line">0xad    wear_leveling_count                             93         1670768296327</span><br><span class="line">0xb8    e2e_error_detect_count                         100         0</span><br><span class="line">0xc7    crc_error_count                                100         0</span><br><span class="line">0xe2    media_wear_percentage                          100         65535</span><br><span class="line">0xe3    host_reads                                     100         65535</span><br><span class="line">0xe4    timed_work_load                                100         65535</span><br><span class="line">0xea    thermal_throttle_status                        100         0</span><br><span class="line">0xf0    retry_buff_overflow_count                      100         0</span><br><span class="line">0xf3    pll_lock_loss_counter                          100         0</span><br><span class="line">0xf4    nand_bytes_written                             100         13794633</span><br><span class="line">0xf5    host_bytes_written                             100         5789483</span><br><span class="line"></span><br><span class="line">https://github.com/linux-nvme/nvme-cli/issues/814</span><br><span class="line"></span><br><span class="line">Available Spare</span><br><span class="line">  Contains a normalized percentage (0 to 100%) of the remaining spare capacity that is available.</span><br><span class="line">Available Spare Threshold</span><br><span class="line">  When the Available Spare capacity falls below the threshold indicated <span class="keyword">in</span> this field, an asynchronous event completion can occur. The value is indicated as a normalized percentage (0 to 100%).</span><br><span class="line">(Note: I’m not quite sure what the practical meaning of “asynchronous event completion” is, but it looks like something to avoid!)</span><br><span class="line"></span><br><span class="line">Percentage Used</span><br><span class="line">  Contains a vendor specific estimate of the percentage of the NVM subsystem life used, based on actual usage and the manufacturer’s prediction of NVM life.</span><br><span class="line">(Note: the number can be more than 100% <span class="keyword">if</span> you’re using storage <span class="keyword">for</span> longer than its planned life.)</span><br><span class="line"></span><br><span class="line">Data Units Read/Data Units Written</span><br><span class="line">  This is the number of 512-byte data units that are <span class="built_in">read</span>/written, but it is measured <span class="keyword">in</span> an unusual way. The first value corresponds to 1000 of the 512-byte units. So you can multiply this value by 512000 to get value <span class="keyword">in</span> bytes. It does not include meta-data accesses.</span><br><span class="line"></span><br><span class="line">Host Read/Write Commands</span><br><span class="line">  The number of commands of the appropriate <span class="built_in">type</span> issued. Using this value, as well as one below, you can compute the average IO size <span class="keyword">for</span> “physical” reads and writes.</span><br><span class="line"></span><br><span class="line">Controller Busy Time</span><br><span class="line">  Time <span class="keyword">in</span> minutes that the controller was busy servicing commands. This can be used to gauge long-term storage load trends.</span><br><span class="line"></span><br><span class="line">Unsafe Shutdowns</span><br><span class="line">  The number of <span class="built_in">times</span> a power loss happened without a shutdown notification being sent. Depending on the NVMe device you’re using, an unsafe shutdown might corrupt user data.</span><br><span class="line"></span><br><span class="line">Warning Temperature Time/Critical Temperature Time</span><br><span class="line">  The time <span class="keyword">in</span> minutes a device operated above a warning or critical temperature. It should be zeroes.</span><br><span class="line"></span><br><span class="line">Wear_Leveling</span><br><span class="line">  This shows how much of the rated cell life was used, as well as the min/max/avg write count <span class="keyword">for</span> different cells. In this <span class="keyword">case</span>, it looks like the cells are rated <span class="keyword">for</span> 1800 writes and about 1100 on average were used</span><br><span class="line"></span><br><span class="line">Timed Workload Media Wear</span><br><span class="line">  The media wear by the current “workload.” This device allows you to measure some statistics from the time you reset them (called the “workload”) <span class="keyword">in</span> addition to showing the device lifetime values.</span><br><span class="line"></span><br><span class="line">Timed Workload Host Reads</span><br><span class="line">  The percentage of IO operations that were reads (since the workload timer was reset).</span><br><span class="line"></span><br><span class="line">Thermal Throttle Status</span><br><span class="line">  This shows <span class="keyword">if</span> the device is throttled due to overheating, and when there were throttling events <span class="keyword">in</span> the past.</span><br><span class="line"></span><br><span class="line">Nand Bytes Written</span><br><span class="line">  The bytes written to NAND cells. For this device, the measured unit seems to be <span class="keyword">in</span> 32MB values. It might be different <span class="keyword">for</span> other devices.</span><br><span class="line"></span><br><span class="line">Host Bytes Written</span><br><span class="line">  The bytes written to the NVMe storage from the system. This unit also is <span class="keyword">in</span> 32MB values. The scale of these values is not very important, as they are the most helpful <span class="keyword">for</span> finding the write amplification of your workload. This ratio is measured <span class="keyword">in</span> writes to NAND and writes to HOST. For this example, the Write Amplification Factor (WAF) is 16185227 / 6405605 = 2.53  </span><br></pre></td></tr></table></figure>

<h4 id="delete-the-nvme-device"><a href="#delete-the-nvme-device" class="headerlink" title="delete the nvme device"></a><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E53596_01/html/E53601/gopyz.html">delete the nvme device</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">find /sys/devices | egrep <span class="string">&#x27;nvme[0-9][0-9]?$&#x27;</span></span><br><span class="line">/sys/devices/pci0000:80/0000:80:03.0/0000:b0:00.0/0000:b1:04.0/0000:b2:00.0/misc/nvme0</span><br><span class="line">/sys/devices/pci0000:80/0000:80:03.0/0000:b0:00.0/0000:b1:05.0/0000:b4:00.0/misc/nvme1</span><br><span class="line"></span><br><span class="line">egrep –H <span class="string">&#x27;.*&#x27;</span> /sys/bus/pci/slots/*/address</span><br><span class="line">/sys/bus/pci/slots/10/address:0000:b8:00</span><br><span class="line">/sys/bus/pci/slots/11/address:0000:b6:00</span><br><span class="line">/sys/bus/pci/slots/12/address:0000:b2:00 (instance nvme0, pcie slot 12, drive label nvme2)</span><br><span class="line">/sys/bus/pci/slots/13/address:0000:b4:00 (instance nvme1, pcie slot 13, drive label nvme3)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /sys/bus/pci/slots/10/power</span><br></pre></td></tr></table></figure>

<h4 id="isdct-show-all-info"><a href="#isdct-show-all-info" class="headerlink" title="isdct show all info"></a>isdct show all info</h4><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/dam/support/us/en/documents/memory-and-storage/Intel_SSD_DCT_3_0_x_User_Guide.pdf">isdct</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">$ nvme list</span><br><span class="line">Node             SN                   Model                                    Namespace Usage                      Format           FW Rev</span><br><span class="line">---------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme0n1     FUKS731100771P5CGN   INTEL SSDPED1K015TA                      1           1.50  TB /   1.50  TB    512   B +  0 B   E2010435</span><br><span class="line"></span><br><span class="line">$ isdct  show -a -intelssd 1</span><br><span class="line"></span><br><span class="line">- Intel SSD DC S3510 Series BTWA650406RK480FGN -</span><br><span class="line"></span><br><span class="line">AccessibleMaxAddressSupported : True</span><br><span class="line">AggregationThreshold : Device does not support this command set.</span><br><span class="line">AggregationTime : Device does not support this command set.</span><br><span class="line">ArbitrationBurst : Device does not support this command set.</span><br><span class="line">CoalescingDisable : Device does not support this command set.</span><br><span class="line">DIPMEnabled : False</span><br><span class="line">DIPMSupported : False</span><br><span class="line">DevicePath : /dev/sg0</span><br><span class="line">DeviceStatus : Healthy</span><br><span class="line">DigitalFenceSupported : False</span><br><span class="line">DownloadMicrocodePossible : True</span><br><span class="line">DynamicMMIOEnabled : The selected drive does not support this feature.</span><br><span class="line">EDriveSupported : False</span><br><span class="line">EnduranceAnalyzer : 7195.06 years</span><br><span class="line">ErrorString :</span><br><span class="line">Firmware : G201DL2B</span><br><span class="line">FirmwareActivationNoticesConfiguration : Device does not support this command set.</span><br><span class="line">FirmwareUpdateAvailable : Please contact your Intel representative about firmware update for this drive.</span><br><span class="line">HDD : False</span><br><span class="line">HighPriorityWeightArbitration : Device does not support this command set.</span><br><span class="line">IOCompletionQueuesRequested : Device does not support this command set.</span><br><span class="line">IOSubmissionQueuesRequested : Device does not support this command set.</span><br><span class="line">Index : 1</span><br><span class="line">Intel : True</span><br><span class="line">IntelGen3SATA : True</span><br><span class="line">IntelNVMe : False</span><br><span class="line">InterruptVector : Device does not support this command set.</span><br><span class="line">IsDualPort : False</span><br><span class="line">LatencyTrackingEnabled : False</span><br><span class="line">LowPriorityWeightArbitration : Device does not support this command set.</span><br><span class="line">MaximumLBA : 937703087</span><br><span class="line">MediumPriorityWeightArbitration : Device does not support this command set.</span><br><span class="line">ModelNumber : INTEL SSDSC2BB480G6R</span><br><span class="line">NVMePowerState : Device does not support this command set.</span><br><span class="line">NamespaceAttributeNoticesConfiguration : Device does not support this command set.</span><br><span class="line">NativeMaxLBA : 937703087</span><br><span class="line">OEM : Dell</span><br><span class="line">PLITestTimeInterval : 10080 minutes</span><br><span class="line">PhyConfig : 0 (Default Enterprise Settings)</span><br><span class="line">PhySpeed : 6.0 Gbps</span><br><span class="line">PhysicalSectorSize : 4096 bytes</span><br><span class="line">PhysicalSize : 480103981056</span><br><span class="line">PowerGovernorAveragePower : 8500 milliwatts</span><br><span class="line">PowerGovernorBurstPower : 8500 milliwatts</span><br><span class="line">PowerGovernorMode : 0 Unconstrained. Limited by maximum budget</span><br><span class="line">Product : HaleyvilleSE L95</span><br><span class="line">ProductFamily : Intel SSD DC S3510 Series</span><br><span class="line">ProductProtocol : ATA</span><br><span class="line">ReadErrorRecoveryTimer : 80</span><br><span class="line">RemoteSecureEraseSupported : False</span><br><span class="line">SMARTEnabled : True</span><br><span class="line">SMARTHealthCriticalWarningsConfiguration : Device does not support this command set.</span><br><span class="line">SMARTSelfTestSupported : True</span><br><span class="line">SMBusAddress : Device does not support this command set.</span><br><span class="line">SMI : False</span><br><span class="line">SSCEnabled : False</span><br><span class="line">SanitizeBlockEraseSupported : True</span><br><span class="line">SanitizeCryptoScrambleSupported : False</span><br><span class="line">SanitizeSupported : True</span><br><span class="line">SataGen1 : True</span><br><span class="line">SataGen2 : True</span><br><span class="line">SataGen3 : True</span><br><span class="line">SataNegotiatedSpeed : 6.0 Gbs</span><br><span class="line">SectorSize : 512</span><br><span class="line">SecurityEnabled : False</span><br><span class="line">SecurityFrozen : True</span><br><span class="line">SecurityLocked : False</span><br><span class="line">SecuritySupported : True</span><br><span class="line">SerialNumber : xxxxxxxxxxxxxxxxxxx</span><br><span class="line">TCGSupported : False</span><br><span class="line">TelemetryLogNoticesConfiguration : Device does not support this command set.</span><br><span class="line">TelemetryLogSupported : True</span><br><span class="line">TempThreshold : Device does not support this command set.</span><br><span class="line">TemperatureLoggingInterval : 1 minute(s)</span><br><span class="line">ThermalThrottleEnabled : Device does not support this command set.</span><br><span class="line">TimeLimitedErrorRecovery : Device does not support this command set.</span><br><span class="line">TrimSize : 4</span><br><span class="line">TrimSupported : True</span><br><span class="line">VolatileWriteCacheEnabled : Device does not support this command set.</span><br><span class="line">WWID : 934300737939264973</span><br><span class="line">WriteAtomicityDisableNormal : Device does not support this command set.</span><br><span class="line">WriteCacheEnabled : False</span><br><span class="line">WriteCacheReorderingStateEnabled : True</span><br><span class="line">WriteCacheState : 1</span><br><span class="line">WriteCacheSupported : True</span><br><span class="line">WriteErrorRecoveryTimer : 80</span><br></pre></td></tr></table></figure>

<h4 id="Enable-write-cache"><a href="#Enable-write-cache" class="headerlink" title="Enable write cache"></a>Enable write cache</h4><p>1: Write cache state is determined by ATA Set Features<br>2: Write cache is enabled.<br>3: Write cache is disabled.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /sys/block/nvme0n1/queue/write_cache</span><br><span class="line">write back</span><br><span class="line">$ dmesg -T | <span class="built_in">tail</span> <span class="comment">#show the enable successful</span></span><br><span class="line"></span><br><span class="line">$ nvme get-feature -f 0x6 /dev/nvme0 -n 0 -s 0</span><br><span class="line"><span class="comment">## disable</span></span><br><span class="line">$ nvme set-feature -f 0x6 /dev/nvme0 -v 0 -s 0</span><br><span class="line">$ nvme set-feature -f 0x6 /dev/nvme0 -v 3 -s 0</span><br><span class="line">$ nvme set-feature -f 0x6 /dev/nvme0 -v 3 -s</span><br><span class="line">$ nvme id-ns /dev/nvme1n1</span><br><span class="line"></span><br><span class="line"><span class="comment">#if support HBM</span></span><br><span class="line">$ nvme get-feature /dev/nvme0 -f 0xd -H</span><br><span class="line">$ nvme id-ctrl -H /dev/nvme0 | grep -E <span class="string">&quot;hmmpre|hmmin&quot;</span> <span class="comment">#enabled means not zero</span></span><br><span class="line">https://github.com/linux-nvme/nvme-cli/issues/1612</span><br><span class="line"></span><br><span class="line"><span class="comment">#udev</span></span><br><span class="line">ACTION==<span class="string">&quot;add&quot;</span>, KERNEL==<span class="string">&quot;nvme*&quot;</span>, RUN+=<span class="string">&quot;nvme set-feature -f 6 -v 0 %N&quot;</span></span><br><span class="line"></span><br><span class="line">$ nvme id-ns -H /dev/nvme3n1 | grep <span class="string">&quot;LBA Format&quot;</span></span><br><span class="line">  [3:0] : 0     Current LBA Format Selected</span><br><span class="line">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0 Best (<span class="keyword">in</span> use)</span><br><span class="line">LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0 Best</span><br><span class="line"></span><br><span class="line">$ nvme format --lbaf=1 --reset /dev/nvme0n1 <span class="comment">#4KiB</span></span><br><span class="line">$ nvme format --lbaf=0 /dev/nvme0n1 <span class="comment">#512B</span></span><br><span class="line">https://www.bjonnh.net/article/20210721_nvme4k/</span><br><span class="line"></span><br><span class="line"><span class="comment">#Running with PI setting, following settings steps are required. First, format device namespace with proper PI setting. For example:</span></span><br><span class="line">$ nvme format /dev/nvme0n1 -l 1 -i 1 -p 0 -m 1</span><br><span class="line">-l 1 = --lbaf=1 </span><br><span class="line">-i &lt;pi&gt;, --pi=&lt;pi&gt; </span><br><span class="line">           ┌──────┬───────────────────────────────────────────┐</span><br><span class="line">           │Value │ Definition                                │</span><br><span class="line">           ├──────┼───────────────────────────────────────────┤</span><br><span class="line">           │0     │ Protection information is not enabled     │</span><br><span class="line">           ├──────┼───────────────────────────────────────────┤</span><br><span class="line">           │1     │ Protection information is enabled, Type 1 │</span><br><span class="line">           ├──────┼───────────────────────────────────────────┤</span><br><span class="line">           │2     │ Protection information is enabled, Type 2 │</span><br><span class="line">           ├──────┼───────────────────────────────────────────┤</span><br><span class="line">           │3     │ Protection information is enabled, Type 3 │</span><br><span class="line">           ├──────┼───────────────────────────────────────────┤</span><br><span class="line">           │4–7   │ Reserved                                  │</span><br><span class="line">           └──────┴───────────────────────────────────────────┘</span><br><span class="line">-p &lt;pil&gt;, --pil=&lt;pil&gt;</span><br><span class="line">Protection Information Location: If <span class="built_in">set</span> to ‘1’ and protection information is enabled, <span class="keyword">then</span> protection information is transferred as the first eight bytes of metadata. If cleared to ‘0’ and protection information is enabled, <span class="keyword">then</span> protection information is transferred as the last eight bytes of metadata. Defaults to 0.</span><br><span class="line"></span><br><span class="line">-m &lt;ms&gt;, --ms=&lt;ms&gt;</span><br><span class="line">Metadata Settings: This field is <span class="built_in">set</span> to ‘1’ <span class="keyword">if</span> the metadata is transferred as part of an extended data LBA. This field is cleared to ‘0’ <span class="keyword">if</span> the metadata is transferred as part of a separate buffer. The metadata may include protection information, based on the Protection Information (PI) field. Defaults to 0.</span><br><span class="line"></span><br><span class="line">https://github.com/spdk/spdk/tree/master/examples/nvme/fio_plugin</span><br><span class="line">$ ~/spdk/scripts/setup.sh config</span><br><span class="line">0000:41:00.0 (1e3b 0600): Active devices: mount@nvme0n1:nvme0n1p2, so not binding PCI dev</span><br><span class="line">0000:43:00.0 (8086 0a54): Active devices: mount@nvme1n1:nvme1n1p1,mount@nvme1n1:nvme1n1p2,mount@nvme1n1:nvme1n1p4, so not binding PCI dev</span><br><span class="line">0000:45:00.0 (1cb0 8266): Active devices: mount@nvme2n1:nvme2n1p2, so not binding PCI dev</span><br><span class="line">0000:47:00.0 (1fe4 1600): Active devices: mount@nvme3n1:nvme3n1p2, so not binding PCI dev</span><br><span class="line">INFO: Requested 1024 hugepages but 1024 already allocated on node0</span><br><span class="line"></span><br><span class="line">$ LD_PRELOAD=/root/spdk/build/fio/spdk_nvme /root/fio-fio-3.36/fio example_config.fio <span class="string">&#x27;--filename=trtype=PCIe traddr=0000.41.00.0 ns=1&#x27;</span></span><br><span class="line"><span class="built_in">test</span>: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=spdk, iodepth=128</span><br><span class="line">fio-3.36</span><br><span class="line">Starting 1 thread</span><br><span class="line">EAL: Driver cannot attach the device (0000:41:00.0)</span><br><span class="line">EAL: Failed to attach device on primary process</span><br><span class="line">[2023-11-21 21:25:17.170800] nvme.c: 815:nvme_probe_internal: *ERROR*: NVMe ctrlr scan failed</span><br><span class="line">[2023-11-21 21:25:17.170808] nvme.c: 892:spdk_nvme_probe: *ERROR*: Create probe context failed</span><br><span class="line">[2023-11-21 21:25:17.170813] fio_plugin.c: 668:spdk_fio_setup: *ERROR*: spdk_nvme_probe() failed</span><br><span class="line"><span class="built_in">test</span>: you need to specify size=</span><br><span class="line">fio: pid=0, err=22/file:filesetup.c:1144, func=total_file_size, error=Invalid argument</span><br><span class="line"></span><br><span class="line">https://www.intel.com/content/www/us/en/developer/articles/technical/evaluate-performance-for-storage-performance-development-kit-spdk-based-nvme-ssd.html</span><br><span class="line"></span><br><span class="line">$ nvme format -s1 /dev/nvme1n1 </span><br><span class="line"><span class="comment">#User Data Erase</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This example shows the nvme0n1 is formatted with a metadata size of 8, so it needs to be reformatted for use with IBM Spectrum Scale Erasure Code Edition. LBA format 3 has zero metadata size, and have rp of zero. </span></span><br><span class="line">$ nvme format /dev/nvme1n1 --lbaf=3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ isdct <span class="built_in">set</span> -intelssd 1 WriteCacheState=3</span><br><span class="line">Set WriteCacheState successful. Completed successfully.</span><br><span class="line"></span><br><span class="line">$ isdct  show -a -intelssd 1  | grep -i writecache</span><br><span class="line">VolatileWriteCacheEnabled : Device does not support this <span class="built_in">command</span> <span class="built_in">set</span>.</span><br><span class="line">WriteCacheEnabled : False</span><br><span class="line">WriteCacheReorderingStateEnabled : True</span><br><span class="line">WriteCacheState : 3</span><br><span class="line">WriteCacheSupported : True</span><br><span class="line"></span><br><span class="line">$ isdct <span class="built_in">set</span> -intelssd 1 WriteCacheState=2</span><br><span class="line">Set WriteCacheState successful. Completed successfully.</span><br><span class="line"></span><br><span class="line">$ isdct  show -a -intelssd 1  | grep -i writecache</span><br><span class="line">VolatileWriteCacheEnabled : Device does not support this <span class="built_in">command</span> <span class="built_in">set</span>.</span><br><span class="line">WriteCacheEnabled : True</span><br><span class="line">$ isdct <span class="built_in">set</span> -intelssd 1 WriteCacheEnabled=<span class="literal">false</span></span><br><span class="line">Set WriteCacheEnabled successful. Completed successfully.</span><br><span class="line"></span><br><span class="line">$ isdct  show -a -intelssd 1  | grep -i writecache</span><br><span class="line">VolatileWriteCacheEnabled : Device does not support this <span class="built_in">command</span> <span class="built_in">set</span>.</span><br><span class="line">WriteCacheEnabled : True</span><br><span class="line">WriteCacheReorderingStateEnabled : True</span><br><span class="line">WriteCacheState : 2</span><br><span class="line">WriteCacheSupported : True</span><br></pre></td></tr></table></figure>

<h4 id="Trim-feature"><a href="#Trim-feature" class="headerlink" title="Trim feature"></a>Trim feature</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ isdct  show -a -intelssd 1  | grep -i TrimSupported</span><br><span class="line">TrimSupported : True</span><br></pre></td></tr></table></figure>

<h4 id="Intel-ssd-secure-erase"><a href="#Intel-ssd-secure-erase" class="headerlink" title="Intel ssd secure erase"></a>Intel ssd secure erase</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">isdct  show -intelssd 5</span><br><span class="line">- Intel Optane(TM) SSD DC P4800X Series PHKS7413003T375AGN -</span><br><span class="line"></span><br><span class="line">Bootloader : EB3B0306</span><br><span class="line">DevicePath : /dev/nvme5n1</span><br><span class="line">DeviceStatus : Healthy</span><br><span class="line">Firmware : E2010324</span><br><span class="line">FirmwareUpdateAvailable : The selected Intel SSD contains current firmware as of this tool release.</span><br><span class="line">Index : 5</span><br><span class="line"></span><br><span class="line">isdct  start -nvmeformat -intelssd 5 SecureEraseSetting = 0</span><br><span class="line">isdct delete  -intelssd 5</span><br><span class="line">isdct  start -nvmeformat -intelssd 5</span><br></pre></td></tr></table></figure>

<h4 id="Software-optimization"><a href="#Software-optimization" class="headerlink" title="Software optimization"></a>Software optimization</h4><ul>
<li>System call (VFS)<br>  - Optimizations introduced with kernel 4.10</li>
<li>BIO stack<br>  - blk-mq already very efficient</li>
<li>Device driver<br>  - NVMe driver submission and completion paths are very short</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://metebalci.com/blog/a-quick-tour-of-nvm-express-nvme/">I’m copy the article, just read it</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">$ nvme --smart-log /dev/nvme0</span><br><span class="line">Smart Log <span class="keyword">for</span> NVME device:nvme0 namespace-id:ffffffff</span><br><span class="line">critical_warning                    : 0</span><br><span class="line">temperature                         : 35 C</span><br><span class="line">available_spare                     : 100%</span><br><span class="line">available_spare_threshold           : 0%</span><br><span class="line">percentage_used                     : 0%</span><br><span class="line">data_units_read                     : 320,346,034</span><br><span class="line">data_units_written                  : 441,545,307</span><br><span class="line">host_read_commands                  : 16,537,842,223</span><br><span class="line">host_write_commands                 : 19,148,305,649</span><br><span class="line">controller_busy_time                : 3,505</span><br><span class="line">power_cycles                        : 50</span><br><span class="line">power_on_hours                      : 16,079</span><br><span class="line">unsafe_shutdowns                    : 33</span><br><span class="line">media_errors                        : 0</span><br><span class="line">num_err_log_entries                 : 0</span><br><span class="line">Warning Temperature Time            : 0</span><br><span class="line">Critical Composite Temperature Time : 0</span><br><span class="line">Thermal Management T1 Trans Count   : 0</span><br><span class="line">Thermal Management T2 Trans Count   : 0</span><br><span class="line">Thermal Management T1 Total Time    : 0</span><br><span class="line">Thermal Management T2 Total Time    : 0</span><br><span class="line"></span><br><span class="line">nvme error-log /dev/nvme0</span><br><span class="line">Error Log Entries <span class="keyword">for</span> device:nvme0 entries:64</span><br><span class="line">.................</span><br><span class="line"> Entry[ 0]</span><br><span class="line">.................</span><br><span class="line">error_count  : 0</span><br><span class="line">sqid         : 0</span><br><span class="line">cmdid        : 0</span><br><span class="line">status_field : 0(SUCCESS: The <span class="built_in">command</span> completed successfully)</span><br><span class="line">parm_err_loc : 0</span><br><span class="line">lba          : 0</span><br><span class="line">nsid         : 0</span><br><span class="line">vs           : 0</span><br><span class="line">cs           : 0</span><br><span class="line">.................</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Entry[63]</span><br><span class="line">.................</span><br><span class="line">error_count  : 0</span><br><span class="line">sqid         : 0</span><br><span class="line">cmdid        : 0</span><br><span class="line">status_field : 0(SUCCESS: The <span class="built_in">command</span> completed successfully)</span><br><span class="line">parm_err_loc : 0</span><br><span class="line">lba          : 0</span><br><span class="line">nsid         : 0</span><br><span class="line">vs           : 0</span><br><span class="line">cs           : 0</span><br><span class="line">.................</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ nvme get-log /dev/nvme0 --log-id=2 --log-len=512</span><br><span class="line">Device:nvme0 log-id:2 namespace-id:0xffffffff</span><br><span class="line">       0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f</span><br><span class="line">0000: 00 33 01 64 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;.3.d............&quot;</span></span><br><span class="line">0010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0020: b2 17 18 13 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0030: 5b 72 51 1a 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;[rQ.............&quot;</span></span><br><span class="line">0040: 2f 72 bb d9 03 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;/r..............&quot;</span></span><br><span class="line">0050: f1 f4 53 75 04 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;..Su............&quot;</span></span><br><span class="line">0060: b1 0d 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0070: 32 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;2...............&quot;</span></span><br><span class="line">0080: cf 3e 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;.&gt;..............&quot;</span></span><br><span class="line">0090: 21 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;!...............&quot;</span></span><br><span class="line"></span><br><span class="line">$ nvme list</span><br><span class="line">Node             SN                   Model                                    Namespace Usage                      Format           FW Rev</span><br><span class="line">---------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme0n1     PHKS00000000000000   INTEL SSDPED1K375GA                      1         375.08  GB / 375.08  GB      4 KiB +  0 B   E2010435</span><br><span class="line"></span><br><span class="line">$ nvme list-ns /dev/nvme0n1</span><br><span class="line">NVMe Status:INVALID_NS: The namespace or the format of that namespace is invalid(400b) NSID:0</span><br><span class="line"></span><br><span class="line">$ nvme fw-download /dev/nvme0n1 -f &lt;fw binary&gt;</span><br><span class="line">$ nvme fw-commit /dev/nvme0n1 -s 1 -a 1</span><br><span class="line">$ nvme reset /dev/nvme0</span><br><span class="line">$ nvme subsystem-reset /dev/nvme0 </span><br><span class="line"></span><br><span class="line"><span class="comment">#secure format</span></span><br><span class="line">$ nvme format /dev/nvme0 -s 1</span><br><span class="line">SES = 0 results <span class="keyword">in</span> drive being formatted and trimmed</span><br><span class="line">SES = 1 <span class="keyword">for</span> Block Erase – low level block erase on media (physically erase NAND blocks, or overwrite with 0 on SCM)</span><br><span class="line">SES = 2 <span class="keyword">for</span> Crypto Erase - change media encryption key</span><br><span class="line">-l <span class="keyword">for</span> LBA format, find capabilities <span class="keyword">in</span> NVMe identify controller -t <span class="built_in">timeout</span> <span class="keyword">for</span> devices that will take a long time</span><br><span class="line">-p <span class="keyword">for</span> protection information with variable sector size</span><br><span class="line"></span><br><span class="line"><span class="comment">## for more info</span></span><br><span class="line">Format NVM, <span class="built_in">command</span> dword 10</span><br><span class="line"><span class="comment">#Securely erasing SSD</span></span><br><span class="line"></span><br><span class="line">Sanitize (not widely supported yet)</span><br><span class="line">$ nvme sanitize</span><br><span class="line"></span><br><span class="line"><span class="comment">#Block Erase – low level block erase on media (physically erase NAND blocks)</span></span><br><span class="line"><span class="comment">#Crypto Erase - change media encryption key</span></span><br><span class="line"><span class="comment">#Overwrite – overwrite with data patterns (not good or recommended for NAND based SSDs due to endurance)</span></span><br><span class="line">$ nvme id-ctrl /dev/nvme0 -H | grep sanicap -A 5</span><br><span class="line">sanicap   : 0</span><br><span class="line">  [31:30] : 0	Additional media modification after sanitize operation completes successfully is not defined</span><br><span class="line">  [29:29] : 0	No-Deallocate After Sanitize bit <span class="keyword">in</span> Sanitize <span class="built_in">command</span> Supported</span><br><span class="line">    [2:2] : 0	Overwrite Sanitize Operation Not Supported</span><br><span class="line">    [1:1] : 0	Block Erase Sanitize Operation Not Supported</span><br><span class="line">    [0:0] : 0	Crypto Erase Sanitize Operation Not Supported</span><br><span class="line"></span><br><span class="line"><span class="comment">#Block Erase – low level block erase on media (physically erase NAND blocks)</span></span><br><span class="line">$ nvme sanitize -a 2 /dev/nvme0n1</span><br><span class="line">$ nvme sanitize-log -H /dev/nvme0n1</span><br><span class="line">Sanitize Progress                      (SPROG) :  40164 (61.285400%)</span><br><span class="line">Sanitize Status                        (SSTAT) :  0x2</span><br><span class="line">        [2:0]   Sanitize <span class="keyword">in</span> Progress.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="create-mdraid-for-nvme-ssd"><a href="#create-mdraid-for-nvme-ssd" class="headerlink" title="create mdraid for nvme ssd"></a>create mdraid for nvme ssd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">$ mdadm -C /dev/md0 /dev/nvme[0-3]n1 –n 4 –e imsm</span><br><span class="line">$ mdadm -C /dev/md0 /dev/nvme[0-3]n1 –n 4 –e imsm</span><br><span class="line"></span><br><span class="line"><span class="comment">## I/O polling mode was introduced with linux 4.4, in polling mode the cpu continuously checks if the I/O command completed</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">bash: <span class="built_in">echo</span>: write error: Invalid argument</span><br><span class="line"></span><br><span class="line"><span class="comment">## Hybird polling mode was introduced in linux kenrel 4.10, hybrid polling mode improvded QD1 performance closer to that of polling mode performance, but with lower cpu utilizaion</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /sys/block/nvme0n1/queue/io_poll_delay</span><br><span class="line">0=hybrid, 1 = always poll( default )</span><br><span class="line"></span><br><span class="line">block-mq enabled devices only</span><br><span class="line">Device queue flagged with “poll enabled</span><br><span class="line"></span><br><span class="line">CPU frequency    &gt;  3.0GHz</span><br><span class="line">Hyper threading     <span class="built_in">disable</span></span><br><span class="line">EIST(Enhanced intel speed step technology)    disabled</span><br><span class="line">intel Turbo mode    <span class="built_in">disable</span></span><br><span class="line">C-states            <span class="built_in">disable</span></span><br><span class="line">P-states            <span class="built_in">disable</span></span><br><span class="line">CPU Governor(os)    performance mode</span><br><span class="line">IRQ balancing(os)   disabled</span><br><span class="line">SMP Affinity        <span class="built_in">set</span> interrupts to run <span class="keyword">in</span> the proper CPU cores</span><br><span class="line">I/O polling or Hybrid mode    Enabled</span><br><span class="line">Linux flow of <span class="built_in">command</span> execution on NVME SSDs</span><br><span class="line">User app requestion IO -&gt; kernel processes IO request and sends to device driver -&gt; device driver processes the requests(create SQ entry, rings doorbell register) -&gt; device processes the requests(<span class="built_in">read</span> sq entry, processes IO, create cq entry, signals MSI-x to host) -&gt; kernel call device driver to handle the completion -&gt; device driver ack, that the entry <span class="keyword">in</span> CQ has been processed</span><br><span class="line"></span><br><span class="line">IO execution <span class="keyword">in</span> SPDK</span><br><span class="line">User app requestion IO -&gt; SPDK userspace device driver process the requests(create SQ entry, rings doorbell register) -&gt; device processes the requestion(<span class="built_in">read</span> sq entry, processes IO, create cq entry) -&gt; user application polls SPDK <span class="keyword">for</span> IO completion -&gt; spdk call user application completion callback when IO is complete</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /proc/version /proc/cpuinfo /proc/meminfo /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor</span><br><span class="line">lspci -v</span><br><span class="line">nvme list</span><br><span class="line"></span><br><span class="line"><span class="comment">#disable IRQ balance</span></span><br><span class="line"><span class="built_in">set</span> SMP affinity</span><br><span class="line">systemctl stop irqbalance</span><br><span class="line">folders=/proc/irq/*</span><br><span class="line"><span class="keyword">for</span> folder <span class="keyword">in</span> <span class="variable">$folders</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  files=<span class="string">&quot;<span class="variable">$folder</span>/*&quot;</span></span><br><span class="line">  <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$files</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">     <span class="keyword">if</span> [[ <span class="variable">$file</span> == *<span class="string">&quot;nvme&quot;</span>* ]]</span><br><span class="line">     <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$file</span></span><br><span class="line">        contents=$(<span class="built_in">cat</span> <span class="variable">$folder</span>/affinity_hint)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$contents</span> &gt; <span class="variable">$folder</span>/smp_affinity</span><br><span class="line">        <span class="built_in">cat</span> <span class="variable">$folder</span>/smp_affinity</span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ nvme id-ctrl -H /dev/nvme0n1</span><br><span class="line">NVME Identify Controller:</span><br><span class="line">vid       : 0x8086                  <span class="comment"># vid is PCI Vendor ID (so Samsung in this case), 0x144d as in the lspci output.</span></span><br><span class="line">ssvid     : 0x8086                  <span class="comment"># ssvid is PCI Subsystem Vendor ID</span></span><br><span class="line">sn        : PHK000000000000000</span><br><span class="line">mn        : INTEL SSDPED1K375GA</span><br><span class="line">fr        : E2010435</span><br><span class="line">rab       : 0</span><br><span class="line">ieee      : 5cd2e4</span><br><span class="line">cmic      : 0                       <span class="comment"># the Controller Multi-Path I/O and Namespace Sharing Capabilities.</span></span><br><span class="line">  [3:3] : 0     ANA not supported</span><br><span class="line">  [2:2] : 0     PCI</span><br><span class="line">  [1:1] : 0     Single Controller</span><br><span class="line">  [0:0] : 0     Single Port</span><br><span class="line"></span><br><span class="line">mdts      : 5                       <span class="comment"># mdts is Maximum Data Transfer Size.</span></span><br><span class="line">                                    <span class="comment"># It is reported as a power of two and in units of minimum memory page size. mdts=5 here</span></span><br><span class="line">                                    <span class="comment"># so 2⁵ = 32. We will see the minimum memory page size (MPSMIN) as 4K below. So MDTS is 32 * 4K = 128K.</span></span><br><span class="line">cntlid    : 0</span><br><span class="line">ver       : 0</span><br><span class="line">rtd3r     : 0</span><br><span class="line">rtd3e     : 0</span><br><span class="line">oaes      :</span><br><span class="line">  [9:9] : 0     Firmware Activation Notices Not Supported</span><br><span class="line">  [8:8] : 0     Namespace Attribute Changed Event Not Supported</span><br><span class="line"></span><br><span class="line">ctratt    : 0</span><br><span class="line">  [5:5] : 0     Predictable Latency Mode Not Supported</span><br><span class="line">  [4:4] : 0     Endurance Groups Not Supported</span><br><span class="line">  [3:3] : 0     Read Recovery Levels Not Supported</span><br><span class="line">  [2:2] : 0     NVM Sets Not Supported</span><br><span class="line">  [1:1] : 0     Non-Operational Power State Permissive Not Supported</span><br><span class="line">  [0:0] : 0     128-bit Host Identifier Not Supported</span><br><span class="line"></span><br><span class="line">rrls      : 0</span><br><span class="line">oacs      : 0x7                    <span class="comment"># Optional Admin Command Support</span></span><br><span class="line">  [8:8] : 0     Doorbell Buffer Config Not Supported</span><br><span class="line">  [7:7] : 0     Virtualization Management Not Supported</span><br><span class="line">  [6:6] : 0     NVMe-MI Send and Receive Not Supported</span><br><span class="line">  [5:5] : 0     Directives Not Supported</span><br><span class="line">  [4:4] : 0     Device Self-<span class="built_in">test</span> Not Supported</span><br><span class="line">  [3:3] : 0     NS Management and Attachment Not Supported</span><br><span class="line">  [2:2] : 0x1   FW Commit and Download Supported</span><br><span class="line">  [1:1] : 0x1   Format NVM Supported</span><br><span class="line">  [0:0] : 0x1   Security Send and Receive Supported</span><br><span class="line"></span><br><span class="line">acl       : 3</span><br><span class="line">aerl      : 3</span><br><span class="line">frmw      : 0x2                    <span class="comment"># firmware update</span></span><br><span class="line">  [4:4] : 0     Firmware Activate Without Reset Not Supported</span><br><span class="line">  [3:1] : 0x1   Number of Firmware Slots</span><br><span class="line">  [0:0] : 0     Firmware Slot 1 Read/Write</span><br><span class="line"></span><br><span class="line">lpa       : 0x2</span><br><span class="line">  [3:3] : 0     Telemetry host/controller initiated <span class="built_in">log</span> page Not Suporrted</span><br><span class="line">  [2:2] : 0     Extended data <span class="keyword">for</span> Get Log Page Not Supported</span><br><span class="line">  [1:1] : 0x1   Command Effects Log Page Supported</span><br><span class="line">  [0:0] : 0     SMART/Health Log Page per NS Not Supported</span><br><span class="line"></span><br><span class="line">elpe      : 63</span><br><span class="line">npss      : 0</span><br><span class="line">avscc     : 0</span><br><span class="line">  [0:0] : 0     Admin Vendor Specific Commands uses Vendor Specific Format</span><br><span class="line"></span><br><span class="line">apsta     : 0</span><br><span class="line">  [0:0] : 0     Autonomous Power State Transitions Not Supported</span><br><span class="line"></span><br><span class="line">wctemp    : 0</span><br><span class="line">cctemp    : 0</span><br><span class="line">mtfa      : 0</span><br><span class="line">hmpre     : 0</span><br><span class="line">hmmin     : 0</span><br><span class="line">tnvmcap   : 0                      <span class="comment"># Total NVM Capacity and it is an optional field. As it is reported as zero, it is not supported.</span></span><br><span class="line">unvmcap   : 0</span><br><span class="line">rpmbs     : 0</span><br><span class="line"> [31:24]: 0     Access Size</span><br><span class="line"> [23:16]: 0     Total Size</span><br><span class="line">  [5:3] : 0     Authentication Method</span><br><span class="line">  [2:0] : 0     Number of RPMB Units</span><br><span class="line"></span><br><span class="line">edstt     : 0</span><br><span class="line">dsto      : 0</span><br><span class="line">fwug      : 0</span><br><span class="line">kas       : 0</span><br><span class="line">hctma     : 0</span><br><span class="line">  [0:0] : 0     Host Controlled Thermal Management Not Supported</span><br><span class="line">mntmt     : 0</span><br><span class="line">mxtmt     : 0</span><br><span class="line">sanicap   : 0</span><br><span class="line">  [2:2] : 0     Overwrite Sanitize Operation Not Supported</span><br><span class="line">  [1:1] : 0     Block Erase Sanitize Operation Not Supported</span><br><span class="line">  [0:0] : 0     Crypto Erase Sanitize Operation Not Supported</span><br><span class="line"></span><br><span class="line">hmminds   : 0</span><br><span class="line">hmmaxd    : 0</span><br><span class="line">nsetidmax : 0</span><br><span class="line">anatt     : 0</span><br><span class="line">anacap    : 0</span><br><span class="line">  [7:7] : 0     Non-zero group ID Not Supported</span><br><span class="line">  [6:6] : 0     Group ID does not change</span><br><span class="line">  [4:4] : 0     ANA Change state Not Supported</span><br><span class="line">  [2:2] : 0     ANA Inaccessible state Not Supported</span><br><span class="line">  [1:1] : 0     ANA Non-optimized state Not Supported</span><br><span class="line">  [0:0] : 0     ANA Optimized state Not Supported</span><br><span class="line"></span><br><span class="line">anagrpmax : 0</span><br><span class="line">nanagrpid : 0</span><br><span class="line">sqes      : 0x66   <span class="comment"># (Maximum and Required) Submission Queue Entry (SQE) Size.</span></span><br><span class="line">                   <span class="comment"># It is expected to be 64 but with proprietary extensions it can be modified. The value is 0x66 here.</span></span><br><span class="line">  [7:4] : 0x6   Max SQ Entry Size (64)</span><br><span class="line">  [3:0] : 0x6   Min SQ Entry Size (64)</span><br><span class="line"></span><br><span class="line">cqes      : 0x44   <span class="comment"># (Maximum and Required) Completion Queue Entry (CQE) Size. Similar to calculation of SQE size,</span></span><br><span class="line">                   <span class="comment"># its value is 0x44 here, so both maximum and required completion queue entry size is 2⁴=16 bytes.</span></span><br><span class="line">  [7:4] : 0x4   Max CQ Entry Size (16)</span><br><span class="line">  [3:0] : 0x4   Min CQ Entry Size (16)</span><br><span class="line"></span><br><span class="line">maxcmd    : 0</span><br><span class="line">nn        : 1      <span class="comment"># (Maximum) Number of Namespaces supported by the controller. Although theoretical maximum is high, here it is 1,</span></span><br><span class="line">                   <span class="comment"># so only one namespace is possible.</span></span><br><span class="line">oncs      : 0x6    <span class="comment"># is Optional NVM Command Support</span></span><br><span class="line">  [7:7] : 0     Virtualization Management Not Supported</span><br><span class="line">  [6:6] : 0     Timestamp Not Supported</span><br><span class="line">  [5:5] : 0     Reservations Not Supported</span><br><span class="line">  [4:4] : 0     Save and Select Not Supported</span><br><span class="line">  [3:3] : 0     Write Zeroes Not Supported</span><br><span class="line">  [2:2] : 0x1   Data Set Management Supported</span><br><span class="line">  [1:1] : 0x1   Write Uncorrectable Supported</span><br><span class="line">  [0:0] : 0     Compare Not Supported</span><br><span class="line"></span><br><span class="line">fuses     : 0</span><br><span class="line">  [0:0] : 0     Fused Compare and Write Not Supported</span><br><span class="line"></span><br><span class="line">fna       : 0x4</span><br><span class="line">  [2:2] : 0x1   Crypto Erase Supported as part of Secure Erase</span><br><span class="line">  [1:1] : 0     Crypto Erase Applies to Single Namespace(s)</span><br><span class="line">  [0:0] : 0     Format Applies to Single Namespace(s)</span><br><span class="line"></span><br><span class="line">vwc       : 0</span><br><span class="line">  [0:0] : 0     Volatile Write Cache Not Present</span><br><span class="line"></span><br><span class="line">awun      : 0</span><br><span class="line">awupf     : 0</span><br><span class="line">nvscc     : 0</span><br><span class="line">  [0:0] : 0     NVM Vendor Specific Commands uses Vendor Specific Format</span><br><span class="line"></span><br><span class="line">nwpc      : 0</span><br><span class="line">  [2:2] : 0     Permanent Write Protect Not Supported</span><br><span class="line">  [1:1] : 0     Write Protect Until Power Supply Not Supported</span><br><span class="line">  [0:0] : 0     No Write Protect and Write Protect Namespace Not Supported</span><br><span class="line"></span><br><span class="line">acwu      : 0</span><br><span class="line">sgls      : 0</span><br><span class="line"> [1:0]  : 0     Scatter-Gather Lists Not Supported</span><br><span class="line"></span><br><span class="line">mnan      : 0</span><br><span class="line">subnqn    :</span><br><span class="line">ioccsz    : 0</span><br><span class="line">iorcsz    : 0</span><br><span class="line">icdoff    : 0</span><br><span class="line">ctrattr   : 0</span><br><span class="line">  [0:0] : 0     Dynamic Controller Model</span><br><span class="line"></span><br><span class="line">msdbd     : 0</span><br><span class="line">ps    0 : mp:18.00W operational enlat:0 exlat:0 rrt:0 rrl:0</span><br><span class="line">          rwt:0 rwl:0 idle_power:- active_power:-</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">vid is PCI Vendor ID (so Samsung <span class="keyword">in</span> this <span class="keyword">case</span>), 0x144d as <span class="keyword">in</span> the lspci output.</span><br><span class="line">ssvid is PCI Subsystem Vendor ID.</span><br><span class="line">SN is Serial Number, MN is Model Number, FR is Firmware Revision.</span><br><span class="line"></span><br><span class="line">cmic is Controller Multi-Path I/O and Namespace Sharing Capabilities.</span><br><span class="line">Bit 2 = 0: Controller is associated with a PCI Function not SR-IOV.</span><br><span class="line">Bit 1 = 0: Controller can only be connected to a single host.</span><br><span class="line">Bit 0 = 0: Controller contains only a single NVM port.</span><br><span class="line">These basically mean there is no Multi-Path I/O and Namespace Sharing support on this controller.</span><br><span class="line"></span><br><span class="line">mdts is Maximum Data Transfer Size. It is reported as a power of two and <span class="keyword">in</span> units of minimum memory page size. mdts=5 here, so 2⁵ = 32. We will see the minimum memory page size (MPSMIN) as 4K below. So MDTS is 32 * 4K = 128K.</span><br><span class="line"></span><br><span class="line">oacs is Optional Admin Command Support.</span><br><span class="line">Bit 5, 4, 3 = 0: Directives, Device Self-<span class="built_in">test</span>, NVMe-MI Send, NVMe-MI Receive and Namespace Management and Attachment commands not supported.</span><br><span class="line">Bit 2, 1, 0 =1: Firmware Commit and Firmware Image Download, Format NVM, Security Send and Receive commands are supported.</span><br><span class="line"></span><br><span class="line">rmw is Firmware Updates.</span><br><span class="line">Bit 4 = 0: A reset is required to activate a firmware.</span><br><span class="line">Bit 3:1 = 3: There are 3 firmware slots.</span><br><span class="line">Bit 0 = 0: Firmware Slot 1 is <span class="built_in">read</span>/write.</span><br><span class="line"></span><br><span class="line">tnvmcap is Total NVM Capacity and it is an optional field. As it is reported as zero, it is not supported.</span><br><span class="line"></span><br><span class="line">sqes is (Maximum and Required) Submission Queue Entry (SQE) Size. It is expected to be 64 but with proprietary extensions it can be modified. The value is 0x66 here.</span><br><span class="line">Bits 7:4 = 6, indicates the maximum entry size as a power of two, so it is 2⁶ = 64 bytes.</span><br><span class="line">Bits 3:0 = 6, indicates the required entry size as a power of two, so it is 2⁶ = 64 bytes.</span><br><span class="line"></span><br><span class="line">cqes is (Maximum and Required) Completion Queue Entry (CQE) Size. Similar to calculation of SQE size, its value is 0x44 here, so both maximum and required completion queue entry size is 2⁴=16 bytes.</span><br><span class="line">nn is (Maximum) Number of Namespaces supported by the controller. Although theoretical maximum is high, here it is 1, so only one namespace is possible.</span><br><span class="line"></span><br><span class="line">oncs is Optional NVM Command Support.</span><br><span class="line">Bits 6:5 = 0: Timestamp feature and Reservation commands are not supported.</span><br><span class="line">Bits 4:0 = 1: Save and Select, Write Zeroes, Dataset Management, Write Uncorrectable and Compare commands are supported.</span><br><span class="line">fna is Format NVM Attributes.</span><br><span class="line">Bit 2 = 0: Cryptographic erase is not supported.</span><br><span class="line">Bit 1 = 0: Crytographic erase (<span class="keyword">if</span> supported) applies to single namespace.</span><br><span class="line">Bit 0 = 0: Format applies to single namespace.</span><br><span class="line"></span><br><span class="line">https://metebalci.com/blog/a-quick-tour-of-nvm-express-nvme/</span><br></pre></td></tr></table></figure>

<p>sending Identify List Namespaces   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ nvme list-ns /dev/nvme0 <span class="string">&quot;</span></span><br><span class="line"><span class="string">[   0]:0x1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#optane</span></span><br><span class="line"><span class="string">$ nvme list-ns /dev/nvme0</span></span><br><span class="line"><span class="string">NVMe Status:INVALID_NS: The namespace or the format of that namespace is invalid(400b) NSID:0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ nvme id-ns /dev/nvme0 --namespace-id=0x1</span></span><br><span class="line"><span class="string">NVME Identify Namespace 1:</span></span><br><span class="line"><span class="string">nsze    : 0x5754b9a  # Namespace Size (NSZE). Indicates the number of logical blocks, 0x5754b9a = 91573146</span></span><br><span class="line"><span class="string">                     # lsblk -b show nvme0n1     259:0    0  375083606016  0 disk    91573146*4096=375083606016</span></span><br><span class="line"><span class="string">ncap    : 0x5754b9a  # The maximum number of logical blocks allocated to the namespace.</span></span><br><span class="line"><span class="string">                     # If there is a thin provisioning (if disk space is allocated on demand),</span></span><br><span class="line"><span class="string">                     # this value can be less than NSZE. Here, it is not the case so its value is same as NSZE.</span></span><br><span class="line"><span class="string">nuse    : 0x5754b9aa # nuse, Namespace Utilization (NUSE). The current number of logical blocks allocated to the namespace.</span></span><br><span class="line"><span class="string">                     # If there is a thin provisioning (if disk space is allocated on demand), this value can be less than NSZE.</span></span><br><span class="line"><span class="string">                     # Here, it is not the case so its value is same as NSZE.</span></span><br><span class="line"><span class="string">nsfeat  : 0          #  Namespace Features (NSFEAT)</span></span><br><span class="line"><span class="string">                     # Bit 3 = 0, NGUID and EUI64 values may be reused by the controller after this namespace is deleted.</span></span><br><span class="line"><span class="string">                     # Bit 2 = 0, the controller does not support the Deallocated or Unwritten Logical Block error.</span></span><br><span class="line"><span class="string">                     # Bit 1 = 0, AWUN, AWUPF and ACWU fields should be used instead of NAWUN, NAWUPF, NACWU.</span></span><br><span class="line"><span class="string">                     # Bit 0 = 0, meaning the namespace does not support Thin Provisioning.</span></span><br><span class="line"><span class="string">nlbaf   : 6          # Number of LBA Formats (NLBAF). Indicates the number of supported LBA data size and metadata size</span></span><br><span class="line"><span class="string">                     # combinations supported by the namespace.</span></span><br><span class="line"><span class="string">                     # If It is a zero based value and its value here is 0, so there is only 1 format supported.</span></span><br><span class="line"><span class="string">flbas   : 0x3        # Formatted LBA Size (FLBAS). Indicates the LBA data size and metadata size combination</span></span><br><span class="line"><span class="string">                     # Bits 3:0 indicates one of the 16 supported LBA Formats indicated in this data structure.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     #LBA Format fields:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     #ms, Metadata Size (MS). Since its value is 0, metadata is not supported.</span></span><br><span class="line"><span class="string">                     #ds, LBA Data Size (LBADS). It is reported in terms of a power of two, so LBA data size is 2⁹ = 512 bytes.</span></span><br><span class="line"><span class="string">                     #rp, Releative Performance (RP). Indicates the relative performance of this format to other formats.</span></span><br><span class="line"><span class="string">                     # Value of 0 indicates it is the best performance.</span></span><br><span class="line"><span class="string">                     # It does not make much sense here because we have only one LBA Format supported.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mc      : 0x1</span></span><br><span class="line"><span class="string">dpc     : 0x11</span></span><br><span class="line"><span class="string">dps     : 0          # End-to-end Data Protection Type Settings (DPS), T10 PI</span></span><br><span class="line"><span class="string">                     # Bit 3 if set to ‘1’ indicates that the protection information,</span></span><br><span class="line"><span class="string">                     # if enabled, is transferred as the first eight bytes of metadata.</span></span><br><span class="line"><span class="string">                     # Bit 3 if cleared to ‘0’ indicates that the protection information,</span></span><br><span class="line"><span class="string">                     # if enabled, is transferred as the last eight bytes of metadata.</span></span><br><span class="line"><span class="string">                     # 000b Protection information is not enabled</span></span><br><span class="line"><span class="string">                     # 001b Protection information is enabled, Type 1</span></span><br><span class="line"><span class="string">                     # 010b Protection information is enabled, Type 2</span></span><br><span class="line"><span class="string">                     # 011b Protection information is enabled, Type 3</span></span><br><span class="line"><span class="string">                     # 100b – 111b Reserved</span></span><br><span class="line"><span class="string">nmic    : 0</span></span><br><span class="line"><span class="string">rescap  : 0</span></span><br><span class="line"><span class="string">fpi     : 0</span></span><br><span class="line"><span class="string">dlfeat  : 0</span></span><br><span class="line"><span class="string">nawun   : 0</span></span><br><span class="line"><span class="string">nawupf  : 0</span></span><br><span class="line"><span class="string">nacwu   : 0</span></span><br><span class="line"><span class="string">nabsn   : 0</span></span><br><span class="line"><span class="string">nabo    : 0</span></span><br><span class="line"><span class="string">nabspf  : 0</span></span><br><span class="line"><span class="string">noiob   : 0</span></span><br><span class="line"><span class="string">nvmcap  : 0</span></span><br><span class="line"><span class="string">nsattr  : 0</span></span><br><span class="line"><span class="string">nvmsetid: 0</span></span><br><span class="line"><span class="string">anagrpid: 0</span></span><br><span class="line"><span class="string">endgid  : 0</span></span><br><span class="line"><span class="string">nguid   : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">eui64   : 5cd2e4e419330100</span></span><br><span class="line"><span class="string">lbaf  0 : ms:0   lbads:9  rp:0x2</span></span><br><span class="line"><span class="string">lbaf  1 : ms:8   lbads:9  rp:0x2</span></span><br><span class="line"><span class="string">lbaf  2 : ms:16  lbads:9  rp:0x2</span></span><br><span class="line"><span class="string">lbaf  3 : ms:0   lbads:12 rp:0 (in use)</span></span><br><span class="line"><span class="string">lbaf  4 : ms:8   lbads:12 rp:0</span></span><br><span class="line"><span class="string">lbaf  5 : ms:64  lbads:12 rp:0</span></span><br><span class="line"><span class="string">lbaf  6 : ms:128 lbads:12 rp:0</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://nvmexpress.org/wp-content/uploads/NVM_Express_Revision_1.3.pdf">nvme_express_revision</a><br>nvme admin command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">VMe Admin Commands</span><br><span class="line">Here are the NVMe admin commands with opcodes:</span><br><span class="line">Create and Delete I/O Submission Queue (01h, 00h)</span><br><span class="line">Get Log Page (02h)</span><br><span class="line">Create and Delete I/O Completion Queue (05h, 04h)</span><br><span class="line">Identify (06h)</span><br><span class="line">Abort (08h)</span><br><span class="line">Get and Set Features (0Ah, 09h)</span><br><span class="line">Asynchronous Event Request (0Ch)</span><br><span class="line">Namespace Management (0Dh)</span><br><span class="line">Firmware Commit and Image Download (10h, 11h)</span><br><span class="line">Device Self-<span class="built_in">test</span> (14h)</span><br><span class="line">Namespace Attachment (15h)</span><br><span class="line">Keep Alive (18h)</span><br><span class="line">Directive Send and Receive (19h, 1Ah)</span><br><span class="line">Virtualization Management (1Ch)</span><br><span class="line">NVMe-MI Send and Receive (1Dh, 1Eh)</span><br><span class="line">Doorbell Buffer Config (7Ch)</span><br><span class="line">Format NVM (80h)</span><br><span class="line">Security Send and Receive (81h, 82h)</span><br><span class="line">Sanitize (84h)</span><br><span class="line"></span><br><span class="line">$ nvme admin-passthru /dev/nvme0 --opcode=0x06 --cdw10=0x0001 --data-len=4096 -r -d -s</span><br><span class="line">opcode       : 06</span><br><span class="line">flags        : 00</span><br><span class="line">rsvd1        : 0000</span><br><span class="line">nsid         : 00000000</span><br><span class="line">cdw2         : 00000000</span><br><span class="line">cdw3         : 00000000</span><br><span class="line">data_len     : 00001000</span><br><span class="line">metadata_len : 00000000</span><br><span class="line">addr         : 563223139000</span><br><span class="line">metadata     : 0</span><br><span class="line">cdw10        : 00000001</span><br><span class="line">cdw11        : 00000000</span><br><span class="line">cdw12        : 00000000</span><br><span class="line">cdw13        : 00000000</span><br><span class="line">cdw14        : 00000000</span><br><span class="line">cdw15        : 00000000</span><br><span class="line">timeout_ms   : 00000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># NVM command</span></span><br><span class="line"><span class="comment"># NVM comands should only be sent if controller is ready (indicated by Controller Status register CSTS.RDY) and after I/O submission and completion queue have been created.</span></span><br><span class="line">Flush (00h)</span><br><span class="line">Write and Read (01h, 02h)</span><br><span class="line">Write Uncorrectable (04h)</span><br><span class="line">Compare (05h)</span><br><span class="line">Write Zeroes (08h)</span><br><span class="line">Dataset Management (09h)</span><br><span class="line">Reservation Register and Report (0Dh, 0Eh)</span><br><span class="line">Reservation Acquire and Release (11h, 15h)</span><br><span class="line"></span><br><span class="line">$ nvme show-regs -H /dev/nvme0</span><br><span class="line"><span class="built_in">cap</span>     : 2004010fff</span><br><span class="line">        Memory Page Size Maximum      (MPSMAX): 4096 bytes</span><br><span class="line">        Memory Page Size Minimum      (MPSMIN): 4096 bytes</span><br><span class="line">        Boot Partition Support           (BPS): No</span><br><span class="line">        Command Sets Supported           (CSS): NVM <span class="built_in">command</span> <span class="built_in">set</span> is supported</span><br><span class="line">        NVM Subsystem Reset Supported  (NSSRS): No &lt;---------------------------not support NSSRS</span><br><span class="line">        Doorbell Stride                (DSTRD): 4 bytes</span><br><span class="line">        Timeout                           (TO): 2000 ms</span><br><span class="line">        Arbitration Mechanism Supported  (AMS): Weighted Round Robin with Urgent Priority Class is not supported</span><br><span class="line">        Contiguous Queues Required       (CQR): Yes</span><br><span class="line">        Maximum Queue Entries Supported (MQES): 4096  <span class="comment">### Bytes</span></span><br><span class="line"></span><br><span class="line">version : 10000</span><br><span class="line">        NVMe specification 1.0</span><br><span class="line"></span><br><span class="line">cc      : 460001</span><br><span class="line">        I/O Completion Queue Entry Size (IOCQES): 16 bytes</span><br><span class="line">        I/O Submission Queue Entry Size (IOSQES): 64 bytes</span><br><span class="line">        Shutdown Notification              (SHN): No notification; no effect</span><br><span class="line">        Arbitration Mechanism Selected     (AMS): Round Robin</span><br><span class="line">        Memory Page Size                   (MPS): 4096 bytes</span><br><span class="line">        I/O Command Sets Selected          (CSS): NVM Command Set</span><br><span class="line">        Enable                              (EN): Yes</span><br><span class="line"></span><br><span class="line">csts    : 1</span><br><span class="line">        Processing Paused               (PP): No</span><br><span class="line">        NVM Subsystem Reset Occurred (NSSRO): No</span><br><span class="line">        Shutdown Status               (SHST): Normal operation (no shutdown has been requested)</span><br><span class="line">        Controller Fatal Status        (CFS): False</span><br><span class="line">        Ready                          (RDY): Yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># linux nvme driver, check the nvme_disable_ctrl and nvme_disable_dev function   </span></span><br><span class="line">If the PCC bit is 0 (enabled) without NVMe disk, when the NVMe disk is Hot-Added <span class="keyword">for</span> the first time, the specific OS driver may detect the PRSNT<span class="comment"># state change, then it will trigger PCC bit inverted so power off the slot. PCC control will match with later HotAdd/Hot-Remove steps from driver.</span></span><br><span class="line">Workaround:</span><br><span class="line">BIOS will <span class="built_in">set</span> the appropriate PCC bit as 0 (Power on) <span class="keyword">if</span> it detects PCIe card present, and <span class="built_in">set</span> it as 1 (Power Off) <span class="keyword">if</span> no PCIe card present <span class="keyword">in</span> a slot during power on.</span><br><span class="line"></span><br><span class="line">When the system is being shut down or hibernated, StorNVMe sets the device’s Shutdown Notification (CC.SHN) field to 1. StorNVMe <span class="keyword">then</span> waits <span class="keyword">for</span> the device’s reported RTD3 entry latency <span class="keyword">for</span> the device to indicate it is ready (by updating the Shutdown Status (CSTS.SHST) field to 2)</span><br><span class="line"></span><br><span class="line">The host should <span class="built_in">set</span> the Shutdown Notification (CC.SHN) field to 01b to indicate a normal shutdown operation. The controller indicates when shutdown processing is completed by updating the Shutdown Status (CSTS.SHST) field to 10b.</span><br><span class="line"></span><br><span class="line">nssr    : 0</span><br><span class="line">        NVM Subsystem Reset Control (NSSRC): 0</span><br><span class="line"></span><br><span class="line">intms   : 0</span><br><span class="line">        Interrupt Vector Mask Set (IVMS): 0</span><br><span class="line"></span><br><span class="line">intmc   : 0</span><br><span class="line">        Interrupt Vector Mask Clear (IVMC): 0</span><br><span class="line">aqa     : 1f001f</span><br><span class="line">        Admin Completion Queue Size (ACQS): 32</span><br><span class="line">        Admin Submission Queue Size (ASQS): 32</span><br><span class="line"></span><br><span class="line">asq     : 10255f9000</span><br><span class="line">        Admin Submission Queue Base (ASQB): 10255f9000</span><br><span class="line"></span><br><span class="line">acq     : 10255f8000</span><br><span class="line">        Admin Completion Queue Base (ACQB): 10255f8000</span><br><span class="line"></span><br><span class="line">cmbloc  : 0</span><br><span class="line">        Controller Memory Buffer feature is not supported</span><br><span class="line"></span><br><span class="line">cmbsz   : 0</span><br><span class="line">        Controller Memory Buffer feature is not supported</span><br><span class="line"></span><br><span class="line">bpinfo  : 0</span><br><span class="line">        Boot Partition feature is not supported</span><br><span class="line"></span><br><span class="line">bprsel  : 0</span><br><span class="line">        Boot Partition feature is not supported</span><br><span class="line"></span><br><span class="line">bpmbl   : 0</span><br><span class="line">        Boot Partition feature is not supported</span><br></pre></td></tr></table></figure>

<h3 id="NVME-power-save-cause-controller-reset"><a href="#NVME-power-save-cause-controller-reset" class="headerlink" title="NVME power save cause controller reset"></a><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Solid_state_drive/NVMe">NVME power save cause controller reset</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ nvme get-feature /dev/nvme0 -f 0x0c -H</span><br><span class="line">get-feature:0xc (Autonomous Power State Transition), Current value:0x000001</span><br><span class="line">        Autonomous Power State Transition Enable (APSTE): Enabled</span><br><span class="line">        Auto PST Entries        .................</span><br><span class="line"></span><br><span class="line">$ modinfo nvme_core</span><br><span class="line">filename:       /lib/modules/3.10.0-1062.9.1.el7_lustre.x86_64/kernel/drivers/nvme/host/nvme-core.ko.xz</span><br><span class="line">version:        1.0</span><br><span class="line">license:        GPL</span><br><span class="line">retpoline:      Y</span><br><span class="line">rhelversion:    7.7</span><br><span class="line">srcversion:     6EA4D58A56BBBDF984F2765</span><br><span class="line">depends:</span><br><span class="line">intree:         Y</span><br><span class="line">vermagic:       3.10.0-1062.9.1.el7_lustre.x86_64 SMP mod_unload modversions</span><br><span class="line">signer:         CentOS Linux kernel signing key</span><br><span class="line">sig_key:        49:99:79:DA:C1:E0:E4:9A:85:3A:4A:6C:50:DD:78:73:02:5A:28:24</span><br><span class="line">sig_hashalgo:   sha256</span><br><span class="line">parm:           admin_timeout:<span class="built_in">timeout</span> <span class="keyword">in</span> seconds <span class="keyword">for</span> admin commands (uint)</span><br><span class="line">parm:           io_timeout:<span class="built_in">timeout</span> <span class="keyword">in</span> seconds <span class="keyword">for</span> I/O (uint)</span><br><span class="line">parm:           shutdown_timeout:<span class="built_in">timeout</span> <span class="keyword">in</span> seconds <span class="keyword">for</span> controller shutdown (byte)</span><br><span class="line">parm:           max_retries:max number of retries a <span class="built_in">command</span> may have (byte)</span><br><span class="line">parm:           default_ps_max_latency_us:max power saving latency <span class="keyword">for</span> new devices; use PM QOS to change per device (ulong)</span><br><span class="line">parm:           force_apst:allow APST <span class="keyword">for</span> newly enumerated devices even <span class="keyword">if</span> quirked off (bool)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /sys/module/nvme_core/parameters/default_ps_max_latency_us</span><br><span class="line">100000</span><br><span class="line">$ <span class="built_in">cat</span> /sys/module/nvme_core/parameters/force_apst</span><br><span class="line">N</span><br><span class="line">$ <span class="built_in">cat</span> /sys/module/nvme_core/parameters/io_timeout</span><br><span class="line">30</span><br><span class="line">$ <span class="built_in">cat</span> /sys/module/nvme_core/parameters/shutdown_timeout</span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<p>When APST is enabled the output should contain “Autonomous Power State Transition Enable (APSTE): Enabled” and there should be non-zero entries in the table below indicating the idle time before transitioning into each of the available states.</p>
<p>If APST is enabled but no non-zero states appear in the table, the latencies might be too high for any states to be enabled by default. The output of nvme id-ctrl &#x2F;dev&#x2F;nvme[0-9] (as the root user) should show the available non-operational power states of the NVME controller. If the total latency of any state (enlat + xlat) is greater than 25000 (25ms) you must pass a value at least that high as parameter default_ps_max_latency_us for the nvme_core kernel module. This should enable APST and make the table in nvme get-feature (as the root user) show the entries.</p>
<p><a target="_blank" rel="noopener" href="https://tekbyte.net/2020/fixing-nvme-ssd-problems-on-linux/">The issue same with me</a><br>nvme_core.default_ps_max_latency_us&#x3D;0 means disable or increase the value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># low power</span><br><span class="line">$ nvme set-feature /dev/nvme0 -f 2 -v 2</span><br><span class="line"></span><br><span class="line"># normal power</span><br><span class="line">$ nvme set-feature /dev/nvme0 -f 2 -v 1</span><br><span class="line"></span><br><span class="line"># performance mode</span><br><span class="line">$  nvme set-features /dev/nvme0 -f 2 -v 0</span><br></pre></td></tr></table></figure>

<h3 id="Read-data-from-the-device"><a href="#Read-data-from-the-device" class="headerlink" title="Read data from the device"></a>Read data from the device</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/nvme0n1 of=lba.0.dd bs=512 count=1</span><br><span class="line">$ nvme <span class="built_in">read</span> /dev/nvme0n1 --start-block=0 --block-count=0 --data-size=512 --data=lba.0.read</span><br><span class="line">$ nvme io-passthru /dev/nvme0 --opcode=0x02 --namespace-id=0x1 --data-len=512 --<span class="built_in">read</span> --cdw10=0 --cdw11=0 --cdw12=0 -b &gt; lba.0.io</span><br><span class="line">nvme: malloc.c:2392: sysmalloc: Assertion `(old_top == initial_top (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize - <span class="number">1</span>)) == 0)<span class="string">&#x27; failed.</span></span><br><span class="line"><span class="string">Aborted (core dumped)</span></span><br></pre></td></tr></table></figure>

<h3 id="connect-and-disconnect"><a href="#connect-and-disconnect" class="headerlink" title="connect and disconnect"></a>connect and disconnect</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ nvme list | <span class="built_in">cut</span> -d <span class="string">&#x27; &#x27;</span> -f 1</span><br><span class="line">$ nvme disconnect -d /dev/nvme0n1</span><br><span class="line">$ nvme discover</span><br><span class="line">$ nvme connect-all</span><br></pre></td></tr></table></figure>

<h3 id="read-and-write"><a href="#read-and-write" class="headerlink" title="read and write"></a>read and write</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/linux-nvme/nvme-cli/issues/223<span class="comment">#issuecomment-324942849</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> | nvme write /dev/nvme0n1 --data-size=520 --prinfo=1</span><br><span class="line">write: Success</span><br><span class="line">$ nvme <span class="built_in">read</span> /dev/nvme0n1 --data-size=520 --prinfo=1</span><br><span class="line">hello world</span><br><span class="line"><span class="built_in">read</span>: Success</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#dump info</span></span><br><span class="line">$ nvme write /dev/nvme0n1  -s 0 -c 10 -z 40960 -d test.nvme0</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify binary file by vim and import</span></span><br><span class="line">https://github.com/acidanthera/bugtracker/issues/732</span><br><span class="line">eg:</span><br><span class="line">Find: 31 F6 FF 90 E8 08 00 00 4C 8D 35 57 30 02 00</span><br><span class="line">Replace: B0 01 FF 90 E8 08 00 00 4C 8D 35 57 30 02 00 </span><br><span class="line"></span><br><span class="line"><span class="comment">#make sure with the nvme device spec !!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#import info</span></span><br><span class="line">$ nvme <span class="built_in">read</span>  /dev/nvme0n1 -s 0 -c 10 -z 40960 -d test.nvme0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://access.redhat.com/solutions/6685321</span><br><span class="line">eg:</span><br><span class="line">If the PCC bit is 0 (enabled) without NVMe disk, when the NVMe disk is Hot-Added <span class="keyword">for</span> the first time, the specific OS driver may detect the PRSNT<span class="comment"># state change, then it will trigger PCC bit inverted so power off the slot. PCC control will match with later HotAdd/Hot-Remove steps from driver.</span></span><br><span class="line">Workaround: BIOS will <span class="built_in">set</span> the appropriate PCC bit as 0 (Power on) <span class="keyword">if</span> it detects PCIe card present, and <span class="built_in">set</span> it as 1 (Power Off) <span class="keyword">if</span> no PCIe card present <span class="keyword">in</span> a slot during power on.</span><br><span class="line"></span><br><span class="line">looks like the nvme write could modify the PCC bit too.</span><br></pre></td></tr></table></figure>

<h3 id="self-test"><a href="#self-test" class="headerlink" title="self test"></a><a target="_blank" rel="noopener" href="https://nvmexpress.org/open-source-nvme-ssd-management-utility-nvme-command-line-interface-nvme-cli/">self test</a></h3><ul>
<li>RAM Check 1</li>
<li>SMART Check 2</li>
<li>Volatile memory backup 3</li>
<li>Metadata validation 4</li>
<li>NVM integrity 5</li>
<li>Data Integrity 6</li>
<li>Media Check 7</li>
<li>Drive Life 8</li>
<li>SMART Check 9</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nvme device-self-test -s 1 /dev/nvme2n1</span><br><span class="line">$ nvme error-log /dev/nvme2n1</span><br></pre></td></tr></table></figure>

<h3 id="upgrade-firmware"><a href="#upgrade-firmware" class="headerlink" title="upgrade firmware"></a>upgrade firmware</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ nvme fw-download -f vendorfirmware.bin /dev/nvme0n1</span><br><span class="line"></span><br><span class="line">0: Downloaded image replaces the image indicated by the Firmware Slot field. This image is not activated.</span><br><span class="line">1: Downloaded image replaces the image indicated by the Firmware Slot field. This image is activated at the next reset.</span><br><span class="line">2: The image indicated by the Firmware Slot field is activated at the next reset.</span><br><span class="line">3: The image specified by the Firmware Slot field is requested to be activated immediately without reset</span><br><span class="line"></span><br><span class="line">$ nvme fw-commit -s 0 -a 3 /dev/nvme0n1</span><br></pre></td></tr></table></figure>

<h3 id="detach-namespaces"><a href="#detach-namespaces" class="headerlink" title="detach namespaces"></a><a target="_blank" rel="noopener" href="https://nvmexpress.org/open-source-nvme-ssd-management-utility-nvme-command-line-interface-nvme-cli/">detach namespaces</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Steps to overprovision using NVMe cli, per namespace:</span><br><span class="line">Detach all namespaces from each controller (spec recommends detaching first but delete also works).</span><br><span class="line">$ nvme detach-ns /dev/nvme0 –namespace-id=1 –controllers=0</span><br><span class="line"></span><br><span class="line">Delete each namespace you’ve detached.</span><br><span class="line">$ nvme delete-ns /dev/nvme0 –namespace-id=1</span><br><span class="line"></span><br><span class="line">Create a new namespace at the desired capacity (repeat for each namespace). This example is going from 3.84TB to 3.2TB. This is used to take a 1 DWPD drive and turn it into a 3 DWPD drive with overprovisoning.</span><br><span class="line">$ nvme create-ns /dev/nvme0 –nsze-si 3.2T –ncap 3.2T –flbas 0 –dps 0 –nmic 0</span><br><span class="line"></span><br><span class="line">Attach new namespaces to desired controllers.</span><br><span class="line">$ nvme attach-ns /dev/nvme0 –namespace-id=1 –controllers=0</span><br><span class="line"></span><br><span class="line">Reset device to make the target visible to the host.</span><br><span class="line">$ nvme reset /dev/nvme0</span><br></pre></td></tr></table></figure>

<h3 id="power-off-power-on-the-nvme-ctrl-in-the-linux-nvme-driver"><a href="#power-off-power-on-the-nvme-ctrl-in-the-linux-nvme-driver" class="headerlink" title="power off &#x2F; power on the nvme ctrl in the linux nvme driver"></a><a target="_blank" rel="noopener" href="https://elixir.free-electrons.com/linux/v6.4.11/source/drivers/nvme/host/core.c#L493">power off &#x2F; power on the nvme ctrl in the linux nvme driver</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">nvme protocol</span><br><span class="line">To shutdown the controller, the host should <span class="built_in">set</span> the Shutdown Notification (CC.SHN) field to 01b to indicate a normal shutdown operation using the Property Set <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">https://pynvme.readthedocs.io/en/latest/install.html</span><br><span class="line">https://pynvme.readthedocs.io/en/latest/api.html</span><br><span class="line">https://github.com/pynvme/pynvme/blob/master/driver_test.py </span><br><span class="line">https://raw.githubusercontent.com/cranechu/pynvme/master/doc/_static/pynvme_builds_your_own_tests.pdf</span><br><span class="line"></span><br><span class="line">import pynvme as d &lt;---crash <span class="keyword">in</span> my <span class="built_in">test</span> <span class="built_in">env</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the NVMe device name</span></span><br><span class="line">nvme0 = d.Controller(d.Pcie(<span class="string">&quot;01:00.0&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Power off the NVMe device</span></span><br><span class="line">nvme0.shutdown_notify()</span><br><span class="line">nvme0.poweroff()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sleep for 15 seconds</span></span><br><span class="line">time.sleep(15)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Power on the NVMe device</span></span><br><span class="line">nvme0.poweron()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://elixir.free-electrons.com/linux/v6.4.11/source/drivers/nvme/host/nvme.h<span class="comment">#L226</span></span><br><span class="line">/*</span><br><span class="line"> * enum nvme_ctrl_state: Controller state</span><br><span class="line"> *</span><br><span class="line"> * @NVME_CTRL_NEW:		New controller just allocated, initial state</span><br><span class="line"> * @NVME_CTRL_LIVE:		Controller is connected and I/O capable</span><br><span class="line"> * @NVME_CTRL_RESETTING:	Controller is resetting (or scheduled reset)</span><br><span class="line"> * @NVME_CTRL_CONNECTING:	Controller is disconnected, now connecting the</span><br><span class="line"> *				transport</span><br><span class="line"> * @NVME_CTRL_DELETING:		Controller is deleting (or scheduled deletion)</span><br><span class="line"> * @NVME_CTRL_DELETING_NOIO:	Controller is deleting and I/O is not</span><br><span class="line"> *				disabled/failed immediately. This state comes</span><br><span class="line"> * 				after all async event processing took place and</span><br><span class="line"> * 				before ns removal and the controller deletion</span><br><span class="line"> * 				progress</span><br><span class="line"> * @NVME_CTRL_DEAD:		Controller is non-present/unresponsive during  &lt;---------Dead is not stop, just no connection, it deps the <span class="keyword">function</span> of the nvme device</span><br><span class="line"> *				shutdown or removal. In this <span class="keyword">case</span> we forcibly</span><br><span class="line"> *				<span class="built_in">kill</span> all inflight I/O as they have no chance to</span><br><span class="line"> *				complete</span><br><span class="line"> */</span><br><span class="line">enum nvme_ctrl_state &#123;</span><br><span class="line">	NVME_CTRL_NEW,</span><br><span class="line">	NVME_CTRL_LIVE,</span><br><span class="line">	NVME_CTRL_RESETTING,</span><br><span class="line">	NVME_CTRL_CONNECTING,</span><br><span class="line">	NVME_CTRL_DELETING,</span><br><span class="line">	NVME_CTRL_DELETING_NOIO,</span><br><span class="line">	NVME_CTRL_DEAD,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="nvme-over-fabrics"><a href="#nvme-over-fabrics" class="headerlink" title="nvme over fabrics"></a><a target="_blank" rel="noopener" href="https://www.snia.org/sites/default/files/SDCEMEA/2020/NVMe-oF%20Management%20v2.pdf">nvme over fabrics</a></h3><h4 id="why"><a href="#why" class="headerlink" title="why"></a>why</h4><ul>
<li>Multi-queue model</li>
<li>Multipathing capabilities built-in</li>
<li>Same Architecture regardless of transport</li>
<li>Extends efficiencies across fabric</li>
<li>Efficient sharing</li>
<li>Workload migration support</li>
<li>Better capacity utilization</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ modprobe rdma_ucm; modprobe nvme-tcp; modprobe nvme-rdma</span><br><span class="line">nvme_rdma              45056  0</span><br><span class="line">nvme_tcp               36864  0</span><br><span class="line">nvme_fabrics           24576  2 nvme_tcp,nvme_rdma &lt;------module loading</span><br><span class="line">rdma_ucm               32768  0</span><br><span class="line">rdma_cm               118784  3 ko2iblnd,nvme_rdma,rdma_ucm</span><br><span class="line">iw_cm                  53248  1 rdma_cm</span><br><span class="line">ib_cm                 118784  2 rdma_cm,ib_ipoib</span><br><span class="line">ib_uverbs             155648  2 rdma_ucm,mlx5_ib</span><br><span class="line">ib_core               442368  10 rdma_cm,ib_ipoib,ko2iblnd,nvme_rdma,iw_cm,ib_umad,rdma_ucm,ib_uverbs,mlx5_ib,ib_cm</span><br><span class="line">nvme                   53248  36</span><br><span class="line">nvme_core             126976  41 nvme_tcp,nvme,nvme_rdma,nvme_fabrics &lt;------module loading</span><br><span class="line">t10_pi                 16384  1 nvme_core</span><br><span class="line">mlx_compat             16384  17 rdma_cm,ib_ipoib,mlxdevm,ko2iblnd,nvme_tcp,nvme,nvme_rdma,iw_cm,nvme_core,nvme_fabrics,ib_umad,ib_core,rdma_ucm,ib_uverbs,mlx5_ib,ib_cm,mlx5_core</span><br><span class="line"></span><br><span class="line"><span class="comment"># nvme-show-hostnqn - Show the host NQN configured for the system</span></span><br><span class="line"></span><br><span class="line">Disconnect the controller nvme4</span><br><span class="line"><span class="comment"># nvme disconnect --nqn=nqn.2014-08.com.example:nvme:nvm-subsystem-sn-d78432</span></span><br><span class="line">or</span><br><span class="line"><span class="comment"># nvme disconnect --device=nvme4</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://bugzilla.kernel.org/show_bug.cgi?id=196325">debug</a><br><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Solid_state_drive/NVMe#Troubleshooting">NVMe_Troubleshooting</a><br>becareful the “nvme_core.default_ps_max_latency_us&#x3D;0”   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[  175.090115] nvme nvme0: I/O 18 QID 0 <span class="built_in">timeout</span>, <span class="built_in">disable</span> controller</span><br><span class="line">[  175.213259] nvme nvme0: failed to <span class="built_in">set</span> APST feature (-4)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> “qid == 0” &gt; /sys/kernel/debug/tracing/events/nvme/filter</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/events/nvme/enable</span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/debug/tracing/trace</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_storage_devices/configuring-nvme-over-fabrics-using-nvme-rdma_managing-storage-devices#doc-wrapper">Configuring NVMe over fabrics using NVMe&#x2F;RDMA</a><br>test under AlmaLinux 8.8<br>Has development mlnxofed-docs-5.8-3.0.7.0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">$ modprobe nvmet-rdma</span><br><span class="line">$ <span class="built_in">mkdir</span> /sys/kernel/config/nvmet/subsystems/testnqn</span><br><span class="line">$ <span class="built_in">cd</span> /sys/kernel/config/nvmet/subsystems/testnqn</span><br><span class="line"></span><br><span class="line"><span class="comment">#Allow any host to connect to this controller:</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; attr_allow_any_host</span><br><span class="line"></span><br><span class="line"><span class="comment">#Configure a namespace:</span></span><br><span class="line">$ <span class="built_in">mkdir</span> namespaces/10</span><br><span class="line">$ <span class="built_in">cd</span> namespaces/10</span><br><span class="line"></span><br><span class="line"><span class="comment">#Set a path to the NVMe device:</span></span><br><span class="line">$ <span class="built_in">echo</span> -n /dev/nvme2n1 &gt; device_path</span><br><span class="line"><span class="comment">#Enable the namespace:</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Create a directory with an NVMe port:</span></span><br><span class="line">$ <span class="built_in">mkdir</span> /sys/kernel/config/nvmet/ports/1</span><br><span class="line">$ <span class="built_in">cd</span> /sys/kernel/config/nvmet/ports/1</span><br><span class="line"></span><br><span class="line">$ ibdev2netdev </span><br><span class="line">mlx5_0 port 1 ==&gt; ens1np0 (Up) &lt;---192.168.0.1</span><br><span class="line">mlx5_1 port 1 ==&gt; ens2f0np0 (Down)</span><br><span class="line">mlx5_2 port 1 ==&gt; ens2f1np1 (Down)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> -n 192.168.0.1 &gt; addr_traddr</span><br><span class="line"><span class="comment">#Set RDMA as the transport type</span></span><br><span class="line">$ <span class="built_in">echo</span> rdma &gt; addr_trtype</span><br><span class="line">$ <span class="built_in">echo</span> 4420 &gt; addr_trsvcid</span><br><span class="line"></span><br><span class="line"><span class="comment">#Set the address family for the port</span></span><br><span class="line">$ <span class="built_in">echo</span> ipv4 &gt; addr_adrfam</span><br><span class="line"></span><br><span class="line"><span class="comment">#Create a soft link</span></span><br><span class="line">$ <span class="built_in">ln</span> -s /sys/kernel/config/nvmet/subsystems/testnqn   /sys/kernel/config/nvmet/ports/1/subsystems/testnqn</span><br><span class="line"></span><br><span class="line">$  dmesg | grep <span class="string">&quot;enabling port&quot;</span></span><br><span class="line">[449447.666391] nvmet_rdma: enabling port 1 (10.53.129.71:4420)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dnf install nvmetcli</span><br><span class="line">$ wget http://git.infradead.org/users/hch/nvmetcli.git/blob_plain/0a6b088db2dc2e5de11e6f23f1e890e4b54fee64:/rdma.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#Edit the rdma.json file and change the traddr value to 192.168.0.1</span></span><br><span class="line">$ <span class="built_in">cat</span> rdma.json </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;hosts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;nqn&quot;</span>: <span class="string">&quot;hostnqn&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ], </span><br><span class="line">  <span class="string">&quot;ports&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;addr&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;adrfam&quot;</span>: <span class="string">&quot;ipv4&quot;</span>, </span><br><span class="line">        <span class="string">&quot;traddr&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span>, </span><br><span class="line">        <span class="string">&quot;treq&quot;</span>: <span class="string">&quot;not specified&quot;</span>, </span><br><span class="line">        <span class="string">&quot;trsvcid&quot;</span>: <span class="string">&quot;4420&quot;</span>, </span><br><span class="line">        <span class="string">&quot;trtype&quot;</span>: <span class="string">&quot;rdma&quot;</span></span><br><span class="line">      &#125;, </span><br><span class="line">      <span class="string">&quot;portid&quot;</span>: 2, </span><br><span class="line">      <span class="string">&quot;referrals&quot;</span>: [], </span><br><span class="line">      <span class="string">&quot;subsystems&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;testnqn&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ], </span><br><span class="line">  <span class="string">&quot;subsystems&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;allowed_hosts&quot;</span>: [], </span><br><span class="line">      <span class="string">&quot;attr&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;allow_any_host&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">      &#125;, </span><br><span class="line">      <span class="string">&quot;namespaces&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;device&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;nguid&quot;</span>: <span class="string">&quot;ef90689c-6c46-d44c-89c1-1000011119a8&quot;</span>, </span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/dev/nvme2n1&quot;</span></span><br><span class="line">          &#125;, </span><br><span class="line">          <span class="string">&quot;enable&quot;</span>: 1, </span><br><span class="line">          <span class="string">&quot;nsid&quot;</span>: 1</span><br><span class="line">        &#125;</span><br><span class="line">      ], </span><br><span class="line">      <span class="string">&quot;nqn&quot;</span>: <span class="string">&quot;testnqn&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#Setup the controller by loading the NVMe controller configuration file  </span></span><br><span class="line">$ nvmetcli restore rdma.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#Optional: Clear the current NVMe controller:</span></span><br><span class="line">$ nvmetcli clear</span><br><span class="line"></span><br><span class="line"><span class="comment">#client</span></span><br><span class="line">$ yum install nvme-cli</span><br><span class="line">$ modprobe nvme-rdma</span><br><span class="line">$ nvme discover -t rdma -a 192.168.0.1 -s 4420</span><br><span class="line"></span><br><span class="line">Discovery Log Number of Records 2, Generation counter 5</span><br><span class="line">=====Discovery Log Entry 0======</span><br><span class="line">trtype:  rdma</span><br><span class="line">adrfam:  ipv4</span><br><span class="line">subtype: current discovery subsystem</span><br><span class="line">treq:    not specified, sq flow control <span class="built_in">disable</span> supported</span><br><span class="line">portid:  2</span><br><span class="line">trsvcid: 4420</span><br><span class="line">subnqn:  nqn.2014-08.org.nvmexpress.discovery</span><br><span class="line">traddr:  192.168.0.1</span><br><span class="line">eflags:  not specified</span><br><span class="line">rdma_prtype: not specified</span><br><span class="line">rdma_qptype: connected</span><br><span class="line">rdma_cms:    rdma-cm</span><br><span class="line">rdma_pkey: 0x0000</span><br><span class="line">=====Discovery Log Entry 1======</span><br><span class="line">trtype:  rdma</span><br><span class="line">adrfam:  ipv4</span><br><span class="line">subtype: nvme subsystem</span><br><span class="line">treq:    not specified, sq flow control <span class="built_in">disable</span> supported</span><br><span class="line">portid:  2</span><br><span class="line">trsvcid: 4420</span><br><span class="line">subnqn:  testnqn</span><br><span class="line">traddr:  10.53.129.71</span><br><span class="line">eflags:  not specified</span><br><span class="line">rdma_prtype: not specified</span><br><span class="line">rdma_qptype: connected</span><br><span class="line">rdma_cms:    rdma-cm</span><br><span class="line">rdma_pkey: 0x0000</span><br><span class="line"></span><br><span class="line">$ nvme connect -t rdma -n testnqn -a 10.53.129.71 -s 4420</span><br><span class="line">$ nvme list</span><br><span class="line">Node                  Generic               SN                   Model                                    Namespace Usage                      Format           FW Rev  </span><br><span class="line">--------------------- --------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme6n1          /dev/ng6n1            39c00d0ebd70a569e569 Linux                                    1           3.84  TB /   3.84  TB    512   B +  0 B   4.18.0-4 </span><br><span class="line"></span><br><span class="line">[471877.350001] nvme nvme6: new ctrl: NQN <span class="string">&quot;nqn.2014-08.org.nvmexpress.discovery&quot;</span>, addr 10.53.129.71:4420</span><br><span class="line">[471877.351335] nvme nvme6: Removing ctrl: NQN <span class="string">&quot;nqn.2014-08.org.nvmexpress.discovery&quot;</span></span><br><span class="line">[471972.099443] nvme nvme6: new ctrl: NQN <span class="string">&quot;nqn.2014-08.org.nvmexpress.discovery&quot;</span>, addr 10.53.129.71:4420</span><br><span class="line">[471972.100912] nvme nvme6: Removing ctrl: NQN <span class="string">&quot;nqn.2014-08.org.nvmexpress.discovery&quot;</span></span><br><span class="line">[471986.294474] nvme nvme6: creating 63 I/O queues.</span><br><span class="line">[472001.209112] nvme nvme6: mapped 63/0/0 default/read/poll queues.</span><br><span class="line">[472001.221449] nvme nvme6: new ctrl: NQN <span class="string">&quot;testnqn&quot;</span>, addr 10.53.129.71:4420</span><br><span class="line">[472001.225180]  nvme6n1: p1</span><br><span class="line"></span><br><span class="line">$ nvme disconnect -d /dev/nvme6</span><br><span class="line">or</span><br><span class="line">$ nvme disconnect --nqn=testnqn</span><br><span class="line"><span class="comment">#dmesg show</span></span><br><span class="line">nvme nvme6: Removing ctrl: NQN <span class="string">&quot;testnqn&quot;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://enterprise-support.nvidia.com/s/article/howto-configure-nvme-over-fabrics">HOWTO CONFIGURE NVME OVER FABRICS</a><br><a target="_blank" rel="noopener" href="https://enterprise-support.nvidia.com/s/article/howto-configure-nvme-over-fabrics--nvme-of--target-offload">HOWTO CONFIGURE NVME OVER FABRICS TARGET OFFLOAD</a>  </p>
<h3 id="topic"><a href="#topic" class="headerlink" title="topic"></a>topic</h3><h4 id="local-nvme-is-ok"><a href="#local-nvme-is-ok" class="headerlink" title="local nvme is ok"></a>local nvme is ok</h4><h4 id="spdk-show-the-osq-lock"><a href="#spdk-show-the-osq-lock" class="headerlink" title="spdk show the osq_lock"></a>spdk show the osq_lock</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Samples: 515K of event &#x27;cycles&#x27;, 4000 Hz, Event count (approx.): 46740578176</span><br><span class="line">osq_lock  /usr/lib/debug/lib/modules/4.18.0-477.27.2.el8_lustre.x86_64/vmlinux [Percent: local period]</span><br><span class="line">Percent│     PVOP_VCALL1(pv_lock_ops.kick, cpu);</span><br><span class="line">       │     &#125;</span><br><span class="line">       │</span><br><span class="line">       │     static __always_inline bool pv_vcpu_is_preempted(long cpu)</span><br><span class="line">       │     &#123;</span><br><span class="line">       │     return PVOP_CALLEE1(bool, pv_lock_ops.vcpu_is_preempted, cpu);</span><br><span class="line">  1.32 │       movslq %edi,%rdi</span><br><span class="line">  1.12 │     → callq  *ffffffff82a38920</span><br><span class="line">       │     osq_lock():</span><br><span class="line">       │     if (smp_cond_load_relaxed(&amp;node-&gt;locked, VAL || need_resched() ||</span><br><span class="line">       │       test   %al,%al</span><br><span class="line">  0.01 │     ↓ jne    90</span><br><span class="line">       │     rep_nop():</span><br><span class="line">       │     #ifndef __ASSEMBLY__</span><br><span class="line">       │</span><br><span class="line">       │     /* REP NOP (PAUSE) is a good thing to insert into busy-wait loops. */</span><br><span class="line">       │     static __always_inline void rep_nop(void)</span><br><span class="line">       │     &#123;</span><br><span class="line">       │     asm volatile(&quot;rep; nop&quot; ::: &quot;memory&quot;);</span><br><span class="line">       │       pause</span><br><span class="line">       │     __read_once_size():</span><br><span class="line"> 10.18 │       mov    0x10(%rdx),%eax</span><br><span class="line">       │     osq_lock():</span><br><span class="line"> 79.25 │       test   %eax,%eax</span><br><span class="line">  0.37 │     ↓ jne    f9</span><br><span class="line">       │     get_current():</span><br><span class="line">       │</span><br><span class="line">       │     DECLARE_PER_CPU(struct task_struct *, current_task);</span><br><span class="line">       │</span><br><span class="line">       │     static __always_inline struct task_struct *get_current(void)</span><br><span class="line">       │     &#123;</span><br><span class="line">       │     return this_cpu_read_stable(current_task);</span><br><span class="line">       │ 80:   mov    %gs:0x1dc40,%rax</span><br><span class="line">       │     constant_test_bit():</span><br><span class="line">       │     /*</span><br><span class="line">       │     * Because this is a plain access, we need to disable KCSAN here to</span><br><span class="line">       │     * avoid double instrumentation via instrumented bitops.</span><br><span class="line">       │     */</span><br><span class="line">       │     return ((1UL &lt;&lt; (nr &amp; (BITS_PER_LONG-1))) &amp;</span><br><span class="line">       │     (addr[nr &gt;&gt; _BITOPS_LONG_SHIFT])) != 0;</span><br><span class="line">  0.16 │       mov    (%rax),%rax</span><br><span class="line">       │     osq_lock():</span><br><span class="line">  5.87 │       test   $0x8,%al</span><br><span class="line">  1.19 │     ↑ je     5f</span><br><span class="line">       │     cmpxchg_size():</span><br><span class="line">       │     return arch_cmpxchg((u16 *)ptr, (u16)old, (u16)new);</span><br><span class="line">Press &#x27;h&#x27; for help on key bindings</span><br><span class="line"></span><br><span class="line">Samples: 4M of event &#x27;cycles&#x27;, 4000 Hz, Event count (approx.): 3569065543976 lost: 0/0 drop: 0/3792476</span><br><span class="line">Overhead  Shared Object            Symbol</span><br><span class="line">  82.12%  [kernel]                 [k] osq_lock                                                                                                                                              ◆</span><br><span class="line">   5.50%  [kernel]                 [k] rwsem_spin_on_owner                                                                                                                                   ▒</span><br><span class="line">   1.06%  [kernel]                 [k] copy_user_generic_string                                                                                                                              ▒</span><br><span class="line">   0.56%  [kernel]                 [k] rwsem_down_write_slowpath                                                                                                                             ▒</span><br><span class="line">   0.50%  [kernel]                 [k] native_queued_spin_lock_slowpath                                                                                                                      ▒</span><br><span class="line">   0.34%  [kernel]                 [k] _raw_spin_lock_irqsave                                                                                                                                ▒</span><br><span class="line">   0.24%  [kernel]                 [k] __list_del_entry_valid                                                                                                                                ▒</span><br><span class="line">   0.22%  [kernel]                 [k] _raw_spin_lock                                                                                                                                        ▒</span><br><span class="line">   0.21%  [kernel]                 [k] xas_load                                                                                                                                              ▒</span><br><span class="line">   0.19%  [crc32c_intel]           [k] crc32c_pcl_intel_update                                                                                                                               ▒</span><br><span class="line">   0.17%  [jbd2]                   [k] jbd2__journal_start                                                                                                                                   ▒</span><br><span class="line">   0.15%  [ext4]                   [k] ext4_do_update_inode                                                                                                                                  ▒</span><br><span class="line">   0.15%  [kernel]                 [k] get_page_from_freelist                                                                                                                                ▒</span><br><span class="line">   0.15%  [kernel]                 [k] test_clear_page_writeback                                                                                                                             ▒</span><br><span class="line">   0.14%  [jbd2]                   [k] stop_this_handle                   </span><br></pre></td></tr></table></figure>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-features"><span class="toc-number">1.</span> <span class="toc-text">nvme features</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-detach-and-attach-hotplugging"><span class="toc-number">2.</span> <span class="toc-text">nvme detach and attach; hotplugging</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#single-port-or-worked-in-single-port"><span class="toc-number">2.1.</span> <span class="toc-text">single port or worked in single port</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setting"><span class="toc-number">3.</span> <span class="toc-text">setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-help"><span class="toc-number">4.</span> <span class="toc-text">nvme help</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVME-SSD-device-info"><span class="toc-number">5.</span> <span class="toc-text">NVME SSD device info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-interface-nvme-port"><span class="toc-number">6.</span> <span class="toc-text">nvme interface&#x2F;nvme port</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#why-EBOF"><span class="toc-number">6.1.</span> <span class="toc-text">why EBOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVME-persist-reservation"><span class="toc-number">6.2.</span> <span class="toc-text">NVME persist reservation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVME-PI"><span class="toc-number">6.3.</span> <span class="toc-text">NVME PI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#show-err-count"><span class="toc-number">6.4.</span> <span class="toc-text">show err count</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-the-nvme-device"><span class="toc-number">6.5.</span> <span class="toc-text">delete the nvme device</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isdct-show-all-info"><span class="toc-number">6.6.</span> <span class="toc-text">isdct show all info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-write-cache"><span class="toc-number">6.7.</span> <span class="toc-text">Enable write cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trim-feature"><span class="toc-number">6.8.</span> <span class="toc-text">Trim feature</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Intel-ssd-secure-erase"><span class="toc-number">6.9.</span> <span class="toc-text">Intel ssd secure erase</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-optimization"><span class="toc-number">6.10.</span> <span class="toc-text">Software optimization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create-mdraid-for-nvme-ssd"><span class="toc-number">6.11.</span> <span class="toc-text">create mdraid for nvme ssd</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVME-power-save-cause-controller-reset"><span class="toc-number">7.</span> <span class="toc-text">NVME power save cause controller reset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Read-data-from-the-device"><span class="toc-number">8.</span> <span class="toc-text">Read data from the device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#connect-and-disconnect"><span class="toc-number">9.</span> <span class="toc-text">connect and disconnect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-and-write"><span class="toc-number">10.</span> <span class="toc-text">read and write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#self-test"><span class="toc-number">11.</span> <span class="toc-text">self test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-firmware"><span class="toc-number">12.</span> <span class="toc-text">upgrade firmware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detach-namespaces"><span class="toc-number">13.</span> <span class="toc-text">detach namespaces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#power-off-power-on-the-nvme-ctrl-in-the-linux-nvme-driver"><span class="toc-number">14.</span> <span class="toc-text">power off &#x2F; power on the nvme ctrl in the linux nvme driver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvme-over-fabrics"><span class="toc-number">15.</span> <span class="toc-text">nvme over fabrics</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#why"><span class="toc-number">15.1.</span> <span class="toc-text">why</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#topic"><span class="toc-number">16.</span> <span class="toc-text">topic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#local-nvme-is-ok"><span class="toc-number">16.1.</span> <span class="toc-text">local nvme is ok</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spdk-show-the-osq-lock"><span class="toc-number">16.2.</span> <span class="toc-text">spdk show the osq_lock</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/13/nvme/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/13/nvme/&text=NVME"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/13/nvme/&is_video=false&description=NVME"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=NVME&body=Check out this article: http://example.com/2022/11/13/nvme/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/13/nvme/&title=NVME"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/13/nvme/&name=NVME&description=&lt;h3 id=&#34;nvme-features&#34;&gt;&lt;a href=&#34;#nvme-features&#34; class=&#34;headerlink&#34; title=&#34;nvme features&#34;&gt;&lt;/a&gt;nvme features&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;NVMe® Cross Namespace Copy Technology&lt;ul&gt;
&lt;li&gt;NVMe Cross Namespace Copy (CNC) functionality copies data across multiple storage volumes (i.e., NVMe namespaces), enabling more flexibility across an entire SSD or storage system without resorting to host-based copy&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ nvme version&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme version 2.2.1 (git 2.2.1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;libnvme version 1.2 (git 1.2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;nvme-detach-and-attach-hotplugging&#34;&gt;&lt;a href=&#34;#nvme-detach-and-attach-hotplugging&#34; class=&#34;headerlink&#34; title=&#34;nvme detach and attach; hotplugging&#34;&gt;&lt;/a&gt;&lt;a href=&#34;https://community.intel.com/t5/Intel-NUCs/NVMe-Hotplugging/m-p/1261165&#34;&gt;nvme detach and attach; hotplugging&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://access.redhat.com/solutions/3998121&#34;&gt;grub setting&lt;/a&gt;   &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#HOT swapping with the NVMe devices&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#el7/el8/el9 hot swap NVME not auto discover in the AMD mainboard, add this parameters, it &amp;#x27;s worked for the hot swap nvme dev &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ grubby --update-kernel=ALL --args=&lt;span class=&#34;string&#34;&gt;&amp;#x27;pciehp.pciehp_debug=y pci=realloc=on pcie_ports=native&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$  nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt; /sys/class/nvme/nvme0/address&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;0000:41:00.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ lspci | grep 41:00.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41:00.0 Non-Volatile memory controller: DapuStor Corporation NVMe SSD Controller DP600&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt; /sys/bus/pci/devices/0000\:41\:00.0/remove&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---no output---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#if not hot plugout, it &amp;#x27;s ok, I plugout from server, it &amp;#x27;s not working&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt; /sys/bus/pci/rescan&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/dev/nvme0n1          JR5U34A22A007DV2     DAPUSTOR DPJD3108T0T806T4000             1           6.40  TB /   6.40  TB    512   B +  0 B   FF002100&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;single-port-or-worked-in-single-port&#34;&gt;&lt;a href=&#34;#single-port-or-worked-in-single-port&#34; class=&#34;headerlink&#34; title=&#34;single port or worked in single port&#34;&gt;&lt;/a&gt;single port or worked in single port&lt;/h4&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$  nvme id-ctrl /dev/nvme0n1 -H |grep cmic -A 4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cmic      : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [3:3] : 0	ANA not supported&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [2:2] : 0	PCI&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [1:1] : 0	Single Controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [0:0] : 0	Single Port&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ lspci -vvv -s 41:00.0 | grep gt -i&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCap:	Port &lt;span class=&#34;comment&#34;&gt;#0, Speed 16GT/s, Width x4, ASPM not supported&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkSta:	Speed 16GT/s (ok), Width x4 (ok)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCap2: Supported Link Speeds: 2.5-16GT/s, Crosslink+ Retimer+ 2Retimers+ DRS+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		LnkCtl2: Target Link Speed: 16GT/s, EnterCompliance- SpeedDis-&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	Capabilities: [198 v1] Physical Layer 16.0 GT/s &amp;lt;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;setting&#34;&gt;&lt;a href=&#34;#setting&#34; class=&#34;headerlink&#34; title=&#34;setting&#34;&gt;&lt;/a&gt;setting&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#the default is noop&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; nvme_device &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; /sys/block/nvme*; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; noop &amp;gt; &lt;span class=&#34;variable&#34;&gt;$nvme_device&lt;/span&gt;/queue/scheduler&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#not test, default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; nvme_device &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; /sys/block/nvme*; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 512 &amp;gt; &lt;span class=&#34;variable&#34;&gt;$nvme_device&lt;/span&gt;/queue/nr_requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;nvme-help&#34;&gt;&lt;a href=&#34;#nvme-help&#34; class=&#34;headerlink&#34; title=&#34;nvme help&#34;&gt;&lt;/a&gt;nvme help&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ nvme intel endurance-log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ERROR: Invalid sub-command &lt;span class=&#34;string&#34;&gt;&amp;#x27;endurance-log&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; plugin intel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-2.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;usage: nvme &amp;lt;&lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt;&amp;gt; [&amp;lt;device&amp;gt;] [&amp;lt;args&amp;gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;lt;device&amp;gt;&amp;#x27;&lt;/span&gt; may be either an NVMe character device (ex: /dev/nvme0), an&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme block device (ex: /dev/nvme0n1), or a mctp address &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; the form&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mctp:&amp;lt;net&amp;gt;,&amp;lt;eid&amp;gt;[:ctrl-id]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The following are all implemented sub-commands:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list                         List all NVMe devices and namespaces on machine&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-subsys                  List nvme subsystems&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ctrl                      Send NVMe Identify Controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns                        Send NVMe Identify Namespace, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns-granularity            Send NVMe Identify Namespace Granularity List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  id-ns-lba-format             Send NVMe Identify Namespace &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; the specified LBA Format index, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-ns                      Send NVMe Identify List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  list-ctrl                    Send NVMe Identify Controller List, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvm-id-ctrl                  Send NVMe Identify Controller NVM Command Set, display structure&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvme-show-regs - Reads and shows the defined NVMe controller registers &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; NVMe over PCIe or the controller properties &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; NVMe over Fabrics.  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;See &lt;span class=&#34;string&#34;&gt;&amp;#x27;nvme help &amp;lt;command&amp;gt;&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; more information on a specific &lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The following are all installed plugin extensions:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ocp             OCP cloud SSD extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  zns             Zoned Namespace Command Set&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ymtc            Ymtc vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  wdc             Western Digital vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  virtium         Virtium vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  transcend       Transcend vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  toshiba         Toshiba NVME plugin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  solidigm        Solidigm vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  shannon         Shannon vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  seagate         Seagate vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sfx             ScaleFlux vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  nvidia          NVIDIA vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  netapp          NetApp vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  micron          Micron vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  memblaze        Memblaze vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  innogrit        innogrit vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  intel           Intel vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  huawei          Huawei vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  dera            Dera vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  dell            DELL vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  amzn            Amazon vendor specific extensions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ nvme list-subsys&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys0 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ134102RX4P0VGN  INTEL SSDPE2KX040T8                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme0 pcie 0000:41:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys1 - NQN=nqn.2014.08.org.nvmexpress:80868086BTLJ135402294P0VGN  INTEL SSDPE2KX040T8                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme1 pcie 0000:43:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys2 - NQN=nqn.2014.08.org.nvmexpress:144d144dS481NC0R916614      SAMSUNG MZQLB3T8HALS-00003              &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme2 pcie 0000:45:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys3 - NQN=nqn.2021-02.com.siliconmotion:1cb01cb0SX23725P8070265     SHANNON P8G6400&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme3 pcie 0000:47:00.0 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nvme-subsys4 - NQN=nqn.2014-08.org.nvmexpress:5f54e23544580edb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme4 rdma traddr=10.53.129.69 trsvcid=4421 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; +- nvme5 rdma traddr=10.53.129.68 trsvcid=4421 live &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#enable multipath&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$cat&lt;/span&gt; /etc/modprobe.d/nvme_core.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;options nvme_core multipath=Y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;###set to local kernel, or you could not set it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cp&lt;/span&gt; /boot/initramfs-$(&lt;span class=&#34;built_in&#34;&gt;uname&lt;/span&gt; -r).img /boot/initramfs-$(&lt;span class=&#34;built_in&#34;&gt;uname&lt;/span&gt; -r).bak.$(&lt;span class=&#34;built_in&#34;&gt;date&lt;/span&gt; +%m-%d-%H%M%S).img&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dracut --force --verbose&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ the_controller_id=4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;round-robin&amp;quot;&lt;/span&gt; &amp;gt; /sys/class/nvme-subsystem/nvme-subsys&lt;span class=&#34;variable&#34;&gt;$&amp;#123;the_controller_id&amp;#125;&lt;/span&gt;/iopolicy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;NVME-SSD-device-info&#34;&gt;&lt;a href=&#34;#NVME-SSD-device-info&#34; class=&#34;headerlink&#34; title=&#34;NVME SSD device info&#34;&gt;&lt;/a&gt;NVME SSD device info&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;NAND P&amp;#x2F;E Cycles &amp;#x3D; amount of program &amp;#x2F; erase cycles NAND can do before wearing out&lt;br&gt;  - WAF &amp;#x3D; NAND writes &amp;#x2F; host writes&lt;/li&gt;
&lt;li&gt;TBW or PBW – amount of host writes to SSD before wearing out&lt;br&gt;  - TBW &amp;#x3D; drive capacity * cycles &amp;#x2F; WAF&lt;/li&gt;
&lt;li&gt;DWPD (drive writes per day): amount of data you can write to device each day of the warranty (typically 5 years) without wearing out&lt;br&gt;  - DWPD &amp;#x3D; TBW&amp;#x2F;365&amp;#x2F;5&amp;#x2F;drive capacity&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Create partition smaller than total user capacity of SSD&lt;/li&gt;
&lt;li&gt;Limit max LBA of drive through vendor specific tools&lt;/li&gt;
&lt;li&gt;Create a namespace smaller than total user capacity&lt;/li&gt;
&lt;li&gt;Limit application use to smaller LBA range&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;https://events.static.linuxfound.org/sites/events/files/slides/lemoal-nvme-polling-vault-2017-final_0.pdf&#34;&gt;nvme hybird polling&lt;/a&gt;&lt;br&gt;I&amp;#x2F;O models&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;IRQ vs polling&lt;br&gt;  - NVM is coming ! Is this relevant ?&lt;br&gt;  - Linux implementation&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Block Layer and NVMe driver&lt;br&gt;  - Evaluation Results&lt;br&gt;  - Classic polling vs Hybrid polling&lt;br&gt;  - Impact of process scheduling&lt;br&gt;  - Comparison with user level drivers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Implemented by blk_mq_poll&lt;br&gt;  - block-mq enabled devices only&lt;br&gt;  - Device queue flagged with “poll enabled”&lt;br&gt;          - Can be controlled through sysfs&lt;br&gt;          - Enabled by default for devices supporting it, e.g. NVMe&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# To enable it, you echo 1 to /sys/block/&amp;lt;dev&amp;gt;/queue/io_poll.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 1 &amp;gt;  /sys/block/nvme0n1/queue/io_poll&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt;  /sys/block/nvme0n1/queue/io_poll&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Polling is tried for any block I&amp;#x2F;O belonging to a high-priority I&amp;#x2F;O context (IOCB_HIPRI)&lt;/li&gt;
&lt;li&gt;IRQs are NOT disabled&lt;br&gt;  - ISR is still executed as the device signals completions&lt;br&gt;  - But ISR sees a completion slot already processed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;6us average latency with IRQ, 4.5us with polling&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;25% lower latency with polling&lt;/li&gt;
&lt;li&gt;166 KIOPS vs 222 KIOPS&lt;/li&gt;
&lt;li&gt;&lt;code&gt;But 100% load on the polling CPU&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Only 32% CPU load with IRQ model&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adaptive hybrid polling gives the same average latency of 4.5us as classic polling&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;But with only 58% CPU load&lt;/li&gt;
&lt;li&gt;32% with IRQ model&lt;/li&gt;
&lt;li&gt;Fixed time polling allows controlling the CPU vs latency trade-off&lt;/li&gt;
&lt;li&gt;IRQ like average latency and CPU load for high polling delay&lt;/li&gt;
&lt;li&gt;Better use the IRQ model&lt;/li&gt;
&lt;li&gt;Lower CPU loads with a small average latency degradation achieved with intermediate polling delay&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;If I use NVME, if you have the top CPU, you could enable the polling, if not , irq is the better choice&lt;/code&gt;&lt;br&gt;dm-stripe&amp;#x2F;dm-linear support I&amp;#x2F;O polling&lt;br&gt;&lt;a href=&#34;https://developer.aliyun.com/article/783641&#34;&gt;Compare with blktrace d2c%&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cat&lt;/span&gt; /sys/block/nvme0n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# -1 class polling (default)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 0 means adaptive hybird polling&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 &amp;gt; /sys/block/nvme0n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;|&amp;lt;------------------------Application&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Perecived&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;I/O&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;latency---------------------------------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;IRQ&lt;/span&gt;      &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt;             &lt;span class=&#34;string&#34;&gt;sleep&lt;/span&gt;            &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                                            &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;(wake)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                               &lt;span class=&#34;string&#34;&gt;CS&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ISR&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;-------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                               &lt;span class=&#34;string&#34;&gt;|(IRQ)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                    &lt;span class=&#34;string&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;execution-----------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Polling&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;    &lt;span class=&#34;string&#34;&gt;Are&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;you&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;?&lt;/span&gt;    &lt;span class=&#34;string&#34;&gt;BIO_stack&amp;lt;-------Gain-------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                 &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;                                           command execution&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Hybrid&lt;/span&gt;   &lt;span class=&#34;string&#34;&gt;syscall&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;Device_driver&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;sleep&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cs&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;done?&lt;/span&gt;  &lt;span class=&#34;string&#34;&gt;BIO_stack&amp;lt;-------Gain-------&amp;gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                     &lt;span class=&#34;string&#34;&gt;|(wake)|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                      &lt;span class=&#34;string&#34;&gt;Timer&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IRQ&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;--&amp;gt;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ISR&lt;/span&gt;     &lt;span class=&#34;string&#34;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                                     &lt;span class=&#34;string&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;execution&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;If you need the high throughput, should be disable poll&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;### BIOS setting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PCIe Maximum Payload &lt;span class=&#34;built_in&#34;&gt;set&lt;/span&gt; to 256b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PCIe Maximum Read Request &lt;span class=&#34;built_in&#34;&gt;set&lt;/span&gt; to 4096b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ tuned-adm profile througput-performance&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- Throughput&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - Scheduler quantum (default 4/10 ms,-&amp;gt; 10/15 ms)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel.sched_min_granularity_ns=10000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel_sched_wakeup _granularity_ns = 15000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - Weight &lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; on how often to migrate - 5ms -&amp;gt; 50ms&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - kernel.sched_migration_cost_ns=50000000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ modprobe -r nvme &amp;amp;&amp;amp; modprobe nvme poll_queues=36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 | &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /sys/block/nvme*n1/queue/io_poll_delay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; 0 | &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /sys/block/nvme*n1/queue/iostats&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;nvme-interface-nvme-port&#34;&gt;&lt;a href=&#34;#nvme-interface-nvme-port&#34; class=&#34;headerlink&#34; title=&#34;nvme interface&amp;#x2F;nvme port&#34;&gt;&lt;/a&gt;&lt;a href=&#34;https://www.snia.org/forums/cmsi/knowledge/formfactors&#34;&gt;nvme interface&amp;#x2F;nvme port&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;EDSFF  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;E1.L 9.5mm&lt;ul&gt;
&lt;li&gt;w up to 25W - 38.4mm, l 318.75mm, Thickness 9.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.L 18mm&lt;ul&gt;
&lt;li&gt;w up to 40W - 38.4mm, l 318.75mm, Thickness 18mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S&lt;ul&gt;
&lt;li&gt;E1.S 5.9mm&lt;ul&gt;
&lt;li&gt;w 31.5mm, l 111.49mm,Thickness 5.9mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S 8mm heat spreader&lt;ul&gt;
&lt;li&gt;w 31.5mm. l 111.49mm, Thickness 8.01mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Symmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 9.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Asymmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 15mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E1.S Asymmetric Enclosure&lt;ul&gt;
&lt;li&gt;w33.75mm, l 118.75mm, 25mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;EDSFF E3.S and E3.L, 2U 40+ E3.S&amp;#x2F;L dev&lt;ul&gt;
&lt;li&gt;E3.S&lt;ul&gt;
&lt;li&gt;h 76mm, l 112.75mm, w 7.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.S 2T&lt;ul&gt;
&lt;li&gt;h 76mm, l 112.75mm, w 16.8mm, up to 40w (pcie g5x4)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.L&lt;ul&gt;
&lt;li&gt;h 76mm, l 142.2mm, w 7.5mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;E3.L 2T&lt;ul&gt;
&lt;li&gt;h 76mm, l 142.2mm, w 16.8mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;M.2&lt;ul&gt;
&lt;li&gt;16.15 x 20.15 x 1.3  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 30.15 x 2.23  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 80.15 x 2.23  W x L x H&lt;/li&gt;
&lt;li&gt;22.15 x 110.15 x 3.88  W x L x H&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;U.2&lt;ul&gt;
&lt;li&gt;7mm&lt;ul&gt;
&lt;li&gt;69.85 x 100 x 7 W x L x H&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;15mm&lt;ul&gt;
&lt;li&gt;69.85 x 100 x 15&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;AIC&lt;ul&gt;
&lt;li&gt;Full Height&lt;ul&gt;
&lt;li&gt;6.6 in&amp;#x2F;167 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Half Height&lt;ul&gt;
&lt;li&gt;4.3 in&amp;#x2F; 111 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Low Profile&lt;ul&gt;
&lt;li&gt;2.5 in&amp;#x2F;64 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Full Length&lt;ul&gt;
&lt;li&gt;12.2 in&amp;#x2F;312 mm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Half Length&lt;ul&gt;
&lt;li&gt;6.6 in&amp;#x2F;167 mm"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/13/nvme/&t=NVME"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
