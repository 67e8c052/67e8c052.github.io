<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Debain&#x2F;ubuntu12# show system info, linux vers, linux distros, linux distributions$ neofetch  take screenshot of selected Area in Ubuntu 20.04shortcut key, shift + Print screen, notebook fn+shift+">
<meta property="og:type" content="article">
<meta property="og:title" content="operating system">
<meta property="og:url" content="http://example.com/2022/11/15/operating-system/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Debain&#x2F;ubuntu12# show system info, linux vers, linux distros, linux distributions$ neofetch  take screenshot of selected Area in Ubuntu 20.04shortcut key, shift + Print screen, notebook fn+shift+">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/vlc-set1.png">
<meta property="og:image" content="http://example.com/img/e_desktop.png">
<meta property="og:image" content="http://example.com/img/e_firewall.png">
<meta property="article:published_time" content="2022-11-15T05:55:43.000Z">
<meta property="article:modified_time" content="2022-11-15T08:19:27.662Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="os">
<meta property="article:tag" content="operating system">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/vlc-set1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>operating system</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/14/hello-world/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/15/operating-system/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/15/operating-system/&text=operating system"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/15/operating-system/&is_video=false&description=operating system"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=operating system&body=Check out this article: http://example.com/2022/11/15/operating-system/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/15/operating-system/&name=operating system&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/15/operating-system/&t=operating system"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Debain-x2F-ubuntu"><span class="toc-number">1.</span> <span class="toc-text">Debain&#x2F;ubuntu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RHEL"><span class="toc-number">2.</span> <span class="toc-text">RHEL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#let-selinux-to-permissive-mode"><span class="toc-number">2.1.</span> <span class="toc-text">let selinux to permissive mode</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#audit"><span class="toc-number">3.</span> <span class="toc-text">audit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync-debug"><span class="toc-number">3.1.</span> <span class="toc-text">rsync debug</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#chrome-enable-dns-over-https"><span class="toc-number">3.2.</span> <span class="toc-text">chrome enable dns over https</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#traceroute"><span class="toc-number">3.3.</span> <span class="toc-text">traceroute</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#export-tcmalloc"><span class="toc-number">3.4.</span> <span class="toc-text">export tcmalloc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vi-paste-not-auto-inherit-the-file-type"><span class="toc-number">3.5.</span> <span class="toc-text">vi paste not auto inherit the file type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sudo"><span class="toc-number">3.6.</span> <span class="toc-text">sudo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#printk-messages"><span class="toc-number">3.7.</span> <span class="toc-text">printk messages</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#centos-7-7-not-report-kenrel-symbols"><span class="toc-number">3.8.</span> <span class="toc-text">centos 7.7 not report kenrel symbols</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kill-sockets"><span class="toc-number">3.9.</span> <span class="toc-text">kill sockets</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-by-xz"><span class="toc-number">4.</span> <span class="toc-text">compress by xz</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#systemd-limit"><span class="toc-number">4.1.</span> <span class="toc-text">systemd limit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#custom-rc-local"><span class="toc-number">4.2.</span> <span class="toc-text">custom rc-local</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pipe-fifo"><span class="toc-number">4.3.</span> <span class="toc-text">pipe, fifo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">4.4.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Nofile"><span class="toc-number">4.5.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pidstat"><span class="toc-number">4.6.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rand-file"><span class="toc-number">4.7.</span> <span class="toc-text">rand file</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#samba"><span class="toc-number">4.8.</span> <span class="toc-text">samba</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#update-kernel-moduels-in-x2F-lib-x2F-moduels-x2F-uname-r"><span class="toc-number">4.9.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#filter-syslog"><span class="toc-number">4.10.</span> <span class="toc-text">filter syslog</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-permission"><span class="toc-number">5.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#taskset"><span class="toc-number">6.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh"><span class="toc-number">7.</span> <span class="toc-text">ssh</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ssh-key-not-work"><span class="toc-number">7.1.</span> <span class="toc-text">ssh key not work</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ssh-config-allow-users"><span class="toc-number">7.2.</span> <span class="toc-text">ssh config allow users</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strace"><span class="toc-number">8.</span> <span class="toc-text">strace</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calculated-CPU-usage"><span class="toc-number"></span> <span class="toc-text">Calculated CPU usage</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">1.</span> <span class="toc-text">ps</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#others"><span class="toc-number">1.1.</span> <span class="toc-text">others</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xattr"><span class="toc-number"></span> <span class="toc-text">xattr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tc"><span class="toc-number">1.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-VNC"><span class="toc-number">2.</span> <span class="toc-text">CentOS VNC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#screen"><span class="toc-number">3.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VLC"><span class="toc-number">4.</span> <span class="toc-text">VLC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Not-show-media-title"><span class="toc-number">4.1.</span> <span class="toc-text">Not show media title</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Not-resize-interface"><span class="toc-number">4.2.</span> <span class="toc-text">Not resize interface</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#record-stream-by-vlc-and-front-camera"><span class="toc-number">4.3.</span> <span class="toc-text">record stream by vlc and front camera</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grub"><span class="toc-number">5.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-systemd-journal-not-in-the-x2F-run-x2F-log"><span class="toc-number">6.</span> <span class="toc-text">set systemd journal not in the &#x2F;run&#x2F;log</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump"><span class="toc-number"></span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number"></span> <span class="toc-text">MTU problem check</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#yum"><span class="toc-number">1.</span> <span class="toc-text">yum</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Exclude-packages"><span class="toc-number">1.1.</span> <span class="toc-text">Exclude packages</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Switch-version"><span class="toc-number">1.2.</span> <span class="toc-text">Switch version</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Yum-conf"><span class="toc-number">1.3.</span> <span class="toc-text">Yum.conf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Download-to-local"><span class="toc-number">1.4.</span> <span class="toc-text">Download to local</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Resolve-dependency-resolution-errors"><span class="toc-number">1.5.</span> <span class="toc-text">Resolve dependency resolution errors</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Uninstall-rpm-packages-from-rpmdb"><span class="toc-number">1.6.</span> <span class="toc-text">Uninstall rpm packages from rpmdb</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">2.</span> <span class="toc-text">upgrade kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#patch-kernel"><span class="toc-number">2.1.</span> <span class="toc-text">patch kernel</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gen-the-patch-if-you-modify-the-kernel-source"><span class="toc-number">2.2.</span> <span class="toc-text">gen the patch, if you modify the kernel source</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#compile-linux-kernel-failed"><span class="toc-number">2.3.</span> <span class="toc-text">compile linux kernel ( failed )</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-BBR"><span class="toc-number">3.</span> <span class="toc-text">Enable BBR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">4.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LVM-partition"><span class="toc-number">4.1.</span> <span class="toc-text">LVM partition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Test-in-ubuntu"><span class="toc-number">4.2.</span> <span class="toc-text">Test in ubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Test-in-CentOS-7-set-boot-menu"><span class="toc-number">4.3.</span> <span class="toc-text">Test in CentOS 7, set boot menu</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Re-install-EFI"><span class="toc-number">5.</span> <span class="toc-text">Re-install EFI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">6.</span> <span class="toc-text">rdesktop to win10</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Enable-remote-desktop"><span class="toc-number">6.1.</span> <span class="toc-text">Enable remote desktop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Modify-registry-from-win10"><span class="toc-number">6.2.</span> <span class="toc-text">Modify registry from win10</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">7.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">8.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lshw"><span class="toc-number">9.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmcli"><span class="toc-number">10.</span> <span class="toc-text">nmcli</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bonding"><span class="toc-number">10.1.</span> <span class="toc-text">bonding</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Permission"><span class="toc-number">11.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route-config"><span class="toc-number">12.</span> <span class="toc-text">static route config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Check-the-Linux-NIC-kernel-driver-err"><span class="toc-number">13.</span> <span class="toc-text">Check the Linux NIC kernel driver err</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collectl"><span class="toc-number">14.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time"><span class="toc-number">15.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#youtube-download"><span class="toc-number">16.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">17.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sshfs"><span class="toc-number">18.</span> <span class="toc-text">sshfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scan-file-size"><span class="toc-number">19.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kernel-issue"><span class="toc-number">20.</span> <span class="toc-text">kernel issue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slowpath-and-fastpath"><span class="toc-number">21.</span> <span class="toc-text">slowpath and fastpath</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">22.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">23.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-ELF-Executable-and-Linking-Format"><span class="toc-number">24.</span> <span class="toc-text">Read ELF(Executable and Linking Format)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">25.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">26.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">27.</span> <span class="toc-text">size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">28.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">29.</span> <span class="toc-text">gpart recovery partition table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ffmpeg"><span class="toc-number">30.</span> <span class="toc-text">ffmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iptables"><span class="toc-number">31.</span> <span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fail2ban"><span class="toc-number">32.</span> <span class="toc-text">fail2ban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof"><span class="toc-number">33.</span> <span class="toc-text">lsof</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Process-accounting-on-Linux"><span class="toc-number">34.</span> <span class="toc-text">Process accounting on Linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git-token"><span class="toc-number">35.</span> <span class="toc-text">git token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tuned-adm"><span class="toc-number">36.</span> <span class="toc-text">tuned-adm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tick"><span class="toc-number">37.</span> <span class="toc-text">Tick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blacklist-kernel-module"><span class="toc-number">38.</span> <span class="toc-text">blacklist kernel module</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iftop"><span class="toc-number">39.</span> <span class="toc-text">iftop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shadowsocks"><span class="toc-number">40.</span> <span class="toc-text">shadowsocks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#use-proxychains"><span class="toc-number">41.</span> <span class="toc-text">use proxychains</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMI"><span class="toc-number">42.</span> <span class="toc-text">NMI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dmidecode"><span class="toc-number">43.</span> <span class="toc-text">dmidecode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><span class="toc-number">44.</span> <span class="toc-text">How to got the info from the pipe fd and socke fd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#process-schdule"><span class="toc-number">45.</span> <span class="toc-text">process schdule</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Process-schdule"><span class="toc-number">45.1.</span> <span class="toc-text">Process schdule</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        operating system
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-15T05:55:43.000Z" itemprop="datePublished">2022-11-15</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/OS/">OS</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/operating-system/" rel="tag">operating system</a>, <a class="tag-link-link" href="/tags/os/" rel="tag">os</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h4 id="Debain-x2F-ubuntu"><a href="#Debain-x2F-ubuntu" class="headerlink" title="Debain&#x2F;ubuntu"></a>Debain&#x2F;ubuntu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show system info, linux vers, linux distros, linux distributions</span></span><br><span class="line">$ neofetch</span><br></pre></td></tr></table></figure>

<p>take screenshot of selected Area in Ubuntu 20.04<br>shortcut key, shift + Print screen, notebook fn+shift+print screen</p>
<p>vim split</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">::split</span><br><span class="line"></span><br><span class="line">:split filename</span><br><span class="line"></span><br><span class="line">:new #create an new window</span><br><span class="line"></span><br><span class="line">::vsplit</span><br><span class="line"></span><br><span class="line">:vsplit filename</span><br><span class="line"></span><br><span class="line">:vnew</span><br><span class="line"></span><br><span class="line">#switch window</span><br><span class="line">ctrl + double click &quot;w&quot;</span><br><span class="line">&lt;CTRL＋W&gt; h：跳转到左边的窗口 （若为大写H，则是把当前窗口调至左方）</span><br><span class="line">&lt;CTRL＋W&gt; l：跳转到右边的窗口 （类似于上）</span><br><span class="line">&lt;CTRL+W&gt; w：在窗口之间跳转</span><br><span class="line">&lt;CTRL+W&gt; +：扩大窗口 (或在当前窗口位置，输入命令：res +9)</span><br><span class="line">&lt;CTRL+W&gt; －：缩小窗口</span><br><span class="line"></span><br><span class="line">如何关闭其他窗口?      Ctrl + w, o</span><br><span class="line"></span><br><span class="line">关闭当前屏: Ctrl+w，c</span><br><span class="line"></span><br><span class="line">Ctrl + w, w 后一个</span><br><span class="line">Ctrl + w, p 前一个</span><br><span class="line"></span><br><span class="line">切换焦点？</span><br><span class="line"></span><br><span class="line">Ctrl + w, h 四个方向</span><br><span class="line">Ctrl + w, i</span><br><span class="line">Ctrl + w, k</span><br><span class="line">Ctrl + w, l</span><br><span class="line"></span><br><span class="line">zt zz zb: 把光标所在行移动窗口的顶端、中间或底部</span><br><span class="line"></span><br><span class="line">   zo – 打开光标下的折叠</span><br><span class="line">   zO – 循环打开光标下的折叠，也就是说，如果存在多级折叠，每一级都会被打开</span><br><span class="line">   zc – 关闭光标下的折叠</span><br><span class="line">   zC – 循环关闭光标下的折叠</span><br><span class="line">   [z – 到当前打开折叠的开始</span><br><span class="line">   ]z – 到当前打开折叠的结束</span><br><span class="line">   zj – 向下移动到下一个折叠的开始处</span><br><span class="line">   zk – 向上移动到上一个折叠的结束处</span><br></pre></td></tr></table></figure>

<p>vim enable mouse</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.vimrc</span><br><span class="line">set mouse=r</span><br><span class="line">syntax on</span><br></pre></td></tr></table></figure>

<p>rc.local</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/systemd/system/rc-local.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line"><span class="comment">#multiple command</span></span><br><span class="line"><span class="comment"># https://cds.lol/tutorial/2713833-execute-multiple-commands-with-&amp;&amp;-in-systemd-service-execstart-on-redhat-7.9</span></span><br><span class="line"><span class="comment">#ExecStart=/bin/bash -c &#x27;sleep 45 ; /bin/bash bin/eum.sh start&#x27;</span></span><br><span class="line">TimeoutSec=0</span><br><span class="line">StandardOutput=<span class="built_in">tty</span></span><br><span class="line">RemainAfterExit=<span class="built_in">yes</span></span><br><span class="line">SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ systemctl <span class="built_in">enable</span> rc-local</span><br><span class="line"></span><br><span class="line">$ systemctl list-units --<span class="built_in">type</span>=service</span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service</span><br><span class="line"></span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service --state=active</span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service --state=running</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>DNS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#worked</span></span><br><span class="line">/etc/systemd/resolved.conf</span><br><span class="line">[Resolve]</span><br><span class="line">DNS=8.8.8.8,4.4.4.4</span><br><span class="line"></span><br><span class="line">$ sudo systemd-resolve --set-dns=8.8.8.8 --interface=eth0</span><br><span class="line">$ service systemd-resolved restart</span><br><span class="line">$ systemctl restart systemd-resolved</span><br><span class="line">$ sudo systemd-resolve --reset-statistics --flush-caches</span><br><span class="line">$ systemd-resolve --status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#not work</span></span><br><span class="line">apt install resolvconf</span><br><span class="line"><span class="built_in">ls</span> -al /etc/resolv.conf</span><br><span class="line"><span class="built_in">cat</span> /run/resolvconf/interface/systemd-resolved</span><br><span class="line">resolvconf -u</span><br></pre></td></tr></table></figure>

<p>disable fstrim service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /var/lib/systemd/timers/stamp-fstrim.timer</span><br><span class="line">systemctl stop fstrim.service fstrim.timer</span><br><span class="line">systemctl <span class="built_in">disable</span> fstrim.service fstrim.timer</span><br><span class="line">systemctl mask fstrim.service fstrim.timer</span><br></pre></td></tr></table></figure>

<p>installation</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check the linux kernel</span></span><br><span class="line"></span><br><span class="line">$ sudo dpkg --get-selections | grep linux-image</span><br><span class="line"></span><br><span class="line">$ apt update</span><br><span class="line">$ systemctl <span class="built_in">disable</span> apt-daily-upgrade.service; systemctl <span class="built_in">disable</span> apt-daily-upgrade.timer</span><br><span class="line">$ apt install gcc make automake autoconf perl ethtool bpfcc-tools fio gdb crash python3-bpfcc smartmontools sg3-utils nfs-kernel-server tcpdump screen sysstat iotop iftop openssh-server linux-tools-5.4.0-58-generic atop collectl net-tools axel remmina tightvncserver ffmpeg gimp gimp-resynthesizer sshfs fail2ban policycoreutils selinux-utils selinux-basics icedtea-netx tigervnc-viewer</span><br><span class="line">$ apt install ubuntu-mate-desktop</span><br><span class="line"></span><br><span class="line">$ sudo apt install linux-headers-5.11.0-46-lowlatency linux-image-5.11.0-46-lowlatency linux-modules-5.11.0-46-lowlatency linux-tools-5.11.0-46-lowlatency</span><br><span class="line"></span><br><span class="line">$ vi /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#PermitRootLogin prohibit-password</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#white ip list</span></span><br><span class="line">https://yurisk.info/2011/04/05/two-tips-to-secure-ssh-access-from-specific-ips-to-specific-users-in-checkpoint-or-any-linux/</span><br><span class="line">AllowUsers  admin@123.123.123.10 admin@10.88.88.*  yurisk</span><br><span class="line">or</span><br><span class="line">AllowUsers *@99.19.19.*</span><br><span class="line"></span><br><span class="line">https://unix.stackexchange.com/questions/406245/limit-ssh-access-to-specific-clients-by-ip-address</span><br><span class="line"><span class="comment">#limit key</span></span><br><span class="line">from=<span class="string">&quot;192.168.1.*,192.168.2.*&quot;</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABA...etc...mnMo7n1DD useralias</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ systemctl restart sshd</span><br><span class="line">$ passwd root <span class="comment"># set root passwd</span></span><br><span class="line">$ apt remove libreoffice-core</span><br><span class="line">$ apt upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment">##bridge network config example</span></span><br><span class="line">vi /etc/network/interfaces</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto br0</span><br><span class="line">iface br0 inet static</span><br><span class="line">        address 192.168.0.10</span><br><span class="line">        network 192.168.0.0</span><br><span class="line">        netmask 255.255.255.0</span><br><span class="line">        broadcast 192.168.0.255</span><br><span class="line">        gateway 192.168.0.1</span><br><span class="line">        dns-nameservers 192.168.0.5 8.8.8.8</span><br><span class="line">        dns-search example.com</span><br><span class="line">        bridge_ports eth0</span><br><span class="line">        bridge_stp off</span><br><span class="line">        bridge_fd 0</span><br><span class="line">        bridge_maxwait 0</span><br><span class="line"></span><br><span class="line"><span class="comment">###install main-line kernel</span></span><br><span class="line">https://www.linuxcapable.com/how-to-install-linux-kernel-5-19-on-ubuntu-20-04-lts/</span><br><span class="line"></span><br><span class="line">$ add-apt-repository ppa:tuxinvader/lts-mainline  -y</span><br><span class="line"><span class="comment">#remove</span></span><br><span class="line">$ add-apt-repository --remove ppa:tuxinvader/lts-mainline -y</span><br><span class="line"></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ apt-get install linux-generic-6.0 -y</span><br><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">6.0.3-060003-generic</span><br><span class="line"></span><br><span class="line"><span class="comment">###debug-info</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span> main restricted universe multiverse</span></span><br><span class="line"><span class="string">      deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span>-updates main restricted universe multiverse</span></span><br><span class="line"><span class="string">      deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span>-proposed main restricted universe multiverse&quot;</span> | \</span><br><span class="line">      sudo <span class="built_in">tee</span> -a /etc/apt/sources.list.d/ddebs.list</span><br><span class="line"></span><br><span class="line">$ apt install ubuntu-dbgsym-keyring</span><br><span class="line">$ apt update</span><br><span class="line">$ apt install debian-goodies</span><br><span class="line"></span><br><span class="line">debian install kernel-debuginfo</span><br><span class="line">$ apt install linux-image-amd64-dbg</span><br><span class="line"></span><br><span class="line"><span class="comment">### kernel source</span></span><br><span class="line">$ apt-get install linux-source linux-crashdump</span><br><span class="line">$ kdump-config show</span><br><span class="line">$ dmesg | grep -i crash</span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/sysrq</span><br><span class="line">176</span><br><span class="line"></span><br><span class="line">$ sysctl -w kernel.sysrq=1</span><br><span class="line">$ <span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br><span class="line">$ <span class="built_in">cat</span> /etc/default/grub.d/kdump-tools.cfg</span><br><span class="line">$ update-grub</span><br><span class="line">$ kdump-config load</span><br><span class="line">$ kdump-config unload</span><br><span class="line"></span><br><span class="line">find-dbgsym-packages [core_path|running_pid|binary_path]</span><br><span class="line">$ find-dbgsym-packages /bin/ls</span><br><span class="line">coreutils-dbgsym libpcre2-8-0-dbgsym libselinux1-dbgsym</span><br><span class="line"></span><br><span class="line">$ apt-get install coreutils-dbgsym</span><br><span class="line"></span><br><span class="line">$ crash  /usr/lib/debug/boot/vmlinux-5.4.0-58-generic</span><br><span class="line"></span><br><span class="line">$ apt install linux-image-5.4.0-58-generic-dbgsym</span><br><span class="line">$ apt install linux-image-5.10.0-13-amd64-dbg</span><br><span class="line"></span><br><span class="line">$ crash /usr/lib/debug/boot/vmlinux-5.10.0-13-amd64</span><br><span class="line"></span><br><span class="line">$ vi /etc/apt/sources.list <span class="comment"># Enable src</span></span><br><span class="line">$ apt-get <span class="built_in">source</span> linux-image-unsigned-$(<span class="built_in">uname</span> -r)</span><br><span class="line"><span class="comment">#ubuntu</span></span><br><span class="line">http://ddebs.ubuntu.com/ubuntu/pool/main/l/linux/linux-image-unsigned-5.4.0-58-generic-dbgsym_5.4.0-58.64_amd64.ddeb</span><br><span class="line"></span><br><span class="line"><span class="comment">#debian</span></span><br><span class="line">http://mirrors.ustc.edu.cn/debian/pool/main/l/linux/linux-image-4.19.0-13-amd64-dbg_4.19.160-2_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /etc/apt/sources.list</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian-security buster/updates main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add dbgsym</span></span><br><span class="line"><span class="comment">#deb http://deb.debian.org/debian-debug/ buster-debug main</span></span><br><span class="line">deb http://debug.mirrors.debian.org/debian-debug/ buster-debug main</span><br><span class="line"><span class="comment"># for security updates</span></span><br><span class="line"><span class="comment">#deb http://deb.debian.org/debian-debug/ buster-proposed-updates-debug main</span></span><br><span class="line">deb http://debug.mirrors.debian.org/debian-debug/ buster-proposed-updates-debug main</span><br><span class="line"></span><br><span class="line">$ apt install linux-image-4.19.0-13-amd64-dbg</span><br></pre></td></tr></table></figure>

<p>Install wechat   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">https://deepin-wine.i-m.dev/</span><br><span class="line">$ wget -O- https://deepin-wine.i-m.dev/setup.sh | sh</span><br><span class="line">$ sudo apt install com.qq.weixin.deepin</span><br><span class="line">$ sudo apt-get install -y libjpeg62:i386</span><br><span class="line"></span><br><span class="line"><span class="comment">#hold upgrade</span></span><br><span class="line">$ sudo apt-mark hold com.qq.weixin.deepin</span><br><span class="line">$ sudo apt-mark hold linux-image-generic linux-headers-generic</span><br><span class="line">$ sudo apt-mark unhold linux-image-generic linux-headers-generic</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1315906/unmet-dependencies-libc6-the-package-system-is-broken">install newer glibc deb packages and apt source not update cause the deps issue</a>   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## apt install specify version</span></span><br><span class="line">$ sudo apt install libc6=2.31-0ubuntu9.2 libc-bin=2.31-0ubuntu9.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## snap remove</span></span><br><span class="line">$ sudo snap remove chromium</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-20-04">setup vnc</a>    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># change the vnc default port</span></span><br><span class="line">$ grep <span class="string">&quot;59&quot;</span> /usr/bin/vncserver -n</span><br><span class="line"><span class="comment">#modify 5900 to xxxx</span></span><br><span class="line"></span><br><span class="line">$ apt update</span><br><span class="line">$ apt install xfce4 xfce4-goodies tightvncserver</span><br><span class="line">$ vncpasswd</span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br><span class="line"></span><br><span class="line">$ vncserver</span><br><span class="line">$ vncserver -<span class="built_in">kill</span> :1</span><br><span class="line"></span><br><span class="line">$ apt install ubuntu-mate-desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#backup mate terminal config</span></span><br><span class="line">                  --------------- don<span class="string">&#x27;t not modify the path</span></span><br><span class="line"><span class="string">                  |</span></span><br><span class="line"><span class="string">$ dconf dump /org/mate/terminal/ &gt; bkp</span></span><br><span class="line"><span class="string">#restore mate terminal config</span></span><br><span class="line"><span class="string">$ dconf load /org/mate/terminal/ &lt; bkp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#or delete the vnc lock</span></span><br><span class="line"><span class="string">$ rm -f /tmp/.X11-unix/X1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ mv ~/.vnc/xstartup ~/.vnc/xstartup.bak</span></span><br><span class="line"><span class="string">$ cat ~/.vnc/xstartup</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">xrdb $HOME/.Xresources</span></span><br><span class="line"><span class="string">startxfce4 &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## gnome</span></span><br><span class="line"><span class="string">$ apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal</span></span><br><span class="line"><span class="string">$ cat ~/.vnc/xstartup ## for ubuntu 20.04</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">unset SESSION_MANAGER</span></span><br><span class="line"><span class="string">unset DBUS_SESSION_BUS_ADDRESS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export XKL_XMODMAP_DISABLE=1</span></span><br><span class="line"><span class="string">export XDG_CURRENT_DESKTOP=&quot;GNOME-Flashback:GNOME&quot;</span></span><br><span class="line"><span class="string">export XDG_MENU_PREFIX=&quot;gnome-flashback-&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span></span><br><span class="line"><span class="string">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span></span><br><span class="line"><span class="string">xsetroot -solid grey</span></span><br><span class="line"><span class="string">vncconfig -iconic &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gnome-session --builtin --session=gnome-flashback-metacity --disable-acceleration-check --debug &amp;</span></span><br><span class="line"><span class="string">nautilus &amp;</span></span><br><span class="line"><span class="string">gnome-terminal &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ vncserver -localhost no -geometry 1440x900 -SecurityTypes=VeNCrypt,TLSVnc</span></span><br><span class="line"><span class="string">$ vncserver -geometry 1440x900 -SecurityTypes=VeNCrypt,TLSVnc</span></span><br><span class="line"><span class="string">$  vncviewer -SecurityTypes=VeNCrypt,TLSVnc 192.168.1.45:1</span></span><br><span class="line"><span class="string">$ vncserver -kill :1</span></span><br><span class="line"><span class="string">$ chmod +x ~/.vnc/xstartup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ssh -L 59000:localhost:5901 -C -N -l $username $your_server_ip</span></span><br><span class="line"><span class="string">-L 59000:localhost:5901: The -L switch specifies that the given port on the local computer (59000) is to be forwarded to the given host and port on the destination server (localhost:5901, meaning port 5901 on the destination server, defined as your_server_ip). Note that the local port you specify is somewhat arbitrary; as long as the port isn’t already bound to another service, you can use it as the forwarding port for your tunnel.</span></span><br></pre></td></tr></table></figure>

<p>set ubuntu shutdown slow  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/systemd/system.conf</span><br><span class="line">DefaultTimeoutStartSec=10s</span><br><span class="line">DefaultTimeoutStopSec=5s</span><br><span class="line"></span><br><span class="line">$ sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<h4 id="RHEL"><a href="#RHEL" class="headerlink" title="RHEL"></a>RHEL</h4><h5 id="let-selinux-to-permissive-mode"><a href="#let-selinux-to-permissive-mode" class="headerlink" title="let selinux to permissive mode"></a>let selinux to permissive mode</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ setenforce 0</span><br><span class="line">$ sestatus</span><br><span class="line">SELinux status:                 enabled</span><br><span class="line">SELinuxfs mount:                /sys/fs/selinux</span><br><span class="line">SELinux root directory:         /etc/selinux</span><br><span class="line">Loaded policy name:             targeted</span><br><span class="line">Current mode:                   permissive</span><br><span class="line">Mode from config file:          permissive</span><br><span class="line">Policy MLS status:              enabled</span><br><span class="line">Policy deny_unknown status:     allowed</span><br><span class="line">Max kernel policy version:      31</span><br><span class="line"></span><br><span class="line">$ setroubleshoot</span><br></pre></td></tr></table></figure>

<h4 id="audit"><a href="#audit" class="headerlink" title="audit"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files">audit</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ auditctl -e 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## /etc/audit/auditd.conf</span></span><br><span class="line">$ systemctl start auditd</span><br><span class="line">$ auditctl -b 8192 <span class="comment">#buff</span></span><br><span class="line">$ auditctl -f 2 <span class="comment"># Set  failure  mode  0=silent 1=printk 2=panic. This option lets you determine how you want the kernel to handle critical errors</span></span><br><span class="line">$ auditctl -r 0 <span class="comment"># not limit speed</span></span><br><span class="line">$ auditctl -e 2 <span class="comment"># Set enabled flag. When 0 is passed, this can be used to temporarily disable auditing. When 1 is passed as an argument, it will enable auditing.  To  lock the  audit  configuration  so  that  it  can&#x27;t  be  changed,  pass  a  2 as the argument</span></span><br><span class="line">$ auditctl -s <span class="comment"># Report  the  kernel&#x27;s  audit  subsystem status</span></span><br><span class="line">$ auditctl -l <span class="comment"># list rule</span></span><br><span class="line">$ auditctl -D <span class="comment"># del all policy</span></span><br><span class="line">$ auditctl -w path_to_file -p permissions -k key_name</span><br><span class="line"><span class="comment">#&quot;a&quot; means change the dir/file attribute, the others same with r w x</span></span><br><span class="line">$ auditctl -w /etc/passwd -p wa -k passwd_changes</span><br><span class="line">$ auditctl -w /etc/selinux/ -p wa -k selinux_changes</span><br><span class="line">$ auditctl -w /sbin/insmod -p x -k module_insertion</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S adjtimex -S settimeofday -k time_change</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -S <span class="built_in">unlink</span> -S unlinkat -S rename -S renameat -F auid&gt;=500 -F auid!=4294967295 -k delete</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -F path=/etc/shadow -F perm=wa</span><br><span class="line">$ auditctl -R /usr/share/doc/audit-version/stig.rules <span class="comment"># Read rules from a file</span></span><br><span class="line"></span><br><span class="line">$ auditctl -w /etc/ssh/sshd_config -p warx -k sshd_config</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> audit.log</span><br><span class="line"><span class="built_in">type</span>=SYSCALL msg=audit(1364481363.243:24287): <span class="built_in">arch</span>=c000003e syscall=2 success=no <span class="built_in">exit</span>=-13 a0=7fffd19c5592 a1=0 a2=7fffd19c4b50 a3=a items=1 ppid=2686 pid=3538 auid=500 uid=500 gid=500 euid=500 suid=500 fsuid=500 egid=500 sgid=500 fsgid=500 <span class="built_in">tty</span>=pts0 ses=1 <span class="built_in">comm</span>=<span class="string">&quot;cat&quot;</span> exe=<span class="string">&quot;/bin/cat&quot;</span> subj=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 key=<span class="string">&quot;sshd_config&quot;</span></span><br><span class="line"><span class="built_in">type</span>=CWD msg=audit(1364481363.243:24287):  cwd=<span class="string">&quot;/home/shadowman&quot;</span></span><br><span class="line"><span class="built_in">type</span>=PATH msg=audit(1364481363.243:24287): item=0 name=<span class="string">&quot;/etc/ssh/sshd_config&quot;</span> inode=409248 dev=fd:00 mode=0100600 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:etc_t:s0</span><br><span class="line"></span><br><span class="line"><span class="comment">#may be the ausearch is not a good choice</span></span><br></pre></td></tr></table></figure>

<h5 id="rsync-debug"><a href="#rsync-debug" class="headerlink" title="rsync debug"></a>rsync debug</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -h --debug=<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Use OPT or OPT1 <span class="keyword">for</span> level 1 output, OPT2 <span class="keyword">for</span> level 2, etc.; OPT0 silences.</span><br><span class="line"></span><br><span class="line">ACL        Debug extra ACL info</span><br><span class="line">BACKUP     Debug backup actions (levels 1-2)</span><br><span class="line">BIND       Debug socket <span class="built_in">bind</span> actions</span><br><span class="line">CHDIR      Debug when the current directory changes</span><br><span class="line">CONNECT    Debug connection events (levels 1-2)</span><br><span class="line">CMD        Debug commands+options that are issued (levels 1-2)</span><br><span class="line">DEL        Debug delete actions (levels 1-3)</span><br><span class="line">DELTASUM   Debug delta-transfer checksumming (levels 1-4)</span><br><span class="line">DUP        Debug weeding of duplicate names</span><br><span class="line">EXIT       Debug <span class="built_in">exit</span> events (levels 1-3)</span><br><span class="line">FILTER     Debug filter actions (levels 1-2)</span><br><span class="line">FLIST      Debug file-list operations (levels 1-4)</span><br><span class="line">FUZZY      Debug fuzzy scoring (levels 1-2)</span><br><span class="line">GENR       Debug generator <span class="built_in">functions</span></span><br><span class="line">HASH       Debug hashtable code</span><br><span class="line">HLINK      Debug hard-link actions (levels 1-3)</span><br><span class="line">ICONV      Debug iconv character conversions (levels 1-2)</span><br><span class="line">IO         Debug I/O routines (levels 1-4)</span><br><span class="line">OWN        Debug ownership changes <span class="keyword">in</span> <span class="built_in">users</span> &amp; <span class="built_in">groups</span> (levels 1-2)</span><br><span class="line">PROTO      Debug protocol information</span><br><span class="line">RECV       Debug receiver <span class="built_in">functions</span></span><br><span class="line">SEND       Debug sender <span class="built_in">functions</span></span><br><span class="line">TIME       Debug setting of modified <span class="built_in">times</span> (levels 1-2)</span><br><span class="line"></span><br><span class="line">ALL        Set all --debug options (e.g. all4)</span><br><span class="line">NONE       Silence all --debug options (same as all0)</span><br><span class="line">HELP       Output this <span class="built_in">help</span> message</span><br><span class="line"></span><br><span class="line">Options added <span class="keyword">for</span> each increase <span class="keyword">in</span> verbose level:</span><br><span class="line">2) BIND,CONNECT,CMD,DEL,DELTASUM,DUP,FILTER,FLIST,ICONV</span><br><span class="line">3) ACL,BACKUP,CONNECT2,DEL2,DELTASUM2,EXIT,FILTER2,FLIST2,FUZZY,GENR,OWN,RECV,SEND,TIME</span><br><span class="line">4) CMD2,DEL3,DELTASUM3,EXIT2,FLIST3,ICONV2,OWN2,PROTO,TIME2</span><br><span class="line">5) CHDIR,DELTASUM4,FLIST4,FUZZY2,HASH,HLINK</span><br></pre></td></tr></table></figure>

<h5 id="chrome-enable-dns-over-https"><a href="#chrome-enable-dns-over-https" class="headerlink" title="chrome enable dns over https"></a>chrome enable dns over https</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome://flags/<span class="comment">#dns-over-https</span></span><br></pre></td></tr></table></figure>

<h5 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ traceroute -q 1 -m 16 12.34.56.78 <span class="comment"># avoid linux kernel peer limit</span></span><br><span class="line">$ mtr -c 50 -i 0.2 -rw 12.34.56.78</span><br><span class="line"></span><br><span class="line">https://www.ibm.com/support/knowledgecenter/TI0003M/p8hcg/p8hcg_traceroute.htm</span><br><span class="line">!H</span><br><span class="line">Host unreachable</span><br><span class="line">!N</span><br><span class="line">Network unreachable</span><br><span class="line">!P</span><br><span class="line">Protocol unreachable</span><br><span class="line">!S</span><br><span class="line">Source route failed</span><br><span class="line">!F</span><br><span class="line">Fragmentation needed</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### mapping file to loop dev</span><br><span class="line">```bash</span><br><span class="line">#align check</span><br><span class="line">(parted) align-check optimal 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ losetup /dev/loop0 /opt/test_file</span><br><span class="line">$ losetup -D ## remove all loop dev</span><br><span class="line"></span><br><span class="line"># get the partition</span><br><span class="line">$ dd if=/dev/zero bs=1M count=0 seek=9600000 of=tempfile-sdb</span><br><span class="line">$ losetup -P -f tempfile-sdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dd if=/dev/zero of=block-1 bs=1M count=5120</span><br><span class="line">or</span><br><span class="line">$ dd if=/dev/zero of=block-1 bs=1M count=0 seek=5120</span><br><span class="line"></span><br><span class="line">$ losetup -P /dev/loop0 /test/block-1</span><br><span class="line"></span><br><span class="line">$ parted /dev/loop0</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/loop0</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) mkpart</span><br><span class="line">Error: /dev/loop0: unrecognised disk label</span><br><span class="line">(parted) mklabel</span><br><span class="line">New disk label type? gpt</span><br><span class="line">(parted) mkpart</span><br><span class="line">Partition name?  []?</span><br><span class="line">File system type?  [ext2]? ext4</span><br><span class="line">Start? 2048s</span><br><span class="line">End? 100%</span><br><span class="line"></span><br><span class="line">$ mkfs.ext4 /dev/loop0p1</span><br><span class="line"></span><br><span class="line">$ parted /dev/loop0</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/loop0</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) unit s</span><br><span class="line">(parted) p</span><br><span class="line">Model: Loopback device (loopback)</span><br><span class="line">Disk /dev/loop0: 10485760s</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End        Size       File system  Name  Flags</span><br><span class="line"> 1      2048s  10483711s  10481664s  ext4         p1</span><br><span class="line"></span><br><span class="line">$ echo $((10483711-2047))</span><br><span class="line">10481664</span><br><span class="line">[root@test2-1gbe ~]# dmsetup create base &lt;&lt;EOF</span><br><span class="line">&gt; 0 10481664 linear /dev/loop0 2048</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">$ mount /dev/mapper/base /mnt</span><br><span class="line">$ df -h /mnt</span><br><span class="line">Filesystem        Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/base  4.8G  793M  3.8G  18% /mnt</span><br><span class="line"></span><br><span class="line">$ umount /mnt</span><br><span class="line">$ losetup /dev/loop1 /test/block-2</span><br><span class="line">$ blockdev --getsz /dev/loop1</span><br><span class="line">$ dmsetup create mysnap --table &#x27;0 10481664 snapshot /dev/loop0p1 /dev/loop1p1 P 8&#x27;</span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ blockdev --getsz /dev/loop0p1</span><br><span class="line">10481664</span><br><span class="line">$ echo 0 $(blockdev --getsz /dev/loop0p1) snapshot /dev/loop0p1 /dev/loop1p1 P 8 | dmsetup create mysnap</span><br><span class="line"></span><br><span class="line">$ mount /dev/mapper/mysnap /mnt</span><br><span class="line">$ df -h /mnt</span><br><span class="line">Filesystem          Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/mysnap  4.8G  793M  3.8G  18% /mnt</span><br><span class="line"></span><br><span class="line">$ dmsetup table mysnap</span><br><span class="line">$ dmsetup status mysnap</span><br><span class="line">$ dmsetup suspend mysnap</span><br><span class="line">$ dmsetup table mysnap_dup | dmsetup load mysnap</span><br><span class="line">$ msetup resume mysnap</span><br><span class="line"></span><br><span class="line">https://blog.oddbit.com/post/2018-01-25-fun-with-devicemapper-snapshot/</span><br></pre></td></tr></table></figure>

<h5 id="export-tcmalloc"><a href="#export-tcmalloc" class="headerlink" title="export tcmalloc"></a>export tcmalloc</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install gperftools-libs</span><br><span class="line">$ <span class="built_in">export</span> LD_PRELOAD=/usr/lib64/libtcmalloc.so.4</span><br></pre></td></tr></table></figure>

<h5 id="vi-paste-not-auto-inherit-the-file-type"><a href="#vi-paste-not-auto-inherit-the-file-type" class="headerlink" title="vi paste not auto inherit the file type"></a>vi paste not auto inherit the file type</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="built_in">paste</span></span><br><span class="line">:<span class="built_in">set</span> nopaste</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> TERM=xterm-256color</span><br><span class="line">$ <span class="built_in">export</span> TERM=screen-256color</span><br></pre></td></tr></table></figure>

<h5 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&#x27;Defaults !requiretty\nnobody ALL=(ALL) NOPASSWD: /usr/sbin/&#x27;</span> | sudo EDITOR=<span class="string">&#x27;tee -a&#x27;</span> visudo</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&#x27;Defaults !requiretty\nnobody ALL=(ALL) NOPASSWD: /usr/sbin/&#x27;</span> &gt; /etc/sudoers.d/nrpe</span><br><span class="line">$ visudo -c -f /etc/sudoers.d/nobody</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="printk-messages"><a href="#printk-messages" class="headerlink" title="printk messages"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/13019/description-of-kernel-printk-values">printk messages</a></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="meta"># linux/kernel.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_EMERG <span class="string">&quot;&lt;0&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_ALERT <span class="string">&quot;&lt;1&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_CRIT <span class="string">&quot;&lt;2&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_ERR <span class="string">&quot;&lt;3&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_WARNING <span class="string">&quot;&lt;4&gt;&quot;</span> <span class="comment">//default level</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_NOTICE <span class="string">&quot;&lt;5&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_INFO <span class="string">&quot;&lt;6&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_DEBUG <span class="string">&quot;&lt;7&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line">#<span class="meta"># <span class="keyword">define</span> in kernel/printk.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_DEFAULT <span class="string">&quot;&lt;d&gt;&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>DEFAULT_MESSAGE_LOGLEVEL   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/kernel/printk</span><br><span class="line">4(console level) 4(default) 1 7</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">kernel.printk = 4 4 1 7</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify the console log level</span></span><br><span class="line">$ <span class="built_in">echo</span> 5 &gt; /proc/sys/kernel/printk</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">echo</span> 8 &gt; /proc/sys/kernel/printk</span><br><span class="line"></span><br><span class="line"><span class="comment">## Some warning messages are rate limited. printk_ratelimit specifies the minimum length of time between these messages (in jiffies), by default we allow one every 5 seconds</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/printk_ratelimit</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line"><span class="comment">## While long term we enforce one message per printk_ratelimit seconds, we do allow a burst of messages to pass through</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/printk_ratelimit_burst</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#set the log level</span></span><br><span class="line">$ dmesg -n 5</span><br><span class="line">$ dmesg --follow</span><br><span class="line">$ <span class="built_in">echo</span> Some message &gt; /dev/kmsg <span class="comment">## write log to dmesg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The four values <span class="keyword">in</span> printk denote: console_loglevel, default_message_loglevel, minimum_console_loglevel and default_console_loglevel respectively.</span><br><span class="line">console_loglevel: messages with a higher priority than this will be printed to the console</span><br><span class="line">default_message_loglevel: messages without an explicit priority will be printed with this priority</span><br><span class="line">minimum_console_loglevel: minimum (highest) value to <span class="built_in">which</span> console_loglevel can be <span class="built_in">set</span></span><br><span class="line">default_console_loglevel: default value <span class="keyword">for</span> console_loglevel</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;0&quot;</span> → Emergency messages, system is about to crash or is unstable pr_emerg</span><br><span class="line"><span class="string">&quot;1&quot;</span> → Something bad happened and action must be taken immediately pr_alert</span><br><span class="line"><span class="string">&quot;2&quot;</span> → A critical condition occurred like a serious hardware/software failure pr_crit</span><br><span class="line"><span class="string">&quot;3&quot;</span> → An error condition, often used by drivers to indicate difficulties with the hardware pr_err</span><br><span class="line"><span class="string">&quot;4&quot;</span> → A warning, meaning nothing serious by itself but might indicate problems pr_warning</span><br><span class="line"><span class="string">&quot;5&quot;</span> → Nothing serious, but notably nevertheless. Often used to report security events. pr_notice</span><br><span class="line"><span class="string">&quot;6&quot;</span> → Informational message e.g. startup information at driver initialization pr_info</span><br><span class="line"><span class="string">&quot;7&quot;</span> → Debug messages pr_debug, pr_devel <span class="keyword">if</span> DEBUG is defined</span><br><span class="line">KERN_DEFAULT <span class="string">&quot;d&quot;</span> The default kernel loglevel</span><br><span class="line">KERN_CONT <span class="string">&quot;&quot;</span> <span class="string">&quot;continued&quot;</span> line of <span class="built_in">log</span> printout (only <span class="keyword">done</span> after a line that had no enclosing)</span><br></pre></td></tr></table></figure>
<h5 id="centos-7-7-not-report-kenrel-symbols"><a href="#centos-7-7-not-report-kenrel-symbols" class="headerlink" title="centos 7.7 not report kenrel symbols"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/4797281">centos 7.7 not report kenrel symbols</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/kptr_restrict</span><br></pre></td></tr></table></figure>

<h5 id="kill-sockets"><a href="#kill-sockets" class="headerlink" title="kill sockets"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/71940/killing-tcp-connection-in-linux">kill sockets</a></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ss -K dst 192.168.1.214 dport = 49029</span><br><span class="line">       -K, --kill</span><br><span class="line">              Attempts to forcibly close sockets. This option displays sockets that are successfully closed and silently skips sockets that the kernel does not support closing. It sup‐</span><br></pre></td></tr></table></figure>
<h4 id="compress-by-xz"><a href="#compress-by-xz" class="headerlink" title="compress by xz"></a>compress by xz</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar cf - <span class="variable">$dir</span> | xz -T 8 &gt; <span class="variable">$&#123;dir&#125;</span>.tar.xz</span><br></pre></td></tr></table></figure>

<h5 id="systemd-limit"><a href="#systemd-limit" class="headerlink" title="systemd limit"></a>systemd limit</h5><p>set limit by systemd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$  <span class="built_in">cat</span> /proc/928119/limits</span><br><span class="line"></span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 379704</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 4096</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 379704</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line">Directive        <span class="built_in">ulimit</span> equivalent     Unit</span><br><span class="line">LimitCPU=        <span class="built_in">ulimit</span> -t             Seconds</span><br><span class="line">LimitFSIZE=      <span class="built_in">ulimit</span> -f             Bytes</span><br><span class="line">LimitDATA=       <span class="built_in">ulimit</span> -d             Bytes</span><br><span class="line">LimitSTACK=      <span class="built_in">ulimit</span> -s             Bytes</span><br><span class="line">LimitCORE=       <span class="built_in">ulimit</span> -c             Bytes</span><br><span class="line">LimitRSS=        <span class="built_in">ulimit</span> -m             Bytes</span><br><span class="line">LimitNOFILE=     <span class="built_in">ulimit</span> -n             Number of File Descriptors</span><br><span class="line">LimitAS=         <span class="built_in">ulimit</span> -v             Bytes</span><br><span class="line">LimitNPROC=      <span class="built_in">ulimit</span> -u             Number of Processes</span><br><span class="line">LimitMEMLOCK=    <span class="built_in">ulimit</span> -l             Bytes</span><br><span class="line">LimitLOCKS=      <span class="built_in">ulimit</span> -x             Number of Locks</span><br><span class="line">LimitSIGPENDING= <span class="built_in">ulimit</span> -i             Number of Queued Signals</span><br><span class="line">LimitMSGQUEUE=   <span class="built_in">ulimit</span> -q             Bytes</span><br><span class="line">LimitNICE=       <span class="built_in">ulimit</span> -e             Nice Level</span><br><span class="line">LimitRTPRIO=     <span class="built_in">ulimit</span> -r             Realtime Priority</span><br><span class="line">LimitRTTIME=     No equivalent</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">LimitNPROC=1048576</span><br><span class="line"></span><br><span class="line"><span class="comment">#custom service</span></span><br><span class="line">/etc/systemd/system/apm.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Local system resume actions</span><br><span class="line">After=suspend.target hybrid-sleep.target hibernate.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/hdparm -B 254 /dev/sda</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sleep.target</span><br></pre></td></tr></table></figure>

<h5 id="custom-rc-local"><a href="#custom-rc-local" class="headerlink" title="custom rc-local"></a>custom rc-local</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/systemd/system/rc-local.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local Compatibility</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">TimeoutSec=0</span><br><span class="line">StandardOutput=<span class="built_in">tty</span></span><br><span class="line">RemainAfterExit=<span class="built_in">yes</span></span><br><span class="line">SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;exit 0&quot;</span> &gt; /etc/rc.local</span><br><span class="line"></span><br><span class="line">$ sudo <span class="built_in">chmod</span> +x /etc/rc.local</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> rc-local</span><br></pre></td></tr></table></figure>

<h5 id="pipe-fifo"><a href="#pipe-fifo" class="headerlink" title="pipe, fifo"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8554568/add-a-big-buffer-to-a-pipe-between-two-commands">pipe, fifo</a></h5><p>dd modify pipe buffer block size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ commandA | <span class="built_in">dd</span> status=none iflag=fullblock bs=1M | commandB</span><br><span class="line">$ process1 | mbuffer -m 1024M | process2</span><br><span class="line"></span><br><span class="line"><span class="comment">#F_SETPIPE_SZ F_GETPIPE_SZ</span></span><br><span class="line">$ <span class="built_in">echo</span> 104857600 &gt; /proc/sys/fs/pipe-max-size</span><br><span class="line">fs.pipe-max-size=104857600</span><br><span class="line"></span><br><span class="line"><span class="comment">#ulimit pipe size            (512 bytes, -p) 8 = 4096 bytes, it &#x27;s pipe buffer size in the ulimit, not pipe size</span></span><br><span class="line"><span class="comment">## POSIX.1-2001 says that write(2)s of less than PIPE_BUF  bytes  must  be atomic:  the  output  data  is  written  to  the  pipe  as a contiguous sequence.  Writes of more than PIPE_BUF bytes may  be  non-atomic:  the kernel  may  interleave the data with data written by other processes.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#here 2 tools for pipe</span></span><br><span class="line">$ pv - Pipe Viewer - is a terminal-based tool <span class="keyword">for</span> monitoring the progress of data through a pipeline.</span><br><span class="line">$ process1 | pv -pterbTCB 1G | process2</span><br><span class="line"></span><br><span class="line">$ pv -cN sources linux-image-unsigned-4.15.0-65-generic-dbgsym_4.15.0-65.74_amd64.ddeb | <span class="built_in">dd</span> of=/tmp/tmp bs=512 | pv -cN <span class="built_in">cat</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkfifo</span> -m 777 /tmp/lfs.log</span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## lfs 40MB log</span></span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.80.bin 80</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Software-Collections-SCL-Repository"><a href="#Software-Collections-SCL-Repository" class="headerlink" title="Software Collections ( SCL ) Repository"></a>Software Collections ( SCL ) Repository</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ yum install centos-release-scl-rh</span><br><span class="line">$ yum install devtoolset-9-toolchain</span><br><span class="line"></span><br><span class="line">#centos 8</span><br><span class="line">$ dnf install gcc-toolset-9</span><br><span class="line"></span><br><span class="line">$ gfortran --version | head -2</span><br><span class="line">GNU Fortran (GCC) 4.8.5 20150623 (Red Hat 4.8.5-36)</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">$ scl enable devtoolset-9 bash</span><br><span class="line"></span><br><span class="line">$  gfortran --version | head -2</span><br><span class="line">GNU Fortran (GCC) 8.2.1 20180905 (Red Hat 8.2.1-3)</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">https://www.softwarecollections.org/en/scls/rhscl/rh-varnish6/</span><br><span class="line"># 1. Install a package with repository for your system:</span><br><span class="line"># On CentOS, install package centos-release-scl available in CentOS repository:</span><br><span class="line">$ sudo yum install centos-release-scl</span><br><span class="line"></span><br><span class="line"># On RHEL, enable RHSCL repository for you system:</span><br><span class="line">$ sudo yum-config-manager --enable rhel-server-rhscl-7-rpms</span><br><span class="line"></span><br><span class="line"># 2. Install the collection:</span><br><span class="line">$ sudo yum install rh-varnish6</span><br><span class="line"></span><br><span class="line"># 3. Start using software collections:</span><br><span class="line">$ scl enable rh-varnish6 bash</span><br><span class="line"></span><br><span class="line">In order to view the individual components included in this collection, including additional subpackages, you can run:</span><br><span class="line"></span><br><span class="line">$ sudo yum list rh-varnish6\*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">On CentOS 7 and RHEL 7 you can pull the image with the following command:</span><br><span class="line">$ docker pull rhscl/varnish-6-rhel7</span><br></pre></td></tr></table></figure>

<h5 id="Nofile"><a href="#Nofile" class="headerlink" title="Nofile"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/447583/ulimit-vs-file-max">Nofile</a></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/fs/file-max</span><br><span class="line">ulimit -n</span><br></pre></td></tr></table></figure>
<p>file-max is the maximum File Descriptors (FD) enforced on a kernel level, which cannot be surpassed by all processes without increasing.<br>The ulimit is enforced on a process level, which can be less than the file-max.   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/fs/file-nr</span><br><span class="line">This will return three values denote the number of allocated file handles the number of allocated but unused file handles, and the maximum number of file handles.</span><br></pre></td></tr></table></figure>

<h5 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -C <span class="string">&#x27;linpack|stream&#x27;</span> -d 2 -rsuw</span><br></pre></td></tr></table></figure>

<h5 id="rand-file"><a href="#rand-file" class="headerlink" title="rand file"></a>rand file</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -out 1G.file 1073741824</span><br></pre></td></tr></table></figure>

<h5 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h5><p>Account   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /bin/false  <span class="variable">$USER</span></span><br><span class="line">PASSINPUT=`<span class="built_in">echo</span> <span class="variable">$USER</span>|<span class="built_in">cut</span> -c1-3`123</span><br><span class="line">(<span class="built_in">echo</span> <span class="variable">$PASSINPUT</span> ; <span class="built_in">echo</span> <span class="variable">$PASSINPUT</span>)  | smbpasswd -s -a <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>
<p>config  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">        workgroup = MYGROUP</span><br><span class="line">        server string = Samba Server Version %v</span><br><span class="line">        <span class="built_in">log</span> file = /var/log/samba/log.%m</span><br><span class="line">        max <span class="built_in">log</span> size = 50</span><br><span class="line">        security = user</span><br><span class="line">        passdb backend = tdbsam</span><br><span class="line">load printers = no</span><br><span class="line">printing = bsd</span><br><span class="line">printcap name = /dev/null</span><br><span class="line"><span class="built_in">disable</span> spoolss = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">[SMB_DATA]</span><br><span class="line">path = /samba/data</span><br><span class="line">valid <span class="built_in">users</span> =  test1,test2,test3,test4</span><br><span class="line">create mask = 0744</span><br><span class="line">force create mode = 0744</span><br><span class="line">security mask = 0744</span><br><span class="line">force security mode = 0744</span><br><span class="line">directory mask = 0755</span><br><span class="line">force directory mode = 0755</span><br><span class="line">directory security mask = 0755</span><br><span class="line">force directory security mode = 0755</span><br><span class="line">writable = <span class="built_in">yes</span></span><br><span class="line">fileid:mapping = smb_data</span><br><span class="line">use mmap = no</span><br><span class="line">nt acl support = <span class="built_in">yes</span></span><br><span class="line">ea support = <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<p>Show status   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ smbclient -L localhost <span class="comment">#show share point</span></span><br><span class="line">$ pdbedit -L <span class="comment"># show users</span></span><br><span class="line">$ mount.cifs //<span class="variable">$domain_addr</span>/SMB_DATA -o username=test1,password=<span class="variable">$your_pass</span> /mnt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -l /var/lib/samba/private/</span><br><span class="line">total 936</span><br><span class="line">-rw------- 1 root root 528384 Aug 22 10:36 passdb.tdb</span><br><span class="line">-rw------- 1 root root 430080 Dec 29  2013 secrets.tdb</span><br><span class="line"><span class="comment"># backup data</span></span><br><span class="line">$ pdbedit -e smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># import</span></span><br><span class="line">$ pdbedit -i smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Please backup all users from /etc/passwd too</span></span><br></pre></td></tr></table></figure>

<h5 id="update-kernel-moduels-in-x2F-lib-x2F-moduels-x2F-uname-r"><a href="#update-kernel-moduels-in-x2F-lib-x2F-moduels-x2F-uname-r" class="headerlink" title="update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)"></a>update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># re-generate modules.alias modules.dep</span></span><br><span class="line">$ depmod -a</span><br></pre></td></tr></table></figure>

<h5 id="filter-syslog"><a href="#filter-syslog" class="headerlink" title="filter syslog"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1564823">filter syslog</a></h5><p>Created slice user-0.slice.<br>Starting Session 150 of user root.<br>Started Session 150 of user root.<br>Created slice user-0.slice.<br>Starting Session 151 of user root.<br>Started Session 151 of user root.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;l_getidentity.*&quot; then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-lustre-id-session.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;systemd&quot; and ($msg contains &quot;Starting Session&quot; or $msg contains &quot;Started Session&quot; or $msg contains &quot;Created slice&quot; or $msg contains &quot;Starting user-&quot; or $msg contains &quot;Starting User Slice of&quot; or $msg contains &quot;Removed session&quot; or $msg contains &quot;Removed slice User Slice of&quot; or $msg contains &quot;Stopping User Slice of&quot;) then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-systemd-session-slice.conf</span><br><span class="line"></span><br><span class="line">$ systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<h4 id="tmp-permission"><a href="#tmp-permission" class="headerlink" title="tmp permission"></a>tmp permission</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 1777 /tmp</span><br></pre></td></tr></table></figure>

<h4 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ taskset -p a 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity mask: ffffffffff</span></span><br><span class="line"><span class="string">pid 205344&#x27;</span>s new affinity mask: a</span><br><span class="line"></span><br><span class="line">$ taskset -c -p 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity list: 1,3</span></span><br><span class="line"><span class="string">$ taskset -cp 0-3 $pid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ echo &quot;obase=2; ibase=16; A&quot; | bc</span></span><br><span class="line"><span class="string">1010 # core 1,3</span></span><br></pre></td></tr></table></figure>

<h4 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h4><h5 id="ssh-key-not-work"><a href="#ssh-key-not-work" class="headerlink" title="ssh key not work"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6377009/adding-public-key-to-ssh-authorized-keys-does-not-log-me-in-automatically">ssh key not work</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> 700 ~/.ssh</span><br><span class="line">$ <span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br><span class="line">$ <span class="built_in">chmod</span> go-w ~</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to localhost:7910</span></span><br><span class="line">$ ssh -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># to 0.0.0.0:7910</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># same with 0.0.0.0</span></span><br><span class="line">$ ssh -g -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># limit the client ip</span></span><br><span class="line">$ ssh -g -L 7910:<span class="variable">$&#123;ssh_client_ip&#125;</span>:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to $vnc_server_ip:7910 by $ssh_client</span></span><br><span class="line"><span class="comment"># modify -L to -R</span></span><br><span class="line">$ ssh -R 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># share all ip addr</span></span><br><span class="line"><span class="comment"># modify /etc/ssh/sshd_config &#x27;GatewayPorts clientspecified&#x27;</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip2 and ip1 in the same LAN, bind vnc_server_ip2 5910 to ssh client 7910 and forward by vnc_server_ip1</span></span><br><span class="line">$ ssh -L 7910:<span class="variable">$&#123;vnc_server_ip2&#125;</span>:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line">vnc_server_ip1 $ vncviewer localhost:7910</span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip1 access ssh_client_ip2 vnc service</span></span><br><span class="line">$ ssh -R 7910:ssh_client_ip2:5910 user@vnc_server_ip1</span><br><span class="line">vnc_server_ip1 $ vncviewer localhost::7910</span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 user@vnc_server_ip1</span><br><span class="line"></span><br><span class="line"><span class="comment">#### [pass through another machine to forward sock5](https://superuser.com/questions/332850/ssh-as-socks-proxy-through-multiple-hosts)</span></span><br><span class="line">A-&gt;B-&gt;C</span><br><span class="line">C could connecnt internet, A and B could not, A pass through B to forward sock5 port to <span class="variable">$A_local_sock_port</span></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># make these port have not block by firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### In A, you could set sock5 localhost:$A_local_sock_port to connect internnet</span></span><br><span class="line">client $ ssh -C -f -N -D <span class="variable">$local_sock_port</span> -oProxyCommand=<span class="string">&quot;ssh -C -W %h:%p username@<span class="variable">$B_ipaddr</span>&quot;</span> username@<span class="variable">$C_ipaddr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">client $ ssh -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> <span class="variable">$B_IPADDR</span></span><br><span class="line">A $ ssh -f -N -D <span class="variable">$PORT2</span> <span class="variable">$C_IPADDR</span></span><br><span class="line"><span class="comment">#merge dual command to single command</span></span><br><span class="line">client $ ssh -f -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> liyan@192.168.210.3 <span class="string">&quot;ssh -f -N -D <span class="variable">$PORT2</span> liyan@<span class="variable">$C_IPADDR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># forward remote port to local</span></span><br><span class="line">client $ ssh -fNT -R 1025:127.0.0.1:1025 -J user@<span class="variable">$B_IP</span> user@<span class="variable">$C_IP</span></span><br><span class="line">AllowTcpForwarding <span class="built_in">yes</span></span><br><span class="line">GatewayPorts <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h5 id="ssh-config-allow-users"><a href="#ssh-config-allow-users" class="headerlink" title="ssh config allow users"></a>ssh config allow users</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowUsers *@192.168.1.0/24 *@*.example.com *@1.2.3.4</span><br><span class="line">AllowGroups ssh</span><br></pre></td></tr></table></figure>

<h4 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h4><p>-ttt If given thrice, the time printed will include the microseconds and the leading portion will be printed as the number of seconds since the epoch</p>
<p>-s strsize  Specify the maximum string size to print (the default is 32).  Note that filenames are not considered strings and are always printed in full.</p>
<p>-f Trace child processes as they are created by currently traced processes  as  a  result  of  the  fork(2),  vfork(2)  and clone(2)  system  calls. Note that -p PID -f will attach all threads of process PID if it is multi-threaded, not only thread with thread_id &#x3D; PID</p>
<p>-T Show the time spent in system calls.  This records the time difference between the beginning and the end of each  system call</p>
<p>-c Count time, calls, and errors for each system call and report a summary on program exit, suppressing the regular output. This attempts to show system time (CPU time spent running in the kernel) independent of wall clock time.  If -c is used with -f, only aggregate totals for all traced processes are kept.<br>-C Like -c but also print regular output while processes are running.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ strace -f -c -p 49285</span><br><span class="line">% time     seconds  usecs/call     calls    errors syscall</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line"> 92.89   69.955928        2530     27640      1203 futex</span><br><span class="line">  2.33    1.754302       70172        25        25 restart_syscall</span><br><span class="line">  1.56    1.172474          52     22512           write</span><br><span class="line">  1.54    1.156547          63     18080           <span class="built_in">read</span></span><br><span class="line">  1.09    0.821847         119      6873           <span class="built_in">unlink</span></span><br><span class="line">  0.28    0.211894          30      6874           open</span><br><span class="line">  0.14    0.108041          15      6859           munmap</span><br><span class="line">  0.07    0.049564           7      6874           close</span><br><span class="line">  0.05    0.035222           2     13733           fstat</span><br><span class="line">  0.03    0.024198           3      6859           mmap</span><br><span class="line">  0.02    0.015568           2      5522           clock_gettime</span><br><span class="line">  0.01    0.006484           2      2208           getrusage</span><br><span class="line">  0.00    0.001998           3       552           mprotect</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line">100.00   75.314067                124611      1228 total</span><br><span class="line"></span><br><span class="line">$ strace -k cmd  <span class="comment">#show backtrace for each syscall</span></span><br><span class="line">$ strace -t cmd  <span class="comment">#prefix each syscall with walllock time</span></span><br><span class="line">$ strace -D cmd  strace process runs as detached grandchild of cmd</span><br><span class="line">$ strace -p 1234 -f <span class="comment">#addatch to all threads in process-group 1234</span></span><br><span class="line"></span><br><span class="line">strace -Tfe trace=open,<span class="built_in">read</span>,write  ./program</span><br><span class="line">$ strace -f -FF -tt -T -s 128 -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%memory -C -o ~/memory.log -f -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%desc -C -o ~/desc.log -f -p <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

<h3 id="Calculated-CPU-usage"><a href="#Calculated-CPU-usage" class="headerlink" title="Calculated CPU usage"></a><a target="_blank" rel="noopener" href="https://github.com/Leo-G/DevopsWiki/wiki/How-Linux-CPU-Usage-Time-and-Percentage-is-calculated">Calculated CPU usage</a></h3><p>cpu usage&#x3D;(idle2-idle1)&#x2F;(cpu2-cpu1)*100 # script example<br>cpu usage&#x3D;[(user_2 +sys_2+nice_2) - (user_1 + sys_1+nice_1)]&#x2F;(total_2 - total_1)*100</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">cat</span> /proc/stat</span><br><span class="line">     user <span class="built_in">nice</span> system idle iowait  irq  softirq steal guest guest_nice</span><br><span class="line">cpu  4705 356  584    3699   23    23     0       0     0          0</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="comment"># by Paul Colby (http://colby.id.au), no rights reserved ;)</span></span><br><span class="line"></span><br><span class="line"> PREV_TOTAL=0</span><br><span class="line"> PREV_IDLE=0</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">   <span class="comment"># Get the total CPU statistics, discarding the &#x27;cpu &#x27; prefix.</span></span><br><span class="line">   CPU=(`sed -n <span class="string">&#x27;s/^cpu\s//p&#x27;</span> /proc/stat`)</span><br><span class="line">   IDLE=<span class="variable">$&#123;CPU[3]&#125;</span> <span class="comment"># Just the idle CPU time.</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the total CPU time.</span></span><br><span class="line">   TOTAL=0</span><br><span class="line">   <span class="keyword">for</span> VALUE <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;CPU[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">     ((TOTAL=<span class="variable">$TOTAL</span>+<span class="variable">$VALUE</span>))</span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the CPU usage since we last checked.</span></span><br><span class="line">   ((DIFF_IDLE=<span class="variable">$IDLE</span>-<span class="variable">$PREV_IDLE</span>))</span><br><span class="line">   ((DIFF_TOTAL=<span class="variable">$TOTAL</span>-<span class="variable">$PREV_TOTAL</span>))</span><br><span class="line"></span><br><span class="line">   <span class="comment">##</span></span><br><span class="line">   DIFF_USAGE=$(awk -v diff_idle=<span class="variable">$DIFF_IDLE</span> -v diff_total=<span class="variable">$DIFF_TOTAL</span> <span class="string">&#x27;BEGIN&#123;printf &quot;%.2f&quot;, (diff_total-diff_idle)/diff_total*100&#125;&#x27;</span>)</span><br><span class="line">   <span class="built_in">echo</span> -en <span class="string">&quot;\rCPU: <span class="variable">$DIFF_USAGE</span>%  \b\b&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Remember the total and idle CPU times for the next check.</span></span><br><span class="line">   PREV_TOTAL=<span class="string">&quot;<span class="variable">$TOTAL</span>&quot;</span></span><br><span class="line">   PREV_IDLE=<span class="string">&quot;<span class="variable">$IDLE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Wait before checking again.</span></span><br><span class="line">   usleep 100000</span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## the lib messages</span></span><br><span class="line">$ <span class="built_in">read</span>(3, <span class="string">&quot;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\273\0\0\0\0\0\0&quot;</span>..., 832) = 832</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">od</span> -bc /lib/x86_64-linux-gnu/libc.so.6 | <span class="built_in">head</span> -n4</span><br><span class="line">0000000 177 105 114 106 002 001 001 003 000 000 000 000 000 000 000 000</span><br><span class="line">        177   E   L   F 002 001 001 003  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000020 003 000 076 000 001 000 000 000 260 034 002 000 000 000 000 000</span><br><span class="line">        003  \0   &gt;  \0 001  \0  \0  \0 260 034 002  \0  \0  \0  \0  \0</span><br></pre></td></tr></table></figure>


<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL</span><br><span class="line"> 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE</span><br><span class="line"> 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2</span><br><span class="line">13) SIGPIPE     14) SIGALRM     15) SIGTERM     16) SIGSTKFLT</span><br><span class="line">17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU</span><br><span class="line">25) SIGXFSZ     26) SIGVTALRM   27) SIGPROF     28) SIGWINCH</span><br><span class="line">29) SIGIO       30) SIGPWR      31) SIGSYS      34) SIGRTMIN</span><br><span class="line">35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4</span><br><span class="line">39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12</span><br><span class="line">47) SIGRTMIN+13 48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14</span><br><span class="line">51) SIGRTMAX-13 52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10</span><br><span class="line">55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6</span><br><span class="line">59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line"></span><br><span class="line"><span class="comment">## send STOP signal for this user</span></span><br><span class="line">$ pkill --signal 19 -U testuser</span><br><span class="line"></span><br><span class="line"><span class="comment">## send CONT signal for this user</span></span><br><span class="line">$ pkill --signal 18 -U testuser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#process schduler</span></span><br><span class="line">$ chrt -p <span class="variable">$pid</span></span><br><span class="line">$ chrt -m</span><br><span class="line">$ chrt [-b/-f/-o/-r/-i/-d] -p <span class="variable">$priority</span> <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line">-b SCHED_BATCH</span><br><span class="line">-f SCHED_FIFO</span><br><span class="line">-o SCHED_OTHER</span><br><span class="line">-r SCHED_RR</span><br><span class="line">-i SCHED_IDLE</span><br><span class="line">-d SCHED_DEADLINE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nwchan     WCHAN     address of the kernel <span class="keyword">function</span> <span class="built_in">where</span> the process</span><br><span class="line">                     is sleeping (use wchan <span class="keyword">if</span> you want the kernel</span><br><span class="line">                     <span class="keyword">function</span> name).  Running tasks will display a</span><br><span class="line">                     dash (<span class="string">&#x27;-&#x27;</span>) <span class="keyword">in</span> this column.</span><br><span class="line">wchan      WCHAN     name of the kernel <span class="keyword">function</span> <span class="keyword">in</span> <span class="built_in">which</span> the process</span><br><span class="line">                     is sleeping, a <span class="string">&quot;-&quot;</span> <span class="keyword">if</span> the process is running, or</span><br><span class="line">                     a <span class="string">&quot;*&quot;</span> <span class="keyword">if</span> the process is multi-threaded and ps is</span><br><span class="line">                     not displaying threads.</span><br><span class="line"><span class="comment"># show full username</span></span><br><span class="line">$ ps axo user:20,pid,pcpu,pmem,vsz,rss,<span class="built_in">tty</span>,<span class="built_in">stat</span>,start,time,<span class="built_in">comm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show thread and whan</span></span><br><span class="line">$ ps axHo <span class="built_in">stat</span>,pid,tid,pgid,ppid,<span class="built_in">comm</span>,cls,cmd,wchan</span><br><span class="line">S&lt;      139    139      0      2 kblockd          TS [kblockd]                   rescuer_thread</span><br><span class="line">S&lt;      141    141      0      2 md               TS [md]                        rescuer_thread</span><br><span class="line">S&lt;      142    142      0      2 edac-poller      TS [edac-poller]               rescuer_thread</span><br><span class="line">S&lt;      143    143      0      2 watchdogd        TS [watchdogd]                 rescuer_thread</span><br><span class="line">S       152    152      0      2 kswapd0          TS [kswapd0]                   kswapd</span><br><span class="line">S       153    153      0      2 kswapd1          TS [kswapd1]                   kswapd</span><br><span class="line"></span><br><span class="line">$ ps -T -o <span class="built_in">stat</span>,pid,tid,pgid,ppid,<span class="built_in">comm</span>,cls,cmd,wchan,psr &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#show the pid info process schdule and show the parent id ppid</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -r 99</span><br><span class="line">$ <span class="built_in">setcap</span>  cap_sys_nice=eip  /usr/bin/chrt <span class="comment">## for the non-root user</span></span><br><span class="line">$ chrt -p <span class="variable">$pid</span></span><br><span class="line">$ chrt -b -p <span class="variable">$priority</span> <span class="variable">$pid</span> <span class="comment">## the number higher ,the highest prority is 99</span></span><br><span class="line">$ chrt -m</span><br><span class="line">$ <span class="built_in">nice</span> -n 5 ./a.out -20~19 <span class="comment"># -19 is the highest prority , it not real-time</span></span><br><span class="line">$ renice 10 <span class="variable">$pid</span></span><br><span class="line">$ pstree -aps <span class="variable">$pid</span></span><br><span class="line">$ ps -efj</span><br><span class="line">$ ps -eo pid,ppid,cmd,%mem,rss,%cpu,policy,ni --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span></span><br><span class="line">$ ps -eo pid,ppid,cmd,%mem,%cpu --<span class="built_in">sort</span>=-%mem | <span class="built_in">head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check the process on which cpu cores</span></span><br><span class="line">$ ps -mo pid,tid,%cpu,psr -p 198851 | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> | <span class="built_in">sort</span> -n  | <span class="built_in">uniq</span> -c</span><br><span class="line">   PID    TID %CPU PSR</span><br><span class="line">198851      -  0.1   -</span><br><span class="line">     - 198851  0.1  15</span><br></pre></td></tr></table></figure>
<h5 id="others"><a href="#others" class="headerlink" title="others"></a>others</h5><p>atop -PMEM not got the right value, do it by yourself</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##process memory overhead</span></span><br><span class="line">awk <span class="string">&#x27;$0~/Pss/&#123;mem+=$2&#125;; END &#123;printf &quot;%.2f GiB\n&quot;, mem/1024/1024&#125;&#x27;</span> /proc/44833/smaps</span><br><span class="line"></span><br><span class="line"><span class="comment">##the system memory overhead</span></span><br><span class="line">awk <span class="string">&#x27;$0~/Pss/&#123;mem+=$2&#125;; END &#123;printf &quot;%.2f GiB\n&quot;, mem/1024/1024&#125;&#x27;</span> /proc/[1-9]*/smaps</span><br><span class="line"></span><br><span class="line"><span class="comment">#/proc/pid/smaps vmflags</span></span><br><span class="line">rd      readable</span><br><span class="line">wr      writeable</span><br><span class="line">ex      executable</span><br><span class="line">sh      shared</span><br><span class="line">mr      may <span class="built_in">read</span></span><br><span class="line">mw      may write</span><br><span class="line">me      may execute</span><br><span class="line">ms      may share</span><br><span class="line">gd      stack segment growns down</span><br><span class="line">pf      pure PFN range</span><br><span class="line">dw      disabled write to the mapped file</span><br><span class="line">lo      pages are locked <span class="keyword">in</span> memory</span><br><span class="line">io      memory mapped I/O area</span><br><span class="line">sr      sequential <span class="built_in">read</span> advise provided</span><br><span class="line">rr      random <span class="built_in">read</span> advise provided</span><br><span class="line">dc      <span class="keyword">do</span> not copy area on fork</span><br><span class="line">de      <span class="keyword">do</span> not <span class="built_in">expand</span> area on remapping</span><br><span class="line">ac      area is accountable</span><br><span class="line">nr      swap space is not reserved <span class="keyword">for</span> the area</span><br><span class="line">ht      area uses huge tlb pages</span><br><span class="line"><span class="built_in">nl</span>      non-linear mapping</span><br><span class="line">ar      architecture specific flag</span><br><span class="line"><span class="built_in">dd</span>      <span class="keyword">do</span> not include area into core dump</span><br><span class="line">mm      mixed map area</span><br><span class="line">hg      huge page advise flag</span><br><span class="line">nh      no-huge page advise flag</span><br><span class="line">mg      mergable advise flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Kill all processes with the ppid</span></span><br><span class="line">$ pkill -P $$</span><br><span class="line">$ <span class="built_in">kill</span> $(ps -o pid= --ppid $$)</span><br><span class="line"></span><br><span class="line">$ top -n 3 -b</span><br><span class="line">$ top -b -p 12345</span><br><span class="line">$ pstree -sg 25153 <span class="comment"># get process tree</span></span><br><span class="line">systemd(1)───sshd(3266)───sshd(32704)───hydra_pmi_proxy(32706)───test.sh(32725)</span><br><span class="line"></span><br><span class="line">$ pstree -sga 32725</span><br><span class="line">systemd,1 --switched-root --system --deserialize 22</span><br><span class="line">  └─sshd,3266 -D</span><br><span class="line">      └─sshd,32704</span><br><span class="line">          └─hydra_pmi_proxy,32706 --control-port centos7-test:38001 --rmk user --launcher ssh --demux poll --pgid 0 --retries 10--u</span><br><span class="line">              └─test.sh,32725 /root/test.sh /mnt</span><br><span class="line"></span><br><span class="line">$ pidstat -drsuw</span><br><span class="line">    * CPU utilization</span><br><span class="line">    * IO</span><br><span class="line">    * page faults and memory utilization</span><br><span class="line">    * stack utilization</span><br><span class="line">    * task switching</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt p<span class="variable">$pid</span> -oT</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt u<span class="variable">$uid</span> -oT</span><br><span class="line"></span><br><span class="line">$ iotop -b -n1 -o -P</span><br><span class="line"></span><br><span class="line">sys%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $9/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line">use%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print ($10+$11)/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">idle%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $12/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">wait</span>%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $13/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | <span class="built_in">sort</span> -nr -k 13 -k 15  | <span class="built_in">head</span></span><br><span class="line">                                                                           reads    <span class="built_in">read</span> sec     writes write sec(512B)</span><br><span class="line">PRD kvm-manager-a23-1 1585239068 2020/03/27 00:11:08 4256 4006 (bash) S n y 1758081744 1758081744 64      64              48 4006 n y</span><br><span class="line">last line <span class="string">&#x27;y&#x27;</span> means not thread</span><br><span class="line">                                                                                                                         (2097152/1024=2048KB)</span><br><span class="line">$ atop -c -m 5 <span class="comment"># show cpu and mem, interval 5s                                                                          huge page size (bytes)</span></span><br><span class="line">$ atop -PCPU,MEM 5 <span class="comment"># Batch-mode output cpu and memory                                                                               |</span></span><br><span class="line">                                                        interval   total(page)          cache       slab  slab-rec  shmem  shswp hugesz hpfre</span><br><span class="line">                                                             |         |                  |           |          |      |     |    |      |</span><br><span class="line">MEM cngb-compute-h3c-amd-test 1608821373 2020/12/24 22:49:33 2 4096 264131575 217895897 230834 13135 222600 16 44190 0 2598 8 0 2097152 0 0 0</span><br><span class="line">                                                                |               |               |           |        |      |           |   |</span><br><span class="line">                                                             pagesize         free            fsbuff      dirty  vmball  shrss       hptot arc</span><br><span class="line">                                total       free           cache buff   slap dirty</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;printf &quot;%f GB\n&quot;, ((264131575-217895897)*4096-(230834+13135+222600+16+44190+2598)*4096)/1024/1024/1024&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## man page is wrong, source code is right, and I make sure with /proc/meminfo</span></span><br><span class="line">print_MEM(char *hp, struct sstat *ss, struct tstat *ps, int nact)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;%s %u %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld\n&quot;</span>,</span><br><span class="line">                        hp,</span><br><span class="line">                        pagesize,</span><br><span class="line">                        ss-&gt;mem.physmem,</span><br><span class="line">                        ss-&gt;mem.freemem,</span><br><span class="line">                        ss-&gt;mem.cachemem,</span><br><span class="line">                        ss-&gt;mem.buffermem,</span><br><span class="line">                        ss-&gt;mem.slabmem,</span><br><span class="line">                        ss-&gt;mem.cachedrt,</span><br><span class="line">                        ss-&gt;mem.slabreclaim,</span><br><span class="line">                        ss-&gt;mem.vmwballoon,</span><br><span class="line">                        ss-&gt;mem.shmem,</span><br><span class="line">                        ss-&gt;mem.shmrss,</span><br><span class="line">                        ss-&gt;mem.shmswp,</span><br><span class="line">                        ss-&gt;mem.hugepagesz,</span><br><span class="line">                        ss-&gt;mem.tothugepage,</span><br><span class="line">                        ss-&gt;mem.freehugepage,</span><br><span class="line">                        ss-&gt;mem.zfsarcsize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | awk <span class="string">&#x27;NF&gt;10 &#123;if($(NF-6)+$(NF-4)&gt;120000) &#123;if($NF==&quot;y&quot;) print $0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># show the proc/thread read or write &gt; 60MB</span></span><br></pre></td></tr></table></figure>
<h3 id="xattr"><a href="#xattr" class="headerlink" title="xattr"></a>xattr</h3><p>If you files system support attr</p>
<ul>
<li>: Adds the attribute to the existing attribute of the files.<br>– : Removes the attribute to the existing attribute of the files.<br>&#x3D; : Keep the existing attributes that the files have.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">$ chattr +i -R demo</span><br><span class="line">$ <span class="built_in">rm</span> -rf demo/</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/0’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/1’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/2’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/3’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/4’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/5’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/6’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/7’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/8’: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘demo/9’: Permission denied</span><br><span class="line"></span><br><span class="line">$ lsattr demo/</span><br><span class="line">----i----------- demo/0</span><br><span class="line">----i----------- demo/1</span><br><span class="line">----i----------- demo/2</span><br><span class="line">----i----------- demo/3</span><br><span class="line">----i----------- demo/4</span><br><span class="line">----i----------- demo/5</span><br><span class="line">----i----------- demo/6</span><br><span class="line">----i----------- demo/7</span><br><span class="line">----i----------- demo/8</span><br><span class="line">----i----------- demo/9</span><br><span class="line">$ chattr -i -R demo/</span><br><span class="line">$ <span class="built_in">rm</span> -f demo/*</span><br><span class="line"></span><br><span class="line"><span class="comment">### could be append</span></span><br><span class="line">$ chattr -R +a demo/</span><br><span class="line">$ <span class="built_in">cd</span> demo/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">0  1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; 0</span><br><span class="line">-bash: 0: Operation not permitted</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt;&gt; 0</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">$ lsattr 0</span><br><span class="line"></span><br><span class="line">----i----------- demo/0</span><br><span class="line">----i----------- demo/1</span><br><span class="line">----i----------- demo/2</span><br><span class="line">----i----------- demo/3</span><br><span class="line">----i----------- demo/4</span><br><span class="line">----i----------- demo/5</span><br><span class="line">----i----------- demo/6</span><br><span class="line">----i----------- demo/7</span><br><span class="line">----i----------- demo/8</span><br><span class="line">----i----------- demo/9</span><br><span class="line">$ chattr -i -R demo/</span><br><span class="line">$ <span class="built_in">rm</span> -f demo/*</span><br><span class="line"></span><br><span class="line"><span class="comment">### could be append</span></span><br><span class="line">$ chattr -R +a demo/</span><br><span class="line">$ <span class="built_in">cd</span> demo/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">0  1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; 0</span><br><span class="line">-bash: 0: Operation not permitted</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt;&gt; 0</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">$ lsattr 0</span><br><span class="line">-----a---------- 0</span><br><span class="line">$ <span class="built_in">rm</span> -f 0</span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘0’: Operation not permitted</span><br><span class="line"></span><br><span class="line">$ chattr -R -a demo</span><br><span class="line">$ <span class="built_in">rm</span> -f demo/*</span><br></pre></td></tr></table></figure>


<h4 id="tc"><a href="#tc" class="headerlink" title="tc"></a><a target="_blank" rel="noopener" href="https://colobu.com/2017/04/21/tc-introduction/">tc</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## fixed delay</span></span><br><span class="line">$ tc qdisc add dev eth0 root netem delay 100ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## fixed delay range 100ms ± 10ms</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## This causes the added delay to be 100ms ± 10ms with the next random element depending 25% on the last one. This isn&#x27;t true statistical correlation, but an approximation.</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% package loss</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.1%</span><br><span class="line"></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.3% 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1% duplicate package</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem duplicate 1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% randomly modify single bit</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem corrupt 0.1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order, 5,10,15,20,25... package send right now, the others delay 10ms, it &#x27;s fixed, not random</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem gap 5 delay 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order randomly, 25% will be transmit, the others will be delay 10ms, next and previos has the 50% relevance ??</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 10ms reorder 25% 50%</span><br><span class="line"></span><br><span class="line"><span class="comment">## delay time range at 100ms ± 75ms, it could cause the package out of order</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 75ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## flow control</span></span><br><span class="line">$ tc qdisc add dev eth0 root handle 1:0 netem delay 100ms</span><br><span class="line">$ tc qdisc add dev eth0 parent 1:1 handle 10: tbf rate 256kbit buffer 1600 <span class="built_in">limit</span> 3000</span><br><span class="line">$ tc -s qdisc <span class="built_in">ls</span> dev eth0</span><br></pre></td></tr></table></figure>

<h4 id="CentOS-VNC"><a href="#CentOS-VNC" class="headerlink" title="CentOS VNC"></a>CentOS VNC</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall -y <span class="string">&quot;GNOME Desktop&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#if there is no another data in this file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;exec gnome-session&quot;</span> &gt; ~/.xinitrc</span><br><span class="line"></span><br><span class="line">systemctl is-enabled vncserver@.service</span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@.service</span><br><span class="line"></span><br><span class="line">systemctl get-default</span><br><span class="line">systemctl set-default multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:4.service</span><br><span class="line">vi /etc/systemd/system/vncserver@:4.service <span class="comment">## replace root user to normal user</span></span><br><span class="line">ExecStart=/usr/sbin/runuser -l root -c <span class="string">&quot;/usr/bin/vncserver %i&quot;</span></span><br><span class="line">PIDFile=/root/.vnc/%H%i.pid</span><br><span class="line"></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="built_in">ln</span> -s <span class="string">&#x27;/etc/systemd/system/vncserver@:4.service&#x27;</span> <span class="string">&#x27;/etc/systemd/system/multi-user.target.wants/vncserver@:4.service&#x27;</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@:4.service</span><br><span class="line">systemctl start vncserver@:4.service</span><br></pre></td></tr></table></figure>

<p>#Vncserer was runing, but there is no desktop in centos 7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ yum groupinstall Xfce</span><br><span class="line">$ yum install xorg-x11-twm xterm xorg-x11-xinit</span><br><span class="line">$ <span class="built_in">chmod</span>  755 ~/.vnc/xstartup</span><br><span class="line">$ <span class="built_in">cat</span> ~/.vnc/xstartup</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> SESSION_MANAGER</span><br><span class="line"><span class="built_in">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class="line"><span class="built_in">exec</span> startxfce4</span><br></pre></td></tr></table></figure>

<h4 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\<span class="string">&#x27;&quot;collectl --export graphite,$ip,d=2 -i60 -s CMDN --netfilt &quot;\&quot;&quot;eth|en|p[0-9]|em&quot;\&quot;&quot; --dskfilt &quot;\&quot;&quot;nvme|sd&quot;\&quot;\&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#exit reverse-i-search mode</span></span><br><span class="line">ctrl + g</span><br><span class="line"></span><br><span class="line">$ screen -L -Logfile screen.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># read</span></span><br><span class="line">$ less -R screen.log</span><br></pre></td></tr></table></figure>

<p>copy mode<br>ctrl + A + esc, press space, scroll up and select the text you want<br>and press “space&#x2F;blank” to copied<br>ctrl + A + c, create a new session, and use vim open a file, press i go to insert mode, and press ctrl + a + ], it will copy all text to vim.<br>background running by screen</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\<span class="string">&#x27;&quot;collectl --export graphite,10.53.20.206:2003,d=1 -i60 -s CMDN --netfilt &quot;\&quot;&quot;eth|en|p[0-9]|em&quot;\&quot;&quot; --dskfilt &quot;\&quot;&quot;nvme|sd&quot;\&quot;\&#x27;</span></span><br><span class="line">$ ssh -n <span class="variable">$line</span> <span class="string">&quot;sh /home/test001/kill.sh;&quot;</span></span><br><span class="line">$ <span class="built_in">cat</span> /home/test001/kill.sh</span><br><span class="line">pstree -p | awk -F <span class="string">&#x27;[)( ]+&#x27;</span> <span class="string">&#x27;$0~/screen/&#123;print $3&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;to kill &quot;</span><span class="variable">$line</span></span><br><span class="line">   pkill -9 -P <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ ssh -n <span class="variable">$line</span> <span class="string">&quot;top -n 3 -b | head&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ssh and awk</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;timeout 60 ssh <span class="variable">$line</span> \&quot;echo ps auxn \\| awk \&#x27;\\\\\\\$1!=0\&#x27; | bash \&quot;&quot;</span></span><br><span class="line">$ ssh root@test_node1 <span class="string">&quot;echo cat /tmp/tmp  \| awk \&#x27;\\\$1!=0\&#x27; | bash &quot;</span></span><br><span class="line">1 1 1</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> hosts | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$line</span> ; ssh -n <span class="variable">$line</span> <span class="string">&quot;pkill lustre_exporter; ps aux | grep run.sh&quot;</span>; scp run.sh <span class="variable">$line</span>:/root/; ssh -n <span class="variable">$line</span> <span class="string">&quot;screen -dmS test_screen /root/run.sh&quot;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line">ssh <span class="variable">$line</span> <span class="string">&quot;screen -dmS test su -s /bin/bash -c \&quot;cd /<span class="variable">$&#123;i&#125;</span>/test/; source test.sh;sh ./run.sh;\&quot;&quot;</span> &amp;</span><br><span class="line">((i++))</span><br><span class="line"><span class="keyword">done</span> &lt; test_hosts</span><br></pre></td></tr></table></figure>

<h4 id="VLC"><a href="#VLC" class="headerlink" title="VLC"></a>VLC</h4><h5 id="Not-show-media-title"><a href="#Not-show-media-title" class="headerlink" title="Not show media title"></a>Not show media title</h5><p><a target="_blank" rel="noopener" href="https://forum.videolan.org/viewtopic.php?t=50202">Same question</a><br>Tools–&gt;Preferences–&gt;Subtitles &#x2F; OSD–&gt; Show media title on media start (disable it)<br>Tools–&gt;Preferences–&gt;Subtitles &#x2F; OSD–&gt; Enable on screen display (disable it)</p>
<h5 id="Not-resize-interface"><a href="#Not-resize-interface" class="headerlink" title="Not resize interface"></a>Not resize interface</h5><p><img src="/img/vlc-set1.png"></p>
<h5 id="record-stream-by-vlc-and-front-camera"><a href="#record-stream-by-vlc-and-front-camera" class="headerlink" title="record stream by vlc and front camera"></a>record stream by vlc and front camera</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> 777 /tmp/sshfs/record</span><br><span class="line"></span><br><span class="line"><span class="comment">#not worked extfat, only ext4 or sshfs and support linux permission</span></span><br><span class="line">$ vlc -I dummy v4l2:///dev/video0 --no-audio --sout=<span class="string">&quot;#transcode&#123;venc=x264,vcodec=h264,vb=800,width=640,height=480,fps=16.0&#125;:std&#123;mux=mp4,dst=/sshfs/record/<span class="subst">$(date &#x27;+%Y%m%d-%H%M%S&#x27;)</span>.mp4,access=file&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#$ vlc -I dummy v4l2:///dev/video0 --no-audio --sout=&quot;#transcode&#123;venc=x264&#123;aud,profile=baseline,level=30,no-cabac&#125;,vcodec=h264,vb=800,width=640,height=480,fps=24.0&#125;:std&#123;mux=mp4,dst=~/sshfs/record/$(date &#x27;+%Y%m%d-%H%M%S&#x27;).mp4,access=file&#125;&quot;</span></span><br><span class="line"><span class="comment">#not work $ vlc -I dummy v4l2:///dev/video0 --video-filter adjust --fps-fps=16 --no-audio --sout=&quot;#transcode&#123;vcodec=mp4v,vfilter=canvas&#123;width=640,height=480&#125;&#125;:std&#123;access=file,mux=mp4,dst=/sshfs/record/$(date &#x27;+%Y%m%d-%H%M%S&#x27;).mp4&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#take photograph</span></span><br><span class="line">$ vlc -I dummy v4l2:///dev/video0 --video-filter scene --no-audio --scene-path /home/zzz --scene-prefix image_prefix --scene-format png vlc://quit --run-time=1</span><br><span class="line"><span class="built_in">echo</span> send mail!!</span><br><span class="line">uuencode /home/zzz/image_prefix00001.png image_prefix00001| mail -s <span class="string">&quot;`date`&quot;</span>  xxx@gmail.com</span><br></pre></td></tr></table></figure>

<h4 id="grub"><a href="#grub" class="headerlink" title="grub"></a>grub</h4><p>CentOS 7 add kernel parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable pcie power save</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;pcie_aspm=off scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y consoleblank=0&#x27;</span></span><br><span class="line"></span><br><span class="line">grubby --remove-args=<span class="string">&quot;argX argY&quot;</span> --args=<span class="string">&quot;argA argB&quot;</span> --update-kernel /boot/kernel</span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## kernel boot blacklist</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;modprobe.blacklist=mpt2sas&#x27;</span></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/modprobe.d/anaconda-blacklist.conf</span><br><span class="line"><span class="comment"># Module blacklists written by anaconda</span></span><br><span class="line">blacklist mpt2sas</span><br><span class="line"></span><br><span class="line"><span class="comment">## disable screen saver,  The console blank (screen saver) timeout in seconds.</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;consoleblank=0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## debug boot information, Enabling this can be very useful for tracking down hardware issues.</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;earlyprintk=[ vga | serial ][,ttyS n [, baudrate ]][,keep]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Disable consistent network device naming</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;biosdevname=0&#x27;</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;net.ifnames=0&#x27;</span></span><br><span class="line">or</span><br><span class="line"><span class="built_in">ln</span> -s /dev/null /etc/udev/rules.d/80-net-name-slot.rules</span><br><span class="line"></span><br><span class="line"><span class="comment">## disable hugepage and avoid vmware hang in ubuntu 20.04</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;transparent_hugepage=never&#x27;</span></span><br><span class="line">$ sysctl -w vm.swappiness=5</span><br><span class="line">And Add swap to 2GB and <span class="built_in">disable</span> nvme write cache <span class="keyword">in</span> vmware disk setting, not the nvme block device</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## set boot order</span></span><br><span class="line">grubby --default-kernel</span><br><span class="line">grubby --default-index</span><br><span class="line">grubby --set-default /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br><span class="line">grubby --info=ALL</span><br><span class="line">grubby --info /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br></pre></td></tr></table></figure>

<p>set default boot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">grubby --info=ALL</span><br><span class="line">index=0</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-514.6.1.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-514.6.1.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-514.6.1.el7.x86_64) 7 (Core)</span><br><span class="line">index=1</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-327.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-327.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)</span><br><span class="line">index=2</span><br><span class="line">kernel=/boot/vmlinuz-0-rescue-f614a3c482eb4b21add5ae750b3871bb</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-0-rescue-f614a3c482eb4b21add5ae750b3871bb.img</span><br><span class="line">title=CentOS Linux (0-rescue-f614a3c482eb4b21add5ae750b3871bb) 7 (Core)</span><br><span class="line">index=3</span><br><span class="line">non linux entry</span><br><span class="line"></span><br><span class="line">grubby --set-default /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br><span class="line">grubby --info /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>set debug parameters    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;mem=66G&#x27;</span></span><br><span class="line"><span class="comment">## for debug</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;rd.debug rdudevdebug loglevel=7 systemd.log_level=debug systemd.log_target=console console=ttyS1,115200n8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>set kdump   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grubby --update-kernel=ALL --remove-args=<span class="string">&quot;crashkernel=auto&quot;</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;crashkernel=256M@16M&#x27;</span></span><br><span class="line"><span class="comment">#an additional 64MB added for each TB of physical RAM present in the system. So for example if a system has 1TB of memory 192MB (128MB + 64MB) will be reserved</span></span><br><span class="line"><span class="comment">#after you set 256M@16M</span></span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/kexec_crash_size</span><br><span class="line">268435456</span><br></pre></td></tr></table></figure>
<p>crashkernel&#x3D;X@Y<br>X: denotes how much memory to reserve for the second kernel(capture kernel)<br>Y: denotes what physical address the reserved memory section starts<br>X-Y&#x3D;Z: Capture kernel runs form reserved memory location(Z)   </p>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/3700611">set the early kdump in RHEL 8</a>  </p>
<ul>
<li>Early kdump is a new feature of the kdump mechanism to capture the kernel crash dump of the booting kernel</li>
<li>In earlier releases of RHEL(5&#x2F;6&#x2F;7), the kdump service starts too late during the boot sequence, so early crashes will have no chance to get kdump kernel booting, this will cause crash information to be lost.</li>
<li>Early Kdump stores the vmlinuz and initramfs of the crash kernel inside the initramfs of the booting kernel and load them directly into the reserved memory (crashkernel) during early boot stage.</li>
<li>Two dracut modules are added in the kexec-tools package in order to load crash kernel and initramfs as early as possible during the boot sequence to capture the kernel crash dump of the booting kernel.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> kdump</span><br><span class="line">$ systemctl start kdump</span><br><span class="line">$ dracut --list-modules | grep earlykdump</span><br><span class="line">$ <span class="built_in">touch</span> /etc/systemd/system/sysrq.service</span><br><span class="line">$ <span class="built_in">chmod</span> 664 /etc/systemd/system/sysrq.service</span><br><span class="line">$ <span class="built_in">cat</span> /etc/systemd/system/sysrq.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Custom SysRq Service to <span class="built_in">test</span> early kdump</span><br><span class="line">Before=kdump.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/early-kdump-test.sh</span><br><span class="line">Type=simple</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /usr/local/early-kdump-test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/bin/grep <span class="string">&quot;early_panic&quot;</span> /proc/cmdline&gt; /dev/null</span><br><span class="line">output=$(<span class="built_in">echo</span> $?)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$output</span> -eq <span class="string">&quot;0&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> +x /usr/local/early-kdump-test.sh</span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl <span class="built_in">enable</span> sysrq.service</span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;early_panic&#x27;</span></span><br><span class="line">or</span><br><span class="line">$ dracut -f --add earlykdump</span><br><span class="line">$ journalctl -x | grep early-kdump</span><br></pre></td></tr></table></figure>

<h4 id="set-systemd-journal-not-in-the-x2F-run-x2F-log"><a href="#set-systemd-journal-not-in-the-x2F-run-x2F-log" class="headerlink" title="set systemd journal not in the &#x2F;run&#x2F;log"></a>set systemd journal not in the &#x2F;run&#x2F;log</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/journalctl --vacuum-size=200M <span class="comment">#add it to the crond</span></span><br><span class="line"></span><br><span class="line">$ /etc/systemd/journald.conf</span><br><span class="line">Storage=persistent</span><br><span class="line">SystemMaxUse=1G <span class="comment"># not test</span></span><br><span class="line"></span><br><span class="line">$ systemctl restart systemd-journald.service</span><br><span class="line"></span><br><span class="line">$ journalctl --vacuum-size=512M</span><br><span class="line">$ journalctl --vacuum-files=2</span><br><span class="line">$ journalctl --verify</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /usr/lib/tmpfiles.d/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/ntpd</span><br><span class="line">ExecStart=/usr/sbin/ntpd -u ntp:ntp <span class="variable">$OPTIONS</span></span><br><span class="line">PrivateTmp=<span class="literal">true</span>  &lt;--- tmp files</span><br><span class="line"></span><br><span class="line">sytemd-tmpfiles-setup.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## clean all</span></span><br><span class="line"><span class="comment"># ExecStart=/usr/bin/systemd-tmpfiles --create --remove --boot --exclude-prefix=/dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">$ <span class="built_in">env</span> SYSTEMD_LOG_LEVEL=debug systemd-tmpfiles --clean</span><br><span class="line"><span class="comment"># http://bean-li.github.io/systemd-tmpfiles/</span></span><br></pre></td></tr></table></figure>

<h3 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a><a target="_blank" rel="noopener" href="https://gist.github.com/tuxfight3r/9ac030cb0d707bb446c7">tcpdump</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define ETH_P_PAUSE 0x8808 /* IEEE Pause frames</span></span><br><span class="line">$ tcpdump -w test.pcap -i bond0 ether proto 0x8808</span><br><span class="line"></span><br><span class="line"><span class="comment"># get ack and syn packet</span></span><br><span class="line">$ tcpdump <span class="string">&quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">$ tcpdump -n -i eth0 -A -x dst port 443 and greater 100</span><br><span class="line">$ tcpdump -i eth0 -nt -s 500 port 53 and udp</span><br><span class="line">$ tcpdump -ni enp97s0f0 -s0 -w /tmp/capture.pcap host <span class="variable">$hostname1</span></span><br><span class="line"></span><br><span class="line">$ <span class="comment">##TCP FLAGS##</span></span><br><span class="line"></span><br><span class="line">Unskilled Attackers Pester Real Security Folks</span><br><span class="line">==============================================</span><br><span class="line">                     TCPDUMP FLAGS</span><br><span class="line">Unskilled =  URG  =  (Not Displayed <span class="keyword">in</span> Flag Field, Displayed elsewhere)</span><br><span class="line">Attackers =  ACK  =  (Not Displayed <span class="keyword">in</span> Flag Field, Displayed elsewhere)</span><br><span class="line">Pester    =  PSH  =  [P] (Push Data)</span><br><span class="line">Real      =  RST  =  [R] (Reset Connection)</span><br><span class="line">Security  =  SYN  =  [S] (Start Connection)</span><br><span class="line">Folks     =  FIN  =  [F] (Finish Connection)</span><br><span class="line">          SYN-ACK =  [S.] (SynAcK Packet)</span><br><span class="line">                     [.] (No Flag Set)</span><br><span class="line"></span><br><span class="line"><span class="comment">##USAGE##</span></span><br><span class="line">Basic communication // see the basics without many options</span><br><span class="line"><span class="comment"># tcpdump -nS</span></span><br><span class="line"></span><br><span class="line">Basic communication (very verbose) // see a good amount of traffic, with verbosity and no name <span class="built_in">help</span></span><br><span class="line"><span class="comment"># tcpdump -nnvvS</span></span><br><span class="line"></span><br><span class="line">A deeper look at the traffic // adds -X <span class="keyword">for</span> payload but doesn’t grab any more of the packet</span><br><span class="line"><span class="comment"># tcpdump -nnvvXS</span></span><br><span class="line"></span><br><span class="line">Heavy packet viewing // the final “s” increases the snaplength, grabbing the whole packet</span><br><span class="line"><span class="comment"># tcpdump -nnvvXSs 1514</span></span><br><span class="line"></span><br><span class="line">host // look <span class="keyword">for</span> traffic based on IP address (also works with hostname <span class="keyword">if</span> you’re not using -n)</span><br><span class="line"><span class="comment"># tcpdump host 1.2.3.4</span></span><br><span class="line"></span><br><span class="line">src, dst // find traffic from only a <span class="built_in">source</span> or destination (eliminates one side of a host conversation)</span><br><span class="line"><span class="comment"># tcpdump src 2.3.4.5</span></span><br><span class="line"><span class="comment"># tcpdump dst 3.4.5.6</span></span><br><span class="line"></span><br><span class="line">net // capture an entire network using CIDR notation</span><br><span class="line"><span class="comment"># tcpdump net 1.2.3.0/24</span></span><br><span class="line"></span><br><span class="line">proto // works <span class="keyword">for</span> tcp, udp, and icmp. Note that you don’t have to <span class="built_in">type</span> proto</span><br><span class="line"><span class="comment"># tcpdump icmp</span></span><br><span class="line"></span><br><span class="line">port // see only traffic to or from a certain port</span><br><span class="line"><span class="comment"># tcpdump port 3389</span></span><br><span class="line"></span><br><span class="line">src, dst port // filter based on the <span class="built_in">source</span> or destination port</span><br><span class="line"><span class="comment"># tcpdump src port 1025 # tcpdump dst port 389</span></span><br><span class="line"></span><br><span class="line">src/dst, port, protocol // combine all three</span><br><span class="line"><span class="comment"># tcpdump src port 1025 and tcp</span></span><br><span class="line"><span class="comment"># tcpdump udp and src port 53</span></span><br><span class="line"></span><br><span class="line">You also have the option to filter by a range of ports instead of declaring them individually, and to only see packets that are above or below a certain size.</span><br><span class="line"></span><br><span class="line">Port Ranges // see traffic to any port <span class="keyword">in</span> a range</span><br><span class="line">tcpdump portrange 21-23</span><br><span class="line"></span><br><span class="line">Packet Size Filter // only see packets below or above a certain size (<span class="keyword">in</span> bytes)</span><br><span class="line">tcpdump less 32</span><br><span class="line">tcpdump greater 128</span><br><span class="line">[ You can use the symbols <span class="keyword">for</span> less than, greater than, and less than or equal / greater than or equal signs as well. ]</span><br><span class="line"></span><br><span class="line">// filtering <span class="keyword">for</span> size using symbols</span><br><span class="line">tcpdump &gt; 32</span><br><span class="line">tcpdump &lt;= 128</span><br><span class="line"></span><br><span class="line">[ Note: Only the PSH, RST, SYN, and FIN flags are displayed <span class="keyword">in</span> tcpdump‘s flag field output. URGs and ACKs are displayed, but they are shown elsewhere <span class="keyword">in</span> the output rather than <span class="keyword">in</span> the flags field ]</span><br><span class="line"></span><br><span class="line">Keep <span class="keyword">in</span> mind the reasons these filters work. The filters above find these various packets because tcp[13] looks at offset 13 <span class="keyword">in</span> the TCP header, the number represents the location within the byte, and the !=0 means that the flag <span class="keyword">in</span> question is <span class="built_in">set</span> to 1, i.e. it’s on.</span><br><span class="line"></span><br><span class="line">Show all URG packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 32 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all ACK packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 16 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all PSH packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 8 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all RST packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 4 != 0&#x27;</span></span><br><span class="line">Show all SYN packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 2 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all FIN packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 1 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all SYN-ACK packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] = 18&#x27;</span></span><br><span class="line"></span><br><span class="line">Show icmp <span class="built_in">echo</span> request and reply</span><br><span class="line"><span class="comment">#tcpdump -n icmp and &#x27;icmp[0] != 8 and icmp[0] != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all IP packets with a non-zero TOS field (one byte TOS field is at offset 1 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -v -n ip and ip[1]!=0</span></span><br><span class="line"></span><br><span class="line">Show all IP packets with TTL less than some value (on byte TTL field is at offset 8 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -v ip and &#x27;ip[8]&lt;2&#x27;</span></span><br><span class="line"></span><br><span class="line">Show TCP SYN packets:</span><br><span class="line"><span class="comment"># tcpdump -n tcp and port 80 and &#x27;tcp[tcpflags] &amp; tcp-syn == tcp-syn&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump tcp and port 80 and &#x27;tcp[tcpflags] == tcp-syn&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-syn) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP ACK packets:</span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-ack) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP SYN/ACK packets (typically, responses from servers):</span><br><span class="line"><span class="comment"># tcpdump -n tcp and &#x27;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) == (tcp-syn|tcp-ack)&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -n tcp and &#x27;tcp[tcpflags] &amp; tcp-syn == tcp-syn&#x27; and &#x27;tcp[tcpflags] &amp; tcp-ack == tcp-ack&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP FIN packets:</span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-fin) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show ARP Packets with MAC address</span><br><span class="line"><span class="comment"># tcpdump -vv -e -nn ether proto 0x0806</span></span><br><span class="line"></span><br><span class="line">Show packets of a specified length (IP packet length (16 bits) is located at offset 2 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -l icmp and &#x27;(ip[2:2]&gt;50)&#x27; -w - |tcpdump -r - -v ip and &#x27;(ip[2:2]&lt;60)&#x27;</span></span><br><span class="line"></span><br><span class="line">http://danielmiessler.com/study/tcpdump/</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.wains.be/pub/networking/tcpdump_advanced_filters.txt">tcpdump_advanced_filters</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- This rule will match any TCP traffic on port 80 (web) with 192.168.1.254 or 192.168.1.200 as destination host</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((tcp) and (port 80) and ((dst host 192.168.1.254) or (dst host 192.168.1.200)))&#x27;</span></span><br><span class="line"></span><br><span class="line">- Will match any ICMP traffic involving the destination with physical/MAC address 00:01:02:03:04:05</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((icmp) and ((ether dst host 00:01:02:03:04:05)))&#x27;</span></span><br><span class="line"></span><br><span class="line">- Will match any traffic <span class="keyword">for</span> the destination network 192.168 except destination host 192.168.1.200</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((tcp) and ((dst net 192.168) and (not dst host 192.168.1.200)))&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="MTU-problem-check"><a href="#MTU-problem-check" class="headerlink" title="MTU problem check"></a>MTU problem check</h3><p>Level 3 network, between 2 nodes pass through gateway<br>Tcpdump show some packets loss, nmap show 10.xx.xx.clent port is “open”.<br>There are some packages return, some are not.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ping -f -c 20000 -M <span class="keyword">do</span> -s 8972 10.xx.xx.client</span><br><span class="line">PING 10.xx.xx.client (10.xx.xx.client) 8972(9000) bytes of data.</span><br><span class="line">...................................................................^C</span><br><span class="line">--- 10.xx.xx.client ping statistics ---</span><br><span class="line">67 packets transmitted, 0 received, 100% packet loss, time 1076ms</span><br></pre></td></tr></table></figure>
<p>You can got the issue from tcpdump, all larger than 1500 packets are loss.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">client <span class="comment"># tcpdump -v host 10.53.19.52 and greater 1500</span></span><br><span class="line">tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes</span><br><span class="line">11:23:58.134708 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27071, offset 0, flags [DF], proto TCP (6), length 8532)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], <span class="built_in">cksum</span> 0x496d (incorrect -&gt; 0x5fe6), <span class="built_in">seq</span> 2359537411:2359545891, ack 3804990367, win 53, options [nop,nop,TS val 1203816317 ecr 81802289], length 8480</span><br><span class="line">11:23:58.136045 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27077, offset 0, flags [DF], proto TCP (6), length 7292)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [.], <span class="built_in">cksum</span> 0x4495 (incorrect -&gt; 0xe386), <span class="built_in">seq</span> 8480:15720, ack 1, win 53, options [nop,nop,TS val 1203816318 ecr 81802294], length 7240</span><br><span class="line">11:23:58.148023 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27083, offset 0, flags [DF], proto TCP (6), length 8588)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], <span class="built_in">cksum</span> 0x49a5 (incorrect -&gt; 0x4006), <span class="built_in">seq</span> 17016:25552, ack 1, win 53, options [nop,nop,TS val 1203816330 ecr 81802295], length 8536</span><br></pre></td></tr></table></figure>
<p>If client MTU is 1500, tcpdump(client) will not receive any large packages. they are loss in switch.   </p>
<h4 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h4><h5 id="Exclude-packages"><a href="#Exclude-packages" class="headerlink" title="Exclude packages"></a>Exclude packages</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install --enablerepo=<span class="string">&quot;epel&quot;</span> iotop</span><br><span class="line">$ yum update --exclude=kernel*</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">keepcache=0</span><br><span class="line">debuglevel=2</span><br><span class="line">logfile=/var/log/yum.log</span><br><span class="line">exclude=kernel* redhat-release* *.i?86</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10185">reference</a></p>
<h5 id="Switch-version"><a href="#Switch-version" class="headerlink" title="Switch version"></a>Switch version</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ yum --showduplicates list kernel</span><br><span class="line">Installed Packages</span><br><span class="line">Installed Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       @anaconda-CentOS-201508042137.x86_64/6.7</span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   @update</span><br><span class="line">Available Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       base</span><br><span class="line">kernel.x86_64       2.6.32-573.1.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.3.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.7.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.12.1.el6  update</span><br><span class="line">kernel.x86_64       2.6.32-573.18.1.el6  update</span><br></pre></td></tr></table></figure>

<h5 id="Yum-conf"><a href="#Yum-conf" class="headerlink" title="Yum.conf"></a>Yum.conf</h5><figure class="highlight apacheconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keepcache</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h5 id="Download-to-local"><a href="#Download-to-local" class="headerlink" title="Download to local"></a>Download to local</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">install</span> <span class="string">yum-plugin-downloadonly</span></span><br><span class="line"><span class="string">$</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">--downloadonly</span> <span class="string">--downloaddir=&lt;directory&gt;</span> <span class="string">&lt;package&gt;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10154">reference</a></p>
<h5 id="Resolve-dependency-resolution-errors"><a href="#Resolve-dependency-resolution-errors" class="headerlink" title="Resolve dependency resolution errors"></a>Resolve dependency resolution errors</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum update</span></span><br><span class="line">** Found 5 pre-existing rpmdb problem(s), <span class="string">&#x27;yum check&#x27;</span> output follows:</span><br><span class="line">MegaCli-8.04.10-1.noarch is a duplicate with MegaCli-8.04.07-1.noarch</span><br><span class="line">kernel-2.6.32-279.5.1.el6_lustre.gb16fe80.x86_64 has missing requires of kernel-firmware &gt;= (<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2.6.32&#x27;</span>, <span class="string">&#x27;279.5.1.el6_lustre.gb16fe80&#x27;</span>)</span><br><span class="line">kernel-firmware-2.6.32-279.5.1.el6.noarch is a duplicate with kernel-firmware-2.6.32-279.el6.noarch</span><br><span class="line">kernel-headers-2.6.32-279.5.1.el6.x86_64 is a duplicate with kernel-headers-2.6.32-279.el6.x86_64</span><br><span class="line">libcom_err-1.42.3.wc3-7.el6.x86_64 is a duplicate with libcom_err-1.41.12-12.el6.i686</span><br><span class="line">......</span><br><span class="line">You could try using --skip-broken to work around the problem</span><br><span class="line">You could try running: rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure>

<h5 id="Uninstall-rpm-packages-from-rpmdb"><a href="#Uninstall-rpm-packages-from-rpmdb" class="headerlink" title="Uninstall rpm packages from rpmdb"></a>Uninstall rpm packages from rpmdb</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -e --justdb --nodeps <span class="string">&quot;bad rpm packages&quot;</span></span><br><span class="line">$ rpm -ivh --force <span class="string">&quot;replace normal rpm packages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rebuild rpmdb</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/rpm</span><br><span class="line">$ <span class="built_in">rm</span>  -f __db*</span><br><span class="line">$ rpm --rebuilddb</span><br><span class="line"></span><br><span class="line">$ yum clean all</span><br><span class="line">$ yum -y update</span><br></pre></td></tr></table></figure>

<h4 id="upgrade-kernel"><a href="#upgrade-kernel" class="headerlink" title="upgrade kernel"></a>upgrade kernel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://sourceware.org/elfutils/ftp/0.170/elfutils-0.170.tar.bz2</span><br><span class="line">$ tar xjvf elfutils-0.170.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> ./elfutils-0.170</span><br><span class="line">$ ./configire; make -j 8; make install</span><br><span class="line">$ <span class="built_in">export</span> C_INCLUDE_PATH=/sources/kernel/elfutils-0.170/libelf:/sources/lib/el7/mpich-3.2.1/include/:<span class="variable">$C_INCLUDE_PATH</span></span><br><span class="line">$ <span class="built_in">cp</span> -v /boot/config-3.10.0-693.21.1.el7.x86_64 .config</span><br><span class="line">make menuconfig</span><br><span class="line">make rpm-pkg</span><br><span class="line"><span class="comment">### enable what your want</span></span><br></pre></td></tr></table></figure>

<h5 id="patch-kernel"><a href="#patch-kernel" class="headerlink" title="patch kernel"></a>patch kernel</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.10.tar.xz</span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/patch-5.10.22.xz    <span class="comment">## size: 718K</span></span><br><span class="line"><span class="comment">## it &#x27;s the full patch from 5.10, not incr</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> linux-5.10</span><br><span class="line">$ patch -p1 --dry-run &lt; ../patch-5.10.22</span><br><span class="line"><span class="comment">### from 5.10 direct to 5.10.22</span></span><br><span class="line">$ patch -p1 &lt; ../path-5.10.22</span><br><span class="line">$ patch -p1 -R &lt; ../path-5.10.22</span><br><span class="line"></span><br><span class="line"><span class="comment">### from 5.10.21 to 5.10.22</span></span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.10.21.tar.xz</span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/incr/patch-5.10.21-22.xz <span class="comment">## incr size: 15K</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> linux-5.10.21</span><br><span class="line">$ patch -p1 --dry-run &lt; ../patch-5.10.21-22</span><br><span class="line">...</span><br><span class="line">checking file security/tomoyo/network.c</span><br><span class="line">checking file sound/hda/intel-nhlt.c</span><br><span class="line">checking file sound/pci/ctxfi/cthw20k2.c</span><br><span class="line">checking file sound/pci/hda/patch_realtek.c</span><br><span class="line">Hunk <span class="comment">#1 succeeded at 6406 (offset -2 lines).</span></span><br><span class="line">Hunk <span class="comment">#2 succeeded at 7854 (offset -11 lines).</span></span><br><span class="line">Hunk <span class="comment">#3 succeeded at 7890 (offset -11 lines).</span></span><br><span class="line">checking file sound/usb/mixer.c</span><br><span class="line">checking file sound/usb/mixer_maps.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> -n 100 ../patch-5.10.21-22</span><br><span class="line">.....</span><br><span class="line">diff --git a/sound/usb/mixer_maps.c b/sound/usb/mixer_maps.c</span><br><span class="line">index a7212f16660ec..646deb6244b15 100644</span><br><span class="line">--- a/sound/usb/mixer_maps.c</span><br><span class="line">+++ b/sound/usb/mixer_maps.c</span><br><span class="line">@@ -536,6 +536,16 @@ static const struct usbmix_ctl_map usbmix_ctl_maps[] = &#123;</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">+       &#123;</span><br><span class="line">+               /* Corsair Virtuoso SE (wired mode) */</span><br><span class="line">+               .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3d),</span><br><span class="line">+               .map = corsair_virtuoso_map,</span><br><span class="line">+       &#125;,</span><br><span class="line">+       &#123;</span><br><span class="line">+               /* Corsair Virtuoso SE (wireless mode) */</span><br><span class="line">+               .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3e),</span><br><span class="line">+               .map = corsair_virtuoso_map,</span><br><span class="line">+       &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso (wired mode) */</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a41),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$  grep -A 6 <span class="string">&quot;USB_ID(0x05a7, 0x1020)&quot;</span> sound/usb/mixer_maps.c</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso (wired mode) */</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a41),</span><br><span class="line">                .map = corsair_virtuoso_map,</span><br><span class="line"></span><br><span class="line">$  patch -p1 &lt; ../patch-5.10.21-22</span><br><span class="line"></span><br><span class="line">$  grep -A 6 <span class="string">&quot;USB_ID(0x05a7, 0x1020)&quot;</span> sound/usb/mixer_maps.c</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso SE (wired mode) */  <span class="comment">### Add Virtuoso SE</span></span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3d),</span><br><span class="line">                .map = corsair_virtuoso_map,</span><br></pre></td></tr></table></figure>
<h5 id="gen-the-patch-if-you-modify-the-kernel-source"><a href="#gen-the-patch-if-you-modify-the-kernel-source" class="headerlink" title="gen the patch, if you modify the kernel source"></a><a target="_blank" rel="noopener" href="https://lzz5235.github.io/2015/09/01/kernelpatch.html">gen the patch, if you modify the kernel source</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ diff -urN <span class="built_in">arch</span>/x86/include/ ../linux-5.10.21/arch/x86/include/ &gt; patch-5.10.21-update</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">echo</span> patch1 &gt;&gt; patch2</span><br></pre></td></tr></table></figure>

<h5 id="compile-linux-kernel-failed"><a href="#compile-linux-kernel-failed" class="headerlink" title="compile linux kernel ( failed )"></a>compile linux kernel ( failed )</h5><p>For debug<br>You could disable randomize the address of the kernel image (KASLR)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_RANDOMIZE_BASE=n</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">$  /usr/lib/rpm/find-debuginfo.sh --strict-build-id /root/rpmbuild/BUILD/xxxx</span><br><span class="line">or Add to SPEC file</span><br><span class="line">%define debug_package %&#123;nil&#125;</span><br><span class="line"></span><br><span class="line">$ dnf makecache --refresh</span><br><span class="line"></span><br><span class="line">$ dnf install nss nss-devel nspr nspr-devel file file-devel popt popt-devel libdb-devel libdb lua lua-devel libdb-devel libdb-cxx-devel libarchive-devel lua-devel redhat-rpm-config  rpmdevtools dwarves perl-ExtUtils-Embed asciidoc newt-devel xmlto audit-libs-devel libcap-devel ctl-devel slang-devel  pciutils-devel binutils-devel kernel-rpm-macros ncurses-devel elfutils-libelf-devel openssl-devel libgcrypt-devel  popt-devel lzo-devel lz4-devel bison flex dwarves</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cp</span> /boot/config-4.18.0-240.el8.x86_64 .config</span><br><span class="line">$ vi .config</span><br><span class="line"><span class="comment">#CONFIG_MODULE_SIG_KEY=&quot;certs/signing_key.pem&quot;</span></span><br><span class="line"><span class="comment">#CONFIG_SYSTEM_TRUSTED_KEYRING=n</span></span><br><span class="line"><span class="comment">#CONFIG_SYSTEM_TRUSTED_KEYS=&quot;certs/rhel.pem&quot;</span></span><br><span class="line"></span><br><span class="line">$ vi scripts/package/mkspec</span><br><span class="line"><span class="comment">## replace the line  %define debug_package %&#123;nil&#125; to %define with_debuginfo</span></span><br><span class="line">        %define __spec_install_post /usr/lib/rpm/brp-compress || :</span><br><span class="line">        %define with_debug 0</span><br><span class="line">        %define _enable_debug_packages 0</span><br><span class="line">        %define debuginfodir /usr/lib/debug <span class="comment">## not working</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"><span class="comment">#replace</span></span><br><span class="line">        %define __spec_install_post /usr/lib/rpm/brp-compress</span><br><span class="line"><span class="comment">#       %define __spec_install_post /usr/lib/rpm/brp-compress || :</span></span><br><span class="line"><span class="comment">#       %define debug_package %&#123;nil&#125;</span></span><br><span class="line">and</span><br><span class="line">        %install</span><br><span class="line">        <span class="built_in">mkdir</span> -p %&#123;buildroot&#125;/boot</span><br><span class="line">        %ifarch ia64</span><br><span class="line">        <span class="built_in">mkdir</span> -p %&#123;buildroot&#125;/boot/efi</span><br><span class="line">        <span class="built_in">cp</span> \$(<span class="variable">$MAKE</span> image_name) %&#123;buildroot&#125;/boot/efi/vmlinuz-<span class="variable">$KERNELRELEASE</span></span><br><span class="line">        <span class="built_in">ln</span> -s efi/vmlinuz-<span class="variable">$KERNELRELEASE</span> %&#123;buildroot&#125;/boot/</span><br><span class="line">        %<span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cp</span> \$(<span class="variable">$MAKE</span> image_name) %&#123;buildroot&#125;/boot/vmlinuz-<span class="variable">$KERNELRELEASE</span></span><br><span class="line">        %endif</span><br><span class="line">        /usr/lib/rpm/find-debuginfo.sh %&#123;_builddir&#125;/%&#123;?buildsubdir&#125;      &lt;-------------- add this line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try to</span><br><span class="line">        MAKE=<span class="string">&quot;<span class="variable">$MAKE</span> -j 8 -f <span class="variable">$srctree</span>/Makefile&quot;</span></span><br><span class="line">%build</span><br><span class="line">MAKE=<span class="string">&quot;<span class="variable">$MAKE</span> -j 8 -f <span class="variable">$srctree</span>/Makefile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### update dwarves-1.20</span></span><br><span class="line">$ dnf install cmake elfutils-devel elfutils-libs libbpf libdwarf</span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## at the last</span></span><br><span class="line">$ make menuconfig <span class="comment"># just save once, no many question</span></span><br><span class="line">Add <span class="built_in">enable</span> the compressed cache <span class="keyword">for</span> swap page by default</span><br><span class="line"></span><br><span class="line">└─&gt; Kernel hacking</span><br><span class="line">  └─&gt; Compile-time checks and compiler options</span><br><span class="line">    └─&gt; Compile the kernel with debug info</span><br><span class="line"></span><br><span class="line"><span class="comment">## rebuild rpm</span></span><br><span class="line">$ ./autogen.sh</span><br><span class="line">$ ./configure --prefix=/opt/rpm-4.16.1.3</span><br><span class="line">$ make -j 8</span><br><span class="line"></span><br><span class="line">$ make <span class="built_in">help</span></span><br><span class="line">$ make vmlinux -j 8</span><br><span class="line">$ make bzImage</span><br><span class="line">$ make modules -j 8</span><br><span class="line">$ make modules_install -j 8</span><br><span class="line">$ make install -j 8</span><br><span class="line">$ dracut -f /boot/initramfs-5.10.41.el8.x86_64.img 5.10.41 <span class="comment">#default path is /lib/modules</span></span><br><span class="line">$ make install</span><br><span class="line">$ grubby --set-default /boot/vmlinuz-5.10.41</span><br><span class="line">$ grubby --info=ALL</span><br><span class="line">or</span><br><span class="line">$ grub2-set-default 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="comment"># mrproper clean all</span></span><br><span class="line">$ sudo make mrproper</span><br><span class="line">$ sudo make clean</span><br><span class="line"></span><br><span class="line"><span class="comment">## contine complie kernel</span></span><br><span class="line">Add <span class="built_in">env</span> to bashrc</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/opt/rpm-4.16.1.3/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=/opt/rpm-4.16.1.3/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> C_INCLUDE_PATH=<span class="string">&quot;/usr/include&quot;</span></span><br><span class="line"></span><br><span class="line">$ make rpm-pkg -j 8</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">yes</span> <span class="string">&quot;&quot;</span> | make rpm-pkg -j 8</span><br><span class="line"></span><br><span class="line"><span class="comment">## make kernel tools</span></span><br><span class="line">$ make -C tools/testing/selftests TARGETS=dma run_tests</span><br><span class="line">$ <span class="built_in">ls</span> tools/testing/selftests | grep dma_map_benchmark</span><br><span class="line"><span class="comment">## bind driver or you could not bind too</span></span><br><span class="line">$ <span class="built_in">echo</span> dma_map_benchmark &gt; /sys/bus/pci/devices/0000:00:01.0/driver_override</span><br><span class="line">$ <span class="built_in">echo</span> 0000:00:01.0 &gt; /sys/bus/pci/drivers/xxx/unbind</span><br><span class="line">$ <span class="built_in">echo</span> 0000:00:01.0 &gt; /sys/bus/pci/drivers/dma_map_benchmark/bind</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /boot; bzip -dk vmlinux-5.10.41.bz2</span><br><span class="line">$ objcopy --only-keep-debug vmlinux-5.10.41 vmlinux-5.10.41.debug</span><br><span class="line">$ eu-readelf -n vmlinux-5.10.41 | grep Build.ID</span><br><span class="line">$ objcopy --strip-debug vmlinux-5.10.41</span><br><span class="line">crash add kernel module and could <span class="built_in">read</span> the debug symbol, perf could get the <span class="built_in">source</span> code too</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">$ dma_map_benchmark -s 120 -t 16</span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --remove-args=<span class="string">&quot;crashkernel=256M@16M&quot;</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;crashkernel=384M-2G:64M,2G-:128M&quot;</span></span><br></pre></td></tr></table></figure>

<p>install crash-7.3.0<br>copy the gdb-7.6.0.tar.gz to the source code dir</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make lzo</span><br></pre></td></tr></table></figure>
<h4 id="Enable-BBR"><a href="#Enable-BBR" class="headerlink" title="Enable BBR"></a>Enable BBR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.core.default_qdisc=fq&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.tcp_congestion_control=bbr&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line">$ sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">net.ipv4.tcp_available_congestion_control = cubic bbr reno</span><br><span class="line"></span><br><span class="line">$ sysctl -n net.ipv4.tcp_congestion_control</span><br><span class="line">bbr</span><br></pre></td></tr></table></figure>

<h4 id="reinstall-grub2-from-boot-livecd"><a href="#reinstall-grub2-from-boot-livecd" class="headerlink" title="reinstall grub2 from boot livecd"></a>reinstall grub2 from boot livecd</h4><p>&#x2F;dev&#x2F;sdd2 is my linux root partition, OS is pinguyos(ubuntu)</p>
<h5 id="LVM-partition"><a href="#LVM-partition" class="headerlink" title="LVM partition"></a>LVM partition</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## lvm test demo</span></span><br><span class="line">$ pvcreate /dev/sdb1 /dev/sdc1</span><br><span class="line">$ pvs</span><br><span class="line">$ pvdisplay</span><br><span class="line">$ vgcreate vg1 /dev/sdb1 /dev/sdc1</span><br><span class="line">$ vgcreate vg1 /dev/sdb1 /dev/sdc1</span><br><span class="line">$ lvcreate -n test_vol -L +100% vg1</span><br><span class="line">$ mkfs.ext4 /dev/vg1/test_vol</span><br><span class="line"></span><br><span class="line"><span class="comment">## extend</span></span><br><span class="line">$ vgextend centos /dev/sdd1</span><br><span class="line">$ vgs</span><br><span class="line">$ lvextend -L +2GB /dev/vg1/test_vol</span><br><span class="line">$ lvs</span><br><span class="line">$ lvdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment">## rescue mode</span></span><br><span class="line">$ pvscan</span><br><span class="line">$ vgscan</span><br><span class="line">$ lvscan</span><br><span class="line">$ lvchange -a y /dev/centos_vg/lv_root</span><br></pre></td></tr></table></figure>

<h5 id="Test-in-ubuntu"><a href="#Test-in-ubuntu" class="headerlink" title="Test in ubuntu"></a>Test in ubuntu</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdd2 /opt</span><br><span class="line">mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line"><span class="built_in">chroot</span> /opt</span><br><span class="line">grub-install /dev/sdd</span><br><span class="line">grub-install --root-directory=/mnt/sysimages/boot/efi /dev/sdd</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line">or</span><br><span class="line">grub2-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">### some md raid boot failed, and goto dracut env</span></span><br><span class="line">https://ahelpme.com/linux/centos7/centos-7-dracut-initqueue-timeout-and-could-not-boot-warning-dev-disk-by-id-md-uuid-does-not-exist/</span><br><span class="line"></span><br><span class="line">re-generate the grub.cfg</span><br><span class="line">Because some partition loss cause the system boot failed</span><br><span class="line">The system could be boot after delete the mduuid not exist</span><br></pre></td></tr></table></figure>

<h5 id="Test-in-CentOS-7-set-boot-menu"><a href="#Test-in-CentOS-7-set-boot-menu" class="headerlink" title="Test in CentOS 7, set boot menu"></a>Test in CentOS 7, set boot menu</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span>   /boot/grub2/grub.cfg | grep Windows</span><br><span class="line">menuentry <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-set-default  <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-editenv list</span><br><span class="line">saved_entry=Windows 7 (loader) (on /dev/sda1)</span><br><span class="line">or</span><br><span class="line">grub2-set-default <span class="string">&quot;windows&quot;</span></span><br><span class="line"></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.conf</span><br></pre></td></tr></table></figure>
<h4 id="Re-install-EFI"><a href="#Re-install-EFI" class="headerlink" title="Re-install EFI"></a>Re-install EFI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /opt/boot /opt/root</span><br><span class="line">$ mount /dev/sda1 /opt/root</span><br><span class="line">$ mount /dev/sda2 /opt/root/boot/efi</span><br><span class="line"></span><br><span class="line">$ mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">$ mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">$ mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chroot</span> /opt</span><br><span class="line"></span><br><span class="line">$ grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span><br><span class="line">$ yum install grub2-efi</span><br><span class="line">$ efibootmgr -c --disk /dev/sda --part 2 -l <span class="string">&#x27;\EFI\centos\shimx64.efi&#x27;</span> -L <span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">// --part 2 point EFI partition number,-l \\EFI\\FEDORA\\GRUBX64.EFI point the GRUB EFI boot loader</span><br></pre></td></tr></table></figure>
<h4 id="rdesktop-to-win10"><a href="#rdesktop-to-win10" class="headerlink" title="rdesktop to win10"></a>rdesktop to win10</h4><h5 id="Enable-remote-desktop"><a href="#Enable-remote-desktop" class="headerlink" title="Enable remote desktop"></a>Enable remote desktop</h5><p><img src="/img/e_desktop.png"><br><img src="/img/e_firewall.png"></p>
<h5 id="Modify-registry-from-win10"><a href="#Modify-registry-from-win10" class="headerlink" title="Modify registry from win10"></a>Modify registry from win10</h5><p>\HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\SecurityLayer<br>from DWORD Hex ‘2’ to a value of ‘1’</p>
<p><a target="_blank" rel="noopener" href="http://ubuntuforums.org/showthread.php?t=2287213">reference</a>  </p>
<h4 id="record-and-replay-linux-terminal"><a href="#record-and-replay-linux-terminal" class="headerlink" title="record and replay linux terminal"></a>record and replay linux terminal</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ script --timing=time.txt script.log</span><br><span class="line"><span class="comment"># record what you do</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ scriptreplay --timing=time.txt script.log</span><br><span class="line"><span class="comment"># replay</span></span><br></pre></td></tr></table></figure>

<h4 id="Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><a href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable" class="headerlink" title="Getting Error su: cannot set user id: Resource temporarily unavailable"></a>Getting Error su: cannot set user id: Resource temporarily unavailable</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ulimit -u</span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line">$ ulimit -u 10240</span><br><span class="line"></span><br><span class="line">$ /etc/security/limits.conf</span><br><span class="line">testuser         -      nproc          10240</span><br><span class="line"></span><br><span class="line">$ cat /proc/sys/kernel/threads-max</span><br><span class="line">1026188</span><br></pre></td></tr></table></figure>

<h4 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lshw -c network -businfo</span><br><span class="line">Bus info          Device      Class          Description</span><br><span class="line">========================================================</span><br><span class="line">pci@0000:04:00.0  em1         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:04:00.1  em2         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:65:00.0  p2p1        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">pci@0000:65:00.1  p2p2        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">                  bond0       network        Ethernet interface</span><br></pre></td></tr></table></figure>

<h4 id="nmcli"><a href="#nmcli" class="headerlink" title="nmcli"></a>nmcli</h4><h5 id="bonding"><a href="#bonding" class="headerlink" title="bonding"></a>bonding</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f1</span><br><span class="line">$ nmcli connection reload</span><br><span class="line"></span><br><span class="line"><span class="comment">###bond0</span></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0  miimon 100 mode 802.3ad ip4 <span class="variable">$ip</span> gw4 <span class="variable">$gw</span></span><br><span class="line"></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond-slave ifname p1p1 master bond0</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond-slave ifname p1p1 master bond0</span><br><span class="line"></span><br><span class="line">$ nmcli con mod bond0 +bond.option xmit_hash_policy=layer3+4</span><br><span class="line">$ nmcli con mod p1p1 802-3-ethernet.mtu 9000</span><br><span class="line">$ nmcli con mod p1p2 802-3-ethernet.mtu 9000</span><br><span class="line">$ nmcli con mod bond0 802-3-ethernet.mtu 9000</span><br><span class="line"></span><br><span class="line">$ nmcli con up bond-slave-p1p1</span><br><span class="line">$ nmcli con up bond-slave-p1p2</span><br><span class="line">$ nmcli con up bond0</span><br><span class="line"></span><br><span class="line">BONDING_OPTS=<span class="string">&quot;mode=4 miimon=100 lacp_rate=fast xmit_hash_policy=layer3+4 arp_validate=0 updelay=30000&quot;</span></span><br><span class="line">BONDING_OPTS=<span class="string">&quot;mode=1 arp_interval=1000 arp_ip_target=&#123;&#123; gateway &#125;&#125; arp_validate=all&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/30732">none (0)</a><ul>
<li>active<ul>
<li>MII Status is UP as long as any network frame is received within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as any network frame is received within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>active (1)<ul>
<li>active<ul>
<li>MII Status is UP as long as an ARP Response is received from the arp_ip_target within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as any network frame is received within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>backup (2)<ul>
<li>active<ul>
<li>MII Status is UP as long as any network frame is received within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as the broadcast ARP Requests sent to the arp_ip_target by the Active Slave are seen within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>all (3)<ul>
<li>active<ul>
<li>MII Status is UP as long as an ARP Response is received from the arp_ip_target within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as the broadcast ARP Requests sent to the arp_ip_target by the Active Slave are seen within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>filter (4)<ul>
<li>active<ul>
<li>MII Status is UP as long as any ARP packet is received within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as any ARP packet is received within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>filter_active (5)<ul>
<li>active<ul>
<li>MII Status is UP as long as an ARP Response is received from the arp_ip_target within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as any ARP packet is received within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
<li>filter_backup (6)<ul>
<li>active<ul>
<li>MII Status is UP as long as any ARP packet is received within arp_interval × 2</li>
</ul>
</li>
<li>inactive<ul>
<li>MII Status is UP as long as the broadcast ARP Requests sent to the arp_ip_target by the Active Slave are seen within arp_interval × 2</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h4><p>|———-|—R(Read)—|—W(Write)———–|—X(Execute)—<br>|file      |  read       |append&#x2F;del&#x2F;modify data|  exectute file<br>|dir       | list dir    |create&#x2F;del&#x2F;modify&#x2F;move|  cd dir</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">SUID (Set owner User ID up on execution)</span><br><span class="line"><span class="built_in">chmod</span> 4555/u+s /test</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> -l /usr/bin/passwd  /etc/shadow</span><br><span class="line">----------  1 root root  1005 Feb 14 14:15 /etc/shadow</span><br><span class="line">-rwsr-xr-x. 1 root root 27856 Aug  9  2019 /usr/bin/passwd</span><br><span class="line"></span><br><span class="line">SUID is defined as giving temporary permissions to a user to run a program/file with the permissions of the file owner rather that the user <span class="built_in">who</span> runs it</span><br><span class="line"></span><br><span class="line">SGID</span><br><span class="line"><span class="built_in">chmod</span> 2555/g+s /dir</span><br><span class="line">similar with SUID, it <span class="string">&#x27;s the group bit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Sticky Bit</span></span><br><span class="line"><span class="string">chmod 1777/chmod +t /tmp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- T refers to when the execute permissions are off.</span></span><br><span class="line"><span class="string">- t refers to when the execute permissions are on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The sticky bit is primarily used on shared directories.</span></span><br><span class="line"><span class="string">[For example if user bob creates a file named /tmp/bob, other user tom can not delete this file even when the /tmp directory has permission of 777. If sticky bit is not set then tom can delete /tmp/bob, as the /tmp/bob file inherits the parent directory permissions.](https://www.thegeekdiary.com/what-is-suid-sgid-and-sticky-bit/)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### touch set time</span></span><br><span class="line"><span class="string">##### back access time</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">$ atime=$(stat -c%X $filename)</span></span><br><span class="line"><span class="string">$ touch -a --date=@$&#123;atime&#125; $newpath</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ mtime=$(stat -c%Z $filename)</span></span><br><span class="line"><span class="string">$ touch -m --date=@$&#123;mtime&#125; $newpath</span></span><br></pre></td></tr></table></figure>

<h4 id="static-route-config"><a href="#static-route-config" class="headerlink" title="static route config"></a>static route config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">subnet mask could be</span><br><span class="line">01011000  255.255.255.88</span><br><span class="line"></span><br><span class="line">just recommend against using noncontiguous subnet masks.</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/network-scripts/route-em1</span><br><span class="line">ADDRESS0=10.64.0.0</span><br><span class="line">NETMASK0=255.240.0.0</span><br><span class="line">GATEWAY0=192.168</span><br><span class="line">ADDRESS1=10.200.0.0</span><br><span class="line">NETMASK1=255.252.0.0</span><br><span class="line">GATEWAY1=10.0.0.1</span><br><span class="line">ADDRESS2=10.236.0.0</span><br><span class="line">NETMASK2=255.255.0.0</span><br><span class="line">GATEWAY2=10.0.0.1</span><br></pre></td></tr></table></figure>

<h4 id="Check-the-Linux-NIC-kernel-driver-err"><a href="#Check-the-Linux-NIC-kernel-driver-err" class="headerlink" title="Check the Linux NIC kernel driver err"></a>Check the Linux NIC kernel driver err</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ethtool -S enp129s0f0 | grep -Ei <span class="string">&#x27;fail|crc|dis|drop|miss|err|over|timeout|jabb&#x27;</span></span><br><span class="line"></span><br><span class="line">$ ethtool -s eth0 autoneg on</span><br><span class="line">$ ethtool -s eth0 speed 10 duplex half autoneg off</span><br></pre></td></tr></table></figure>

<h4 id="collectl"><a href="#collectl" class="headerlink" title="collectl"></a>collectl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ collectl --top iokb</span><br><span class="line">$ collectl --vmstat</span><br><span class="line">$ collectl -sZ</span><br><span class="line">$ collectl -c10 -f /opt</span><br><span class="line"></span><br><span class="line"><span class="comment">## replay collectl</span></span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT</span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT --from 15:02:00 --thru 15:02:05</span><br><span class="line">$ collectl --<span class="built_in">export</span> graphite,locahost,d=9 -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz</span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT --from <span class="string">&quot;03:30:18&quot;</span> --thru <span class="string">&quot;06:32:08&quot;</span></span><br><span class="line"></span><br><span class="line">$ collectl --showoptions</span><br><span class="line">$ collectl --showsubsys</span><br><span class="line">$ collectl --showsubopts</span><br><span class="line">$ collectl --showtopopts</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,b=test-node -sCMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -m -r00:00,7 -f /var/log/collectl --rawtoo</span><br><span class="line">$ collectl -i3 -P -sCMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -m -r00:00,7 -f /var/log/collectl --rawtoo</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,d=1,s=dn -sCMDNT --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -rawtoo -f /var/log/collectl</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,b=test-node -s CMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> --rawtoo -f /var/log/collectl/</span><br><span class="line"><span class="comment">### tip - if you add 8 to the debug flag, eg d=9, this tells the graphite module not to actually establish the connection with graphite&#x27;s carbon listener but to only echo the data that would have been sent.</span></span><br><span class="line">$ collectl --all --<span class="built_in">export</span> graphite,locahost,d=9 --rawtoo -f /var/log/collectl/</span><br><span class="line">$ collectl -i3 -sCDNMJFt --<span class="built_in">export</span> graphite,locahost,d=9 --rawtoo -f /var/log/collectl/</span><br><span class="line"></span><br><span class="line"><span class="comment"># collectl.conf</span></span><br><span class="line">DaemonCommands = collectl -i30 -sCDEFJMNTXYZs --netfilt <span class="string">&quot;eth|en|p[0-9]|em&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -f /var/log/collectl -r00:00,7 -m -F60 --rawtoo -P</span><br></pre></td></tr></table></figure>

<h4 id="time"><a href="#time" class="headerlink" title="time"></a>time</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time -f <span class="string">&quot;%E real,%U user,%S sys&quot;</span> <span class="built_in">sleep</span> 2</span><br><span class="line">0:02.00 real,0.00 user,0.00 sys</span><br><span class="line"></span><br><span class="line">$ /usr/bin/time -f <span class="string">&quot;%e real&quot;</span> <span class="built_in">sleep</span> 70</span><br><span class="line">70.00 real</span><br></pre></td></tr></table></figure>

<h4 id="youtube-download"><a href="#youtube-download" class="headerlink" title="youtube download"></a>youtube download</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains4 youtube-dl -F https://www.youtube.com/watch?v=_xxxxxx</span><br><span class="line">[info] Available formats <span class="keyword">for</span> _12OJxATpsA:</span><br><span class="line">format code  extension  resolution note</span><br><span class="line">249          webm       audio only tiny   62k , opus @ 50k (48000Hz), 51.86MiB</span><br><span class="line">250          webm       audio only tiny   81k , opus @ 70k (48000Hz), 68.24MiB</span><br><span class="line">140          m4a        audio only tiny  136k , m4a_dash container, mp4a.40.2@128k (44100Hz), 139.88MiB</span><br><span class="line">251          webm       audio only tiny  158k , opus @160k (48000Hz), 136.13MiB</span><br><span class="line">278          webm       256x144    144p  103k , webm container, vp9, 30fps, video only, 100.43MiB</span><br><span class="line">160          mp4        256x144    144p  115k , avc1.4d400c, 30fps, video only, 83.46MiB</span><br><span class="line">242          webm       426x240    240p  250k , vp9, 30fps, video only, 202.66MiB</span><br><span class="line">133          mp4        426x240    240p  257k , avc1.4d4015, 30fps, video only, 168.64MiB</span><br><span class="line">243          webm       640x360    360p  611k , vp9, 30fps, video only, 377.13MiB</span><br><span class="line">134          mp4        640x360    360p  665k , avc1.4d401e, 30fps, video only, 442.58MiB</span><br><span class="line">244          webm       854x480    480p 1052k , vp9, 30fps, video only, 677.08MiB</span><br><span class="line">135          mp4        854x480    480p 1343k , avc1.4d401f, 30fps, video only, 868.67MiB</span><br><span class="line">247          webm       1280x720   720p 2410k , vp9, 30fps, video only, 1.35GiB</span><br><span class="line">136          mp4        1280x720   720p 2678k , avc1.4d401f, 30fps, video only, 1.66GiB</span><br><span class="line">248          webm       1920x1080  1080p 4356k , vp9, 30fps, video only, 2.42GiB</span><br><span class="line">137          mp4        1920x1080  1080p 4525k , avc1.640028, 30fps, video only, 3.06GiB</span><br><span class="line">271          webm       2560x1440  1440p 9330k , vp9, 30fps, video only, 7.15GiB</span><br><span class="line">18           mp4        640x360    360p  622k , avc1.42001E, mp4a.40.2@ 96k (44100Hz), 685.04MiB</span><br><span class="line">22           mp4        1280x720   720p 1673k , avc1.64001F, mp4a.40.2@192k (44100Hz) (best)</span><br><span class="line"></span><br><span class="line">$ proxychains4 youtube-dl -f 137+bestaudio --merge-output-format mkv https://www.youtube.com/watch?v=_xxxxxx</span><br></pre></td></tr></table></figure>

<h4 id="uptime-and-vmstat-running"><a href="#uptime-and-vmstat-running" class="headerlink" title="uptime and vmstat running"></a>uptime and vmstat running</h4><ul>
<li><p>(uptime) number of processes that are either in a runnable or uninterruptable state.<br>  * runnable state is either using the CPU or waiting to use the  CPU.<br>  * A process in uninterruptable state is waiting for some I&#x2F;O access.</p>
</li>
<li><p>(vmstat) Procs r: The number of runnable processes (running or waiting for run time, no contains uninterruptable state)</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/loadavg</span><br><span class="line">47.36 46.22 43.95 53/1682 249686</span><br><span class="line">                     |      |</span><br><span class="line">                     |      -------- the PID of the process that was most recently created on the system.</span><br><span class="line">                     --------------- it consists of two numbers separated by a slash (/)</span><br><span class="line">                                     The first of these is the number of currently runnable(active) kernel scheduling entities</span><br><span class="line">                                     (active task = nr_running + nr_uninterruptible, processes, threads)</span><br><span class="line">                                     The value after the slash is the number of kernel scheduling entities that currently exist on the system</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">/proc/loadavg</span><br><span class="line">linux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-1127.</span>el7/fs/proc/loadavg.c</span><br><span class="line">   <span class="type">static</span> <span class="type">int</span> <span class="title function_">loadavg_proc_show</span><span class="params">(<span class="keyword">struct</span> seq_file *m, <span class="type">void</span> *v)</span></span><br><span class="line"></span><br><span class="line">linux-3.10.0-1127.el7/include/linux/sched.h</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These are the constant used to fake the fixed-point load-average</span></span><br><span class="line"><span class="comment"> * counting. Some notes:</span></span><br><span class="line"><span class="comment"> *  - 11 bit fractions expand to 22 bits by the multiplies: this gives</span></span><br><span class="line"><span class="comment"> *    a load-average precision of 10 bits integer + 11 bits fractional</span></span><br><span class="line"><span class="comment"> *  - if you want to count load-averages more often, you need more</span></span><br><span class="line"><span class="comment"> *    precision, or rounding will get you. With 2-second counting freq,</span></span><br><span class="line"><span class="comment"> *    the EXP_n values would be 1981, 2034 and 2043 if still using only</span></span><br><span class="line"><span class="comment"> *    11 bit fractions.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">unsigned</span> <span class="type">long</span> avenrun[];         <span class="comment">/* Load averages */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">get_avenrun</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> *loads, <span class="type">unsigned</span> <span class="type">long</span> offset, <span class="type">int</span> shift)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FSHIFT          11              <span class="comment">/* nr of bits of precision */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FIXED_1         (1&lt;&lt;FSHIFT)     <span class="comment">/* 1.0 as fixed-point */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FREQ       (5*HZ+1)        <span class="comment">/* 5 sec intervals */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXP_1           1884            <span class="comment">/* 1/exp(5sec/1min) as fixed-point */</span>  1mins weights</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXP_5           2014            <span class="comment">/* 1/exp(5sec/5min) */</span>    5 mins weights</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXP_15          2037            <span class="comment">/* 1/exp(5sec/15min) */</span>  15 mins weights</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALC_LOAD(load,exp,n) \</span></span><br><span class="line"><span class="meta">        load *= exp; \</span></span><br><span class="line"><span class="meta">        load += n*(FIXED_1-exp); \</span></span><br><span class="line"><span class="meta">        load &gt;&gt;= FSHIFT;</span></span><br><span class="line"></span><br><span class="line">linux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-1127.</span>el7/kernel/sched/core.c</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get_avenrun - get the load average array</span></span><br><span class="line"><span class="comment"> * @loads:      pointer to dest load array</span></span><br><span class="line"><span class="comment"> * @offset:     offset to add</span></span><br><span class="line"><span class="comment"> * @shift:      shift count to shift the result left</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * These values are estimates at best, so no need for locking.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_avenrun</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> *loads, <span class="type">unsigned</span> <span class="type">long</span> offset, <span class="type">int</span> shift)</span></span><br><span class="line">&#123;</span><br><span class="line">        loads[<span class="number">0</span>] = (avenrun[<span class="number">0</span>] + offset) &lt;&lt; shift;</span><br><span class="line">...</span><br><span class="line">linux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-1127.</span>el7/kernel/sched/core.c</span><br><span class="line">  calc_global_load</span><br><span class="line">    calc_load - update the avenrun load estimates <span class="number">10</span> ticks after the CPUs have updated calc_load_tasks</span><br></pre></td></tr></table></figure>
<p>avenrun[0]<em>{t} &#x3D; frac{load</em>{t} + load_{t+5} + load_{t+10} + ‘.’ + load_{t+55}}{60 &#x2F; 5}<br>avenrun[0]<em>{t+5} &#x3D; avenrun[0]</em>{t} - frac{1}{60 &#x2F; 5} times load_{t} + frac{1}{60 &#x2F; 5}times load_{t+60}   </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoqiaoq0/article/details/106932338">for more loading avg1</a><br><a target="_blank" rel="noopener" href="http://brytonlee.github.io/blog/2014/05/07/linux-kernel-load-average-calc/">for more loading avg2</a><br><a target="_blank" rel="noopener" href="https://www.ffutop.com/posts/2019-09-16-load-average/">for more loading avg3</a>    </p>
<h4 id="sshfs"><a href="#sshfs" class="headerlink" title="sshfs"></a>sshfs</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sshfs -p <span class="variable">$port</span> <span class="variable">$&#123;user&#125;</span>@<span class="variable">$&#123;ipaddr&#125;</span>:/mnt/sshfs ~/Downloads -o noatime,nonempty,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3</span><br></pre></td></tr></table></figure>

<h4 id="scan-file-size"><a href="#scan-file-size" class="headerlink" title="scan file size"></a>scan file size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## the diff performance in the diff file system</span></span><br><span class="line">$ find /tank -<span class="built_in">printf</span> <span class="string">&#x27;%p\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span></span><br><span class="line">$ <span class="built_in">ls</span> -flsR --time=atime --time-style=<span class="string">&#x27;+%s&#x27;</span> /root/rpmbuild | awk <span class="string">&#x27;/:$/&amp;&amp;f&#123;f=0;&#125;;/:$/&amp;&amp;!f&#123;sub(/:$/,&quot;&quot;);s=$0;f=1;next&#125;;NF&amp;&amp;f&#123; print $0&quot; &quot;s &#125;&#x27;</span></span><br><span class="line">       |                                                               |                   |</span><br><span class="line">       |                                                               |                   --- first line trigger</span><br><span class="line">       |                                                               |</span><br><span class="line">       |                                                               ----- just change f value <span class="keyword">for</span> parent <span class="built_in">dirs</span> <span class="string">&quot;the last char is : , means no file, the next dir&quot;</span></span><br><span class="line">       |                                                                     next change the f value and try to the <span class="string">&quot;first line trigger&quot;</span> part to record the s val</span><br><span class="line">       --- the parameter could not out of order</span><br><span class="line"></span><br><span class="line"><span class="comment">## if you hava all dirs, just show ls info</span></span><br><span class="line">$ <span class="built_in">ls</span> -fls --time=atime --time-style=<span class="string">&#x27;+%s&#x27;</span> <span class="string">&quot;<span class="variable">$fpath</span>&quot;</span> | awk -v fpath=<span class="string">&quot;<span class="variable">$fpath</span>&quot;</span> <span class="string">&#x27;&#123;if(NF&gt;7) &#123;if($NF==&quot;.&quot; || $NF==&quot;..&quot;) &#123;next&#125; else &#123;a[$NF]=$0&#125; &#125; &#125; END&#123;for(i in a) &#123;print fpath&quot;/&quot;i,a[i]&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## you should find too many &quot;.&quot; files</span></span><br><span class="line">$ find /tank -name <span class="string">&quot;.*&quot;</span> -<span class="built_in">printf</span> <span class="string">&#x27;%P\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span> &gt; tank.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#exclude 2 dirs</span></span><br><span class="line">$ find /opt/test1 -<span class="built_in">type</span> f -not -path <span class="string">&quot;/opt/test1/linux1/*&quot;</span> -not -path <span class="string">&quot;/opt/test1/linux2/*&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="kernel-issue"><a href="#kernel-issue" class="headerlink" title="kernel issue"></a>kernel issue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kernel:</span><br><span class="line">INFO: task xxx:xxx blocked for more than 120 seconds.</span><br><span class="line">kernel process or thread hang, could not be wake up at 120s</span><br><span class="line">        hungtask</span><br><span class="line">                hung_task_panic        0</span><br><span class="line">                hung_task_check_count  32768</span><br><span class="line">                hung_task_timeout_secs 120s</span><br><span class="line">                hung_task_warnings     10x times</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">softlockup</span><br><span class="line">NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [cat:153]</span><br><span class="line">softlockup deadlock, check the kernel schdule is ok, if trigger the softlockup, the kernel could not be schduled.</span><br><span class="line">When hrtimer wake up the kernel thread and update watchdog_touch_ts, if time now - watchdog_touch_ts &gt; timeout value, it will show this error, that mean schdule timeout.</span><br><span class="line">/proc/sys/kernel/nmi_watchdog      hard lockup</span><br><span class="line">/proc/sys/kernel/soft_watchdog     soft lockup</span><br><span class="line">/proc/sys/kernel/watchdog          watchdog</span><br><span class="line">/proc/sys/kernel/watchdog_cpumask  watchdog cpumaks，</span><br><span class="line">/proc/sys/kernel/watchdog_thresh   watchdog timeoout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">softlockup : the kernel loop in kernel mode without giving other tasks a chance to run, a kernel task won&#x27;t be unlock the CPU.</span><br><span class="line">             A soft lockup is when a running task is executing kernel code and wont yield the CPU to allow other tasks to run.</span><br><span class="line">             The default soft lockup threshold is 60 seconds for RHEL5/6 and 20 seconds on RHEL7.</span><br><span class="line">hardlockup : the kernel loop in kernel mode without letting other interrupts have change to run, the interrupts aren&#x27;t being processes.</span><br><span class="line">             A hard lockup is when a CPU has interrupts disabled for a long time, which might block important communication between processes or hardware.</span><br><span class="line">             The default hard lockup threshold is 30 second on RHEL5/6 and 10 seconds on RHEL7.</span><br></pre></td></tr></table></figure>

<p>In redhat <a target="_blank" rel="noopener" href="https://access.redhat.com/articles/1353303">doc</a></p>
<ul>
<li>Each CPU has registered it’s own high resolution timer and both hard and soft lockup detection are closely connected with it.<ul>
<li>This timer is fired approximately every [watchdog_thresh * 2 &#x2F; 5]-seconds and does mainly three things:</li>
<li>Wakes up a CPU specific watchdog task with the highest possible priority, in order to get scheduled as soon as possible. This task’s main job is to update a PER_CPU timestamp called watchdog_touch_ts.</li>
<li>Checks if watchdog_touch_ts + watchdog_thresh is smaller than current actual time. If yes, or in other words, if the watchdog task didn’t run for longer than watchdog_thresh, then a soft lockup is reported.</li>
<li>Increments a CPU specific interrupt counter called hrtimer_interrupts, denoting that an interrupt happened on the CPU.</li>
</ul>
</li>
</ul>
<p>Detecting a hard lockup is a bit trickier, since the CPU is stuck and has disabled interrupts. In order to detect it, each CPU has registered a watchdog perf event, which ensures that the CPU hardware issues an NMI (non-maskable interrupt) every [hard lockup threshold]-seconds. Generally approximately 2-3 high resolution timer interrupts are supposed to happen in-between 2 of these NMIs.<br>The handler function of this NMI will check the hrtimer_interrupts counter and copy-save it’s current value. If it sees the same value as it has saved before, it reports a hard lockup, because it means that no interrupt happened during [hard lockup threshold]-seconds.   </p>
<p>Usually a CPU lockup is caused by a task stuck in a loop. Sometimes it’s due to a code loop where the termination condition has not yet been met. For example it may be an unbounded list (ie while !list_empty()). In cases like this the code should limit the maximum iterations of the loop before voluntarily yielding the CPU (ie cond_resched()).    </p>
<p>Often CPU lockups are caused by tasks trying to acquire a spinlock that for some reason cannot be acquired in a reasonable time. This could be due to current owner of the lock not relinquishing the lock or it may be a case of starvation where excessive activity on the lock delays some tasks long enough to exceed the watchdog threshold (ie RHEL5 spinlocks on ).   </p>
<p>Other cases involve a loop where the termination condition is never going to be met. For example the code expects a state change that isn’t going to happen.   </p>
<p>It’s also possible to get false reports from the watchdog on virtual machines where the host system stalls the guest for longer than the watchdog threshold period. The watchdog will think the guest has been running during that time but the CPUs have not been able to make progress.    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##default is enabled</span></span><br><span class="line">$ sysctl kernel.softlockup_panic kernel.hardlockup_panic</span><br><span class="line">kernel.softlockup_panic = 0</span><br><span class="line">kernel.hardlockup_panic = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">##disable, there is no soft lockup watchdog here</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/softlockup_panic</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.seibert-media.com/2018/01/04/log-book-linux-cpu-lockups/#:~:text=A%20'hard%20lockup'%20is%20defined,the%20good%20old%20DOS%20days.">Provoke lockups with your own kernel module</a></p>
<h4 id="slowpath-and-fastpath"><a href="#slowpath-and-fastpath" class="headerlink" title="slowpath and fastpath"></a>slowpath and fastpath</h4><p><a target="_blank" rel="noopener" href="https://kernelnewbies.org/FAQ/FastpathAndSlowpath">In general</a>, “fast path” is the commonly run code that should finish very quickly. For example, when it comes to spinlocks the fast path is that nobody is holding the spinlock and the CPU that wants it can just take it.<br>Conversely, the slow path for spinlocks is that the lock is already taken by somebody else and the CPU will have to wait for the lock to be freed.<br>The first case is the common one that should be optimized.<br>The second one is not as important and does not need to be optimized much at all.    </p>
<h4 id="cgroup-limit-resource"><a href="#cgroup-limit-resource" class="headerlink" title="cgroup limit resource"></a>cgroup limit resource</h4><p>command line mode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /sys/fs/cgroup/memory/</span><br><span class="line">$ <span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line">$ <span class="built_in">cd</span> /sys/fs/cgroup/memory/test</span><br><span class="line">$ <span class="built_in">echo</span> 5M &gt; memory.limit_in_bytes</span><br><span class="line">$ <span class="built_in">echo</span> $$ &gt;&gt; cgroup.procs <span class="comment">## add local bash </span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; memory.swappiness</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> memory.oom_control</span><br><span class="line"><span class="comment"># disable oom</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt;&gt; memory.oom_control<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>


<p>limit memory size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cgcreate -g memory:DBLimitedGroup</span><br><span class="line">$ <span class="built_in">echo</span> 16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes</span><br><span class="line">$ <span class="built_in">sync</span>; <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ cgclassify -g memory:DBLimitedGroup $(pid)</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=<span class="string">&quot;test&quot;</span></span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/test/test 1234</span><br><span class="line">MemoryAccounting=<span class="literal">true</span></span><br><span class="line">MemoryHigh=1024K</span><br><span class="line">MemoryMax=4096K</span><br></pre></td></tr></table></figure>

<h4 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ldd /bin/ls</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007fff59353000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fa12b999000)</span><br><span class="line">        libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007fa12b794000)</span><br><span class="line">        libacl.so.1 =&gt; /lib64/libacl.so.1 (0x00007fa12b58b000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa12b1bd000)</span><br><span class="line">        libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fa12af5b000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fa12ad57000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fa12bbc0000)</span><br><span class="line">        libattr.so.1 =&gt; /lib64/libattr.so.1 (0x00007fa12ab52000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fa12a936000)</span><br></pre></td></tr></table></figure>
<h4 id="Read-ELF-Executable-and-Linking-Format"><a href="#Read-ELF-Executable-and-Linking-Format" class="headerlink" title="Read ELF(Executable and Linking Format)"></a>Read ELF(Executable and Linking Format)</h4><p>Relocatable file (eg: xx.o)<br>Executable file<br>Dynamic Linking Library (eg: xx.so)<br>Static Linking Library  (eg: xx.a)</p>
<p>ELF Header<br>ELF Program Header Table&#x2F;Program Headers<br>ELF Section Header Table&#x2F;Section Headers<br>ELF Sections<br>multiple sections merge to a segment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -h /bin/ls</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2<span class="string">&#x27;s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              EXEC (Executable file)</span></span><br><span class="line"><span class="string">  Machine:                           Advanced Micro Devices X86-64</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x404324</span></span><br><span class="line"><span class="string">  Start of program headers:          64 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          115688 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x0</span></span><br><span class="line"><span class="string">  Size of this header:               64 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           56 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         9</span></span><br><span class="line"><span class="string">  Size of section headers:           64 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         30</span></span><br><span class="line"><span class="string">  Section header string table index: 29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$  readelf -S /bin/ls | grep debug</span></span><br><span class="line"><span class="string">  [27] .gnu_debuglink    PROGBITS         0000000000000000  0001b600</span></span><br><span class="line"><span class="string">  [28] .gnu_debugdata    PROGBITS         0000000000000000  0001b610 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -all /bin/ls</span></span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure>

<h4 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -i </span><br><span class="line"><span class="comment"># Display a list showing all architectures and object formats available for specification with -b or -m.</span></span><br><span class="line">...</span><br><span class="line">$ gcc -O2 -ggdb3 -c -o sort.o sort.c</span><br><span class="line">$ objdump -d sort.o</span><br><span class="line"><span class="comment">#Display the assembler mnemonics for the machine instructions from objfile</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;<span class="built_in">sort</span>&gt;:</span><br><span class="line">   0:   31 c0                   xor    %eax,%eax</span><br><span class="line">   2:   b9 01 00 00 00          mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">   7:   83 f8 1e                cmp    <span class="variable">$0x1e</span>,%eax</span><br><span class="line">   a:   7e 0b                   jle    17 &lt;<span class="built_in">sort</span>+0x17&gt;</span><br><span class="line">   c:   84 c9                   <span class="built_in">test</span>   %cl,%cl</span><br><span class="line">   e:   75 36                   jne    46 &lt;<span class="built_in">sort</span>+0x46&gt;</span><br><span class="line">  10:   b9 01 00 00 00          mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ objdump -t sort.o</span><br><span class="line"><span class="comment"># Print the symbol table entries of the file</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">SYMBOL TABLE:</span><br><span class="line">0000000000000000 l    <span class="built_in">df</span> *ABS*  0000000000000000 sort.c</span><br><span class="line">0000000000000000 l    d  .text  0000000000000000 .text</span><br><span class="line">0000000000000000 l    d  .data  0000000000000000 .data</span><br><span class="line">0000000000000000 l    d  .bss   0000000000000000 .bss</span><br><span class="line">0000000000000000 l    d  .rodata.str1.1 0000000000000000 .rodata.str1.1</span><br><span class="line">0000000000000000 l    d  .text.startup  0000000000000000 .text.startup</span><br><span class="line">0000000000000000 l    d  .debug_info    0000000000000000 .debug_info</span><br><span class="line">0000000000000000 l    d  .debug_abbrev  0000000000000000 .debug_abbrev</span><br><span class="line">0000000000000000 l    d  .debug_loc     0000000000000000 .debug_loc</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h4><p>list symbols from object files</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ nm ./walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br><span class="line"></span><br><span class="line">$ nm -e ./walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br></pre></td></tr></table></figure>

<p>kernel symbol table</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$  grep CONFIG_KALLSYMS /boot/config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_KALLSYMS=y</span><br><span class="line">CONFIG_KALLSYMS_ALL=y</span><br><span class="line"></span><br><span class="line">$ grep &quot; tcp_v4_do_rcv&quot;  /proc/kallsyms</span><br><span class="line">ffffffff936c0c70 T tcp_v4_do_rcv</span><br><span class="line">## Why addr is change ?</span><br><span class="line"></span><br><span class="line">$ grep CONFIG_RANDOMIZE_BASE /boot/config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_RANDOMIZE_BASE=y</span><br><span class="line"></span><br><span class="line">## ALL info, the compiler optimize cause some symbols missing in kallsyms</span><br><span class="line">$ grep &quot; tcp_v4_do_rcv&quot;  /boot/System.map-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">ffffffff816c0c70 T tcp_v4_do_rcv</span><br><span class="line"></span><br><span class="line">uppercase: global(external) symbol</span><br><span class="line">lowercase: local symbol</span><br><span class="line">T The symbol is in the text(code) section</span><br><span class="line">D The symbol is in the initialized data section</span><br><span class="line">R The sysbol is in a read only data section</span><br><span class="line">t static</span><br><span class="line">d static</span><br><span class="line">R const</span><br><span class="line">r static const</span><br></pre></td></tr></table></figure>

<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">size add_lock</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">   5008     660       4    5672    1628 add_lock</span><br></pre></td></tr></table></figure>

<p>代码段： 只读，可共享; 代码段（code segment&#x2F;text segment ）通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段&gt;为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。<br>数据段： 储存已被初始化了的静态数据。数据段（data segment ）通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配。<br>BSS 段：未初始化的数据段. BSS 段（bss segment ）通常是指用来存放程序中未初始化的全局变量的一块内存区域。BSS 是英文Block Started by Symbol 的简称。BSS 段属于静态内存分配。<br>堆（heap ）：low to high, 堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）<br>栈(stack) ： high to low, 栈又称堆栈，是用户存放程序临时创建的局部变量，也就是说我们函数括弧“{} ”中定义的变量（但不包括static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数&gt;被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出特点，所以栈特别方便用来保存&#x2F; 恢复调用现场。从这个意义上讲，我们可以把堆栈看成<br>一个寄存、交换临时数据的内存区。<br>另外, 在高地址还储存了命令行参数及环境变量.</p>
<p>The heap is, generally speaking, one specific memory region created by the C runtime, and managed by malloc (which in turn uses the brk and sbrk system calls to grow and shrink).<br>mmap is a way of creating new memory regions, independently of malloc (and so independently of the heap). munmap is simply its inverse, it releases these regions.<br>Some picture show mmap high addr to low addr, same direction with stack</p>
<h4 id="vim-jump-cursor"><a href="#vim-jump-cursor" class="headerlink" title="vim jump cursor"></a>vim jump cursor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:cal cursor(30, 5)</span><br></pre></td></tr></table></figure>

<h4 id="gpart-recovery-partition-table"><a href="#gpart-recovery-partition-table" class="headerlink" title="gpart recovery partition table"></a>gpart recovery partition table</h4><p>boot by freebsd livecd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ gpart disk list</span><br><span class="line">$ gpart recover /dev/sda</span><br><span class="line"></span><br><span class="line"><span class="comment">#backup and recoery</span></span><br><span class="line">$ yum install gdisk</span><br><span class="line">$ sgdisk --backup=vdb_part_1 /dev/vdb</span><br><span class="line">$ sgdisk --load-backup=vdb_part_1 /dev/vdb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ffmpeg -i twiz-1080p.mkv -s 1280x720 -vcodec libx264 -crf 24 twiz-720p.mkv</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://superuser.com/questions/1324525/is-it-possible-to-speed-up-video-with-audio-using-ffmpeg-without-changing-audio</span></span><br><span class="line"><span class="comment">#The command above works if you want to multiply by 2 the speed. If you want to multiply by any &lt;x&gt;, the parameters become</span></span><br><span class="line">$ ffmpeg -i input.mkv -filter_complex <span class="string">&quot;[0:v]setpts=&lt;1/x&gt;*PTS[v];[0:a]atempo=&lt;x&gt;[a]&quot;</span> -map <span class="string">&quot;[v]&quot;</span> -map <span class="string">&quot;[a]&quot;</span> output.mkv</span><br><span class="line">$ ffmpeg -i input.mkv -filter_complex <span class="string">&quot;[0:v]setpts=0.87*PTS[v];[0:a]atempo=1.15[a]&quot;</span> -map <span class="string">&quot;[v]&quot;</span> -map <span class="string">&quot;[a]&quot;</span> output.mkv</span><br></pre></td></tr></table></figure>

<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h4><p><a target="_blank" rel="noopener" href="https://serverfault.com/questions/763582/how-to-configure-iptables-so-an-unwanted-port-is-not-reported-as-filtered">let namp show filter, you could pretend 22 is the ssh port :) </a><br>change the ssh default port and set </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j drop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Don&#x27;t use DROP, that&#x27;s easily identified as &quot;filtered&quot; if you know the box is up. Instead, you may use the following to send a RST. (as if there is a service listening, but it doesn&#x27;t accept connections from you)</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j REJECT --reject-with tcp-reset</span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j REJECT</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run &#x27;chmod +x /etc/rc.d/rc.local&#x27; to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /var/lock/subsys/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset to a sane state, even if just temporarily</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Erase all the rules</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables --delete-chain</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -X</span><br><span class="line"></span><br><span class="line">nic=ems3</span><br><span class="line"><span class="comment"># disable icmp</span></span><br><span class="line"><span class="comment">#iptables -A INPUT  -p icmp --icmp-type echo-request -j DROP</span></span><br><span class="line"><span class="comment">#iptables -A OUTPUT -p icmp --icmp-type echo-reply -j DROP</span></span><br><span class="line">iptables -A INPUT -p icmp --icmp-type any -j DROP</span><br><span class="line">iptables -A OUTPUT -p icmp -j DROP</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -m state --state INVALID -j LOG --log-prefix <span class="string">&quot;DROP INVALID &quot;</span> --log-ip-options --log-tcp-options</span><br><span class="line">iptables -A INPUT -m state --state INVALID -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">## same with iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span></span><br><span class="line"><span class="comment"># Log attack</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; Null scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE  -m recent --name blacklist_60 --<span class="built_in">set</span> -m comment --comment <span class="string">&quot;Drop/Blacklist Null scan&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">## nmap -sX 192.168.0.2</span></span><br><span class="line"><span class="comment"># Log attacks</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS scan &quot;</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS-PSH scan &quot;</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS-ALL scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas/PSH scan&quot;</span> -j DROP <span class="comment"># Xmas-PSH scan</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas scan&quot;</span> -j DROP <span class="comment"># Against nmap -sX (Xmas tree scan)</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas/All scan&quot;</span> -j DROP <span class="comment"># Xmas All scan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### fin scan nmap -sF 192.168.0.2</span></span><br><span class="line"><span class="comment">#Log attack</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; FIN scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist FIN scan&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">###ACK scan nmap -sA 192.168.0.2</span></span><br><span class="line">iptables   -A INPUT -p tcp ! --syn -m state --state NEW  -m comment --comment <span class="string">&quot;Drop TCP connection not starting by SYN&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">### SYN scan and TCP connect scan, nmap -sS 192.168.0.2, nmap -sT 192.168.0.2</span></span><br><span class="line"><span class="comment"># log  probable sS and full connect tcp scan</span></span><br><span class="line">iptables -A INPUT -p tcp  -m multiport --dports 23,79 --tcp-flags ALL SYN -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt;SYN scan trap:&quot;</span></span><br><span class="line"><span class="comment"># blacklist for three minuts</span></span><br><span class="line">iptables -A  INPUT -p tcp  -m multiport --dports 23,79 --tcp-flags ALL SYN -m recent --name blacklist_180 --<span class="built_in">set</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">### UDP scan</span></span><br><span class="line">iptables -A INPUT -p udp  -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 6/h --limit-burst 1 -m length --length 0:28 -j LOG --log-prefix <span class="string">&quot;Firewall&gt;0 length udp &quot;</span></span><br><span class="line">iptables -A INPUT -p udp -m length --length 0:28 -m comment --comment <span class="string">&quot;Drop UDP packet with no content&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simple NAT rule for outgoing traffic</span></span><br><span class="line"><span class="comment">#iptables -t nat -A POSTROUTING -o $nic -j MASQUERADE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allow established connections</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow loopback</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow the return half of established connections</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"><span class="comment"># Allow incoming and outgoing ssh</span></span><br><span class="line"><span class="comment">####  from Foreign ssh to this, eg: ssh port is 10000</span></span><br><span class="line">iptables -A INPUT -p tcp  --sport 30000:65535 --dport 10000 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">####  from this node ssh to the others</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 30000:65535 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#### vnc for 5901</span></span><br><span class="line">iptables -A INPUT -p tcp  --sport 30000:65535 --dport 5901 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#### ipmi web</span></span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 5900 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># You probably want other stuff permitted here such as DNS on 53/udp and 53/tcp</span></span><br><span class="line"><span class="comment"># and maybe NTP on 123/udp</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p udp --dport 123 -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default policy is to discard all traffic</span></span><br><span class="line">iptables -P INPUT  DROP</span><br><span class="line">iptables -P OUTPUT DROP</span><br><span class="line">systemctl start fail2ban.service</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="comment">### block-scan </span></span><br><span class="line">iptables -N block-scan</span><br><span class="line">iptables -A block-scan -p tcp —tcp-flags SYN,ACK,FIN,RST RST -m <span class="built_in">limit</span> —<span class="built_in">limit</span> 1/s -j RETURN</span><br><span class="line">iptables -A block-scan -j DROP</span><br><span class="line"><span class="comment">### reset tcp</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 2049 -j REJECT --reject-with tcp-reset</span><br></pre></td></tr></table></figure>
<p>[defeating Nmap OS-Fingerprinting]<a target="_blank" rel="noopener" href="https://nmap.org/misc/defeat-nmap-osdetect.html">https://nmap.org/misc/defeat-nmap-osdetect.html</a>)<br><a target="_blank" rel="noopener" href="https://linuxhint.com/traceroute_nmap/">nmap traceroute</a><br><a target="_blank" rel="noopener" href="http://blog.sevagas.com/?Iptables-firewall-versus-nmap-and,31">iptabls vs namp</a></p>
<h4 id="fail2ban"><a href="#fail2ban" class="headerlink" title="fail2ban"></a>fail2ban</h4><p>Default firewalld policy maybe will conflicte with my iptables policy, disable firewalld and reset the policy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y fail2ban</span><br><span class="line">$ <span class="built_in">cat</span> /etc/fail2ban/jail.local</span><br><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># Ban hosts for one hour:</span></span><br><span class="line">bantime = 900</span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line">maxretry = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Override /etc/fail2ban/jail.d/00-firewalld.conf:</span></span><br><span class="line"><span class="comment"># banaction = iptables-multiport</span></span><br><span class="line">banaction = iptables</span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">port    = 10000</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">logpath = /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line">filter    = sshd</span><br><span class="line"></span><br><span class="line">$ sudo fail2ban-client status sshd</span><br><span class="line">Status <span class="keyword">for</span> the jail: sshd</span><br><span class="line">|- Filter</span><br><span class="line">|  |- Currently failed: 0</span><br><span class="line">|  |- Total failed:     7</span><br><span class="line">|  `- Journal matches:  _SYSTEMD_UNIT=sshd.service + _COMM=sshd</span><br><span class="line">`- Actions</span><br><span class="line">   |- Currently banned: 1</span><br><span class="line">   |- Total banned:     1</span><br><span class="line">   `- Banned IP list:   192.168.1.10</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> -f /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line">2021-01-22 10:42:38,088 fail2ban.actions        [1191]: INFO      banTime: 600</span><br><span class="line">2021-01-22 10:42:38,091 fail2ban.jail           [1191]: INFO    Jail <span class="string">&#x27;sshd&#x27;</span> started</span><br><span class="line">2021-01-22 10:43:27,767 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:57</span><br><span class="line">2021-01-22 10:43:27,768 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:58</span><br><span class="line">2021-01-22 10:43:27,768 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:58</span><br><span class="line">2021-01-22 10:43:27,769 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:59</span><br><span class="line">2021-01-22 10:43:27,769 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:00</span><br><span class="line">2021-01-22 10:43:27,770 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:02</span><br><span class="line">2021-01-22 10:43:27,770 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:02</span><br><span class="line">2021-01-22 10:43:28,158 fail2ban.actions        [1191]: NOTICE  [sshd] Ban 192.168.1.10</span><br></pre></td></tr></table></figure>

<h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ lsof </span><br><span class="line">COMMAND    PID   USER   FD   TYPE        DEVICE SIZE/OFF      NODE NAME</span><br><span class="line"><span class="built_in">sched</span>        0   root  cwd   VDIR         136,8     1024         2 /</span><br><span class="line">init         1   root  cwd   VDIR         136,8     1024         2 /</span><br><span class="line">init         1   root  txt   VREG         136,8    49016      1655 /sbin/init</span><br><span class="line">init         1   root  txt   VREG         136,8    51084      3185 /lib/libuutil.so.1</span><br><span class="line">vi        2013   root    3u  VREG         136,8        0      8501 /var/tmp/ExXDaO7d</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the unix socket info</span></span><br><span class="line">$ lsof -aUc sshd</span><br><span class="line">COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">sshd     3199 root    1u  unix 0xffff8a8b39f96a40      0t0  43211 socket</span><br><span class="line">sshd     3199 root    2u  unix 0xffff8a8b39f96a40      0t0  43211 socket</span><br><span class="line">sshd    33510 root    4u  unix 0xffff8a7be8dac400      0t0 283548 socket</span><br><span class="line">sshd    78493 root    4u  unix 0xffff8a8b3a24d940      0t0 443790 socket</span><br><span class="line"></span><br><span class="line">$ ss -xp</span><br><span class="line"> ss -xp | grep sshd</span><br><span class="line">u_str  ESTAB      0      0       * 43211                 * 18675                 <span class="built_in">users</span>:((<span class="string">&quot;sshd&quot;</span>,pid=3199,fd=2),(<span class="string">&quot;sshd&quot;</span>,pid=3199,fd=1))</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/16300/whos-got-the-other-end-of-this-unix-socketpair">example to debug</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof | grep whatever</span></span><br><span class="line">mysqld 14450 (...) unix 0xffff8801011e9600 (...) /var/run/mysqld/mysqld.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb /usr/lib/debug/boot/vmlinux-3.2.0-4-amd64 /proc/kcore</span></span><br><span class="line">(gdb) <span class="built_in">print</span> ((struct unix_sock*)0xffff8801011e9600)-&gt;peer</span><br><span class="line"><span class="variable">$1</span> = (struct sock *) 0xffff880171f078c0</span><br><span class="line"></span><br><span class="line"><span class="comment"># lsof | grep 0xffff880171f078c0</span></span><br><span class="line">mysql 14815 (...) unix 0xffff880171f078c0 (...) socket</span><br></pre></td></tr></table></figure>

<h4 id="Process-accounting-on-Linux"><a href="#Process-accounting-on-Linux" class="headerlink" title="Process accounting on Linux"></a><a target="_blank" rel="noopener" href="https://www.networkworld.com/article/3571465/managing-process-accounting-on-linux.html">Process accounting on Linux</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/accton on</span><br><span class="line">Turning on process accounting, file set to the default &#x27;/var/log/account/pacct&#x27;.</span><br><span class="line">dump-acct /var/log/account/pacct | tail</span><br><span class="line">echo &quot;Command         vers  runtime   systime   elapsed    UID    GID   mem_use     chars      PID     PPID  ?    retcode  term     date/time&quot; &quot;</span><br><span class="line">sudo dump-acct /var/log/account/pacct | tail -5</span><br><span class="line">dump-acct /var/log/account/pacct | awk -F&#x27;|&#x27; &#x27;$6 ~ / 1000$/&#x27;</span><br><span class="line">ls -ltr /var/log/account | tail -6</span><br><span class="line">/usr/sbin/accton off</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://developer.ibm.com/articles/au-lsof/">The Device, SIZE&#x2F;OFF, Node, and Name columns refer to the file itself, specifying the name of the disk, size of the file, inode (the file’s identification on the disk)</a></p>
<h4 id="git-token"><a href="#git-token" class="headerlink" title="git token"></a>git token</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify pass</span></span><br><span class="line">$ git config --global --<span class="built_in">unset</span> user.password</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35942754/how-to-save-username-and-password-in-git/51164322#51164322">Use token replace password</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git add README.md</span><br><span class="line">$ git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">$ git remote add origin https://github.com/xxxx/xxxx.git</span><br><span class="line">$ git pull</span><br><span class="line">$ git push -u origin master </span><br><span class="line"></span><br><span class="line"><span class="comment">## got the token from the web</span></span><br><span class="line">$ git remote add tools https://<span class="variable">$&#123;username&#125;</span>:<span class="variable">$&#123;token_key&#125;</span>@github.com/xxxx/xxxx</span><br><span class="line">$ vi README.md</span><br><span class="line">$ git add --all</span><br><span class="line">$ git commit -m <span class="string">&quot;update readme&quot;</span></span><br><span class="line">$ git push tools master</span><br><span class="line"></span><br><span class="line"><span class="comment">## show repo</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment">## delete</span></span><br><span class="line">$ git remote <span class="built_in">rm</span> tools</span><br></pre></td></tr></table></figure>

<h4 id="tuned-adm"><a href="#tuned-adm" class="headerlink" title="tuned-adm"></a>tuned-adm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default config files</span></span><br><span class="line">$ <span class="built_in">ls</span> /usr/lib/tuned</span><br><span class="line">balanced  desktop  <span class="built_in">functions</span>  latency-performance  network-latency  network-throughput  powersave  recommend.d  throughput-performance  virtual-guest  virtual-host</span><br><span class="line"></span><br><span class="line">$ tuned-adm list</span><br><span class="line">$ tuned-adm profile network-throughput</span><br><span class="line">$ tuned-adm active</span><br><span class="line"></span><br><span class="line">$ /etc/tuned/my-variables.conf</span><br><span class="line"></span><br><span class="line">[variables]</span><br><span class="line">include=/etc/tuned/my-variables.conf</span><br><span class="line"></span><br><span class="line">[bootloader]</span><br><span class="line">cmdline=isolcpus=0,1,2,3</span><br></pre></td></tr></table></figure>

<h4 id="Tick"><a href="#Tick" class="headerlink" title="Tick"></a>Tick</h4><p>Disable Tick to save power in some embedded device</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_NO_HZ</span><br><span class="line">CONFIG_NO_HZ_IDLE</span><br><span class="line"></span><br><span class="line">$ cat /boot/config-3.10.0-1127.el7.x86_64 | grep -Ei &quot;CONFIG_NO_HZ | CONFIG_NO_HZ_IDLE&quot;</span><br><span class="line"># CONFIG_NO_HZ_IDLE is not set</span><br></pre></td></tr></table></figure>

<p>#io_ticks: the IO service wall-clock time in this device<br>in_flight: The number of I&#x2F;Os incomplete in the queue, entry the queue +1, when the IO fininshed -1.<br>time_in_queue &#x3D; in_flight * wall-clock time</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">time=100ms, nothing, in_flight=0, stamp=100, stamp_delta=nothing, io_tickes=0, time_in_queue=0</span><br><span class="line">time=100.1ms, the request in the queue, in_flight=1, stamp=100, stamp_delta=100.1-100=0.1, io_tickes=0.1, time_in_queue=0.1*1=0.1</span><br><span class="line">time=101.2ms, the request in the queue, in_flight=2, stamp=100.1, stamp_delta=101.2-100.1=1.1, io_tickes=1.1+0.1=1.2, time_in_queue=0.1*1+1.1*2=2.3</span><br><span class="line">time=103.6ms, 1x request finish, in_flight=1, stamp=101.2, stamp_delta=103.6-101.2=2.4, io_tickes=1.1+0.1+2.4=3.6, time_in_queue=0.1*1+1.1*2+2.4*1=4.7</span><br><span class="line">time=153.6ms, 1x request finish, in_flight=0, stamp=103.6, stamp_delta=nothing, io_tickes=1.1+0.1+2.4=3.6, time_in_queue=0.1*1+1.1*2+2.4*1=4.7</span><br><span class="line">time=153.9ms, 1x request in, in_flight=1, stamp=153.6, stamp_delta=153.9-153.6=0.3, io_tickes=1.1+0.1+2.4+0.3=3.9, time_in_queue=0.1*1+1.1*2+2.4*1+0.3*1=5</span><br></pre></td></tr></table></figure>
<p>In this case, the time_in_queue &#x3D; sum(in_flight)<br>The_wall-clock_total_time means the interval time for this calculate<br>The iostat utils &#x3D; io_tickes&#x2F;The_wall-clock_total_time &#x3D; utils xx %</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_NO_HZ_COMMON=y</span><br><span class="line"># CONFIG_HZ_PERIODIC is not <span class="built_in">set</span></span><br><span class="line"># CONFIG_NO_HZ_IDLE is not <span class="built_in">set</span></span><br><span class="line">CONFIG_NO_HZ_FULL=y</span><br><span class="line"># CONFIG_NO_HZ_FULL_ALL is not <span class="built_in">set</span></span><br><span class="line">CONFIG_NO_HZ=y</span><br><span class="line"># CONFIG_RCU_FAST_NO_HZ is not <span class="built_in">set</span></span><br><span class="line"># CONFIG_HZ_100 is not <span class="built_in">set</span></span><br><span class="line"># CONFIG_HZ_250 is not <span class="built_in">set</span></span><br><span class="line"># CONFIG_HZ_300 is not <span class="built_in">set</span></span><br><span class="line">CONFIG_HZ_1000=y</span><br><span class="line">CONFIG_HZ=<span class="number">1000</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://www.lenky.info/archives/2013/07/2317">DynTicks</a>  </p>
<ul>
<li><p>DynTicks, NOHZ, tickless</p>
<ul>
<li>reduce overhead, better performance<br><a target="_blank" rel="noopener" href="http://www.wowotech.net/timer_subsystem/tick-device-layer.html">http://www.wowotech.net/timer_subsystem/tick-device-layer.html</a></li>
<li>RHEL7 nohz_full support</li>
<li>If nr_running&#x3D;1, then scheduler&#x2F;tick can avoid that core<ul>
<li>Default disabled</li>
</ul>
</li>
</ul>
</li>
<li><p>kernel ticks</p>
<ul>
<li>timekeeping S(gettimeofday)</li>
<li>schduler loading balancing</li>
<li>memory statistics (vmstat)</li>
</ul>
</li>
<li><p>kernel boot parameters example:</p>
<ul>
<li>move all users tasks off the isolated cpu cores<ul>
<li>include all children of systemd (pid 1)</li>
<li>All future processes too. as default system cpu affinity is changed</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;skew_tick=1,nohz=on,nohz_full=2-39,rcu_nocbs=2-39,tuned.non_isolcpus=0000000003,intel_pstate=disable,nosoftlockup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// linux-3.10.0-1127.el7/include/linux/genhd.h</span></span><br><span class="line"><span class="keyword">struct</span> disk_stats &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> sectors[<span class="number">2</span>];       <span class="comment">/* READs and WRITEs */</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> ios[<span class="number">2</span>];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> merges[<span class="number">2</span>];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> ticks[<span class="number">2</span>];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> io_ticks;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> time_in_queue;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">diskstats_show</span><span class="params">(<span class="keyword">struct</span> seq_file *seqf, <span class="type">void</span> *v)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">gendisk</span> *<span class="title">gp</span> =</span> v;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">disk_part_iter</span> <span class="title">piter</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">hd_struct</span> *<span class="title">hd</span>;</span></span><br><span class="line">        <span class="type">char</span> buf[BDEVNAME_SIZE];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> inflight[<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> cpu;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        if (&amp;disk_to_dev(gp)-&gt;kobj.entry == block_class.devices.next)</span></span><br><span class="line"><span class="comment">                seq_puts(seqf,  &quot;major minor name&quot;</span></span><br><span class="line"><span class="comment">                                &quot;     rio rmerge rsect ruse wio wmerge &quot;</span></span><br><span class="line"><span class="comment">                                &quot;wsect wuse running use aveq&quot;</span></span><br><span class="line"><span class="comment">                                &quot;\n\n&quot;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        disk_part_iter_init(&amp;piter, gp, DISK_PITER_INCL_EMPTY_PART0);</span><br><span class="line">        <span class="keyword">while</span> ((hd = disk_part_iter_next(&amp;piter))) &#123;</span><br><span class="line">                cpu = part_stat_lock();</span><br><span class="line">                part_round_stats(gp-&gt;<span class="built_in">queue</span>, cpu, hd);</span><br><span class="line">                part_stat_unlock();</span><br><span class="line">                part_in_flight(gp-&gt;<span class="built_in">queue</span>, hd, inflight);</span><br><span class="line">                seq_printf(seqf, <span class="string">&quot;%4d %7d %s %lu %lu %lu &quot;</span></span><br><span class="line">                           <span class="string">&quot;%u %lu %lu %lu %u %u %u %u\n&quot;</span>,</span><br><span class="line">                           MAJOR(part_devt(hd)), MINOR(part_devt(hd)),</span><br><span class="line">                           disk_name(gp, hd-&gt;partno, buf),</span><br><span class="line">                           part_stat_read(hd, ios[READ]),</span><br><span class="line">                           part_stat_read(hd, merges[READ]),</span><br><span class="line">                           part_stat_read(hd, sectors[READ]),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, ticks[READ])),</span><br><span class="line">                           part_stat_read(hd, ios[WRITE]),</span><br><span class="line">                           part_stat_read(hd, merges[WRITE]),</span><br><span class="line">                           part_stat_read(hd, sectors[WRITE]),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, ticks[WRITE])),</span><br><span class="line">                           inflight[<span class="number">0</span>],</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, io_ticks)),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, time_in_queue))</span><br><span class="line">                        );</span><br><span class="line">        &#125;</span><br><span class="line">        disk_part_iter_exit(&amp;piter);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> Cpu-partitioning – after reboot</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kernel.hung_task_timeout_secs = 600</span><br><span class="line">kernel.nmi_watchdog = 0</span><br><span class="line">vm.stat_interval = 10</span><br><span class="line">kernel.timer_migration = 1</span><br><span class="line">net.core.busy_read = 50</span><br><span class="line">net.core.busy_poll = 50</span><br><span class="line">kernel.numa_balancing = 0</span><br><span class="line">kernel.sched_min_granularity_ns = 10000000</span><br><span class="line">vm.dirty_ratio = 10</span><br><span class="line">vm.dirty_background_ratio = 3</span><br><span class="line">vm.swappiness = 10</span><br><span class="line">kernel.sched_migration_cost_ns = 5000000</span><br><span class="line">Disables Transparent Hugepages</span><br></pre></td></tr></table></figure>

<h4 id="blacklist-kernel-module"><a href="#blacklist-kernel-module" class="headerlink" title="blacklist kernel module"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/41278">blacklist kernel module</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## kernel boot blacklist</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;modprobe.blacklist=mpt2sas&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modprobe -r module_name                                                      #step1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;blacklist module_name&quot;</span> &gt;&gt; /etc/modprobe.d/local-dontload.conf            <span class="comment">#step2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;install module_name /bin/false&quot;</span> &gt;&gt; /etc/modprobe.d/local-dontload.conf   <span class="comment">#step3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak                       #step4</span></span><br><span class="line"><span class="comment"># dracut --omit-drivers module_name -f                                                                               #step5</span></span><br><span class="line"><span class="comment"># grub2-editenv - list | grep kernelopts                                                                             #step6</span></span><br><span class="line"><span class="comment"># grub2-editenv - set kernelopts=&quot;&lt;&gt; module_name.blacklist=1 rd.driver.blacklist=module_name&quot;                        #step7</span></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak             #step8</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^KDUMP_COMMANDLINE_APPEND=/s/&quot;$/ rd.driver.blacklist=module_name&quot;/&#x27; /etc/sysconfig/kdump                  #step9</span></span><br><span class="line"><span class="comment"># kdumpctl restart                                                                                                   #step10</span></span><br><span class="line"><span class="comment"># mkdumprd -f /boot/initramfs-$(uname -r)kdump.img                                                                   #step11</span></span><br><span class="line"><span class="comment"># reboot                                                                                                             #step12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak                       #step4</span></span><br><span class="line"><span class="comment"># dracut --omit-drivers module_name -f                                                                               #step5</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^GRUB_CMDLINE_LINUX=/s/&quot;$/ module_name.blacklist=1 rd.driver.blacklist=module_name&quot;/&#x27; /etc/default/grub   #step6</span></span><br><span class="line"><span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg                                                                             #step7</span></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak             #step8</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^KDUMP_COMMANDLINE_APPEND=/s/&quot;$/ rd.driver.blacklist=module_name&quot;/&#x27; /etc/sysconfig/kdump                  #step9</span></span><br><span class="line"><span class="comment"># kdumpctl restart                                                                                                   #step10</span></span><br><span class="line"><span class="comment"># mkdumprd -f /boot/initramfs-$(uname -r)kdump.img                                                                   #step11</span></span><br><span class="line"><span class="comment"># reboot                                                                                                             #step12</span></span><br></pre></td></tr></table></figure>

<h4 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">timeout</span> 5 iftop  -F 192.168.* -i bond0 -t  -B -n</span><br><span class="line">Got the top10</span><br><span class="line">$ awk <span class="string">&#x27;&#123;if($1~/10.[0-9]+/) &#123;a[$1]++&#125;; if($2~/10.[0-9]+/) &#123;a[$2]++&#125;&#125; END&#123;for(i in a) &#123;if(a[i]!=20) &#123;print i&#125;&#125;&#125;&#x27;</span> /tmp/tmp1</span><br></pre></td></tr></table></figure>

<h4 id="shadowsocks"><a href="#shadowsocks" class="headerlink" title="shadowsocks"></a>shadowsocks</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">&#x27;s/cleanup/cleanup/g&#x27;</span> /usr/local/lib/pythonX.X/dist-packages/shadowsocks/crypto/openssl.py</span><br></pre></td></tr></table></figure>

<h4 id="use-proxychains"><a href="#use-proxychains" class="headerlink" title="use proxychains"></a>use proxychains</h4><p>Disable the system Integrity Protection</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">⌘ + R go to recovery mode</span><br><span class="line">Utilities -&gt; Terminal -&gt; $ csrutil <span class="built_in">enable</span> --without debug</span><br><span class="line">or</span><br><span class="line">Utilities -&gt; Terminal -&gt; $ csrutil <span class="built_in">disable</span></span><br><span class="line">reboot</span><br><span class="line">$ csrutil status</span><br><span class="line">System Integrity Protection status: disabled</span><br><span class="line"></span><br><span class="line"><span class="comment">#not comment this line in proxychains-ng</span></span><br><span class="line">quiet_mode <span class="comment">#</span></span><br><span class="line">[ProxyList]</span><br><span class="line">socks5 127.0.0.1 1080</span><br><span class="line"></span><br><span class="line">$ proxychains /bin/bash</span><br><span class="line">$ wget https://www.google.com</span><br></pre></td></tr></table></figure>

<h4 id="NMI"><a href="#NMI" class="headerlink" title="NMI"></a>NMI</h4><p>Non-Maskable Interrupt(NMI) is the highest priority interrupt that can not be masked by any software<br>The NMI watchdog base the APIC(Advanced Programmable Interrupt Controller) protocol</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kernel.nmi_watchdog=1 →(I/O APIC)</span><br><span class="line">kernel.nmi_watchdog=2 → (Locall APIC)</span><br><span class="line"></span><br><span class="line"><span class="comment">## or add the parameter to grub</span></span><br><span class="line">nmi_watchdog=0</span><br></pre></td></tr></table></figure>

<h4 id="dmidecode"><a href="#dmidecode" class="headerlink" title="dmidecode"></a>dmidecode</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">```bash</span><br><span class="line">$ dmidecode -t system -s Manufacturer</span><br><span class="line">Invalid string keyword: Manufacturer</span><br><span class="line">Valid string keywords are:</span><br><span class="line">  bios-vendor</span><br><span class="line">  bios-version</span><br><span class="line">  bios-release-date</span><br><span class="line">  bios-revision</span><br><span class="line">  firmware-revision</span><br><span class="line">  system-manufacturer</span><br><span class="line">  system-product-name</span><br><span class="line">  system-version</span><br><span class="line">  system-serial-number</span><br><span class="line">  system-uuid</span><br><span class="line">  system-sku-number</span><br><span class="line">  system-family</span><br><span class="line">  baseboard-manufacturer</span><br><span class="line">  baseboard-product-name</span><br><span class="line">  baseboard-version</span><br><span class="line">  baseboard-serial-number</span><br><span class="line">  baseboard-asset-tag</span><br><span class="line">  chassis-manufacturer</span><br><span class="line">  chassis-type</span><br><span class="line">  chassis-version</span><br><span class="line">  chassis-serial-number</span><br><span class="line">  chassis-asset-tag</span><br><span class="line">  processor-family</span><br><span class="line">  processor-manufacturer</span><br><span class="line">  processor-version</span><br><span class="line">  processor-frequency</span><br><span class="line"></span><br><span class="line">$ dmidecode -s system-manufacturer</span><br><span class="line">Dell Inc.</span><br><span class="line">Type    Information</span><br><span class="line">0       BIOS</span><br><span class="line">1       System</span><br><span class="line">2       Baseboard</span><br><span class="line">3       Chassis</span><br><span class="line">4       Processor</span><br><span class="line">5       Memory Controller</span><br><span class="line">6       Memory Module</span><br><span class="line">7       Cache</span><br><span class="line">8       Port Connector</span><br><span class="line">9       System Slots</span><br><span class="line">10      On Board Devices</span><br><span class="line">11      OEM Strings</span><br><span class="line">12      System Configuration Options</span><br><span class="line">13      BIOS Language</span><br><span class="line">14      Group Associations</span><br><span class="line">15      System Event Log</span><br><span class="line">16      Physical Memory Array</span><br><span class="line">17      Memory Device</span><br><span class="line">18      32-bit Memory Error</span><br><span class="line">19      Memory Array Mapped Address</span><br><span class="line">20      Memory Device Mapped Address</span><br><span class="line">21      Built-<span class="keyword">in</span> Pointing Device</span><br><span class="line">22      Portable Battery</span><br><span class="line">23      System Reset</span><br><span class="line">24      Hardware Security</span><br><span class="line">25      System Power Controls</span><br><span class="line">26      Voltage Probe</span><br><span class="line">27      Cooling Device</span><br><span class="line">28      Temperature Probe</span><br><span class="line">29      Electrical Current Probe</span><br><span class="line">30      Out-of-band Remote Access</span><br><span class="line">31      Boot Integrity Services</span><br><span class="line">32      System Boot</span><br><span class="line">33      64-bit Memory Error</span><br><span class="line">34      Management Device</span><br><span class="line">35      Management Device Component</span><br><span class="line">36      Management Device Threshold Data</span><br><span class="line">37      Memory Channel</span><br><span class="line">38      IPMI Device</span><br><span class="line">39      Power Supply</span><br><span class="line">40      Additional Information</span><br><span class="line">41      Onboard Devices Extended Information</span><br><span class="line">42      Management Controller Host Interface</span><br></pre></td></tr></table></figure>

<h4 id="How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><a href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd" class="headerlink" title="How to got the info from the pipe fd and socke fd"></a>How to got the info from the pipe fd and socke fd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">$ strace <span class="built_in">ls</span> -l /proc/pid/fd</span><br><span class="line"><span class="built_in">readlink</span>(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;socket:[4248017]&quot;</span>, 65)   = 16</span><br><span class="line">lrwx------ 1 nobody nobody 64 Apr 25 11:04 6 -&gt; socket:[4248017]</span><br><span class="line"></span><br><span class="line">$ netstat -alep | grep 4248017</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name</span><br><span class="line">unix  3      [ ]         STREAM                                   CONNECTED               4248017     31233/test</span><br><span class="line"><span class="comment">## it &#x27;s means unix domain socket connectted with another local inter-process</span></span><br><span class="line"><span class="comment">## if it &#x27;s the remote socket connection you could see the ip adddr, grep xxx /proc/net/tcp /proc/net/udp</span></span><br><span class="line">```bash</span><br><span class="line">$ netstat -alep | grep 5522546</span><br><span class="line">tcp        0      0 0.0.0.0:chimera-hwm     0.0.0.0:*               LISTEN      root       5522546    160890/qperf</span><br><span class="line">$ grep 5522546 /proc/net/tcp</span><br><span class="line">   0: 00000000:0FA9 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 5522546 1 ffff952fb5be07c0 100 0 0 10 0</span><br><span class="line"><span class="comment">## local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## remote</span></span><br><span class="line">$ netstat -alep | grep 5866595</span><br><span class="line">tcp        0      0 test-2643-2:ssh         10.0.0.73:47702         ESTABLISHED root       5866595    147135/sshd: root@p</span><br><span class="line">$ grep 5866595 /proc/net/tcp</span><br><span class="line">  31: 0x0100a8c1:0016 0200a8c1:BA56 01 00000000:00000000 02:000AC753 00000000     0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> dec2ip</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">dec2ip</span></span> ()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">local</span> v=<span class="variable">$1</span></span><br><span class="line">   <span class="built_in">local</span> i1=$((v&gt;&gt;<span class="number">24</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i2=$((v&gt;&gt;<span class="number">16</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i3=$((v&gt;&gt;<span class="number">8</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i4=$((v&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">&#x27;%d.%d.%d.%d\n&#x27;</span> <span class="variable">$i4</span> <span class="variable">$i3</span> <span class="variable">$i2</span> <span class="variable">$i1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dec2ip <span class="variable">$1</span></span><br><span class="line"><span class="comment">####</span></span><br><span class="line"></span><br><span class="line">$ sh dec2ip $(<span class="built_in">printf</span> <span class="string">&quot;%d \n&quot;</span> 0x0200a8c1)</span><br><span class="line">193.168.0.2</span><br><span class="line"></span><br><span class="line">// https://gist.github.com/jkstill/5095725</span><br><span class="line">31: 0x0100a8c1:0016 0200a8c1:BA56 01 00000000:00000000 02:000AC753 00000000     0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line">31:0x0100a8c1:0016 0200a8c1:BA56 01</span><br><span class="line"> |   |         |   |        |    |--&gt; connection state</span><br><span class="line"> |   |         |   |        |------&gt; remote TCP port number</span><br><span class="line"> |   |         |   |-------------&gt; remote IPv4 address</span><br><span class="line"> |   |         |--------------------&gt; <span class="built_in">local</span> TCP port number</span><br><span class="line"> |   |---------------------------&gt; <span class="built_in">local</span> IPv4 address</span><br><span class="line"> |----------------------------------&gt; number of entry</span><br><span class="line"></span><br><span class="line">00000000:00000000 02:000AC753 00000000</span><br><span class="line"> |        |        |  |        |--&gt; number of unrecovered RTO timeouts</span><br><span class="line"> |        |        |  |----------&gt; number of jiffies until timer expires</span><br><span class="line"> |        |        |----------------&gt; timer_active (see below)</span><br><span class="line"> |        |----------------------&gt; receive-queue</span><br><span class="line"> |-------------------------------&gt; transmit-queue</span><br><span class="line"></span><br><span class="line">0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line">|        | |                | |        |  | |  |  |--&gt; slow start size threshold,</span><br><span class="line">|        | |                | |        |  | |  |       or -1 <span class="keyword">if</span> the treshold</span><br><span class="line">|        | |                | |        |  | |  |       is &gt;= 0xFFFF</span><br><span class="line">|        | |                | |        |  | |  |----&gt; sending congestion window</span><br><span class="line">|        | |                | |        |  | |-------&gt; (ack.quick&lt;&lt;<span class="string">1)|ack.pingpong</span></span><br><span class="line"><span class="string">|        | |                | |        |  |---------&gt; Predicted tick of soft clock</span></span><br><span class="line"><span class="string">|        | |                | |        |               (delayed ACK control data)</span></span><br><span class="line"><span class="string">|        | |                | |        |------------&gt; retransmit timeout</span></span><br><span class="line"><span class="string">|        | |                | |------------------&gt; location of socket in memory</span></span><br><span class="line"><span class="string">|        | |                |-----------------------&gt; socket reference count</span></span><br><span class="line"><span class="string">|        | |-----------------------------&gt; inode</span></span><br><span class="line"><span class="string">|        |----------------------------------&gt; unanswered 0-window probes</span></span><br><span class="line"><span class="string">|---------------------------------------------&gt; uid</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">net/socket.c</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sockfs_dname() is called from d_path().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *<span class="title function_">sockfs_dname</span><span class="params">(<span class="keyword">struct</span> dentry *dentry, <span class="type">char</span> *buffer, <span class="type">int</span> buflen)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> dynamic_dname(dentry, buffer, buflen, <span class="string">&quot;socket:[%lu]&quot;</span>,</span><br><span class="line">dentry-&gt;d_inode-&gt;i_ino);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">                                          ----&gt; you get the inode number from pipe or socketfs, you could these processes <span class="built_in">list</span></span><br><span class="line">                                          |</span><br><span class="line">$ strace ls -lR /proc <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep -Ei <span class="string">&#x27;4301922|4248015&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="process-schdule"><a href="#process-schdule" class="headerlink" title="process schdule"></a>process schdule</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;NF &gt; 7 &#123; if ($1 == &quot;task&quot;) &#123; if (h == 0) &#123; print; h=1 &#125; &#125; else &#123; print &#125; &#125;&#x27;</span> /proc/sched_debug</span><br></pre></td></tr></table></figure>

<h5 id="Process-schdule"><a href="#Process-schdule" class="headerlink" title="Process schdule"></a><a target="_blank" rel="noopener" href="http://abcdxyzk.github.io/blog/2014/05/22/kernel-sched-tick/">Process schdule</a></h5><ul>
<li>RHEL CFS Scheduler  !!! important<ul>
<li>Implements multiple red&#x2F;black trees as run queues for sockets and cores (asopposed to one run queue per processor or per system)</li>
<li>sched_min_granularity_ns</li>
<li>sched_wakeup_granularity_ns</li>
<li>sched_migration_cost</li>
<li>sched_child_runs_first</li>
<li>sched_latency_ns</li>
</ul>
</li>
<li>Tuned-adm will increase quantum<ul>
<li>echo 10000000 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sched_min_granularity_ns<ul>
<li>Minimal preemption granularity for CPU bound tasks</li>
<li>See sched_latency_ns for details. The default value is 4000000 (ns)</li>
</ul>
</li>
<li>echo 15000000 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sched_wakeup_granularity_ns<ul>
<li>The wake-up preemption granularity</li>
<li>Increasing this variable reduces wake-up preemption, reducing disturbance of compute bound tasks</li>
<li>Decreasing it improves wake-up latency and throughput for latency critical tasks<ul>
<li>particularly when a short duty cycle load component must compete with CPU bound components. The default value is 5000000 (ns)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>loading balancing<ul>
<li>Scheduler tries to keep all CPUs busy by moving tasks form overloaded CPUs to idle CPUs</li>
<li>Detect using “perf stat”, look for excessive “migrations”</li>
<li>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sched_migration_cost_ns<ul>
<li>Amount of time after the last execution that a task is considered to be “cache hot” in migration decisions.<ul>
<li>A “hot” task is less likely to be migrated, so increasing this variable reduces task migrations. The default value is 500000 (ns)</li>
</ul>
</li>
<li>If the CPU idle time is higher than expected when there are runnable processes, try reducing this value.<ul>
<li>If tasks bounce between CPUs or nodes too often, try increasing it</li>
</ul>
</li>
</ul>
</li>
<li>Rule of thumb – increase by 2-10x to reduce load balancing (tuned does this)<ul>
<li>Use 10x on large systems when many CGROUPs are actively used (ex: RHEV&#x2F;KVM&#x2F;RHOS)</li>
</ul>
</li>
</ul>
</li>
<li>Fork behavior<ul>
<li>sched_child_runs_first<ul>
<li>Controls whether parent or child runs first</li>
<li>Default is 0: parent continues before children run</li>
<li>Default is different than RHEL5</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2988101">sched: RT throttling activated</a><br>Enable RT_RUNTIME_GREED with the following command:<br>Raw</p>
<pre><code>/proc/sys/kernel/sched_rt_period_us
Defines the period in μs (microseconds) to be considered as 100% of CPU bandwidth. The default value is 1,000,000 μs (1 second). Changes to the value of the period must be very well thought out as a period too long or too small are equally dangerous.

/proc/sys/kernel/sched_rt_runtime_us
The total bandwidth available to all real-time tasks. The default values is 950,000 μs (0.95 s) or, in other words, 95% of the CPU bandwidth. Setting the value to -1 means that real-time tasks may use up to 100% of CPU times. This is only adequate when the real-time tasks are well engineered and have no obvious caveats such as unbounded polling loops.


$ echo RT_RUNTIME_GREED &gt; /sys/kernel/debug/sched_features

To keep all CPUs with the same rt_runtime, disable the NO_RT_RUNTIME_SHARE logic:
$ echo NO_RT_RUNTIME_SHARE &gt; /sys/kernel/debug/sched_features

### it could cause some issue in pin the linux process to cpu core
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">That means some guy enable the linux process real-time schdule</span><br><span class="line">```bash</span><br><span class="line">## interval</span><br><span class="line"></span><br><span class="line">|----&gt;do_timer()   更新jiffies_64</span><br><span class="line">|----&gt;update_process_times()</span><br><span class="line">        |----&gt;scheduler_tick()</span><br><span class="line">        |----&gt;update_rq_clock()  更新当前调度队列rq的clock</span><br><span class="line">        |----&gt;curr-&gt;sched_class-&gt;task_tick()</span><br><span class="line">        |         对于普通进程，即task_tick_fair()</span><br><span class="line">        |         task_struct: struct sched_class *sched_class</span><br><span class="line"></span><br><span class="line">update_rq_clock()----delta = sched_clock_cpu(cpu_of(rq)) - rq-&gt;clock</span><br><span class="line">        |-----两次相邻两次周期性调度器运行的时间差</span><br><span class="line">        |----rq-&gt;clock += delta; 更新运行队列上的时钟</span><br><span class="line">                |----&gt;update_rq_clock_task(rq, delta)</span><br><span class="line">                |     即rq-&gt;clock_task += delta</span><br><span class="line"></span><br><span class="line">## normal</span><br><span class="line">task_tick_fair()----&gt;entity_tick()   没有考虑组调度</span><br><span class="line">  |----&gt;update_curr() 更新相关统计量</span><br><span class="line">  |----&gt;check_preempt_tick()</span><br><span class="line">  |        检查进程本次获得CPU使用权的执行时间是否超过了</span><br><span class="line">  |        它对应的ideal_runtime值，如果超过了，则将当前进</span><br><span class="line">  |        程的TIF_NEED_RESCHED标志位置位</span><br><span class="line"></span><br><span class="line">update_curr()</span><br><span class="line">  |----delta_exec = (unsigned long)(now - curr-&gt;exec_start);</span><br><span class="line">  |            exec_start当前进程开始获得</span><br><span class="line">  |            cpu使用权时的时间戳;</span><br><span class="line">  |            进程本次所获得的CPU执行权的时间;</span><br><span class="line">  |----&gt;__update_curr(cfs_rq, curr, delta_exec);</span><br><span class="line">      |----&gt;curr-&gt;sum_exec_runtime += delta_exec;</span><br><span class="line">      |     更新该进程获得CPU执行权总时间</span><br><span class="line">      |</span><br><span class="line">      |----&gt;curr-&gt;vruntime += delta_exec_weighted;</span><br><span class="line">      |     更新该进程获得CPU执行权的虚拟时间</span><br><span class="line">      |</span><br><span class="line">      |----&gt;update_min_vruntime()</span><br><span class="line">      |     更新cfs_rq-&gt;min_vruntime</span><br><span class="line">      |</span><br><span class="line">  |----&gt;curr-&gt;exec_start = now</span><br><span class="line">  |        更新进程下次运行起始时间</span><br><span class="line">  |        (如果被抢占，下次被调度时将会更新)</span><br><span class="line"></span><br><span class="line">check_preempt_tick()</span><br><span class="line">  |----ideal_runtime = sched_slice(cfs_rq, curr);</span><br><span class="line">  |----delta_exec = curr-&gt;sum_exec_runtime</span><br><span class="line">  |                 - curr-&gt;prev_sum_exec_runtime;</span><br><span class="line">  |----if(delta_exec &gt; ideal_runtime)</span><br><span class="line">  |          resched_task(rq_of(cfs_rq)-&gt;curr);</span><br><span class="line">  |          把当前进程的TIF_NEED_RESCHED标志位置位</span><br><span class="line">  |----else</span><br><span class="line">  |    delta = curr-&gt;vruntime - se-&gt;vruntime;  //这是什么？</span><br><span class="line">  |    if (delta &gt; ideal_runtime)</span><br><span class="line">  |        resched_task(rq_of(cfs_rq)-&gt;curr);</span><br><span class="line">  |        把当前进程的TIF_NEED_RESCHED标志位置位</span><br><span class="line"></span><br><span class="line">## real time</span><br><span class="line">task_tick_rt()</span><br><span class="line">  |----&gt;update_curr_rt();</span><br><span class="line">  |----&gt;if (p-&gt;policy != SCHED_RR) return;  SCHED_FIFO只有主动放弃CPU使用权</span><br><span class="line">  |----&gt;rt.timeslice值减一，若没有运行完时间则直接返回，</span><br><span class="line">  |     否则再次分配时间片，加入队列尾部，设置TIF_NEED_RESCHED</span><br><span class="line"></span><br><span class="line">update_curr_rt()</span><br><span class="line">  |----delta_exec = rq-&gt;clock - curr-&gt;se.exec_start; //本次运行时间</span><br><span class="line">  |----curr-&gt;se.sum_exec_runtime += delta_exec; //更新总得运行时间</span><br><span class="line">  |----curr-&gt;se.exec_start = rq-&gt;clock; //更新下次进程运行的起始时间</span><br><span class="line">  |----if (sched_rt_runtime(rt_rq) != RUNTIME_INF)</span><br><span class="line">  |-------&#123;</span><br><span class="line">  |           rt_rq-&gt;rt_time += delta_exec;</span><br><span class="line">  |                if (sched_rt_runtime_exceeded(rt_rq))</span><br><span class="line">  |                   resched_task(curr);</span><br><span class="line">  |       &#125;</span><br></pre></td></tr></table></figure>
[in non real time linux kernel, dmesg show the &quot;sched: RT throttling activated&quot;](http://abcdxyzk.github.io/blog/2014/05/22/kernel-sched-tick/)  

#### [Linux watchdog](https://blog.csdn.net/ericstarmars/article/details/81750919)
The kernel code and the SCHED_FIFO(pro=99) process cause the lockup, and the kernel preemption disabled
- softlockup
  - The kernel code not release the CPU resource in the time interval
  - [watchdog/0] [watchdog/1], it depends hrtimer interrupts could be responded
- hardlockup
  - It depends the NMI perf event of x86 PMU, CPU lockup and not respond the hrtimer interrupt
  - NMI interrupt Watchdog
- hardware watchdog
  - systemctl start ipmidog
  - You could custom the timeout action
  - ipmitool mc watchdog get; /dev/watchdog
- Intel TCO WatchDog Timer Driver
  - lsmod | grep wdt
- userspace watchdog
  - /usr/sbin/watchdog

#### [lockdep](http://www.lenky.info/archives/2013/04/2253)
CONFIG_LOCKDEP_SUPPORT=y
- if a new hardirq-safe lock is discovered, we check whether it took any hardirq-unsafe lock in the past.
- if a new softirq-safe lock is discovered, we check whether it took any softirq-unsafe lock in the past.
- if a new hardirq-unsafe lock is discovered, we check whether any hardirq-safe lock took it in the past.
- if a new softirq-unsafe lock is discovered, we check whether any softirq-safe lock took it in the past.

## [IO type](https://lzz5235.github.io/2015/08/25/block.html)
- Synchronous blocking (normal)
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf;</span><br><span class="line">fd = open(<span class="string">&quot;/dev/ttyS1&quot;</span>,O_RDWR);</span><br><span class="line">...</span><br><span class="line">res = read(fd,&amp;buf,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(res == <span class="number">1</span>)</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,buf);</span><br></pre></td></tr></table></figure>
- Synchronous non-blocking (intel loved)
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf;</span><br><span class="line">fd = open(<span class="string">&quot;/dev/ttyS1&quot;</span>,O_RDWR | O_NONBLOCK);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">while</span>(read(fd,&amp;buf,<span class="number">1</span>)!= <span class="number">1</span>)</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,buf);</span><br></pre></td></tr></table></figure>
- Asynchronous blocking
- Asynchronous non-blocking (AIO)
   - 异步通知的全程是“信号驱动的异步I/O”，也就是说一旦设备准备就绪，主动通知应用程序，这样应用程序根本就不需要查询设备状态。
   - O_ASYNC
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; sys/types.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; sys/stat.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; stdio.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; fcntl.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; signal.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; unistd.h &gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LEN 100</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">input_handler</span><span class="params">(<span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">char</span> data[MAX_LEN];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">        len = read(STDIN_FILENO,&amp;data,MAX_LEN);</span><br><span class="line">        data[len] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;input:%s\n&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> oflags;</span><br><span class="line">        signal(SIGIO,input_handler);</span><br><span class="line">        fcntl(STDIN_FILENO,F_SETOWN,getpid());</span><br><span class="line">        oflags = fcntl(STDIN_FILENO,F_GETFL);</span><br><span class="line">        fcntl(STDIN_FILENO,F_SETFL,oflags | O_ASYNC);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

#### [rpm spec](https://www.golinuxhub.com/2018/05/how-to-execute-script-at-pre-post-preun-postun-spec-file-rpm/)
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_usr&#125;&quot;</span></span><br><span class="line">/usr</span><br><span class="line"></span><br><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_libdir&#125;&quot;</span></span><br><span class="line">/usr/lib64</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify /usr/lib/rpm/macros from lib64 to lib</span></span><br><span class="line"><span class="comment">#%_lib                   lib64</span></span><br><span class="line">%_lib                   lib</span><br><span class="line">%_libdir                %&#123;_exec_prefix&#125;/%&#123;_lib&#125;</span><br><span class="line"></span><br><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_libdir&#125;&quot;</span></span><br><span class="line">/usr/lib</span><br><span class="line"></span><br><span class="line">%pre</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is pre&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line">%post</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is post&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line">%preun</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is preun&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line">%postun</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is postun&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm -ivh /tmp/rpmbuild/RPMS/x86_64/deepak-1.0.0-1.x86_64.rpm</span></span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is pre</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:deepak-1.0.0-1                   <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is post</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm -Uvh /tmp/rpmbuild/RPMS/x86_64/deepak-2.0.0-1.x86_64.rpm</span></span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is pre</span><br><span class="line">Install Value: 2</span><br><span class="line">Upgrade Value: 2</span><br><span class="line">Uninstall Value: 2</span><br><span class="line">-------------</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:deepak-2.0.0-1                   <span class="comment">################################# [ 50%]</span></span><br><span class="line">-------------</span><br><span class="line">This is post</span><br><span class="line">Install Value: 2</span><br><span class="line">Upgrade Value: 2</span><br><span class="line">Uninstall Value: 2</span><br><span class="line">-------------</span><br><span class="line">-------------</span><br><span class="line">This is preun</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line">Cleaning up / removing...</span><br><span class="line">   2:deepak-1.0.0-1                   <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is postun</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line"><span class="comment"># rpm -e deepak</span></span><br><span class="line">-------------</span><br><span class="line">This is preun</span><br><span class="line">Install Value: 0</span><br><span class="line">Upgrade Value: 0</span><br><span class="line">Uninstall Value: 0</span><br><span class="line">-------------</span><br><span class="line">-------------</span><br><span class="line">This is postun</span><br><span class="line">Install Value: 0</span><br><span class="line">Upgrade Value: 0</span><br><span class="line">Uninstall Value: 0</span><br><span class="line">-------------</span><br></pre></td></tr></table></figure>

#### setcap - set file capabilities

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wireshark work for non-root user</span></span><br><span class="line">$ <span class="built_in">setcap</span> <span class="string">&#x27;CAP_NET_RAW+eip CAP_NET_ADMIN+eip&#x27;</span> /usr/sbin/dumpcap</span><br><span class="line"></span><br><span class="line"><span class="comment"># set uid</span></span><br><span class="line">$ <span class="built_in">chmod</span> u+s /path/to/application</span><br><span class="line"></span><br><span class="line"><span class="comment"># use ping</span></span><br><span class="line">$ <span class="built_in">setcap</span> <span class="string">&#x27;cap_net_admin,cap_net_raw+ep&#x27;</span> /bin/ping</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear</span></span><br><span class="line">$ <span class="built_in">setcap</span> -r /bin/ping</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">setcap</span> cap_net_bind_service=+eip /opt/openport_under1024.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## found all setcap files</span></span><br><span class="line">$ <span class="built_in">getcap</span> -r  /</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> u+s /bin/vi</span><br><span class="line">$ find /bin -perm -u=s -<span class="built_in">type</span> f</span><br><span class="line"></span><br><span class="line"><span class="comment">### if you set CAP_SETUID cause python switch to root shell</span></span><br><span class="line"><span class="comment"># ALL the capabilites permitted (p) and effective (e)</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">setcap</span> CAP_SETUID+ep /usr/bin/python</span><br><span class="line">$ python -c <span class="string">&#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

#### windows
##### auto start vmware player
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start &quot;C:\Program Files (x86)\VMware\VMware Player\vmplayer.exe&quot; &quot;%USERPROFILE%\Documents\Virtual Machines\&lt;vm&gt;.vmx&quot;</span><br><span class="line">VBoxManage startvm vm001 --type gui</span><br></pre></td></tr></table></figure>

##### terminal
change the colorScheme in json config
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;58ad8b0c-3ef8-5f4d-bc6f-13e4c00f2530&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debian&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;One Half Dark&quot;</span><span class="punctuation">,</span>  &lt;-------- add this line</span><br><span class="line">                <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Windows.Terminal.Wsl&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

#### aws command
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.0.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.1.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.2.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.3.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.4.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.5.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.6.0</span><br><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/rw.7.0</span><br></pre></td></tr></table></figure>

#### [rclone](https://bruxy.regnet.cz/web/linux/EN/rsync-rclone/)
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.config/rclone/rclone.conf</span><br><span class="line">[remote_server]</span><br><span class="line"><span class="built_in">type</span> = sftp</span><br><span class="line">host = 172.102.0.123</span><br><span class="line">user = bruxy</span><br><span class="line">key_file = /home/bruxy/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">$ rclone -v <span class="built_in">sync</span> <span class="built_in">source</span>/directory/ remote_server:/destination/directory/</span><br></pre></td></tr></table></figure>

#### interrput the tcp link
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpkill -i eth0 host 192.168.0.1</span><br><span class="line">$ ss -K dst 192.168.0.1 dport = 2049</span><br><span class="line">$ iptables -A INPUT -p tcp -m tcp --dport 2049 -j REJECT --reject-with tcp-reset</span><br></pre></td></tr></table></figure>

#### bash history
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HISTSIZE=10000</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=100000</span><br></pre></td></tr></table></figure>

#### delete file by inode
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -inum [inode-number] -<span class="built_in">exec</span> <span class="built_in">rm</span> -i &#123;&#125; \;</span><br></pre></td></tr></table></figure>

#### got the node ip addr
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ip r g 1.1.1.1 | awk <span class="string">&#x27;/src/&#123;print $NF&#125;&#x27;</span></span><br><span class="line">$ ip r g 1.1.1.1 | awk <span class="string">&#x27;/src/&#123;print $(NF-2)&quot;_&quot;$NF&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

#### route info
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl net.ipv&#123;4,6&#125;.route.max_size</span><br><span class="line">$ ip route show table all</span><br><span class="line">$ ip route show cache</span><br><span class="line">$ ip -6 route show cache</span><br></pre></td></tr></table></figure>

#### java parameters
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -J-d64 -dump:format=b,file=dump.bin PID</span><br><span class="line">$ jstat -gcold</span><br><span class="line">$ jstat -gcnew [pid]</span><br><span class="line">$ jstat -gc [pid]</span><br><span class="line">$ jmap -histo [pid]</span><br><span class="line">-XX:+HeapDumpOnOutOfMemeryError</span><br><span class="line">-XX:HeapDumpPath=/home/logs -Xloggc:/home/log/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps</span><br><span class="line">-server -Xms4000m -Xmx4000m -Xmn1500m -Xss256k -XX:PermSize=340m -XX:MaxPermSize=340m -XX:+UseConcMarkSweepGC</span><br><span class="line">XX:+DisableAttachMechanism</span><br><span class="line"></span><br><span class="line"><span class="comment">## java temp file</span></span><br><span class="line">/tmp/.java_pid217893</span><br><span class="line">/tmp/hsperfdata_yourname</span><br></pre></td></tr></table></figure>

#### ISO
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### this function</span></span><br><span class="line">$ mkisofs -J -l -R -V <span class="string">&quot;Label CD&quot;</span> -iso-level 4 -o output.iso input_directory</span><br></pre></td></tr></table></figure>

#### [intel boot agent message](https://www.supermicro.com/wdl/ISO_Extracted/CDR-APLUS2_2.02_for_A+_AMD_SP5100_platform/Intel/LAN/v18.0.1/APPS/BOOTAGNT/DOCS/ba_msgs.htm)
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## uefi set bootutil64e</span></span><br><span class="line">FS0:\&gt;bootutil64e -up=efi -all</span><br></pre></td></tr></table></figure>

### [Draw kernel boot dmesg image](http://tinylab.org/measure-and-draw-the-boot-up-time-of-linux-kernel/)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | perl bootgraph.pl &gt; bootgraph.svg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dmesg | perl dmesg-initcall.pl &gt; boot-initcall.log</span><br><span class="line">$ git clone https://github.com/brendangregg/FlameGraph.git</span><br><span class="line">$ cd FlameGraph</span><br><span class="line">$ cat boot-initcall.log | ./FlameGraph/flamegraph.pl --color=mem &gt; linux-boot-flamegraph.svg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo apt-get install gnuplot-x11</span><br><span class="line">$ cat linux-boot.gnuplot</span><br><span class="line">set terminal svg size 800,300 fsize 4</span><br><span class="line">set output &#x27;linux-boot-gnuplot.svg&#x27;</span><br><span class="line">set style data histograms</span><br><span class="line">set style histogram clustered gap 1 title offset character 0, 0, 0</span><br><span class="line">set style fill solid 0.4 border</span><br><span class="line">set xtics rotate by -45</span><br><span class="line">set boxwidth 0.9 absolute</span><br><span class="line">plot &#x27;./boot-initcall.log&#x27; using 2:xticlabels(1)</span><br><span class="line"></span><br><span class="line">$ gnuplot &lt; linux-boot.gnuplot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git clone https://github.com/tinyclub/tinydraw.git</span><br><span class="line">$  ./tinydraw/histogram/histogram.sh boot-initcall.log &gt; linux-boot-histogram.svg</span><br></pre></td></tr></table></figure>

#### Highcharts
[set highcharts high](https://jsfiddle.net/gh/get/library/pure/highcharts/highcharts/tree/master/samples/highcharts/chart/height/)  

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Highcharts.chart(<span class="string">&#x27;container&#x27;</span>, &#123;</span><br><span class="line">    chart: &#123;</span><br><span class="line">        height: 200,</span><br><span class="line">        <span class="built_in">type</span>: <span class="string">&#x27;line&#x27;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>


#### google slide
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">该选项不是明确的，但是您可以做到。</span><br><span class="line">转到插入-&gt;文本框并在其中需要页脚的位置创建一个框，其中包含所需的内容（我建议将其水平居中）。</span><br><span class="line"></span><br><span class="line">然后在框上右键单击并选择添加到主题-&gt;主菜单/ [...]。</span><br><span class="line"></span><br><span class="line">添加到母版会将其放置在所有幻灯片上。</span><br><span class="line">如果您选择其他选项，它将放到该主题的所有幻灯片上（，例如“标题和正文”主题）。</span><br></pre></td></tr></table></figure>

#### centos 7 auto login
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/gdm/custom.conf</span><br><span class="line">[daemon]</span><br><span class="line">AutomaticLoginEnable=<span class="literal">true</span></span><br><span class="line">AutomaticLogin=username</span><br></pre></td></tr></table></figure>

#### restart udev
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ udevadm control --reload-rules &amp;&amp; udevadm trigger</span><br><span class="line">or</span><br><span class="line">$ sudo systemctl stop systemd-udevd systemd-udevd-kernel.socket systemd-udevd-control.socket</span><br><span class="line">$ <span class="built_in">sleep</span> 5</span><br><span class="line">$ sudo systemctl start systemd-udevd systemd-udevd-kernel.socket systemd-udevd-control.socket</span><br></pre></td></tr></table></figure>

#### Terminal setting
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HISTSIZE=10000</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=100000</span><br><span class="line"></span><br><span class="line"><span class="comment">## if your system is the another language</span></span><br><span class="line"><span class="built_in">export</span> LANGUAGE=en_US.UTF-8</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure>

#### overlayer test
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$ tree lower</span><br><span class="line">lower</span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">└── <span class="built_in">dir</span></span><br><span class="line">    ├── c</span><br><span class="line">    └── d</span><br><span class="line"></span><br><span class="line">5 directories, 0 files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree upper</span><br><span class="line">upper</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">└── f</span><br><span class="line"></span><br><span class="line">4 directories, 0 files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree work</span><br><span class="line">work</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br><span class="line"></span><br><span class="line">$ tree merged</span><br><span class="line">merged</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br><span class="line"></span><br><span class="line">$ mount -t overlay overlay -olowerdir=lower,upperdir=upper,workdir=work merged</span><br><span class="line">$ mount | grep overlay</span><br><span class="line">overlay on /tmp/merged <span class="built_in">type</span> overlay (rw,relatime,lowerdir=lower,upperdir=upper,workdir=work,xino=off)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree work</span><br><span class="line">work</span><br><span class="line">└── work</span><br><span class="line"></span><br><span class="line">1 directory, 0 files</span><br><span class="line"></span><br><span class="line">$ sudo tree work merged/</span><br><span class="line">work</span><br><span class="line">└── work</span><br><span class="line">merged/</span><br><span class="line"></span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   ├── c</span><br><span class="line">│   ├── d</span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">└── f</span><br><span class="line"></span><br><span class="line">9 directories, 0 files</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> testfile &gt; merged/testfile</span><br><span class="line">$ tree upper/</span><br><span class="line">upper/</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">├── f</span><br><span class="line">└── testfile</span><br><span class="line"></span><br><span class="line">4 directories, 1 file</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> upper/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  e  f  testfile</span><br><span class="line">$ <span class="built_in">rm</span> -rf e</span><br><span class="line">$ tree ../merged</span><br><span class="line">../merged</span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   ├── c</span><br><span class="line">│   ├── d</span><br><span class="line">│   └── g</span><br><span class="line">├── f</span><br><span class="line">└── testfile</span><br><span class="line"></span><br><span class="line">7 directories, 1 file</span><br><span class="line"></span><br><span class="line"><span class="comment">#if you delete all lower dirs files, the merged dir could not show uppper dirs</span></span><br></pre></td></tr></table></figure>
  
#### rsync mirrors
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RSYNC_PROXY=<span class="string">&quot;192.168.1.1:8080&quot;</span></span><br><span class="line"><span class="built_in">export</span> http_proxy=http://192.168.1.1:8080; <span class="built_in">export</span> https_proxy=https://192.168.1.1:8080; <span class="built_in">export</span> RSYNC_PROXY=<span class="string">&quot;192.168.1.1:8080&quot;</span></span><br><span class="line">rsync -avzP --exclude ppc64le --exclude aarch64 --delete  rsync://mirrors.tuna.tsinghua.edu.cn/centos/8-stream /centos/</span><br><span class="line">rsync -avzP --exclude ppc64le --exclude aarch64 --delete  rsync://ftp.riken.jp/Linux/centos/8-stream /centos/</span><br></pre></td></tr></table></figure>

#### http proxy
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://192.168.1.1:8080</span><br><span class="line"><span class="built_in">export</span> https_proxy=https://192.168.1.1:8080</span><br></pre></td></tr></table></figure>

#### firefox
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">about:config</span><br><span class="line">network.dnsCacheExpiration = 86400</span><br><span class="line">network.dnsCacheExpirationGracePeriod = 86400</span><br></pre></td></tr></table></figure>

#### wine-wechat
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://com-store-packages.uniontech.com/appstore/pool/appstore/c/com.qq.weixin.deepin/com.qq.weixin.deepin_3.2.1.154deepin14_i386.deb</span><br></pre></td></tr></table></figure>

#### get the driver support info
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ find linux-3.10.0-1127.el7/drivers/net/ethernet/mellanox | grep Kconfig | xargs grep -i support</span><br><span class="line">$ $ find linux-3.10.0-1127.el7/drivers/net/ethernet/broadcom/ | grep Kconfig | xargs grep -i support</span><br><span class="line">        tristate <span class="string">&quot;Broadcom 440x/47xx ethernet support&quot;</span></span><br><span class="line"><span class="comment"># Auto-select SSB PCI-HOST support, if possible</span></span><br><span class="line">        tristate <span class="string">&quot;Broadcom 63xx internal mac support&quot;</span></span><br><span class="line">          This driver supports the ethernet MACs <span class="keyword">in</span> the Broadcom 63xx</span><br><span class="line">        tristate <span class="string">&quot;QLogic bnx2 support&quot;</span></span><br><span class="line">          This driver supports QLogic bnx2 gigabit Ethernet cards.</span><br><span class="line">        tristate <span class="string">&quot;QLogic CNIC support&quot;</span></span><br><span class="line">          This driver supports offload features of QLogic bnx2 gigabit</span><br><span class="line">        tristate <span class="string">&quot;SB1250 Gigabit Ethernet support&quot;</span></span><br><span class="line">          This driver supports Gigabit Ethernet interfaces based on the</span><br><span class="line">$ find linux-3.10.0-1127.el7/drivers/net/ethernet/marvell/ | grep Kconfig | xargs grep -i support</span><br><span class="line">        tristate <span class="string">&quot;Marvell Discovery (643XX) and Orion ethernet support&quot;</span></span><br><span class="line">          This driver supports the gigabit ethernet MACs <span class="keyword">in</span> the</span><br><span class="line">        tristate <span class="string">&quot;Marvell MDIO interface support&quot;</span></span><br><span class="line">          This driver supports the MDIO interface found <span class="keyword">in</span> the network</span><br><span class="line">        tristate <span class="string">&quot;Marvell Armada 370/XP network interface support&quot;</span></span><br><span class="line">          This driver supports the network interface units <span class="keyword">in</span> the</span><br></pre></td></tr></table></figure>

#### [disable USB Attached Storage UAS](https://leo.leung.xyz/wiki/How_to_disable_USB_Attached_Storage_(UAS))
- Slow transfer speeds, sometimes even stalling
  - Kernel messages are full of errors similar to the ones listed below. However, the drive is still healthy.
    - Error messages from uas_eh_abort_handler
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ lsusb</span><br><span class="line">Bus 002 Device 005: ID 0bc2:3343 Seagate RSS LLC</span><br><span class="line"></span><br><span class="line">$ rmmod usb-storage</span><br><span class="line">modprobe usb-storage quirks=0bc2:3343:u</span><br><span class="line"></span><br><span class="line">[947347.271519] usb 2-3.2: New USB device found, idVendor=0bc2, idProduct=3343, bcdDevice= 1.00</span><br><span class="line">[947955.635329] usb-storage 2-3.2:1.0: Quirks match <span class="keyword">for</span> vid 0bc2 pid 3343: 800000</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/modprobe.d/disable-uas.conf</span><br><span class="line">options usb-storage quirks=0bc2:3322:u</span><br><span class="line">$ update-initramfs -u</span><br><span class="line"></span><br><span class="line">or add it to grub</span><br><span class="line">$ <span class="built_in">cat</span> /etc/default/grub</span><br><span class="line">GRUB_CMDLINE_LINUX=usb-storage.quirks=0bc2:3322:u</span><br></pre></td></tr></table></figure>

#### [IO model](https://cloud.tencent.com/developer/article/1005481)
- [在第一个阶段用户进程是否阻塞用来区分阻塞/非阻塞，在第二个阶段用户是否阻塞用来区分同步/异步](https://www.zhihu.com/question/26393784/answer/1480048712)
   - 在第一阶段，内核首先会等待数据准备就绪，这个过程中用户进程是阻塞的；在第二阶段，当数据准备就绪之后，数据会从内核空间拷贝到用户空间(应用程序空间)，这个过程中用户进程同样是阻塞的，直到数&gt;据拷贝完成才恢复。所以，阻塞IO在两个阶段都是阻塞的
   - 非阻塞IO和阻塞IO相似，区别在于第一阶段，在等待数据准备就绪的过程中，用户进程不会阻塞，而是在数据没有准备就绪的时候得到一个error返回，这是用户进程就知道数据还没有准备好，然后就可以继续发
起recvfrom操作直到数据准备就绪在第二阶段，数据从内核空间向用户空间拷贝时，非阻塞IO用户进程同样是阻塞的
   - IO多路复用实际上是通过select/epoll等函数轮询多个socket，当用户进程调用了select函数，整个用户进程就会被阻塞，直到收到数据准备就绪的返回后续的操作和非阻塞IO是类似的，由于在recvfrom系统调&gt;用之前，需要的数据就已经准备就绪了，所以第一个阶段是非阻塞的；第二个阶段同样还是阻塞的所以IO多路复用整个过程中，用户进程都是阻塞的
   - 异步IO实际上是用户进程发起read操作之后，就会立刻收到一个返回，所以用户进程就可以去完成其他的工作，而不需要阻塞；直到数据准备就绪并且完成了从内核空间向用户空间拷贝的工作，这时用户进程会&gt;收到一个通知，告诉他read操作已完成整个过程中用户进程不会被阻塞


- Blocking IO
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    app recvfrom--- syscall---&gt;       kernel (no data ready)</span><br><span class="line">  ------|                                 |------</span><br><span class="line">  |     |                                 |     |</span><br><span class="line">  |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">  |     |                                 |     |</span><br><span class="line">block <span class="keyword">in</span>|call to recvfrom                 |------</span><br><span class="line">  |     |                              datagram ready</span><br><span class="line">  |     |                              copy datagram</span><br><span class="line">  |     |                                 |-----</span><br><span class="line">  |     |                                 |    |</span><br><span class="line">  |     |                                 |  copy data from kernel to user</span><br><span class="line">  |     |                                 |    |</span><br><span class="line">  |     |                                 |-----</span><br><span class="line">  ------|                                 v</span><br><span class="line">    process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure>

- non-blocking IO
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)</span><br><span class="line">   ------|                                 |-----------------------</span><br><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)     |</span><br><span class="line">   |     |                                 |                  <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)     |</span><br><span class="line">process repeatedly call recvfrom,          |-----------------------</span><br><span class="line">waiting <span class="keyword">for</span> ok, <span class="built_in">return</span>(polling)            |     |</span><br><span class="line">   |     |                              datagram ready</span><br><span class="line">   |     |                              copy datagram</span><br><span class="line">   |     |                                 |-----</span><br><span class="line">   |     |                                 |    |</span><br><span class="line">   |     |                                 |  copy data from kernel to user</span><br><span class="line">   |     |                                 |    |</span><br><span class="line">   |     |                                 |-----</span><br><span class="line">   ------|                                 v</span><br><span class="line">     process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure>

- IO multiplexing
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                        app select --- syscall---&gt;       kernel (no data ready)</span><br><span class="line">                      ------|                                 |------</span><br><span class="line">                      |     |                                 |     |</span><br><span class="line">                      |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">                      |     |                                 |     |</span><br><span class="line">        process block <span class="keyword">in</span> call to select                       |     |</span><br><span class="line"><span class="built_in">wait</span> <span class="keyword">for</span> one of possible many sockets to become readable      |------</span><br><span class="line">                      ------|     &lt;---<span class="built_in">return</span> readable     datagram ready</span><br><span class="line">                      recvfrom    system call---&gt;         copy datagram</span><br><span class="line">                      ------|                                 |-----</span><br><span class="line">                      |     |                                 |    |</span><br><span class="line"> process block <span class="keyword">while</span> data copied to the user buff             |  copy data from kernel to user</span><br><span class="line">                      |     |                                 |    |</span><br><span class="line">                      |     |                                 |-----</span><br><span class="line">                      ------|                                 v</span><br><span class="line">                        process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure>

- signal driven IO
- asynchronous IO
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                 app aio_read ---syscall---&gt;       kernel (no data ready)</span><br><span class="line">               ------|         &lt;---<span class="built_in">return</span>---           |------</span><br><span class="line">               |     |                                 |     |</span><br><span class="line">               |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">               |     |                                 |     |</span><br><span class="line">         process <span class="built_in">continue</span> excuting                     |------</span><br><span class="line">               |     |                              datagram ready</span><br><span class="line">               |     |                              copy datagram</span><br><span class="line">               |     |                                 |-----</span><br><span class="line">               |     |                                 |    |</span><br><span class="line">               |     |                                 |  copy data from kernel to user</span><br><span class="line">               |     |                                 |    |</span><br><span class="line">               |     |                                 |-----</span><br><span class="line">               ------|                                 v</span><br><span class="line">sinalal handler process datagram &lt;---deliver sinal--- copy complete</span><br><span class="line">                                 specified aio_read</span><br></pre></td></tr></table></figure>

- select 3个问题
  - 被监控的fds集合限制为1024，1024太小了，我们希望能够有个比较大的可监控fds集合(poll, epoll)
  - fds集合需要从用户空间拷贝到内核空间的问题，我们希望不需要拷贝(epoll)
  - 当被监控的fds中某些有数据可读的时候，我们希望通知更加精细一点，就是我们希望能够从通知中得到有可读事件的fds列表，而不是需要遍历整个fds来收集。(epoll)
- epoll
  - 功能分离，select中维护等待队列(socket列表)和阻塞进程两个步骤结合在一起了，对于频繁调用select的进程来说，socket列表变化的可能性很小，基本固定，并不需要每次都修改。EPoll将两个操作分开。
  - 维护就绪列表，select低效的另一个原因在于程序不知道哪些socket收到数据，只能一个个遍历。如果内核维护一个“就绪列表”，引用收到数据的 socket，就能避免遍历。
- 可以看到epoll高效原因，主要是维护了两个队列，一个是监视队列，一个是就绪队列。监视队列解决了select中fds频繁拷贝的问题，就绪队列解决了select中需要遍历列表才能知道哪个socket接收到数据的问题


#### tmp file clean
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /usr/lib/tmpfiles.d/tmp.conf</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See tmpfiles.d(5) for details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clear tmp directories separately, to make them easier to override</span></span><br><span class="line">D /tmp 1777 root root -</span><br><span class="line"><span class="comment">#q /var/tmp 1777 root root 30d</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

#### dkms
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dkms remove -m lustre-zfs -v 2.12.8_6_g5457c37 --all --rpm_safe_upgrade</span><br></pre></td></tr></table></figure>

#### glibc
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in glibc-x.xx/build/</span></span><br><span class="line">CC=<span class="string">&quot;gcc&quot;</span> CXX=<span class="string">&quot;g++&quot;</span> \</span><br><span class="line">    CFLAGS=<span class="string">&quot;-g -g3 -ggdb -gdwarf-4 -Og -Wno-error -fno-stack-protector&quot;</span> \</span><br><span class="line">    CXXFLAGS=<span class="string">&quot;-g -g3 -ggdb -gdwarf-4 -Og -Wno-error -fno-stack-protector&quot;</span> \</span><br><span class="line">    ../configure --prefix=/path/to/install/glibc/x64 --disable-werror</span><br><span class="line"></span><br><span class="line">make -j 8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

#### setfacl
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#remove single</span></span><br><span class="line">$ setfacl -d user:george ch4.doc</span><br><span class="line"></span><br><span class="line"><span class="comment">#remove all</span></span><br><span class="line">$ setfacl -b file</span><br></pre></td></tr></table></figure>

#### [vmlinux.h and ebpf](https://blog.aquasec.com/vmlinux.h-ebpf-programs)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bpftool btf dump file /sys/kernel/btf/vmlinux format c &gt; vmlinux.h</span><br></pre></td></tr></table></figure>

#### sysctl -p not work for /etc/sysctl.d
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl --system</span><br></pre></td></tr></table></figure>

#### cgroup
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/kernel/sched_autogroup_enabled</span><br><span class="line">/proc/PID/autogroup</span><br><span class="line"></span><br><span class="line">/sys/fs/cgroup/memory/memory.stat</span><br><span class="line">systemd-run -p MemoryMax=512M --scope pacman -Syu</span><br><span class="line">systemd-run -p MemoryMax=256M --scope ./backup-my-system</span><br><span class="line"></span><br><span class="line">systemd-run --user --slice=limit-mem.slice --shell</span><br><span class="line"></span><br><span class="line">$ cat ~/.config/systemd/user/limit-mem.slice</span><br><span class="line">[Slice]</span><br><span class="line">MemoryHigh=3G</span><br><span class="line">MemoryMax=4G</span><br><span class="line">MemorySwapMax=2G</span><br><span class="line"></span><br><span class="line">systemd.unified_cgroup_hierarchy=1</span><br><span class="line"># systemctl edit user@1000.service</span><br><span class="line">[Service]</span><br><span class="line">Delegate=yes</span><br><span class="line"></span><br><span class="line">memory.min</span><br><span class="line">memory.low</span><br><span class="line">memory.high</span><br><span class="line">memory.max</span><br><span class="line">memory.swap.high</span><br><span class="line">memory.swap.max</span><br></pre></td></tr></table></figure>

#### kvm
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ qemu-img create -f qcow2 windows-master.qcow2 10G</span><br><span class="line">$ qemu-img convert -f raw -O qcow2 $INPUT_FILE $OUTPUT_FILE</span><br><span class="line">                                 ---source file</span><br><span class="line">                                 |</span><br><span class="line">$ qemu-img create -b windows-master.qcow2 -f qcow2 windows-clone.qcow2</span><br><span class="line">                                                               |</span><br><span class="line">                                                               ---increment file</span><br></pre></td></tr></table></figure>

##### [PCIE pass through](https://bean-li.github.io/KVM-installation-in-RHEL7/)
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 iommu=pt pci-stub.ids=1000:0097&#x27;</span></span><br><span class="line">or</span><br><span class="line">$ vim /lib/modprobe.d/pci-stub.conf</span><br><span class="line">options pci-stub ids=10de:1381,10de:0fbc</span><br><span class="line">softdep drm pre: pci-stub</span><br><span class="line">$ update-initramfs -u</span><br><span class="line"></span><br><span class="line">$ lspci | grep LSI</span><br><span class="line">02:00.0 RAID bus controller: Broadcom / LSI MegaRAID SAS-3 3108 [Invader] (rev 02)</span><br><span class="line">82:00.0 Serial Attached SCSI controller: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 (rev 02)</span><br><span class="line"></span><br><span class="line">$ lspci -vvvnn -s 82:00.0</span><br><span class="line">82:00.0 Serial Attached SCSI controller [0107]: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 [1000:0097] (rev 02)</span><br><span class="line">                                                                                                        |</span><br><span class="line">                                                                                                        V</span><br><span class="line">                                                                                             pci-stub.ids=1000:0097</span><br><span class="line"></span><br><span class="line">$ virsh nodedev-list  |grep pci_0000_82</span><br><span class="line">pci_0000_82_00_0</span><br><span class="line"></span><br><span class="line"><span class="comment">#parent</span></span><br><span class="line">$ virsh nodedev-list  |grep pci_0000_80_03_0</span><br><span class="line">pci_0000_80_03_0</span><br></pre></td></tr></table></figure>

Add to xml file, if wrong, the virt-manager will genarate the xml codes.
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">device</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>pci_0000_82_0_0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span>&gt;</span>/sys/devices/pci0000:80/0000:80:03.0/0000:82:00.0<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span>pci_0000_80_03_0<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mpt3sas<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">capability</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain</span>&gt;</span>0<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bus</span>&gt;</span>82<span class="tag">&lt;/<span class="name">bus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>0<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function</span>&gt;</span>0<span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product</span> <span class="attr">id</span>=<span class="string">&#x27;0x0097&#x27;</span>&gt;</span>Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3<span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vendor</span> <span class="attr">id</span>=<span class="string">&#x27;0x1000&#x27;</span>&gt;</span>Serial Attached SCSI controller<span class="tag">&lt;/<span class="name">vendor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">numa</span> <span class="attr">node</span>=<span class="string">&#x27;0&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">capability</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">device</span>&gt;</span></span><br></pre></td></tr></table></figure>
the iommu=pt could avoid some of kernel driver bugs
[tg3 driver](https://access.redhat.com/solutions/4393391) A bug has been identified in the tg3 driver, it is likely a race/timing issue with the system kexec-ing, and the IOMMU still being used by a device for active DMA.
[latest Nvidia drivers cause system freeze on exit of Chromium](https://github.com/void-linux/void-packages/issues/32241)
  
##### [bind dev](https://gist.github.com/kaapstorm/4e51ff5f500eb7e93820d2e630dfdbbc)
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /usr/local/bin/vfio-bind</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">modprobe vfio-pci</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dev <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    vendor=$(<span class="built_in">cat</span> /sys/bus/pci/devices/<span class="variable">$dev</span>/vendor)</span><br><span class="line">    device=$(<span class="built_in">cat</span> /sys/bus/pci/devices/<span class="variable">$dev</span>/device)</span><br><span class="line">    <span class="keyword">if</span> [ -e /sys/bus/pci/devices/<span class="variable">$dev</span>/driver ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$dev</span> &gt; /sys/bus/pci/devices/<span class="variable">$dev</span>/driver/unbind</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$vendor</span> <span class="variable">$device</span> &gt; /sys/bus/pci/drivers/vfio-pci/new_id</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ lspci -nnk</span><br><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM107 [GeForce GTX 750] [10de:1381] (rev a2)</span><br><span class="line">    Subsystem: Gigabyte Technology Co., Ltd GM107 [GeForce GTX 750] [1458:362e]</span><br><span class="line">    Kernel driver <span class="keyword">in</span> use: nvidia</span><br><span class="line">    Kernel modules: nvidiafb, nouveau, nvidia_384_drm, nvidia_384</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation Device [10de:0fbc] (rev a1)</span><br><span class="line">    Subsystem: Gigabyte Technology Co., Ltd Device [1458:362e]</span><br><span class="line">    Kernel driver <span class="keyword">in</span> use: snd_hda_intel</span><br><span class="line">    Kernel modules: snd_hda_intel</span><br><span class="line">$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/vfio-bind</span><br><span class="line"></span><br><span class="line">vfio-bind 0000:01:00.0 0000:01:00.1</span><br></pre></td></tr></table></figure>

why iommu=pt (pass through)  
for linux kenrel driver module  
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">qemu -device pci-assign,host=01:00.0</span><br><span class="line">kvm_iommu_map_pages</span><br><span class="line">  └─iommu_map</span><br><span class="line">      └─intel_iommu_map(domain-&gt;ops-&gt;map)</span><br><span class="line">          └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line">qemu -device vfio-pci,host=b1:00.0</span><br><span class="line">vfio_iommu_type1_ioctl</span><br><span class="line">  └─vfio_dma_do_map</span><br><span class="line">      └─vfio_pin_map_dma</span><br><span class="line">          └─vfio_iommu_map</span><br><span class="line">              └─iommu_map</span><br><span class="line">                  └─intel_iommu_map(domain-&gt;ops-&gt;map)</span><br><span class="line">                     └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line">i40e</span><br><span class="line">i40e_alloc_mapped_page</span><br><span class="line">  └─dma_map_page &lt;--------------In the i40e driver</span><br><span class="line">      └─intel_map_page</span><br><span class="line">          └─__intel_map_single</span><br><span class="line">              ├─<span class="keyword">if</span>(iommu_no_mapping) <span class="built_in">return</span> paddr;</span><br><span class="line">              ├─intel_alloc_iova</span><br><span class="line">              └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line"><span class="comment">#iommu=pt means the iommu_no_mapping=1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> hw_pass_through==0</span><br><span class="line">   hardware identity mapping</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   software identity mapping</span><br><span class="line"></span><br><span class="line">那是不是如果配置了intel_iommu=on，内核驱动都会被影响（不仅仅是i40e），不能直接使用paddr，而是需要走intel_alloc_iova，domain_pfn_mapping</span><br><span class="line"><span class="comment">#iommu=pt并不会影响kvm/dpdk/spdk的性能，这三者本质上都是用户态驱动，iommu=pt只会影响内核驱动，能让内核驱动设备性能更高。</span></span><br><span class="line">https://zhuanlan.zhihu.com/p/365408539</span><br><span class="line"></span><br><span class="line">kvm一定要用intel_iommu=on，DPDK/SPDK如果绑定vfio-pci那也一定要求intel_iommu=on，如果绑定uio/igb_uio那么就不需要intel_iommu=on，推荐都用vfio-pci，后面kvm中的pci-assign，DPDK/SPDK用到的igb_uio都得淘汰。</span><br><span class="line">还有一个内核参数是nointremap，iommu实现了dma remapping和intr remaping，kvm二者都要用，但DPDK/SPDK用轮询模式，可以不用int remapping功能，那nointremap就派上用场了(Do not <span class="built_in">enable</span> interrupt remapping)</span><br></pre></td></tr></table></figure>
  
remove   
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virsh nodedev-detach pci_0000_82_00_0</span><br></pre></td></tr></table></figure>

#### env setting
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">env</span> SYSTEMD_LOG_LEVEL=debug systemd-tmpfiles --clean</span><br><span class="line">CPLUS_INCLUDE_PATH/C_INCLUDE_PATH: include</span><br><span class="line">LD_LIBRARY_PATH: lib</span><br></pre></td></tr></table></figure>

#### compile process
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gcc -E -I ../include  test.c -o test.i</span><br><span class="line"><span class="comment">#Stop after the preprocessing stage; do not run the compiler proper.  The output is in the form of preprocessed source code, which is sent to the standard output</span></span><br><span class="line"></span><br><span class="line">gcc -S -I ../include  test.i -o test.s</span><br><span class="line"><span class="comment">#Stop after the stage of compilation proper; do not assemble.  The output is in the form of an assembler code file for each non-assembler input file specified</span></span><br><span class="line"></span><br><span class="line">gcc -c test.s -o test.o <span class="comment"># show info by objdump/readelf</span></span><br><span class="line"><span class="comment">#Compile or assemble the source files, but do not link.  The linking stage simply is not done.</span></span><br><span class="line"></span><br><span class="line">gcc -Wall -W -O2 -o <span class="built_in">test</span> test.o  ../lib/test.so -Wl,-rpath -Wl,../test/lib -Wl,-rpath -Wl,/usr/local/lib -I ../include</span><br><span class="line"><span class="comment">#link so</span></span><br></pre></td></tr></table></figure>



</code></pre>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Debain-x2F-ubuntu"><span class="toc-number">1.</span> <span class="toc-text">Debain&#x2F;ubuntu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RHEL"><span class="toc-number">2.</span> <span class="toc-text">RHEL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#let-selinux-to-permissive-mode"><span class="toc-number">2.1.</span> <span class="toc-text">let selinux to permissive mode</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#audit"><span class="toc-number">3.</span> <span class="toc-text">audit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync-debug"><span class="toc-number">3.1.</span> <span class="toc-text">rsync debug</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#chrome-enable-dns-over-https"><span class="toc-number">3.2.</span> <span class="toc-text">chrome enable dns over https</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#traceroute"><span class="toc-number">3.3.</span> <span class="toc-text">traceroute</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#export-tcmalloc"><span class="toc-number">3.4.</span> <span class="toc-text">export tcmalloc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vi-paste-not-auto-inherit-the-file-type"><span class="toc-number">3.5.</span> <span class="toc-text">vi paste not auto inherit the file type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sudo"><span class="toc-number">3.6.</span> <span class="toc-text">sudo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#printk-messages"><span class="toc-number">3.7.</span> <span class="toc-text">printk messages</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#centos-7-7-not-report-kenrel-symbols"><span class="toc-number">3.8.</span> <span class="toc-text">centos 7.7 not report kenrel symbols</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kill-sockets"><span class="toc-number">3.9.</span> <span class="toc-text">kill sockets</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-by-xz"><span class="toc-number">4.</span> <span class="toc-text">compress by xz</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#systemd-limit"><span class="toc-number">4.1.</span> <span class="toc-text">systemd limit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#custom-rc-local"><span class="toc-number">4.2.</span> <span class="toc-text">custom rc-local</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pipe-fifo"><span class="toc-number">4.3.</span> <span class="toc-text">pipe, fifo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">4.4.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Nofile"><span class="toc-number">4.5.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pidstat"><span class="toc-number">4.6.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rand-file"><span class="toc-number">4.7.</span> <span class="toc-text">rand file</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#samba"><span class="toc-number">4.8.</span> <span class="toc-text">samba</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#update-kernel-moduels-in-x2F-lib-x2F-moduels-x2F-uname-r"><span class="toc-number">4.9.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#filter-syslog"><span class="toc-number">4.10.</span> <span class="toc-text">filter syslog</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-permission"><span class="toc-number">5.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#taskset"><span class="toc-number">6.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh"><span class="toc-number">7.</span> <span class="toc-text">ssh</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ssh-key-not-work"><span class="toc-number">7.1.</span> <span class="toc-text">ssh key not work</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ssh-config-allow-users"><span class="toc-number">7.2.</span> <span class="toc-text">ssh config allow users</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strace"><span class="toc-number">8.</span> <span class="toc-text">strace</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calculated-CPU-usage"><span class="toc-number"></span> <span class="toc-text">Calculated CPU usage</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">1.</span> <span class="toc-text">ps</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#others"><span class="toc-number">1.1.</span> <span class="toc-text">others</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xattr"><span class="toc-number"></span> <span class="toc-text">xattr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tc"><span class="toc-number">1.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-VNC"><span class="toc-number">2.</span> <span class="toc-text">CentOS VNC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#screen"><span class="toc-number">3.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VLC"><span class="toc-number">4.</span> <span class="toc-text">VLC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Not-show-media-title"><span class="toc-number">4.1.</span> <span class="toc-text">Not show media title</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Not-resize-interface"><span class="toc-number">4.2.</span> <span class="toc-text">Not resize interface</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#record-stream-by-vlc-and-front-camera"><span class="toc-number">4.3.</span> <span class="toc-text">record stream by vlc and front camera</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grub"><span class="toc-number">5.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-systemd-journal-not-in-the-x2F-run-x2F-log"><span class="toc-number">6.</span> <span class="toc-text">set systemd journal not in the &#x2F;run&#x2F;log</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump"><span class="toc-number"></span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number"></span> <span class="toc-text">MTU problem check</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#yum"><span class="toc-number">1.</span> <span class="toc-text">yum</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Exclude-packages"><span class="toc-number">1.1.</span> <span class="toc-text">Exclude packages</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Switch-version"><span class="toc-number">1.2.</span> <span class="toc-text">Switch version</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Yum-conf"><span class="toc-number">1.3.</span> <span class="toc-text">Yum.conf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Download-to-local"><span class="toc-number">1.4.</span> <span class="toc-text">Download to local</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Resolve-dependency-resolution-errors"><span class="toc-number">1.5.</span> <span class="toc-text">Resolve dependency resolution errors</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Uninstall-rpm-packages-from-rpmdb"><span class="toc-number">1.6.</span> <span class="toc-text">Uninstall rpm packages from rpmdb</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">2.</span> <span class="toc-text">upgrade kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#patch-kernel"><span class="toc-number">2.1.</span> <span class="toc-text">patch kernel</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gen-the-patch-if-you-modify-the-kernel-source"><span class="toc-number">2.2.</span> <span class="toc-text">gen the patch, if you modify the kernel source</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#compile-linux-kernel-failed"><span class="toc-number">2.3.</span> <span class="toc-text">compile linux kernel ( failed )</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-BBR"><span class="toc-number">3.</span> <span class="toc-text">Enable BBR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">4.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LVM-partition"><span class="toc-number">4.1.</span> <span class="toc-text">LVM partition</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Test-in-ubuntu"><span class="toc-number">4.2.</span> <span class="toc-text">Test in ubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Test-in-CentOS-7-set-boot-menu"><span class="toc-number">4.3.</span> <span class="toc-text">Test in CentOS 7, set boot menu</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Re-install-EFI"><span class="toc-number">5.</span> <span class="toc-text">Re-install EFI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">6.</span> <span class="toc-text">rdesktop to win10</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Enable-remote-desktop"><span class="toc-number">6.1.</span> <span class="toc-text">Enable remote desktop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Modify-registry-from-win10"><span class="toc-number">6.2.</span> <span class="toc-text">Modify registry from win10</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">7.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">8.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lshw"><span class="toc-number">9.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmcli"><span class="toc-number">10.</span> <span class="toc-text">nmcli</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bonding"><span class="toc-number">10.1.</span> <span class="toc-text">bonding</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Permission"><span class="toc-number">11.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route-config"><span class="toc-number">12.</span> <span class="toc-text">static route config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Check-the-Linux-NIC-kernel-driver-err"><span class="toc-number">13.</span> <span class="toc-text">Check the Linux NIC kernel driver err</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collectl"><span class="toc-number">14.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time"><span class="toc-number">15.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#youtube-download"><span class="toc-number">16.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">17.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sshfs"><span class="toc-number">18.</span> <span class="toc-text">sshfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scan-file-size"><span class="toc-number">19.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kernel-issue"><span class="toc-number">20.</span> <span class="toc-text">kernel issue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slowpath-and-fastpath"><span class="toc-number">21.</span> <span class="toc-text">slowpath and fastpath</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">22.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">23.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-ELF-Executable-and-Linking-Format"><span class="toc-number">24.</span> <span class="toc-text">Read ELF(Executable and Linking Format)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">25.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">26.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">27.</span> <span class="toc-text">size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">28.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">29.</span> <span class="toc-text">gpart recovery partition table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ffmpeg"><span class="toc-number">30.</span> <span class="toc-text">ffmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iptables"><span class="toc-number">31.</span> <span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fail2ban"><span class="toc-number">32.</span> <span class="toc-text">fail2ban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof"><span class="toc-number">33.</span> <span class="toc-text">lsof</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Process-accounting-on-Linux"><span class="toc-number">34.</span> <span class="toc-text">Process accounting on Linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git-token"><span class="toc-number">35.</span> <span class="toc-text">git token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tuned-adm"><span class="toc-number">36.</span> <span class="toc-text">tuned-adm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tick"><span class="toc-number">37.</span> <span class="toc-text">Tick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blacklist-kernel-module"><span class="toc-number">38.</span> <span class="toc-text">blacklist kernel module</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iftop"><span class="toc-number">39.</span> <span class="toc-text">iftop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shadowsocks"><span class="toc-number">40.</span> <span class="toc-text">shadowsocks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#use-proxychains"><span class="toc-number">41.</span> <span class="toc-text">use proxychains</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMI"><span class="toc-number">42.</span> <span class="toc-text">NMI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dmidecode"><span class="toc-number">43.</span> <span class="toc-text">dmidecode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><span class="toc-number">44.</span> <span class="toc-text">How to got the info from the pipe fd and socke fd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#process-schdule"><span class="toc-number">45.</span> <span class="toc-text">process schdule</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Process-schdule"><span class="toc-number">45.1.</span> <span class="toc-text">Process schdule</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/15/operating-system/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/15/operating-system/&text=operating system"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/15/operating-system/&is_video=false&description=operating system"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=operating system&body=Check out this article: http://example.com/2022/11/15/operating-system/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/15/operating-system/&title=operating system"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/15/operating-system/&name=operating system&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/15/operating-system/&t=operating system"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
