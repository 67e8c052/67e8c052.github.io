<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="steam12-tcp 快捷方式加-tcp则可以启动  background ctrl + z and continue1234567^Z[1]+  Stopped                 find &#x2F;usr -name ubuntu@ip-10-170-59-120:~$ jobs[1]+  Stopped                 find &#x2F;usr -name &quot;*.">
<meta property="og:type" content="article">
<meta property="og:title" content="OS">
<meta property="og:url" content="http://example.com/2022/11/14/os/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="steam12-tcp 快捷方式加-tcp则可以启动  background ctrl + z and continue1234567^Z[1]+  Stopped                 find &#x2F;usr -name ubuntu@ip-10-170-59-120:~$ jobs[1]+  Stopped                 find &#x2F;usr -name &quot;*.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/vlc-set1.png">
<meta property="og:image" content="http://example.com/img/e_desktop.png">
<meta property="og:image" content="http://example.com/img/e_firewall.png">
<meta property="article:published_time" content="2022-11-14T06:48:35.000Z">
<meta property="article:modified_time" content="2025-05-30T03:49:29.843Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="os">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/vlc-set1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>OS</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/11/14/lsi/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/14/perf/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/14/os/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/14/os/&text=OS"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/14/os/&is_video=false&description=OS"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OS&body=Check out this article: http://example.com/2022/11/14/os/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/14/os/&name=OS&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/14/os/&t=OS"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#steam"><span class="toc-number">1.</span> <span class="toc-text">steam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#background-ctrl-z-and-continue"><span class="toc-number">2.</span> <span class="toc-text">background ctrl + z and continue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Are-you-kid-me-node-exporter"><span class="toc-number">3.</span> <span class="toc-text">Are you kid me, node_exporter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#el8-single-mode"><span class="toc-number">4.</span> <span class="toc-text">el8 single mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#caculate-the-oom-score-adj"><span class="toc-number">5.</span> <span class="toc-text">caculate the oom_score_adj</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umask-and-acl"><span class="toc-number">6.</span> <span class="toc-text">[umask and acl]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-disable-kcompactd-systemwide-permanently-forever"><span class="toc-number">7.</span> <span class="toc-text">How to disable kcompactd systemwide, permanently, forever</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#output-kernel-msg"><span class="toc-number">8.</span> <span class="toc-text">output kernel msg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cp-with-acl"><span class="toc-number">9.</span> <span class="toc-text">cp with acl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#remove-pci-dev"><span class="toc-number">10.</span> <span class="toc-text">remove pci dev</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debain-ubuntu"><span class="toc-number">11.</span> <span class="toc-text">Debain&#x2F;ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#distros"><span class="toc-number">11.1.</span> <span class="toc-text">distros</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#install-perf"><span class="toc-number">11.1.1.</span> <span class="toc-text">install perf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lenovo-enable-ipmi-over-lan-in-command-line"><span class="toc-number">11.1.2.</span> <span class="toc-text">lenovo enable ipmi over lan in command line</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Configure-Nemo-to-always-use-a-textual-input-for-the-location-bar"><span class="toc-number">11.1.3.</span> <span class="toc-text">Configure Nemo to always use a textual input for the location bar</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-todesk-new-ver-in-debian11"><span class="toc-number">12.</span> <span class="toc-text">upgrade todesk new ver in debian11</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#boot-options"><span class="toc-number">12.0.1.</span> <span class="toc-text">boot options</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#apt-proxy"><span class="toc-number">12.1.</span> <span class="toc-text">apt proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-repo"><span class="toc-number">12.2.</span> <span class="toc-text">ubuntu repo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-cloud-init"><span class="toc-number">12.2.1.</span> <span class="toc-text">disable cloud init</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-sleep"><span class="toc-number">12.2.2.</span> <span class="toc-text">disable sleep</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-screen-lock-and-screen-blackout"><span class="toc-number">12.3.</span> <span class="toc-text">disable screen lock and screen blackout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-GNOME"><span class="toc-number">12.4.</span> <span class="toc-text">ubuntu GNOME</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#clone-the-whole-linux-system-by-rsync"><span class="toc-number">12.4.1.</span> <span class="toc-text">clone the whole linux system by rsync</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-upgrade"><span class="toc-number">12.4.2.</span> <span class="toc-text">disable upgrade</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#list-all-version-not-installed"><span class="toc-number">12.4.3.</span> <span class="toc-text">list all version(not installed)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VLC"><span class="toc-number">12.5.</span> <span class="toc-text">VLC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Upgrade-pixel-6a"><span class="toc-number">12.6.</span> <span class="toc-text">Upgrade pixel 6a</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rotated-pdf-file"><span class="toc-number">12.7.</span> <span class="toc-text">rotated pdf file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-split"><span class="toc-number">12.8.</span> <span class="toc-text">vim split</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd"><span class="toc-number">12.9.</span> <span class="toc-text">systemd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rc-local"><span class="toc-number">12.10.</span> <span class="toc-text">rc.local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS"><span class="toc-number">12.11.</span> <span class="toc-text">DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Flush-DNS-cache"><span class="toc-number">12.11.1.</span> <span class="toc-text">Flush DNS cache</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-wifi"><span class="toc-number">12.12.</span> <span class="toc-text">ubuntu wifi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-fstrim-service"><span class="toc-number">12.13.</span> <span class="toc-text">disable fstrim service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debian-set-boot-order"><span class="toc-number">12.14.</span> <span class="toc-text">debian set boot order</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delpoy"><span class="toc-number">12.15.</span> <span class="toc-text">delpoy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sysstat-systemd"><span class="toc-number">12.15.1.</span> <span class="toc-text">sysstat systemd</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#wechat"><span class="toc-number">12.15.2.</span> <span class="toc-text">wechat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#install-newer-glibc-deb-packages-and-apt-source-not-update-cause-the-deps-issue"><span class="toc-number">12.15.3.</span> <span class="toc-text">install newer glibc deb packages and apt source not update cause the deps issue</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Almalinux-9-install-X-boot-failed"><span class="toc-number">12.16.</span> <span class="toc-text">Almalinux 9 install X boot failed</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setup-VNC"><span class="toc-number">12.17.</span> <span class="toc-text">setup VNC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-shutdown-slow"><span class="toc-number">12.18.</span> <span class="toc-text">ubuntu shutdown slow</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RHEL"><span class="toc-number">13.</span> <span class="toc-text">RHEL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#verify-packages"><span class="toc-number">13.1.</span> <span class="toc-text">verify-packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-almalinux-src-rpm"><span class="toc-number">13.2.</span> <span class="toc-text">Get almalinux src rpm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP-port-detect"><span class="toc-number">13.3.</span> <span class="toc-text">UDP port detect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Let-selinux-to-permissive-mode"><span class="toc-number">13.4.</span> <span class="toc-text">Let selinux to permissive mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Audit"><span class="toc-number">13.5.</span> <span class="toc-text">Audit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsync-debug"><span class="toc-number">13.6.</span> <span class="toc-text">rsync debug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chrome-enable-dns-over-https"><span class="toc-number">13.7.</span> <span class="toc-text">chrome enable dns over https</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#traceroute"><span class="toc-number">13.8.</span> <span class="toc-text">traceroute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapping-file-to-loop-dev"><span class="toc-number">13.9.</span> <span class="toc-text">mapping file to loop dev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#export-tcmalloc"><span class="toc-number">13.10.</span> <span class="toc-text">export tcmalloc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vi-paste-not-auto-inherit-the-file-type"><span class="toc-number">13.11.</span> <span class="toc-text">vi paste not auto inherit the file type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo"><span class="toc-number">13.12.</span> <span class="toc-text">sudo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NRPE-config"><span class="toc-number">13.12.1.</span> <span class="toc-text">NRPE config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#printk-messages"><span class="toc-number">13.13.</span> <span class="toc-text">printk messages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kill-sockets"><span class="toc-number">13.14.</span> <span class="toc-text">kill sockets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-by-xz"><span class="toc-number">13.15.</span> <span class="toc-text">compress by xz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-limit"><span class="toc-number">13.16.</span> <span class="toc-text">systemd limit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set-limit-by-systemd"><span class="toc-number">13.16.1.</span> <span class="toc-text">set limit by systemd</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#custom-rc-local"><span class="toc-number">13.17.</span> <span class="toc-text">custom rc-local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Starting-udev-Kernel-Device-Manager"><span class="toc-number">13.18.</span> <span class="toc-text">Starting udev Kernel Device Manager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pipe-fifo"><span class="toc-number">13.19.</span> <span class="toc-text">pipe, fifo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RHEL-tuning"><span class="toc-number">13.20.</span> <span class="toc-text">RHEL tuning</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#abrt-watch-log"><span class="toc-number">13.20.1.</span> <span class="toc-text">abrt-watch-log</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tuned-adm"><span class="toc-number">13.20.2.</span> <span class="toc-text">tuned-adm</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sync-time"><span class="toc-number">13.21.</span> <span class="toc-text">sync time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-7-upgrade-to-AlamLinux-8"><span class="toc-number">13.22.</span> <span class="toc-text">CentOS 7 upgrade to AlamLinux 8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">13.23.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nofile"><span class="toc-number">13.24.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#show-parent-pid"><span class="toc-number">13.25.</span> <span class="toc-text">show parent pid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pidstat"><span class="toc-number">13.26.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rand-file"><span class="toc-number">13.27.</span> <span class="toc-text">rand file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#samba"><span class="toc-number">14.</span> <span class="toc-text">samba</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Account"><span class="toc-number">14.1.</span> <span class="toc-text">Account</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">14.2.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update-kernel-moduels-in-lib-moduels-uname-r"><span class="toc-number">14.3.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter-syslog"><span class="toc-number">14.4.</span> <span class="toc-text">filter syslog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-permission"><span class="toc-number">14.5.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#taskset"><span class="toc-number">14.6.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-SSH"><span class="toc-number">14.7.</span> <span class="toc-text">ssh SSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strace"><span class="toc-number">14.8.</span> <span class="toc-text">strace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calulate-CPU-usage"><span class="toc-number">14.9.</span> <span class="toc-text">calulate CPU usage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">14.10.</span> <span class="toc-text">ps</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#others-process-tool"><span class="toc-number">14.10.1.</span> <span class="toc-text">others process tool</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xattr"><span class="toc-number">14.11.</span> <span class="toc-text">xattr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#extended-file-attributes"><span class="toc-number">14.12.</span> <span class="toc-text">extended file attributes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SUID-SGID-and-sticky-bit"><span class="toc-number">14.13.</span> <span class="toc-text">SUID, SGID, and sticky bit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tc"><span class="toc-number">14.14.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-VNC"><span class="toc-number">14.15.</span> <span class="toc-text">CentOS VNC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#KVM-guest-VNC-config"><span class="toc-number">14.15.1.</span> <span class="toc-text">KVM guest VNC config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#screen"><span class="toc-number">14.16.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grub"><span class="toc-number">14.17.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcpdump"><span class="toc-number">14.18.</span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number">14.19.</span> <span class="toc-text">MTU problem check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yum"><span class="toc-number">14.20.</span> <span class="toc-text">yum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">14.21.</span> <span class="toc-text">upgrade kernel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#install-crash-7-3-0"><span class="toc-number">14.22.</span> <span class="toc-text">install crash-7.3.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-BBR"><span class="toc-number">14.23.</span> <span class="toc-text">Enable BBR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">14.24.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#test-under-ubuntu"><span class="toc-number">14.24.1.</span> <span class="toc-text">test under ubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#test-under-centos-7"><span class="toc-number">14.24.2.</span> <span class="toc-text">test under centos 7</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">14.25.</span> <span class="toc-text">rdesktop to win10</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">14.26.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">14.27.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lshw"><span class="toc-number">14.28.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMCLI-nmcli"><span class="toc-number">14.29.</span> <span class="toc-text">NMCLI nmcli</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Permission"><span class="toc-number">14.30.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route-config"><span class="toc-number">14.31.</span> <span class="toc-text">static route config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collectl"><span class="toc-number">14.32.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time"><span class="toc-number">14.33.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#youtube-download"><span class="toc-number">14.34.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">14.35.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scan-file-size"><span class="toc-number">14.36.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kernel-issue"><span class="toc-number">14.37.</span> <span class="toc-text">kernel issue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slowpath-and-fastpath"><span class="toc-number">14.38.</span> <span class="toc-text">slowpath and fastpath</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">14.39.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">14.40.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">14.41.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">14.42.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compile-process"><span class="toc-number">14.43.</span> <span class="toc-text">compile process</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">14.44.</span> <span class="toc-text">size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">14.45.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">14.46.</span> <span class="toc-text">gpart recovery partition table</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#boot-by-freebsd-livecd"><span class="toc-number">14.46.1.</span> <span class="toc-text">boot by freebsd livecd</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">14.47.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ffmpeg"><span class="toc-number">14.48.</span> <span class="toc-text">ffmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iptables"><span class="toc-number">14.49.</span> <span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fail2ban"><span class="toc-number">14.50.</span> <span class="toc-text">fail2ban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof"><span class="toc-number">14.51.</span> <span class="toc-text">lsof</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Process-accounting-on-Linux"><span class="toc-number">14.52.</span> <span class="toc-text">Process accounting on Linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git"><span class="toc-number">14.53.</span> <span class="toc-text">git</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#git-single-branch"><span class="toc-number">14.53.1.</span> <span class="toc-text">git single branch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#token"><span class="toc-number">14.53.2.</span> <span class="toc-text">token</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tick"><span class="toc-number">14.54.</span> <span class="toc-text">Tick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dynticks"><span class="toc-number">14.55.</span> <span class="toc-text">Dynticks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cpu-partitioning-%E2%80%93-after-reboot"><span class="toc-number">14.56.</span> <span class="toc-text">Cpu-partitioning – after reboot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blacklist-kernel-module"><span class="toc-number">14.57.</span> <span class="toc-text">blacklist kernel module</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iftop"><span class="toc-number">14.58.</span> <span class="toc-text">iftop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMI"><span class="toc-number">14.59.</span> <span class="toc-text">NMI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dmidecode"><span class="toc-number">14.60.</span> <span class="toc-text">dmidecode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netstat-show-port"><span class="toc-number">14.61.</span> <span class="toc-text">netstat show port</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><span class="toc-number">14.62.</span> <span class="toc-text">How to got the info from the pipe fd and socke fd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#process-schdule"><span class="toc-number">14.63.</span> <span class="toc-text">process schdule</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-watchdog"><span class="toc-number">14.64.</span> <span class="toc-text">Linux watchdog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lockdep"><span class="toc-number">14.65.</span> <span class="toc-text">lockdep</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IO-Type"><span class="toc-number"></span> <span class="toc-text">IO Type</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-file-clean"><span class="toc-number">0.1.</span> <span class="toc-text">tmp file clean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dkms"><span class="toc-number">0.2.</span> <span class="toc-text">dkms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#glibc"><span class="toc-number">0.3.</span> <span class="toc-text">glibc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setfacl"><span class="toc-number">0.4.</span> <span class="toc-text">setfacl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vmlinux-h-and-ebpf"><span class="toc-number">0.5.</span> <span class="toc-text">vmlinux.h and ebpf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sysctl-p-not-work-for-etc-sysctl-d"><span class="toc-number">0.6.</span> <span class="toc-text">sysctl -p not work for &#x2F;etc&#x2F;sysctl.d</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rpm-spec"><span class="toc-number">0.7.</span> <span class="toc-text">rpm spec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setcap-set-file-capabilities"><span class="toc-number">0.8.</span> <span class="toc-text">setcap - set file capabilities</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#windows"><span class="toc-number">0.9.</span> <span class="toc-text">windows</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tasklist-hang-desktop-hang-when-start-another-program"><span class="toc-number">0.9.1.</span> <span class="toc-text">tasklist hang, desktop hang when start another program</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#auto-start-vmware-player"><span class="toc-number">0.9.2.</span> <span class="toc-text">auto start vmware player</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#terminal"><span class="toc-number">0.9.3.</span> <span class="toc-text">terminal</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aws-command"><span class="toc-number">0.10.</span> <span class="toc-text">aws command</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rclone"><span class="toc-number">0.11.</span> <span class="toc-text">rclone</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#interrput-the-tcp-link"><span class="toc-number">0.12.</span> <span class="toc-text">interrput the tcp link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash-history-env"><span class="toc-number">0.13.</span> <span class="toc-text">bash history env</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-file-by-inode"><span class="toc-number">0.14.</span> <span class="toc-text">delete file by inode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#got-the-node-ip-addr"><span class="toc-number">0.15.</span> <span class="toc-text">got the node ip addr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#route-info"><span class="toc-number">0.16.</span> <span class="toc-text">route info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#java-parameters"><span class="toc-number">0.17.</span> <span class="toc-text">java parameters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ISO"><span class="toc-number">0.18.</span> <span class="toc-text">ISO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#intel-boot-agent-message"><span class="toc-number">0.19.</span> <span class="toc-text">intel boot agent message</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Draw-kernel-boot-dmesg-image"><span class="toc-number">1.</span> <span class="toc-text">Draw kernel boot dmesg image</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Highcharts"><span class="toc-number">1.1.</span> <span class="toc-text">Highcharts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#google-slide"><span class="toc-number">1.2.</span> <span class="toc-text">google slide</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#centos-7-auto-login"><span class="toc-number">1.3.</span> <span class="toc-text">centos 7 auto login</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#restart-udev"><span class="toc-number">1.4.</span> <span class="toc-text">restart udev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Terminal-setting"><span class="toc-number">1.5.</span> <span class="toc-text">Terminal setting</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#overlayer-test"><span class="toc-number">1.6.</span> <span class="toc-text">overlayer test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsync-mirrors"><span class="toc-number">1.7.</span> <span class="toc-text">rsync mirrors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-proxy"><span class="toc-number">1.8.</span> <span class="toc-text">http proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get-the-driver-support-info"><span class="toc-number">1.9.</span> <span class="toc-text">get the driver support info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-USB-Attached-Storage-UAS"><span class="toc-number">1.10.</span> <span class="toc-text">disable USB Attached Storage UAS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup"><span class="toc-number">1.11.</span> <span class="toc-text">cgroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kvm-KVM"><span class="toc-number">1.12.</span> <span class="toc-text">kvm KVM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PCIE-pass-through"><span class="toc-number">1.12.1.</span> <span class="toc-text">PCIE pass through</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bind-dev"><span class="toc-number">1.12.2.</span> <span class="toc-text">bind dev</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Re-import-lvm-LVM"><span class="toc-number">2.</span> <span class="toc-text">Re-import lvm LVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hot-plugin-pci-device"><span class="toc-number">3.</span> <span class="toc-text">hot plugin pci device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-a-nspawn-container"><span class="toc-number">4.</span> <span class="toc-text">Creating a nspawn container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddrescue"><span class="toc-number">5.</span> <span class="toc-text">ddrescue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resume-breakpoint"><span class="toc-number">5.1.</span> <span class="toc-text">resume breakpoint</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KVM"><span class="toc-number">6.</span> <span class="toc-text">KVM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sanlock"><span class="toc-number">6.0.1.</span> <span class="toc-text">sanlock</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#clear-icetea-cache"><span class="toc-number">6.1.</span> <span class="toc-text">clear icetea cache</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OOM"><span class="toc-number">7.</span> <span class="toc-text">OOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#curl"><span class="toc-number">8.</span> <span class="toc-text">curl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fonts-fonts"><span class="toc-number">9.</span> <span class="toc-text">Fonts fonts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Argument-list-too-long"><span class="toc-number">10.</span> <span class="toc-text">Argument list too long</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-randomization-of-memory-addresses"><span class="toc-number">11.</span> <span class="toc-text">Disable randomization of memory addresses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-module-under-centos"><span class="toc-number">12.</span> <span class="toc-text">make module under centos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detect-port"><span class="toc-number">13.</span> <span class="toc-text">detect port</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dnf"><span class="toc-number">14.</span> <span class="toc-text">dnf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deploy-IBM-Spectrum-Scale-GPFS-client"><span class="toc-number">15.</span> <span class="toc-text">deploy IBM Spectrum Scale(GPFS) client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab"><span class="toc-number">16.</span> <span class="toc-text">gitlab</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#certificate-issue"><span class="toc-number">16.1.</span> <span class="toc-text">certificate issue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU"><span class="toc-number">17.</span> <span class="toc-text">GPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-1"><span class="toc-number">18.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-file"><span class="toc-number">19.</span> <span class="toc-text">copy file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM"><span class="toc-number">20.</span> <span class="toc-text">JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#APCI-power-status"><span class="toc-number">21.</span> <span class="toc-text">APCI power status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TIME-time"><span class="toc-number">22.</span> <span class="toc-text">TIME time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron"><span class="toc-number">23.</span> <span class="toc-text">cron</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#my-desktop"><span class="toc-number">24.</span> <span class="toc-text">my desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Google"><span class="toc-number">25.</span> <span class="toc-text">Google</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping-PING"><span class="toc-number">26.</span> <span class="toc-text">ping PING</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVM"><span class="toc-number">27.</span> <span class="toc-text">LVM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lvm-metadata-full"><span class="toc-number">27.1.</span> <span class="toc-text">lvm metadata full</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wipefs"><span class="toc-number">28.</span> <span class="toc-text">wipefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apache-httpda-list-dir-and-link"><span class="toc-number">29.</span> <span class="toc-text">apache httpda list dir and link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#centos-6-upgrade-to-almalinux-8"><span class="toc-number">30.</span> <span class="toc-text">centos 6 upgrade to almalinux 8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-el6-to-el7"><span class="toc-number">30.1.</span> <span class="toc-text">upgrade el6 to el7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-to-el8"><span class="toc-number">30.2.</span> <span class="toc-text">upgrade to el8</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Centos-7-upgrade-glibc-2-31-and-install-lustre-2-15-4-client"><span class="toc-number">31.</span> <span class="toc-text">Centos 7 upgrade glibc 2.31 and install lustre 2.15.4 client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#disable-acpi-power-meter"><span class="toc-number">32.</span> <span class="toc-text">disable acpi_power_meter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logs-flooded-with-systemd-messages-Created-slice-Starting-Session"><span class="toc-number">33.</span> <span class="toc-text">Logs flooded with systemd messages: Created slice, Starting Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crypt-the-file"><span class="toc-number">34.</span> <span class="toc-text">crypt the file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jq-JQ"><span class="toc-number">35.</span> <span class="toc-text">jq JQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-spec"><span class="toc-number">36.</span> <span class="toc-text">Hardware spec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PAM-unable-to-dlopen-lib64-security-pam-fprintd-so"><span class="toc-number">37.</span> <span class="toc-text">PAM unable to dlopen &#x2F;lib64&#x2F;security&#x2F;pam_fprintd.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARM"><span class="toc-number">38.</span> <span class="toc-text">ARM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labtop-power-management"><span class="toc-number">39.</span> <span class="toc-text">labtop power management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Does-the-NIC-of-the-KVM-guest-support-the-promisc-mode"><span class="toc-number">40.</span> <span class="toc-text">Does the NIC of the KVM guest support the promisc mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#google-auth"><span class="toc-number">41.</span> <span class="toc-text">google auth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HEXDUMP-hexdump"><span class="toc-number">42.</span> <span class="toc-text">HEXDUMP hexdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multipass-test"><span class="toc-number">43.</span> <span class="toc-text">multipass test</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-usb-uas-function"><span class="toc-number">43.1.</span> <span class="toc-text">disable usb uas function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsiget-kernel-info"><span class="toc-number">43.2.</span> <span class="toc-text">lsiget kernel info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IPA"><span class="toc-number">43.3.</span> <span class="toc-text">IPA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker"><span class="toc-number">43.4.</span> <span class="toc-text">docker</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfusion"><span class="toc-number">44.</span> <span class="toc-text">xfusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#osq-lock"><span class="toc-number">45.</span> <span class="toc-text">osq_lock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">46.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#we-don%E2%80%99t-want-tcp-nids"><span class="toc-number"></span> <span class="toc-text">we don’t want tcp nids</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gnuplot"><span class="toc-number">0.1.</span> <span class="toc-text">gnuplot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ollama-download-model"><span class="toc-number">0.2.</span> <span class="toc-text">ollama download model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API-send-image-to-AI-server"><span class="toc-number">0.3.</span> <span class="toc-text">API send image to AI server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VPS-ping"><span class="toc-number">0.4.</span> <span class="toc-text">VPS ping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2024-renew-redhat"><span class="toc-number">0.5.</span> <span class="toc-text">2024 renew redhat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reference1"><span class="toc-number">0.6.</span> <span class="toc-text">reference1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reference2"><span class="toc-number">0.7.</span> <span class="toc-text">reference2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#terminal-record-video"><span class="toc-number">0.8.</span> <span class="toc-text">terminal record video</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        OS
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-14T06:48:35.000Z" itemprop="datePublished">2022-11-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/OS/">OS</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/os/" rel="tag">os</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="steam"><a href="#steam" class="headerlink" title="steam"></a>steam</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-tcp </span><br><span class="line">快捷方式加-tcp则可以启动</span><br></pre></td></tr></table></figure>

<h3 id="background-ctrl-z-and-continue"><a href="#background-ctrl-z-and-continue" class="headerlink" title="background ctrl + z and continue"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/465829/pausing-a-long-running-program-in-the-terminal">background ctrl + z and continue</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">^Z</span><br><span class="line">[1]+  Stopped                 find /usr -name </span><br><span class="line"></span><br><span class="line">ubuntu@ip-10-170-59-120:~$ <span class="built_in">jobs</span></span><br><span class="line">[1]+  Stopped                 find /usr -name <span class="string">&quot;*.so&quot;</span></span><br><span class="line"></span><br><span class="line">ubuntu@ip-10-170-59-120:~$ <span class="built_in">fg</span> %1</span><br></pre></td></tr></table></figure>

<h3 id="Are-you-kid-me-node-exporter"><a href="#Are-you-kid-me-node-exporter" class="headerlink" title="Are you kid me, node_exporter"></a>Are you kid me, node_exporter</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Tasks: 2444 total,   2 running, 2442 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  3.7 us,  2.4 sy,  0.0 ni, 90.8 <span class="built_in">id</span>,  3.2 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem : 52787676+total, 18312043+free,  8715524 used, 33604080+buff/cache</span><br><span class="line">KiB Swap: 16777212 total, 15951776 free,   825436 used. 51390054+avail Mem </span><br><span class="line"></span><br><span class="line">   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                       </span><br><span class="line">229004 prometh+  20   0  823440  93460   4268 S  1442  0.0  14141:27 node_exporter                                                                                                                                 </span><br><span class="line">258341 bigdata+  20   0  167.8g   1.4g   8896 S  70.8  0.3 245:20.55 java                                                                                                                                          </span><br><span class="line"> 39953 root      20   0  174936   4876   1624 R  20.8  0.0   0:00.42 top                                                                                                                                           </span><br><span class="line">     9 root      20   0       0      0      0 S   4.2  0.0   1909:21 rcu_sched                                                                                                                                     </span><br><span class="line"> 31545 root      20   0       0      0      0 S   4.2  0.0   0:00.21 kworker/122:0                                                                                                                                 </span><br><span class="line">254216 root      20   0       0      0      0 S   4.2  0.0   0:01.14 kworker/138:1                                                                                                                                 </span><br><span class="line">     1 root      20   0  192084   3164   1572 S   0.0  0.0  97:17.60 systemd                                                                                                                                       </span><br><span class="line">     2 root      20   0       0      0      0 S   0.0  0.0  16:05.31 kthreadd    </span><br></pre></td></tr></table></figure>

<h3 id="el8-single-mode"><a href="#el8-single-mode" class="headerlink" title="el8 single mode"></a>el8 single mode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Reboot server, at grub screen press e to edit.</span><br><span class="line">Go to end of the linux line and add rd.break</span><br><span class="line">Do CTRL-X to boot.</span><br><span class="line">Do mount -o remount,rw /sysroot</span><br><span class="line">Do  <span class="built_in">chroot</span> /sysroot</span><br><span class="line">Do passwd root</span><br><span class="line">Do <span class="built_in">touch</span> /.autorelabel</span><br><span class="line">Do <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="caculate-the-oom-score-adj"><a href="#caculate-the-oom-score-adj" class="headerlink" title="caculate the oom_score_adj"></a>caculate the oom_score_adj</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mm/oom_kill.c</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">while</span> <span class="built_in">read</span> r pid <span class="built_in">comm</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  [ -f /proc/<span class="variable">$pid</span>/oom_score ] &amp;&amp; [ $(<span class="built_in">cat</span> /proc/<span class="variable">$pid</span>/oom_score) != 0 ] &amp;&amp; <span class="built_in">printf</span> <span class="string">&#x27;%d\t%d\t%d\t%s\n&#x27;</span> <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> <span class="string">&quot;<span class="subst">$(cat /proc/$pid/oom_score)</span>&quot;</span> <span class="string">&quot;<span class="subst">$(cat /proc/$pid/oom_sore_adj)</span>&quot;</span> <span class="string">&quot;<span class="variable">$comm</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; &lt;(ps -e -o pid= -o <span class="built_in">comm</span>=) | <span class="built_in">sort</span> -k -2nr</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -200 &gt; /proc/<span class="variable">$pid</span>/oom_score_adj</span><br></pre></td></tr></table></figure>


<h3 id="umask-and-acl"><a href="#umask-and-acl" class="headerlink" title="[umask and acl]"></a>[umask and acl]</h3><p>If ACL activate, umask will not working, just inherit from parent dir ? not make sure   </p>
<h3 id="How-to-disable-kcompactd-systemwide-permanently-forever"><a href="#How-to-disable-kcompactd-systemwide-permanently-forever" class="headerlink" title="How to disable kcompactd systemwide, permanently, forever"></a><a target="_blank" rel="noopener" href="https://www.reddit.com/r/Ubuntu/comments/rcgt6z/how_to_disable_kcompactd_systemwide_permanently/">How to disable kcompactd systemwide, permanently, forever</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fix problem where vmware battles with kcompactd0.</span></span><br><span class="line">vm.compaction_proactiveness=0</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/vm/compaction_proactiveness</span><br><span class="line">Echo 0&gt;/proc/sys/vm/compaction_proactives</span><br></pre></td></tr></table></figure>
<h3 id="output-kernel-msg"><a href="#output-kernel-msg" class="headerlink" title="output kernel msg"></a>output kernel msg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $(<span class="built_in">date</span> +%s) | <span class="built_in">tee</span> -a /proc/kmsg</span><br><span class="line">or some not working</span><br><span class="line"></span><br><span class="line"><span class="comment"># if tee not working</span></span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">date</span> +%s) &gt; /dev/kmsg</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;linux/module.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;linux/kernel.h&gt;</span></span><br><span class="line"></span><br><span class="line">int init_module(void)</span><br><span class="line">&#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void cleanup_module(void)</span><br><span class="line">&#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Goodbye world\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">https://serverfault.com/questions/140354/how-to-add-message-that-will-be-read-with-dmesg</span><br></pre></td></tr></table></figure>

<h3 id="cp-with-acl"><a href="#cp-with-acl" class="headerlink" title="cp with acl"></a>cp with acl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">       -p     same as --preserve=mode,ownership,timestamps</span><br><span class="line"></span><br><span class="line">       --preserve[=ATTR_LIST]</span><br><span class="line">              preserve the specified attributes (default: mode,ownership,timestamps), <span class="keyword">if</span> possible additional attributes: context, links, xattr, all</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -ap file1 file2 <span class="comment"># contains POSIX ACL</span></span><br></pre></td></tr></table></figure>

<h3 id="remove-pci-dev"><a href="#remove-pci-dev" class="headerlink" title="remove pci dev"></a>remove pci dev</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://unix.stackexchange.com/questions/702774/how-to-disable-pcie-device-at-boot</span></span><br><span class="line"><span class="built_in">cat</span> /etc/udev/rules.d/10-remove-nvidia-audio.rules </span><br><span class="line">ACTION==<span class="string">&quot;add&quot;</span>, KERNEL==<span class="string">&quot;0000:58:00.1&quot;</span>, SUBSYSTEM==<span class="string">&quot;pci&quot;</span>, RUN=<span class="string">&quot;/bin/sh -c &#x27;echo 1 &gt; /sys/bus/pci/devices/0000:58:00.1/remove&quot;</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/drivers/mpt3sas/0000:82:00.0/remove</span><br><span class="line"></span><br><span class="line"><span class="comment">#recovery</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/rescan</span><br><span class="line"></span><br><span class="line"><span class="comment">#set it from grub</span></span><br><span class="line"><span class="comment">#https://superuser.com/questions/914810/how-to-disable-a-plugged-in-pci-e-graphic-card-on-os-level</span></span><br><span class="line"></span><br><span class="line">$ lspci | grep LSI</span><br><span class="line">19:00.0 Serial Attached SCSI controller: Broadcom / LSI Fusion-MPT 12GSAS/PCIe Secure SAS38xx</span><br><span class="line"></span><br><span class="line">$ lspci -nnv -s 19:00.0</span><br><span class="line">82:00.0 Serial Attached SCSI controller [0107]: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 [1000:0097] (rev 02)</span><br><span class="line">	Subsystem: Broadcom / LSI SAS9300-8e [1000:30a0]</span><br><span class="line"></span><br><span class="line">$ grep PCI_ID /sys/bus/pci/devices/*/uevent | grep 19:00.0</span><br><span class="line">/sys/bus/pci/devices/0000:19:00.0/uevent:PCI_ID=1000:00E6</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;PCI_ID=%4x:%4x\n&quot;, &amp;vendor_id, &amp;device_id</span></span><br><span class="line">https://stackoverflow.com/questions/59010671/how-to-get-vendor-id-and-device-id-of-all-pci-devices</span><br><span class="line"></span><br><span class="line"><span class="comment">#in redhat doc</span></span><br><span class="line">Prevent the host machine driver from using the GPU device. You can use a vendor-id:device-id with the pci-stub driver. To <span class="keyword">do</span> this, append the pci-stub.ids option, with the vendor-id:device-id as its value, to the GRUB_CMDLINX_LINUX environment variable located <span class="keyword">in</span> the /etc/sysconfig/grub</span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;pci-stub.ids=&quot;</span>1000:00e6<span class="string">&quot;</span></span><br><span class="line"><span class="string">$ grubby --update-kernel=ALL --args=&quot;</span>pci-stub.ids=<span class="string">&quot;1000:00e6,10de:0e0a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#important worked</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;pci-stub.ids=1000:0097,8086:0953 log_buf_len=8M intel_iommu=on consoleblank=0 psi=1 iommu=pt audit=0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#not working &lt;--- test a lot of time</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;log_buf_len=8M intel_iommu=on consoleblank=0 psi=1 iommu=pt audit=0 pci-stub.ids=1000:0097,8086:0953&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Debain-ubuntu"><a href="#Debain-ubuntu" class="headerlink" title="Debain&#x2F;ubuntu"></a>Debain&#x2F;ubuntu</h3><h4 id="distros"><a href="#distros" class="headerlink" title="distros"></a>distros</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#not upgrade kernel</span><br><span class="line">$ apt-mark hold linux-generic</span><br><span class="line"></span><br><span class="line"># show system info, linux vers, linux distros, linux distributions</span><br><span class="line">$ neofetch</span><br></pre></td></tr></table></figure>
<p>take screenshot of selected Area in Ubuntu 20.04<br>shortcut key, shift + Print screen, notebook fn+shift+print screen  </p>
<h5 id="install-perf"><a href="#install-perf" class="headerlink" title="install perf"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/50145/how-to-install-perf-monitoring-tool">install perf</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install build-essential git flex bison</span><br><span class="line">$ git <span class="built_in">clone</span> --depth 1 https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</span><br><span class="line">$ <span class="built_in">cd</span> linux/tools/perf</span><br><span class="line">$ make</span><br><span class="line">$ <span class="built_in">cp</span> perf /usr/bin</span><br></pre></td></tr></table></figure>

<h5 id="lenovo-enable-ipmi-over-lan-in-command-line"><a href="#lenovo-enable-ipmi-over-lan-in-command-line" class="headerlink" title="lenovo enable ipmi over lan in command line"></a>lenovo enable ipmi over lan in command line</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1, SSH login XCC.</span><br><span class="line"></span><br><span class="line">2, Display port status, we can see ipmi port is off</span><br><span class="line"></span><br><span class="line">system&gt; portcontrol</span><br><span class="line">cim : on</span><br><span class="line">ipmi : off</span><br><span class="line">ipmi-kcs : on</span><br><span class="line">rest : on</span><br><span class="line">slp : on</span><br><span class="line">snmp : off</span><br><span class="line">ssdp : on</span><br><span class="line">cli : on</span><br><span class="line">web : on</span><br><span class="line">system&gt;</span><br><span class="line"></span><br><span class="line">3, Enable ipmi port</span><br><span class="line"></span><br><span class="line">system&gt; portcontrol -ipmi on</span><br><span class="line">ok</span><br><span class="line"></span><br><span class="line">4, Verify the port status again, ipmi port is on</span><br><span class="line"></span><br><span class="line">system&gt; portcontrol</span><br><span class="line">cim : on</span><br><span class="line">ipmi : on</span><br><span class="line">ipmi-kcs : on</span><br><span class="line">rest : on</span><br><span class="line">slp : on</span><br><span class="line">snmp : off</span><br><span class="line">ssdp : on</span><br><span class="line">cli : on</span><br><span class="line">web : on</span><br></pre></td></tr></table></figure>

<h5 id="Configure-Nemo-to-always-use-a-textual-input-for-the-location-bar"><a href="#Configure-Nemo-to-always-use-a-textual-input-for-the-location-bar" class="headerlink" title="Configure Nemo to always use a textual input for the location bar"></a><a target="_blank" rel="noopener" href="https://community.linuxmint.com/tutorial/view/1165">Configure Nemo to always use a textual input for the location bar</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dconf-editor</span><br><span class="line"></span><br><span class="line">org &gt; nemo &gt; preferences</span><br><span class="line"></span><br><span class="line"><span class="comment">#pip3 proxy</span></span><br><span class="line">$ pip3 install --proxy <span class="variable">$ip</span>:<span class="variable">$port</span>  -i https://mirrors.aliyun.com/pypi/simple regex</span><br></pre></td></tr></table></figure>

<h3 id="upgrade-todesk-new-ver-in-debian11"><a href="#upgrade-todesk-new-ver-in-debian11" class="headerlink" title="upgrade todesk new ver in debian11"></a>upgrade todesk new ver in debian11</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install libappindicator3-dev</span><br></pre></td></tr></table></figure>

<h5 id="boot-options"><a href="#boot-options" class="headerlink" title="boot options"></a>boot options</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ vi /boot/grub/grub.cfg</span><br><span class="line"><span class="comment">#delete the kernel, you don&#x27;t want to boot, and not exec update-grub</span></span><br><span class="line"><span class="comment">#worked &lt;-------------------------------------</span></span><br><span class="line"><span class="comment">#after edit, reboot right now</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#not working compare delete grub.cfg</span></span><br><span class="line">$ vi /etc/default/grub</span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line"></span><br><span class="line">$ grub-mkconfig | grep -iE <span class="string">&quot;menuentry &#x27;Ubuntu, with Linux&quot;</span> | awk <span class="string">&#x27;&#123;print i++ &quot; : &quot;$1, $2, $3, $4, $5, $6, $7&#125;&#x27;</span> </span><br><span class="line">Sourcing file `/etc/default/grub<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Sourcing file `/etc/default/grub.d/init-select.cfg&#x27;</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-5.15.0-89-generic</span><br><span class="line">Found initrd image: /boot/initrd.img-5.15.0-89-generic</span><br><span class="line">Found linux image: /boot/vmlinuz-5.15.0-25-generic</span><br><span class="line">Found initrd image: /boot/initrd.img-5.15.0-25-generic</span><br><span class="line">Warning: os-prober will not be executed to detect other bootable partitions.</span><br><span class="line">Systems on them will not be added to the GRUB boot configuration.</span><br><span class="line">Check GRUB_DISABLE_OS_PROBER documentation entry.</span><br><span class="line">Adding boot menu entry <span class="keyword">for</span> UEFI Firmware Settings ...</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">0 : menuentry <span class="string">&#x27;Ubuntu, with Linux 5.15.0-89-generic&#x27;</span> --class ubuntu</span><br><span class="line">1 : menuentry <span class="string">&#x27;Ubuntu, with Linux 5.15.0-89-generic (recovery mode)&#x27;</span></span><br><span class="line">2 : menuentry <span class="string">&#x27;Ubuntu, with Linux 5.15.0-25-generic&#x27;</span> --class ubuntu</span><br><span class="line">3 : menuentry <span class="string">&#x27;Ubuntu, with Linux 5.15.0-25-generic (recovery mode)&#x27;</span></span><br><span class="line"></span><br><span class="line">$ grub-set-default 2</span><br><span class="line">or</span><br><span class="line">$ grub-set-default <span class="string">&quot;Ubuntu, with Linux 5.15.0-25-generic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#one time , use &quot;grub-reboot&quot;</span></span><br><span class="line"></span><br><span class="line">$ update-grub</span><br></pre></td></tr></table></figure>
<h4 id="apt-proxy"><a href="#apt-proxy" class="headerlink" title="apt proxy"></a>apt proxy</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/apt/apt.conf.d/proxy.conf</span><br><span class="line">Acquire::http::Proxy <span class="string">&quot;http://username:password@proxy-server-ip:8181/&quot;</span>;</span><br><span class="line">Acquire::https::Proxy <span class="string">&quot;https://username:password@proxy-server-ip:8182/&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="ubuntu-repo"><a href="#ubuntu-repo" class="headerlink" title="ubuntu repo"></a>ubuntu repo</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kernel mainline</span></span><br><span class="line">https://kernel.ubuntu.com/mainline/</span><br><span class="line">https://ubuntuhandbook.org/index.php/2023/08/install-latest-kernel-new-repository/</span><br><span class="line"></span><br><span class="line"><span class="comment">#package check, google search site</span></span><br><span class="line">https://www.cybersecurity-help.cz/vdb/openssh/openssh/8.2p1/</span><br><span class="line"></span><br><span class="line">mirrors.aliyun.com</span><br><span class="line">mirrors.163.com</span><br><span class="line">mirrors.ustc.edu.cn</span><br></pre></td></tr></table></figure>

<h5 id="disable-cloud-init"><a href="#disable-cloud-init" class="headerlink" title="disable cloud init"></a>disable cloud init</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> /etc/cloud/cloud-init.disabled</span><br></pre></td></tr></table></figure>

<h5 id="disable-sleep"><a href="#disable-sleep" class="headerlink" title="disable sleep"></a>disable sleep</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br></pre></td></tr></table></figure>

<h4 id="disable-screen-lock-and-screen-blackout"><a href="#disable-screen-lock-and-screen-blackout" class="headerlink" title="disable screen lock and screen blackout"></a>disable screen lock and screen blackout</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gsettings <span class="built_in">set</span> org.gnome.desktop.screensaver lock-enabled <span class="literal">false</span></span><br><span class="line">$ gsettings <span class="built_in">set</span> org.gnome.desktop.session idle-delay 0</span><br></pre></td></tr></table></figure>

<h4 id="ubuntu-GNOME"><a href="#ubuntu-GNOME" class="headerlink" title="ubuntu GNOME"></a>ubuntu GNOME</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install gnome-session gnome-terminal ubuntu-desktop</span><br><span class="line">$ vi /etc/gdm3/custom.conf</span><br><span class="line"><span class="comment">#uncomment this line</span></span><br><span class="line">WaylandEnable=<span class="literal">false</span> </span><br><span class="line">$ systemctl restart gdm3</span><br></pre></td></tr></table></figure>

<h5 id="clone-the-whole-linux-system-by-rsync"><a href="#clone-the-whole-linux-system-by-rsync" class="headerlink" title="clone the whole linux system by rsync"></a>clone the whole linux system by rsync</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">backup <span class="built_in">command</span>:</span><br><span class="line">sudo rsync -aHAXS</span><br><span class="line">--exclude=&#123;<span class="string">&quot;/dev/*&quot;</span>,<span class="string">&quot;/proc/*&quot;</span>,<span class="string">&quot;/sys/*&quot;</span>,<span class="string">&quot;/tmp/*&quot;</span>,<span class="string">&quot;/run/*&quot;</span>,<span class="string">&quot;/mnt/*&quot;</span>,<span class="string">&quot;/media/*&quot;</span>,<span class="string">&quot;/lost+found&quot;</span>&#125;</span><br><span class="line">/* /backup</span><br><span class="line"></span><br><span class="line">I<span class="string">&#x27;ve also added -H for hard links. I strongly propose you to use it.</span></span><br><span class="line"><span class="string">And -S, in case you have sparse files. I had lots of them, for VMs.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For restoring, I used a live cd/usb, mounted the empty, freshly</span></span><br><span class="line"><span class="string">formatted soon-to-be-/ disk on /mnt and then,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">restore command:</span></span><br><span class="line"><span class="string">sudo rsync -aHAXS</span></span><br><span class="line"><span class="string">--exclude=&#123;&quot;/dev/*&quot;,&quot;/proc/*&quot;,&quot;/sys/*&quot;,&quot;/tmp/*&quot;,&quot;/run/*&quot;,&quot;/mnt/*&quot;,&quot;/media/*&quot;,&quot;/lost+found&quot;&#125;</span></span><br><span class="line"><span class="string">/backup/* /mnt</span></span><br></pre></td></tr></table></figure>

<h5 id="disable-upgrade"><a href="#disable-upgrade" class="headerlink" title="disable upgrade"></a>disable upgrade</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop apt-daily.timer</span><br><span class="line">systemctl <span class="built_in">disable</span> apt-daily.timer</span><br><span class="line">systemctl mask apt-daily.service</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>


<h5 id="list-all-version-not-installed"><a href="#list-all-version-not-installed" class="headerlink" title="list all version(not installed)"></a>list all version(not installed)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">$ apt install apt-file</span><br><span class="line"></span><br><span class="line">$ dpkg -L linux-source-6.1</span><br><span class="line">/.</span><br><span class="line">/usr</span><br><span class="line">/usr/share</span><br><span class="line">/usr/share/doc</span><br><span class="line">/usr/share/doc/linux-source-6.1</span><br><span class="line">/usr/share/doc/linux-source-6.1/changelog.Debian.gz</span><br><span class="line">/usr/share/doc/linux-source-6.1/copyright</span><br><span class="line">/usr/src</span><br><span class="line">/usr/src/linux-source-6.1.tar.xz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#force install deb</span></span><br><span class="line">$ sudo dpkg --purge  --ignore-depends=<span class="variable">$package_name</span> locales</span><br><span class="line"></span><br><span class="line"><span class="comment"># force uninstall</span></span><br><span class="line">$ sudo dpkg --purge --force-all thunderbird</span><br><span class="line"></span><br><span class="line">$ apt-file search smartctl</span><br><span class="line"></span><br><span class="line">bash-completion: /usr/share/bash-completion/completions/smartctl</span><br><span class="line">ceph-base: /etc/sudoers.d/ceph-smartctl</span><br><span class="line">collectd-core: /usr/share/doc/collectd-core/examples/exec-smartctl</span><br><span class="line">gsmartcontrol: /usr/share/doc/gsmartcontrol/contrib/cron-based_noadmin/smartctl_subst.sh</span><br><span class="line">mon: /usr/lib/mon/bin/smartctl.helper</span><br><span class="line">mon: /usr/lib/mon/mon-local.d/smartctl.monitor</span><br><span class="line">munin-plugins-core: /usr/share/munin/plugins/hddtemp_smartctl</span><br><span class="line">pcp-testsuite: /var/lib/pcp/testsuite/smart/smartctl.sh</span><br><span class="line">smartmontools: /usr/sbin/smartctl</span><br><span class="line">smartmontools: /usr/share/man/man8/smartctl.8.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#install </span></span><br><span class="line">$ apt install linux-cpupower</span><br><span class="line"><span class="comment">#turbostat</span></span><br><span class="line"></span><br><span class="line">$ sudo apt install hddtemp lm-sensors</span><br><span class="line"><span class="comment">#sensors command check the temperature</span></span><br><span class="line"></span><br><span class="line">$ apt install radeontop</span><br><span class="line"><span class="comment">#AMD Radeon status</span></span><br><span class="line"></span><br><span class="line">$ vi /etc/vim/vimrc</span><br><span class="line">$ vi ~/.vimrc</span><br><span class="line"><span class="comment">#add the line, vim support mouse</span></span><br><span class="line"><span class="built_in">set</span> mouse=r</span><br><span class="line">syntax on</span><br><span class="line">filetype plugin indent on</span><br><span class="line"><span class="keyword">if</span> has(<span class="string">&quot;autocmd&quot;</span>)</span><br><span class="line">  au BufReadPost * <span class="keyword">if</span> line(<span class="string">&quot;&#x27;\&quot;&quot;</span>) &gt; 0 &amp;&amp; line(<span class="string">&quot;&#x27;\&quot;&quot;</span>) &lt;= line(<span class="string">&quot;$&quot;</span>) | exe <span class="string">&quot;normal! g`\&quot;&quot;</span> | endif</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"><span class="comment">#disable indent</span></span><br><span class="line">filetype indent off</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setting TAB to 2 spaces</span></span><br><span class="line"><span class="built_in">set</span> tabstop=2 softtabstop=2 shiftwidth=2</span><br><span class="line"><span class="built_in">set</span> expandtab</span><br><span class="line"><span class="built_in">set</span> number ruler</span><br><span class="line"><span class="built_in">set</span> autoindent smartindent</span><br><span class="line">syntax <span class="built_in">enable</span></span><br><span class="line">filetype plugin indent on</span><br><span class="line"></span><br><span class="line">$ sensors</span><br><span class="line">amdgpu-pci-0300</span><br><span class="line">Adapter: PCI adapter</span><br><span class="line">vddgfx:      750.00 mV </span><br><span class="line">fan1:             N/A  (min =    0 RPM, max = 5300 RPM)</span><br><span class="line">edge:         +42.0°C  (crit = +94.0°C, hyst = -273.1°C)</span><br><span class="line">power1:       32.06 W  (<span class="built_in">cap</span> = 120.00 W)</span><br><span class="line"></span><br><span class="line">coretemp-isa-0000</span><br><span class="line">Adapter: ISA adapter</span><br><span class="line">Package <span class="built_in">id</span> 0:  +55.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 0:        +51.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 1:        +53.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 2:        +51.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 3:        +52.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 4:        +55.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 5:        +51.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 8:        +51.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 9:        +54.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 10:       +53.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 11:       +53.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 12:       +54.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line">Core 13:       +52.0°C  (high = +74.0°C, crit = +84.0°C)</span><br><span class="line"></span><br><span class="line">$ smartctl -a /dev/sda <span class="comment">#show the temperature</span></span><br><span class="line"></span><br><span class="line">$ apt list -a vlc</span><br><span class="line">$ apt install vlc=3.0.16-1build7</span><br><span class="line">$ apt-mark hold package_name</span><br><span class="line">$ apt-mark unhold package_name</span><br><span class="line"></span><br><span class="line">$ apt update</span><br><span class="line">$ apt list linux-*image-*</span><br><span class="line">$ apt-cache madison linux-image-generic <span class="comment"># or you can tab show all</span></span><br><span class="line">linux-image-generic | 5.15.0.58.56 | http://mirrors.aliyun.com/ubuntu jammy-security/main amd64 Packages</span><br><span class="line">linux-image-generic | 5.15.0.25.27 | http://mirrors.aliyun.com/ubuntu jammy/main amd64 Packages</span><br><span class="line"></span><br><span class="line">$ apt list -a linux-image-generic</span><br><span class="line">linux-image-generic/jammy-security 5.15.0.58.56 amd64 [upgradable from: 5.15.0.57.55]</span><br><span class="line">linux-image-generic/now 5.15.0.57.55 amd64 [installed,upgradable to: 5.15.0.58.56]</span><br><span class="line">linux-image-generic/jammy 5.15.0.25.27 amd64</span><br><span class="line"></span><br><span class="line">$ apt-cache showpkg linux-image-generic</span><br><span class="line"></span><br><span class="line">$ apt-cache policy libsnmp-dev systemd</span><br><span class="line">libsnmp-dev:</span><br><span class="line">  Installed: 5.9.1+dfsg-1ubuntu2.2</span><br><span class="line">  Candidate: 5.9.1+dfsg-1ubuntu2.4</span><br><span class="line">  Version table:</span><br><span class="line">     5.9.1+dfsg-1ubuntu2.4 500</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy-updates/universe amd64 Packages</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy-security/universe amd64 Packages</span><br><span class="line"> *** 5.9.1+dfsg-1ubuntu2.2 100</span><br><span class="line">        100 /var/lib/dpkg/status</span><br><span class="line">     5.9.1+dfsg-1ubuntu2 500</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy/universe amd64 Packages</span><br><span class="line">systemd:</span><br><span class="line">  Installed: 249.11-0ubuntu3.6</span><br><span class="line">  Candidate: 249.11-0ubuntu3.6</span><br><span class="line">  Version table:</span><br><span class="line"> *** 249.11-0ubuntu3.6 100</span><br><span class="line">        100 /var/lib/dpkg/status</span><br><span class="line">     249.11-0ubuntu3 500</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy/main amd64 Packages</span><br><span class="line">$ apt-cache policy linux-image-generic</span><br><span class="line">linux-image-generic:</span><br><span class="line">  Installed: 5.15.0.57.55</span><br><span class="line">  Candidate: 5.15.0.58.56</span><br><span class="line">  Version table:</span><br><span class="line">     5.15.0.58.56 500</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy-security/main amd64 Packages</span><br><span class="line"> *** 5.15.0.57.55 100</span><br><span class="line">        100 /var/lib/dpkg/status</span><br><span class="line">     5.15.0.25.27 500</span><br><span class="line">        500 http://mirrors.aliyun.com/ubuntu jammy/main amd64 Packages</span><br><span class="line"></span><br><span class="line">$ apt list --all-versions linux-image-generic</span><br><span class="line">Listing... Done</span><br><span class="line">linux-image-generic/jammy-security 5.15.0.58.56 amd64 [upgradable from: 5.15.0.57.55]</span><br><span class="line">linux-image-generic/now 5.15.0.57.55 amd64 [installed,upgradable to: 5.15.0.58.56]</span><br><span class="line">linux-image-generic/jammy 5.15.0.25.27 amd64</span><br></pre></td></tr></table></figure>

<h4 id="VLC"><a href="#VLC" class="headerlink" title="VLC"></a>VLC</h4><p><a target="_blank" rel="noopener" href="https://forum.videolan.org/viewtopic.php?t=50202">same issue</a><br>Tools–&gt;Preferences–&gt;Subtitles &#x2F; OSD–&gt; Show media title on media start (disable it)<br>Tools–&gt;Preferences–&gt;Subtitles &#x2F; OSD–&gt; Enable on screen display (disable it)<br>Not resize interface<br><img src="/img/vlc-set1.png"><br>record stream by vlc and front camera  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> 777 /tmp/sshfs/record</span><br><span class="line"></span><br><span class="line"><span class="comment">#not worked extfat, only ext4 or sshfs and support linux permission</span></span><br><span class="line">$ vlc -I dummy v4l2:///dev/video0 --no-audio --sout=<span class="string">&quot;#transcode&#123;venc=x264,vcodec=h264,vb=800,width=640,height=480,fps=16.0&#125;:std&#123;mux=mp4,dst=/sshfs/record/<span class="subst">$(date &#x27;+%Y%m%d-%H%M%S&#x27;)</span>.mp4,access=file&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#$ vlc -I dummy v4l2:///dev/video0 --no-audio --sout=&quot;#transcode&#123;venc=x264&#123;aud,profile=baseline,level=30,no-cabac&#125;,vcodec=h264,vb=800,width=640,height=480,fps=24.0&#125;:std&#123;mux=mp4,dst=~/sshfs/record/$(date &#x27;+%Y%m%d-%H%M%S&#x27;).mp4,access=file&#125;&quot;</span></span><br><span class="line"><span class="comment">#not work $ vlc -I dummy v4l2:///dev/video0 --video-filter adjust --fps-fps=16 --no-audio --sout=&quot;#transcode&#123;vcodec=mp4v,vfilter=canvas&#123;width=640,height=480&#125;&#125;:std&#123;access=file,mux=mp4,dst=/sshfs/record/$(date &#x27;+%Y%m%d-%H%M%S&#x27;).mp4&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#take photograph</span></span><br><span class="line">$ vlc -I dummy v4l2:///dev/video0 --video-filter scene --no-audio --scene-path /home/zzz --scene-prefix image_prefix --scene-format png vlc://quit --run-time=1</span><br><span class="line"><span class="built_in">echo</span> send mail!!</span><br><span class="line">uuencode /home/zzz/image_prefix00001.png image_prefix00001| mail -s <span class="string">&quot;`date`&quot;</span>  xxx@gmail.com</span><br></pre></td></tr></table></figure>

<h4 id="Upgrade-pixel-6a"><a href="#Upgrade-pixel-6a" class="headerlink" title="Upgrade pixel 6a"></a>Upgrade pixel 6a</h4><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kyujin-cho/pixel-volte-patch/blob/main/README.en.md">Enable 4G in China</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/android/ota#bluejay">download from full OTA</a></li>
<li>enable usb debug mode and don’t to unlock</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#get adb for linux, I upgrade by the linux root user base LMDE 5</span></span><br><span class="line">root$ platform-tools/adb kill-server</span><br><span class="line">root$ platform-tools/adb start-server</span><br><span class="line">root$ platform-tools/adb devices</span><br><span class="line">$ wget https://dl.google.com/android/repository/platform-tools_r33.0.3-linux.zip</span><br><span class="line">$ <span class="built_in">sha256sum</span> bluejay-ota-tq1a.221205.011-7a7b0700.zip</span><br><span class="line"></span><br><span class="line">root$ platform-tools/adb reboot fastboot</span><br><span class="line"><span class="comment">#booted to recovery and chose &#x27;&#x27;apply update from ADB&#x27;&#x27; :  </span></span><br><span class="line"></span><br><span class="line">root$ platform-tools/adb sideload ./bluejay-ota-tq1a.221205.011-7a7b0700.zip</span><br><span class="line">$ wget https://dl.google.com/dl/android/aosp/bluejay-ota-tq1a.221205.011-7a7b0700.zip</span><br><span class="line">after upload(100%), reboot the from the recovery mode</span><br></pre></td></tr></table></figure>

<ul>
<li><p>google pixel 6a go to upgrade to adb option</p>
<ul>
<li>shutdown<ul>
<li>Press power button + voice down at the same time and retry<ul>
<li>select “rescue mode” and reboot<ul>
<li>show the “No command” screen<ul>
<li>Press power button + voice up at the same time and retry 3 times<ul>
<li>select “Apply update from ADB</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/kyujin-cho/pixel-volte-patch/blob/main/README.en.md">Enable VoLET for 4G</a></p>
</li>
<li><p>Start shizuku service by executing adb shell sh &#x2F;sdcard&#x2F;Android&#x2F;data&#x2F;moe.shizuku.privileged.api&#x2F;start.sh. You should see something like “Shizuku is running” at your Pixel phone.</p>
</li>
<li><p>Acative Island</p>
<ul>
<li>security &amp; privacy<ul>
<li>Permission manager<ul>
<li>More security setting   <ul>
<li>device admin app (not sure, enable Lsland)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Install Island extension pack</p>
<ul>
<li>install local download and install dingtalk<ul>
<li>clone<ul>
<li>select Island clone app to “via play store”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>aShell is a local ADB shell for <a target="_blank" rel="noopener" href="https://shizuku.rikka.app/">Shizuku</a> powered android devices.</p>
</li>
</ul>
<h4 id="rotated-pdf-file"><a href="#rotated-pdf-file" class="headerlink" title="rotated pdf file"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/409880/how-to-save-a-rotated-pdf-file">rotated pdf file</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">For Ubuntu 22.04 and later:</span><br><span class="line">$ sudo apt-get install pdfarranger</span><br><span class="line"></span><br><span class="line">For versions before Ubuntu 22.04:</span><br><span class="line">$ sudo apt-get install pdfshuffler</span><br></pre></td></tr></table></figure>
<p>click the rotate icon ↺ or ↻ (or use the menu)    </p>
<h4 id="vim-split"><a href="#vim-split" class="headerlink" title="vim split"></a>vim split</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">::split</span><br><span class="line"></span><br><span class="line">:split filename</span><br><span class="line"></span><br><span class="line">:new #create an new window</span><br><span class="line"></span><br><span class="line">::vsplit</span><br><span class="line"></span><br><span class="line">:vsplit filename</span><br><span class="line"></span><br><span class="line">:vnew</span><br><span class="line"></span><br><span class="line">#switch window</span><br><span class="line">ctrl + double click &quot;w&quot;</span><br><span class="line">&lt;CTRL＋W&gt; h：跳转到左边的窗口 （若为大写H，则是把当前窗口调至左方）</span><br><span class="line">&lt;CTRL＋W&gt; l：跳转到右边的窗口 （类似于上）</span><br><span class="line">&lt;CTRL+W&gt; w：在窗口之间跳转</span><br><span class="line">&lt;CTRL+W&gt; +：扩大窗口 (或在当前窗口位置，输入命令：res +9)</span><br><span class="line">&lt;CTRL+W&gt; －：缩小窗口</span><br><span class="line"></span><br><span class="line">如何关闭其他窗口?      Ctrl + w, o</span><br><span class="line"></span><br><span class="line">关闭当前屏: Ctrl+w，c</span><br><span class="line"></span><br><span class="line">Ctrl + w, w 后一个</span><br><span class="line">Ctrl + w, p 前一个</span><br><span class="line"></span><br><span class="line">切换焦点？</span><br><span class="line"></span><br><span class="line">Ctrl + w, h 四个方向</span><br><span class="line">Ctrl + w, i</span><br><span class="line">Ctrl + w, k</span><br><span class="line">Ctrl + w, l</span><br><span class="line"></span><br><span class="line">zt zz zb: 把光标所在行移动窗口的顶端、中间或底部</span><br><span class="line"></span><br><span class="line">   zo – 打开光标下的折叠</span><br><span class="line">   zO – 循环打开光标下的折叠，也就是说，如果存在多级折叠，每一级都会被打开</span><br><span class="line">   zc – 关闭光标下的折叠</span><br><span class="line">   zC – 循环关闭光标下的折叠</span><br><span class="line">   [z – 到当前打开折叠的开始</span><br><span class="line">   ]z – 到当前打开折叠的结束</span><br><span class="line">   zj – 向下移动到下一个折叠的开始处</span><br><span class="line">   zk – 向上移动到上一个折叠的结束处</span><br></pre></td></tr></table></figure>

<p>vim enable mouse  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.vimrc</span><br><span class="line">set mouse=r</span><br><span class="line">syntax on</span><br><span class="line">filetype plugin indent on</span><br><span class="line">if has(&quot;autocmd&quot;)</span><br><span class="line">  au BufReadPost * if line(&quot;&#x27;\&quot;&quot;) &gt; 0 &amp;&amp; line(&quot;&#x27;\&quot;&quot;) &lt;= line(&quot;$&quot;) | exe &quot;normal! g`\&quot;&quot; | endif</span><br><span class="line">endif</span><br><span class="line">filetype indent off</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line"><span class="comment"># Client Env Vars</span></span><br><span class="line">Environment=ETCD_CA_FILE=/path/to/CA.pem</span><br><span class="line">Environment=ETCD_CERT_FILE=/path/to/server.crt</span><br></pre></td></tr></table></figure>
<h4 id="rc-local"><a href="#rc-local" class="headerlink" title="rc.local"></a>rc.local</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#check rc-local is worked </span></span><br><span class="line">$ systemctl is-enabled rc-local.service</span><br><span class="line">$ systemctl status rc-local.service</span><br><span class="line">$ systemctl list-unit-files |grep rc.local </span><br><span class="line"><span class="comment">#if exist, don&#x27;t create a new service</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/systemd/system/rc-local.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line"><span class="comment">#multiple command</span></span><br><span class="line"><span class="comment"># https://cds.lol/tutorial/2713833-execute-multiple-commands-with-&amp;&amp;-in-systemd-service-execstart-on-redhat-7.9</span></span><br><span class="line"><span class="comment"># systemd custom multiple command</span></span><br><span class="line"><span class="comment">#ExecStart=/bin/bash -c &#x27;sleep 45 ; /bin/bash bin/eum.sh start&#x27;</span></span><br><span class="line"><span class="comment">#cat /home/$&#123;USER&#125;/.local/share/systemd/user/ovpnqlz.env</span></span><br><span class="line"><span class="comment">#ARG1=start</span></span><br><span class="line"><span class="comment">#EnvironmentFile=/home/$&#123;USER&#125;/.local/share/systemd/user/ovpnqlz.env</span></span><br><span class="line"><span class="comment">#Environment=&quot;https_proxy=http://mycorporateproxy.local:8080&quot;</span></span><br><span class="line"><span class="comment">#ExecStart=/home/$&#123;USER&#125;/bin/ovpn $ARG1</span></span><br><span class="line">TimeoutSec=0</span><br><span class="line">StandardOutput=<span class="built_in">tty</span></span><br><span class="line">RemainAfterExit=<span class="built_in">yes</span></span><br><span class="line">SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ systemctl <span class="built_in">enable</span> rc-local</span><br><span class="line"></span><br><span class="line">$ systemctl list-units --<span class="built_in">type</span>=service</span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service</span><br><span class="line"></span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service --state=active</span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service --state=running</span><br><span class="line"></span><br><span class="line"><span class="comment">#debug systemd service not start</span></span><br><span class="line"></span><br><span class="line">$ systemd-analyze dot cpupower.service</span><br><span class="line">digraph systemd &#123;</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;sshd.service&quot;</span> [color=<span class="string">&quot;green&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;system.slice&quot;</span> [color=<span class="string">&quot;green&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;basic.target&quot;</span> [color=<span class="string">&quot;green&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;systemd-journald.socket&quot;</span> [color=<span class="string">&quot;green&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;system.slice&quot;</span> [color=<span class="string">&quot;black&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;basic.target&quot;</span> [color=<span class="string">&quot;black&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;shutdown.target&quot;</span> [color=<span class="string">&quot;red&quot;</span>];</span><br><span class="line">	<span class="string">&quot;cpupower.service&quot;</span>-&gt;<span class="string">&quot;tuned.service&quot;</span> [color=<span class="string">&quot;red&quot;</span>];</span><br><span class="line">	<span class="string">&quot;tuned.service&quot;</span>-&gt;<span class="string">&quot;cpupower.service&quot;</span> [color=<span class="string">&quot;red&quot;</span>];    &lt;-------------this enabled</span><br><span class="line">	<span class="string">&quot;shutdown.target&quot;</span>-&gt;<span class="string">&quot;cpupower.service&quot;</span> [color=<span class="string">&quot;green&quot;</span>];</span><br><span class="line">	<span class="string">&quot;shutdown.target&quot;</span>-&gt;<span class="string">&quot;cpupower.service&quot;</span> [color=<span class="string">&quot;red&quot;</span>];   </span><br><span class="line">&#125;</span><br><span class="line">   Color legend: black     = Requires</span><br><span class="line">                 dark blue = Requisite</span><br><span class="line">                 dark grey = Wants</span><br><span class="line">                 red       = Conflicts</span><br><span class="line">                 green     = After</span><br><span class="line">-- You probably want to process this output with graphviz<span class="string">&#x27; dot tool.</span></span><br><span class="line"><span class="string">-- Try a shell pipeline like &#x27;</span>systemd-analyze dot | dot -Tsvg &gt; systemd.svg<span class="string">&#x27;!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ systemctl --type=service --state=running  | grep tuned.service</span></span><br><span class="line"><span class="string">tuned.service            loaded active running Dynamic System Tuning Daemon  &lt;----running and conflicts with cpupower.service</span></span><br></pre></td></tr></table></figure>

<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#worked</span><br><span class="line">/etc/systemd/resolved.conf</span><br><span class="line">[Resolve]</span><br><span class="line">DNS=8.8.8.8,4.4.4.4</span><br><span class="line"></span><br><span class="line">$ sudo systemd-resolve --set-dns=8.8.8.8 --interface=eth0</span><br><span class="line">$ service systemd-resolved restart</span><br><span class="line">$ systemctl restart systemd-resolved</span><br><span class="line">$ sudo systemd-resolve --reset-statistics --flush-caches</span><br><span class="line">$ systemd-resolve --status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#not work</span><br><span class="line">apt install resolvconf</span><br><span class="line">ls -al /etc/resolv.conf</span><br><span class="line">cat /run/resolvconf/interface/systemd-resolved</span><br><span class="line">resolvconf -u</span><br></pre></td></tr></table></figure>

<h5 id="Flush-DNS-cache"><a href="#Flush-DNS-cache" class="headerlink" title="Flush DNS cache"></a>Flush DNS cache</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ journalctl -u systemd-resolved</span><br><span class="line"></span><br><span class="line">$ strings /var/cache/nscd/hosts | <span class="built_in">uniq</span></span><br><span class="line">or</span><br><span class="line">$ nscd -g</span><br><span class="line">or <span class="keyword">if</span> you use dnsmasq</span><br><span class="line">$ journalctl -u dnsmasq &gt; ~/cache.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#flush</span></span><br><span class="line">$ resolvectl flush-caches</span><br><span class="line">$ systemd-resolved --flush-caches</span><br><span class="line">$ nscd -g</span><br><span class="line"></span><br><span class="line"><span class="comment">#invalidate the record</span></span><br><span class="line">$ nscd -i hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#chrome</span></span><br><span class="line">chrome://net-internals/<span class="comment">#dns</span></span><br><span class="line">click <span class="string">&quot;Clear host cache&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="ubuntu-wifi"><a href="#ubuntu-wifi" class="headerlink" title="ubuntu wifi"></a>ubuntu wifi</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Security WPA &amp; WAP2 Enterprise</span><br><span class="line">Authentication Protected EAP(PEAP)</span><br><span class="line">PEAP version automatic</span><br><span class="line">Inner authentication MSCHAPv2</span><br></pre></td></tr></table></figure>

<h4 id="disable-fstrim-service"><a href="#disable-fstrim-service" class="headerlink" title="disable fstrim service"></a>disable fstrim service</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /var/lib/systemd/timers/stamp-fstrim.timer</span><br><span class="line">systemctl stop fstrim.service fstrim.timer</span><br><span class="line">systemctl <span class="built_in">disable</span> fstrim.service fstrim.timer</span><br><span class="line">systemctl mask fstrim.service fstrim.timer</span><br></pre></td></tr></table></figure>

<h4 id="debian-set-boot-order"><a href="#debian-set-boot-order" class="headerlink" title="debian set boot order"></a>debian set boot order</h4><p><a target="_blank" rel="noopener" href="https://gist.github.com/chaiyujin/c08e59752c3e238ff3b1a5098322b363">not working</a>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ grep menuentry --color /boot/grub/grub.cfg</span><br><span class="line"><span class="comment">#count the boot index number </span></span><br><span class="line"></span><br><span class="line">$ vi /etc/default/grub</span><br><span class="line"><span class="comment">#GRUB_DEFAULT=0</span></span><br><span class="line">GRUB_DEFAULT=5</span><br><span class="line">GRUB_SAVEDEFAULT=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">$ sudo update-grub</span><br></pre></td></tr></table></figure>

<h4 id="delpoy"><a href="#delpoy" class="headerlink" title="delpoy"></a>delpoy</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg --add-architecture i386</span><br><span class="line">$ sudo dpkg --remove-architecture i386</span><br><span class="line">$ sudo apt install vlc:amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># dpgk show the package provides file</span></span><br><span class="line">$ dpkg -S /bin/ls</span><br><span class="line">coreutils: /bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the linux kernel</span></span><br><span class="line"></span><br><span class="line">$ sudo dpkg --get-selections | grep linux-image</span><br><span class="line"></span><br><span class="line">$ apt update</span><br><span class="line">$ systemctl <span class="built_in">disable</span> apt-daily-upgrade.service; systemctl <span class="built_in">disable</span> apt-daily-upgrade.timer</span><br><span class="line">$ apt install gcc make automake autoconf perl ethtool bpfcc-tools fio gdb crash python3-bpfcc smartmontools sg3-utils nfs-kernel-server tcpdump screen sysstat iotop iftop openssh-server linux-tools-5.4.0-58-generic atop collectl net-tools axel remmina tightvncserver ffmpeg gimp gimp-resynthesizer sshfs fail2ban policycoreutils selinux-utils selinux-basics icedtea-netx tigervnc-viewer</span><br><span class="line">$ apt install ubuntu-mate-desktop</span><br><span class="line"></span><br><span class="line">$ sudo apt install linux-headers-5.11.0-46-lowlatency linux-image-5.11.0-46-lowlatency linux-modules-5.11.0-46-lowlatency linux-tools-5.11.0-46-lowlatency</span><br><span class="line"></span><br><span class="line">$ vi /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#PermitRootLogin prohibit-password</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#white ip list</span></span><br><span class="line">https://yurisk.info/2011/04/05/two-tips-to-secure-ssh-access-from-specific-ips-to-specific-users-in-checkpoint-or-any-linux/</span><br><span class="line">AllowUsers  admin@123.123.123.10 admin@10.88.88.*  yurisk</span><br><span class="line">or</span><br><span class="line">AllowUsers *@99.19.19.*</span><br><span class="line"></span><br><span class="line">https://unix.stackexchange.com/questions/406245/limit-ssh-access-to-specific-clients-by-ip-address</span><br><span class="line"><span class="comment">#limit key</span></span><br><span class="line">from=<span class="string">&quot;192.168.1.*,192.168.2.*&quot;</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABA...etc...mnMo7n1DD useralias</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ systemctl restart sshd</span><br><span class="line">$ passwd root <span class="comment"># set root passwd</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$password</span>&quot;</span> | passwd <span class="string">&quot;<span class="variable">$user</span>&quot;</span> --stdin</span><br><span class="line">$ apt remove libreoffice-core</span><br><span class="line">$ apt upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment">##bridge network config example</span></span><br><span class="line">vi /etc/network/interfaces</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto br0</span><br><span class="line">iface br0 inet static</span><br><span class="line">        address 192.168.0.10</span><br><span class="line">        network 192.168.0.0</span><br><span class="line">        netmask 255.255.255.0</span><br><span class="line">        broadcast 192.168.0.255</span><br><span class="line">        gateway 192.168.0.1</span><br><span class="line">        dns-nameservers 192.168.0.5 8.8.8.8</span><br><span class="line">        dns-search example.com</span><br><span class="line">        bridge_ports eth0</span><br><span class="line">        bridge_stp off</span><br><span class="line">        bridge_fd 0</span><br><span class="line">        bridge_maxwait 0</span><br><span class="line"></span><br><span class="line"><span class="comment">###install main-line kernel</span></span><br><span class="line">https://www.linuxcapable.com/how-to-install-linux-kernel-5-19-on-ubuntu-20-04-lts/</span><br><span class="line"></span><br><span class="line">$ add-apt-repository ppa:tuxinvader/lts-mainline  -y</span><br><span class="line"><span class="comment">#remove</span></span><br><span class="line">$ add-apt-repository --remove ppa:tuxinvader/lts-mainline -y</span><br><span class="line"></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ apt-get install linux-generic-6.0 -y</span><br><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">6.0.3-060003-generic</span><br><span class="line"></span><br><span class="line"><span class="comment">###debug-info</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span> main restricted universe multiverse</span></span><br><span class="line"><span class="string">      deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span>-updates main restricted universe multiverse</span></span><br><span class="line"><span class="string">      deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span>-proposed main restricted universe multiverse&quot;</span> | \</span><br><span class="line">      sudo <span class="built_in">tee</span> -a /etc/apt/sources.list.d/ddebs.list</span><br><span class="line"></span><br><span class="line">$ apt install ubuntu-dbgsym-keyring</span><br><span class="line">$ apt update</span><br><span class="line">$ apt install debian-goodies</span><br><span class="line"></span><br><span class="line">debian install kernel-debuginfo</span><br><span class="line">$ apt install linux-image-amd64-dbg</span><br><span class="line"></span><br><span class="line"><span class="comment">### kernel source</span></span><br><span class="line">$ apt-get install linux-source linux-crashdump</span><br><span class="line">$ kdump-config show</span><br><span class="line">$ dmesg | grep -i crash</span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/sysrq</span><br><span class="line">176</span><br><span class="line"></span><br><span class="line">$ sysctl -w kernel.sysrq=1</span><br><span class="line">$ <span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br><span class="line">$ <span class="built_in">cat</span> /etc/default/grub.d/kdump-tools.cfg</span><br><span class="line">$ update-grub</span><br><span class="line">$ kdump-config load</span><br><span class="line">$ kdump-config unload</span><br><span class="line"></span><br><span class="line">find-dbgsym-packages [core_path|running_pid|binary_path]</span><br><span class="line">$ find-dbgsym-packages /bin/ls</span><br><span class="line">coreutils-dbgsym libpcre2-8-0-dbgsym libselinux1-dbgsym</span><br><span class="line"></span><br><span class="line">$ apt-get install coreutils-dbgsym</span><br><span class="line"></span><br><span class="line">$ crash  /usr/lib/debug/boot/vmlinux-5.4.0-58-generic</span><br><span class="line"></span><br><span class="line">$ apt install linux-image-5.4.0-58-generic-dbgsym</span><br><span class="line">$ apt install linux-image-5.10.0-13-amd64-dbg</span><br><span class="line"></span><br><span class="line">$ crash /usr/lib/debug/boot/vmlinux-5.10.0-13-amd64</span><br><span class="line"></span><br><span class="line">$ vi /etc/apt/sources.list <span class="comment"># Enable src</span></span><br><span class="line">$ apt-get <span class="built_in">source</span> linux-image-unsigned-$(<span class="built_in">uname</span> -r)</span><br><span class="line"><span class="comment">#ubuntu</span></span><br><span class="line">http://ddebs.ubuntu.com/ubuntu/pool/main/l/linux/linux-image-unsigned-5.4.0-58-generic-dbgsym_5.4.0-58.64_amd64.ddeb</span><br><span class="line"></span><br><span class="line"><span class="comment">#debian</span></span><br><span class="line"><span class="comment">#debian security repo</span></span><br><span class="line"><span class="comment">#deb https://security.debian.org/ bookworm-security main contrib non-free non-free-firmware</span></span><br><span class="line">deb http://mirrors.ustc.edu.cn/debian-security/ bookworm-security main contrib non-free non-free-firmware</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://mirrors.ustc.edu.cn/debian/pool/main/l/linux/linux-image-4.19.0-13-amd64-dbg_4.19.160-2_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /etc/apt/sources.list</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian-security buster/updates main contrib non-free</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add dbgsym</span></span><br><span class="line"><span class="comment">#deb http://deb.debian.org/debian-debug/ buster-debug main</span></span><br><span class="line">deb http://debug.mirrors.debian.org/debian-debug/ buster-debug main</span><br><span class="line"><span class="comment"># for security updates</span></span><br><span class="line"><span class="comment">#deb http://deb.debian.org/debian-debug/ buster-proposed-updates-debug main</span></span><br><span class="line">deb http://debug.mirrors.debian.org/debian-debug/ buster-proposed-updates-debug main</span><br><span class="line"></span><br><span class="line">$ apt install linux-image-4.19.0-13-amd64-dbg</span><br></pre></td></tr></table></figure>

<h5 id="sysstat-systemd"><a href="#sysstat-systemd" class="headerlink" title="sysstat systemd"></a>sysstat systemd</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status sysstat-collect.timer</span><br><span class="line">$ <span class="built_in">cat</span> /usr/lib/systemd/system/sysstat-collect.timer</span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/sysstat-collect.timer</span></span><br><span class="line"><span class="comment"># (C) 2014 Tomasz Torcz &lt;tomek@pipebreaker.pl&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># sysstat-11.7.3 systemd unit file:</span></span><br><span class="line"><span class="comment">#        Activates activity collector every 10 minutes</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Run system activity accounting tool every 10 minutes</span><br><span class="line"></span><br><span class="line">[Timer]</span><br><span class="line">OnCalendar=*:00/10</span><br><span class="line"></span><br><span class="line"><span class="comment">#every 15 mins</span></span><br><span class="line"><span class="comment">#OnCalendar=*:0/15</span></span><br><span class="line"><span class="comment">#or</span></span><br><span class="line"><span class="comment">#OnUnitActiveSec=15min</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sysstat.service</span><br><span class="line"></span><br><span class="line">$ journalctl -g sysstat-collect.service</span><br><span class="line">$ <span class="built_in">cat</span> /etc/sysconfig/sysstat</span><br><span class="line"></span><br><span class="line">$ systemctl <span class="built_in">disable</span> --now sysstat</span><br></pre></td></tr></table></figure>

<h5 id="wechat"><a href="#wechat" class="headerlink" title="wechat"></a>wechat</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://com-store-packages.uniontech.com/appstore/pool/appstore/c/com.qq.weixin.deepin/com.qq.weixin.deepin_3.2.1.154deepin14_i386.deb</span><br><span class="line">$ wget https://com-store-packages.uniontech.com/appstore/pool/appstore/c/com.qq.weixin.deepin/com.qq.weixin.deepin_3.7.0.30deepin24_i386.deb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ wget https://com-store-packages.uniontech.com/appstore/pool/appstore/c/com.qq.weixin.deepin/com.qq.weixin.deepin_3.9.10deepin1_amd64.deb</span><br><span class="line">$ wget https://com-store-packages.uniontech.com/appstore/pool/appstore/c/com.qq.weixin.deepin/com.qq.weixin.deepin_3.9.10deepin3_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://deepin-wine.i-m.dev/</span></span><br><span class="line"></span><br><span class="line">$ wget -O- https://deepin-wine.i-m.dev/setup.sh | sh</span><br><span class="line">$ sudo apt install com.qq.weixin.deepin</span><br><span class="line">$ sudo apt-get install -y libjpeg62:i386</span><br><span class="line"></span><br><span class="line"><span class="comment">#hold upgrade</span></span><br><span class="line">$ sudo apt-mark hold com.qq.weixin.deepin</span><br><span class="line">$ sudo apt-mark hold linux-image-generic linux-headers-generic</span><br><span class="line">$ sudo apt-mark unhold linux-image-generic linux-headers-generic</span><br><span class="line"></span><br><span class="line">$ rsync -avP the_last_system.~/.deepinwine ~</span><br><span class="line">$ rsync -avP the_last_system./usr  /usr</span><br><span class="line">$ rsync -avP the_last_system./var  /var</span><br><span class="line"><span class="comment">#some issue has gone</span></span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">https://forums.debiancn.org/t/topic/4070</span><br><span class="line">我的环境：Debian 12 &amp; KDE 5.103.0 / Plasma 5.27.5</span><br><span class="line">添加仓库</span><br><span class="line">wget -O- https://deepin-wine.i-m.dev/setup.sh | sh</span><br><span class="line">安装微信</span><br><span class="line">sudo apt-get install com.qq.weixin.deepin</span><br><span class="line">安装后我的菜单中没有出现WeChat，找到路径补了个软链接</span><br><span class="line"></span><br><span class="line">ln -s /opt/apps/com.qq.deepin/entries/applications/com.qq.weixin.desktop ~/.local/share/applications/com.qq.weixin.desktop</span><br></pre></td></tr></table></figure>

<h5 id="install-newer-glibc-deb-packages-and-apt-source-not-update-cause-the-deps-issue"><a href="#install-newer-glibc-deb-packages-and-apt-source-not-update-cause-the-deps-issue" class="headerlink" title="install newer glibc deb packages and apt source not update cause the deps issue"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1315906/unmet-dependencies-libc6-the-package-system-is-broken">install newer glibc deb packages and apt source not update cause the deps issue</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## apt install specify version</span></span><br><span class="line">$ sudo apt install libc6=2.31-0ubuntu9.2 libc-bin=2.31-0ubuntu9.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## snap remove</span></span><br><span class="line">$ sudo snap remove chromium</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Almalinux-9-install-X-boot-failed"><a href="#Almalinux-9-install-X-boot-failed" class="headerlink" title="Almalinux 9 install X boot failed"></a>Almalinux 9 install X boot failed</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">X did not start <span class="keyword">in</span> the expected time, falling back to text mode. There are multiple ways to avoid this issue:</span><br><span class="line"></span><br><span class="line">Do not load the stage2 image over a slow network <span class="built_in">link</span>.</span><br><span class="line">Wait longer <span class="keyword">for</span> the X server startup with the inst.xtimeout=&amp;lt;SECONDS&gt; boot option. The default is 60 seconds.</span><br><span class="line">Load the stage2 image into memory with the rd.live.ram boot option to decrease access time.</span><br><span class="line">Enforce text mode when installing from remote media with the inst.text boot option.</span><br><span class="line">Use the customer portal download URL <span class="keyword">in</span> ilo/drac devices <span class="keyword">for</span> greater speed. ================================================================================</span><br><span class="line">X was unable to start on your machine. Would you like to start VNC to connect to this computer from another computer and perform a graphical installation or <span class="built_in">continue</span> with a text mode installation?</span><br><span class="line"></span><br><span class="line">Start VNC</span><br><span class="line">Use text mode<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>Start VNC and connect network is OK</p>
<h4 id="setup-VNC"><a href="#setup-VNC" class="headerlink" title="setup VNC"></a>setup VNC</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># change the vnc default port</span></span><br><span class="line">$ grep <span class="string">&quot;59&quot;</span> /usr/bin/vncserver -n</span><br><span class="line"><span class="comment">#modify 5900 to xxxx</span></span><br><span class="line"></span><br><span class="line">$ apt update</span><br><span class="line">$ apt install xfce4 xfce4-goodies tightvncserver</span><br><span class="line">$ vncpasswd</span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br><span class="line"></span><br><span class="line">$ vncserver</span><br><span class="line">$ vncserver -<span class="built_in">kill</span> :1</span><br><span class="line"></span><br><span class="line">$ apt install ubuntu-mate-desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#backup mate terminal config</span></span><br><span class="line">                  --------------- don<span class="string">&#x27;t not modify the path</span></span><br><span class="line"><span class="string">                  |</span></span><br><span class="line"><span class="string">$ dconf dump /org/mate/terminal/ &gt; bkp</span></span><br><span class="line"><span class="string">#restore mate terminal config</span></span><br><span class="line"><span class="string">$ dconf load /org/mate/terminal/ &lt; bkp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#or delete the vnc lock</span></span><br><span class="line"><span class="string">$ rm -f /tmp/.X11-unix/X1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ mv ~/.vnc/xstartup ~/.vnc/xstartup.bak</span></span><br><span class="line"><span class="string">$ cat ~/.vnc/xstartup</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">xrdb $HOME/.Xresources</span></span><br><span class="line"><span class="string">startxfce4 &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#centos 7</span></span><br><span class="line"><span class="string">vi ~/.vnc/xstartup</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">unset SESSION_MANAGER</span></span><br><span class="line"><span class="string">unset DBUS_SESSION_BUS_ADDRESS</span></span><br><span class="line"><span class="string">/etc/X11/xinit/xinitrc</span></span><br><span class="line"><span class="string">/bin/startxfce4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## gnome</span></span><br><span class="line"><span class="string">$ apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal</span></span><br><span class="line"><span class="string">$ cat ~/.vnc/xstartup ## for ubuntu 20.04</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">unset SESSION_MANAGER</span></span><br><span class="line"><span class="string">unset DBUS_SESSION_BUS_ADDRESS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export XKL_XMODMAP_DISABLE=1</span></span><br><span class="line"><span class="string">export XDG_CURRENT_DESKTOP=&quot;GNOME-Flashback:GNOME&quot;</span></span><br><span class="line"><span class="string">export XDG_MENU_PREFIX=&quot;gnome-flashback-&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span></span><br><span class="line"><span class="string">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span></span><br><span class="line"><span class="string">xsetroot -solid grey</span></span><br><span class="line"><span class="string">vncconfig -iconic &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gnome-session --builtin --session=gnome-flashback-metacity --disable-acceleration-check --debug &amp;</span></span><br><span class="line"><span class="string">nautilus &amp;</span></span><br><span class="line"><span class="string">gnome-terminal &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ vncserver -localhost no -geometry 1440x900 -SecurityTypes=VeNCrypt,TLSVnc</span></span><br><span class="line"><span class="string">$ vncserver -geometry 1440x900 -SecurityTypes=VeNCrypt,TLSVnc</span></span><br><span class="line"><span class="string">$  vncviewer -SecurityTypes=VeNCrypt,TLSVnc 192.168.1.45:1</span></span><br><span class="line"><span class="string">$ vncserver -kill :1</span></span><br><span class="line"><span class="string">$ chmod +x ~/.vnc/xstartup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ssh -L 59000:localhost:5901 -C -N -l $username $your_server_ip</span></span><br><span class="line"><span class="string">-L 59000:localhost:5901: The -L switch specifies that the given port on the local computer (59000) is to be forwarded to the given host and port on the destination server (localhost:5901, meaning port 5901 on the destination server, defined as your_server_ip). Note that the local port you specify is somewhat arbitrary; as long as the port isnt already bound to another service, you can use it as the forwarding port for your tunnel.</span></span><br></pre></td></tr></table></figure>

<h4 id="ubuntu-shutdown-slow"><a href="#ubuntu-shutdown-slow" class="headerlink" title="ubuntu shutdown slow"></a>ubuntu shutdown slow</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/systemd/system.conf</span><br><span class="line">DefaultTimeoutStartSec=10s</span><br><span class="line">DefaultTimeoutStopSec=5s</span><br><span class="line"></span><br><span class="line">$ sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<h3 id="RHEL"><a href="#RHEL" class="headerlink" title="RHEL"></a>RHEL</h3><h4 id="verify-packages"><a href="#verify-packages" class="headerlink" title="verify-packages"></a><a target="_blank" rel="noopener" href="https://www.redhat.com/sysadmin/rpm-gpg-verify-packages">verify-packages</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -K epel-release-latest-8.noarch.rpm </span><br><span class="line">epel-release-latest-8.noarch.rpm: digests SIGNATURES NOT OK</span><br><span class="line"></span><br><span class="line">$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8 </span><br><span class="line"></span><br><span class="line">$ rpm -qa gpg-pubkey*</span><br><span class="line">gpg-pubkey-3abb34f8-5ffd890e</span><br><span class="line"></span><br><span class="line">$ rpm -qi  gpg-pubkey-3abb34f8-5ffd890e</span><br><span class="line">Name        : gpg-pubkey</span><br><span class="line">Version     : 3abb34f8</span><br><span class="line">Release     : 5ffd890e</span><br><span class="line">Architecture: (none)</span><br><span class="line">Install Date: Mon 16 Jan 2023 02:48:05 PM CST</span><br><span class="line">Group       : Public Keys</span><br><span class="line">Size        : 0</span><br><span class="line">License     : pubkey</span><br><span class="line">Signature   : (none)</span><br><span class="line">Source RPM  : (none)</span><br><span class="line">Build Date  : Tue 12 Jan 2021 07:33:34 PM CST</span><br><span class="line">Build Host  : localhost</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : AlmaLinux &lt;packager@almalinux.org&gt;</span><br><span class="line">Summary     : gpg(AlmaLinux &lt;packager@almalinux.org&gt;)</span><br><span class="line">Description :</span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">Version: rpm-4.14.3 (NSS-3)</span><br><span class="line">......</span><br><span class="line">i0oLUChIYKDvVBGqgmIor6YgenNSSZni3rj+RRA3gQom7jyVrQPgUv7lsv/MLCmg</span><br><span class="line">Ogpibxs3+SDbbZ6tP0D8uxdRnB4NVeENewlqw/ImacgjLtjBHaq+BebjWErIAkdX</span><br><span class="line">VnjWoLdZoV3B4ComKsjFNf7sfbzV/T2Xpg/r/u1WkiSjvD0mkSZ+3seDjd6oL20s</span><br><span class="line">p7jGLnSGZqGsUksJym0tWRvuyspgTELZlcjuMfHKuKmYudYFi+Y48+YsdJ7UetNT</span><br><span class="line">kAIBinjtZwEEAP4GumNNy7f4l4tt1CBy1EgoYtYCcJC5SGyhWMee3L3hLhHe7Iwd</span><br><span class="line">72EHtteVBoVn0eg6</span><br><span class="line">=rEWJ</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line"><span class="comment">#Prepare to sign a package</span></span><br><span class="line">$ gpg --keyring /shared/rpm/.gpg --no-default-keyring --full-gen-key </span><br><span class="line">$ sudo yum install rpm-sign</span><br><span class="line">$ rpmsign --addsign my-custom-package.rpm </span><br><span class="line">You must <span class="built_in">set</span> <span class="string">&quot;%_gpg_name&quot;</span> <span class="keyword">in</span> your macro filea</span><br><span class="line"></span><br><span class="line"><span class="comment">#the --addsign and --resign commands are interchangeable. Both will replace the signature portion of an RPM package file with current information.</span></span><br><span class="line">$ rpmsign --addsign myprod-2.x86_64.rpm myprod-libs-2.x86_64.rpm</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Get-almalinux-src-rpm"><a href="#Get-almalinux-src-rpm" class="headerlink" title="Get almalinux src rpm"></a>Get almalinux src rpm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--exclude=<span class="string">&quot;.*&quot;</span> <span class="comment">#rsync exclude dot file</span></span><br><span class="line">--exclude=<span class="string">&quot;.*/&quot;</span> <span class="comment">#rsync exclude dot dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rsync almalinux</span></span><br><span class="line">$ rsync -avzP --exclude Source --exclude aarch64 --exclude s390x --exclude ppc64le --delete rsync://mirrors.nju.edu.cn/almalinux/8.7 ./almalinux</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#download src rpm from source dir el8 and el9</span></span><br><span class="line">$ wget  https://repo.almalinux.org/vault/9.1/AppStream/Source/Packages/qemu-kvm-7.0.0-13.el9.src.rpm</span><br><span class="line">$ wget http://repo.almalinux.org/vault/8.7/BaseOS/Source/Packages/kernel-4.18.0-425.3.1.el8.src.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#download debuginfo </span></span><br><span class="line">$ wget -A rpm -r -l 2 --exclude-directories=Source --exclude-directories=aarch64 --exclude-directories=s390x --<span class="built_in">timeout</span> 3600 http://repo.almalinux.org/vault/8.7/AppStream/debug/x86_64/Packages -P . </span><br><span class="line">$ wget -A rpm -r -l 2 --exclude-directories=Source --exclude-directories=aarch64 --exclude-directories=s390x --<span class="built_in">timeout</span> 3600 http://repo.almalinux.org/vault/8.7/PowerTools/debug/x86_64/Packages -P .</span><br><span class="line">$ wget -A rpm -r -l 2 --exclude-directories=Source --exclude-directories=aarch64 --exclude-directories=s390x --<span class="built_in">timeout</span> 3600 http://repo.almalinux.org/vault/8.7/BaseOS/debug/x86_64/Packages -P .</span><br></pre></td></tr></table></figure>

<h4 id="UDP-port-detect"><a href="#UDP-port-detect" class="headerlink" title="UDP port detect"></a>UDP port detect</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nc -vuz 1.1.1.1 5555</span><br><span class="line">Connection to 1.1.1.1 5555 port [udp/isakmp] succeeded!</span><br></pre></td></tr></table></figure>

<h4 id="Let-selinux-to-permissive-mode"><a href="#Let-selinux-to-permissive-mode" class="headerlink" title="Let selinux to permissive mode"></a>Let selinux to permissive mode</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ setenforce 0</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; /sys/fs/selinux/enforce</span><br><span class="line">or</span><br><span class="line">$ sed -i <span class="string">&#x27;s/enforcing/disabled/g&#x27;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line">$ sestatus</span><br><span class="line">SELinux status:                 enabled</span><br><span class="line">SELinuxfs mount:                /sys/fs/selinux</span><br><span class="line">SELinux root directory:         /etc/selinux</span><br><span class="line">Loaded policy name:             targeted</span><br><span class="line">Current mode:                   permissive</span><br><span class="line">Mode from config file:          permissive</span><br><span class="line">Policy MLS status:              enabled</span><br><span class="line">Policy deny_unknown status:     allowed</span><br><span class="line">Max kernel policy version:      31</span><br><span class="line"></span><br><span class="line">$ setroubleshoot</span><br></pre></td></tr></table></figure>

<h4 id="Audit"><a href="#Audit" class="headerlink" title="Audit"></a>Audit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">$ auditctl -e 0</span><br><span class="line">performance degraded https://access.redhat.com/solutions/666333</span><br><span class="line">  - P:rhel 7.7 / Intel(R) Core(TM) i7-4790 CPU @ 3.60GHz - SSD</span><br><span class="line">    elapsed 0.6  user 0.4  sys 0.2  CPU 104.33 - no audit rule</span><br><span class="line">    elapsed 4.4  user 0.5  sys 0.4  CPU 20.90  - audit rule</span><br><span class="line"></span><br><span class="line">  - P:rhel 7.7  / Intel(R) Core(TM) i7-3740QM CPU @ 2.70GHz - Spinning disk, HDD</span><br><span class="line">    elapsed 0.7  user 0.4  sys 0.2  CPU 100.65</span><br><span class="line">    elapsed 39.5  user 0.5  sys 0.4  CPU 2.66 - audit rule</span><br><span class="line"></span><br><span class="line"><span class="comment">#show info</span></span><br><span class="line">$ auditctl -s</span><br><span class="line">enabled 0     <span class="comment"># &lt;----- this means that auditd logging is disabled</span></span><br><span class="line">failure 1</span><br><span class="line">pid 478</span><br><span class="line">rate_limit 0</span><br><span class="line">backlog_limit 64</span><br><span class="line">lost 0</span><br><span class="line">backlog 0</span><br><span class="line">loginuid_immutable 0 unlocked</span><br><span class="line"></span><br><span class="line"><span class="comment">## /etc/audit/auditd.conf</span></span><br><span class="line">$ systemctl start auditd</span><br><span class="line">$ auditctl -b 8192 <span class="comment">#buff</span></span><br><span class="line">$ auditctl -f 2 <span class="comment"># Set  failure  mode  0=silent 1=printk 2=panic. This option lets you determine how you want the kernel to handle critical errors</span></span><br><span class="line">$ auditctl -r 0 <span class="comment"># not limit speed</span></span><br><span class="line">$ auditctl -e 2 <span class="comment"># Set enabled flag. When 0 is passed, this can be used to temporarily disable auditing. When 1 is passed as an argument, it will enable auditing.  To  lock the  audit  configuration  so  that  it  can&#x27;t  be  changed,  pass  a  2 as the argument</span></span><br><span class="line">$ auditctl -s <span class="comment"># Report  the  kernel&#x27;s  audit  subsystem status</span></span><br><span class="line">$ auditctl -l <span class="comment"># list rule</span></span><br><span class="line">$ auditctl -D <span class="comment"># del all policy</span></span><br><span class="line">$ auditctl -w path_to_file -p permissions -k key_name</span><br><span class="line"><span class="comment">#&quot;a&quot; means change the dir/file attribute, the others same with r w x</span></span><br><span class="line">$ auditctl -w /etc/passwd -p wa -k passwd_changes</span><br><span class="line">$ auditctl -w /etc/selinux/ -p wa -k selinux_changes</span><br><span class="line">$ auditctl -w /sbin/insmod -p x -k module_insertion</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S adjtimex -S settimeofday -k time_change</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -S <span class="built_in">unlink</span> -S unlinkat -S rename -S renameat -F auid&gt;=500 -F auid!=4294967295 -k delete</span><br><span class="line">$ auditctl -a always,<span class="built_in">exit</span> -F path=/etc/shadow -F perm=wa</span><br><span class="line">$ auditctl -R /usr/share/doc/audit-version/stig.rules <span class="comment"># Read rules from a file</span></span><br><span class="line"></span><br><span class="line">$ auditctl -w /etc/ssh/sshd_config -p warx -k sshd_config</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> audit.log</span><br><span class="line"><span class="built_in">type</span>=SYSCALL msg=audit(1364481363.243:24287): <span class="built_in">arch</span>=c000003e syscall=2 success=no <span class="built_in">exit</span>=-13 a0=7fffd19c5592 a1=0 a2=7fffd19c4b50 a3=a items=1 ppid=2686 pid=3538 auid=500 uid=500 gid=500 euid=500 suid=500 fsuid=500 egid=500 sgid=500 fsgid=500 <span class="built_in">tty</span>=pts0 ses=1 <span class="built_in">comm</span>=<span class="string">&quot;cat&quot;</span> exe=<span class="string">&quot;/bin/cat&quot;</span> subj=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 key=<span class="string">&quot;sshd_config&quot;</span></span><br><span class="line"><span class="built_in">type</span>=CWD msg=audit(1364481363.243:24287):  cwd=<span class="string">&quot;/home/shadowman&quot;</span></span><br><span class="line"><span class="built_in">type</span>=PATH msg=audit(1364481363.243:24287): item=0 name=<span class="string">&quot;/etc/ssh/sshd_config&quot;</span> inode=409248 dev=fd:00 mode=0100600 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:etc_t:s0</span><br><span class="line"></span><br><span class="line"><span class="comment">#may be the ausearch is not a good choice</span></span><br></pre></td></tr></table></figure>

<h4 id="rsync-debug"><a href="#rsync-debug" class="headerlink" title="rsync debug"></a>rsync debug</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -h --debug=help</span><br><span class="line"></span><br><span class="line">Use OPT or OPT1 for level 1 output, OPT2 for level 2, etc.; OPT0 silences.</span><br><span class="line"></span><br><span class="line">ACL        Debug extra ACL info</span><br><span class="line">BACKUP     Debug backup actions (levels 1-2)</span><br><span class="line">BIND       Debug socket bind actions</span><br><span class="line">CHDIR      Debug when the current directory changes</span><br><span class="line">CONNECT    Debug connection events (levels 1-2)</span><br><span class="line">CMD        Debug commands+options that are issued (levels 1-2)</span><br><span class="line">DEL        Debug delete actions (levels 1-3)</span><br><span class="line">DELTASUM   Debug delta-transfer checksumming (levels 1-4)</span><br><span class="line">DUP        Debug weeding of duplicate names</span><br><span class="line">EXIT       Debug exit events (levels 1-3)</span><br><span class="line">FILTER     Debug filter actions (levels 1-2)</span><br><span class="line">FLIST      Debug file-list operations (levels 1-4)</span><br><span class="line">FUZZY      Debug fuzzy scoring (levels 1-2)</span><br><span class="line">GENR       Debug generator functions</span><br><span class="line">HASH       Debug hashtable code</span><br><span class="line">HLINK      Debug hard-link actions (levels 1-3)</span><br><span class="line">ICONV      Debug iconv character conversions (levels 1-2)</span><br><span class="line">IO         Debug I/O routines (levels 1-4)</span><br><span class="line">OWN        Debug ownership changes in users &amp; groups (levels 1-2)</span><br><span class="line">PROTO      Debug protocol information</span><br><span class="line">RECV       Debug receiver functions</span><br><span class="line">SEND       Debug sender functions</span><br><span class="line">TIME       Debug setting of modified times (levels 1-2)</span><br><span class="line"></span><br><span class="line">ALL        Set all --debug options (e.g. all4)</span><br><span class="line">NONE       Silence all --debug options (same as all0)</span><br><span class="line">HELP       Output this help message</span><br><span class="line"></span><br><span class="line">Options added for each increase in verbose level:</span><br><span class="line">2) BIND,CONNECT,CMD,DEL,DELTASUM,DUP,FILTER,FLIST,ICONV</span><br><span class="line">3) ACL,BACKUP,CONNECT2,DEL2,DELTASUM2,EXIT,FILTER2,FLIST2,FUZZY,GENR,OWN,RECV,SEND,TIME</span><br><span class="line">4) CMD2,DEL3,DELTASUM3,EXIT2,FLIST3,ICONV2,OWN2,PROTO,TIME2</span><br><span class="line">5) CHDIR,DELTASUM4,FLIST4,FUZZY2,HASH,HLINK</span><br></pre></td></tr></table></figure>

<h4 id="chrome-enable-dns-over-https"><a href="#chrome-enable-dns-over-https" class="headerlink" title="chrome enable dns over https"></a>chrome enable dns over https</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome://flags/#dns-over-https</span><br></pre></td></tr></table></figure>

<h4 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ traceroute -q 1 -m 16 12.34.56.78 <span class="comment"># avoid linux kernel peer limit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default hop = 30, increase to 255</span></span><br><span class="line">$ traceroute -m 255 <span class="variable">$your_domain</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set the package size</span></span><br><span class="line">$ traceroute <span class="variable">$your_domian</span> 70</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the number of probe packets per hop. The default is 3.</span></span><br><span class="line">$ traceroute -q1 <span class="variable">$your_domian</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#If your traceroute dissolves into some asterisks (*), there is a problem with the route to the host</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mtr local random port to detect,  maybe cause the different tcp path in the network</span></span><br><span class="line">$ mtr -c 50 -i 0.2 -rw 12.34.56.78</span><br><span class="line">$ mtr --report www.xxx.com</span><br><span class="line">$ mtr --tcp --port 80 --report --report-cycle 10 www.xxx.com</span><br><span class="line"></span><br><span class="line">https://www.ibm.com/support/knowledgecenter/TI0003M/p8hcg/p8hcg_traceroute.htm</span><br><span class="line">!H</span><br><span class="line">Host unreachable</span><br><span class="line">!N</span><br><span class="line">Network unreachable</span><br><span class="line">!P</span><br><span class="line">Protocol unreachable</span><br><span class="line">!S</span><br><span class="line">Source route failed</span><br><span class="line">!F</span><br><span class="line">Fragmentation needed</span><br></pre></td></tr></table></figure>

<h4 id="mapping-file-to-loop-dev"><a href="#mapping-file-to-loop-dev" class="headerlink" title="mapping file to loop dev"></a>mapping file to loop dev</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">##### mapping file to loop dev</span></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># 4K losetup</span></span><br><span class="line"><span class="comment"># losetup --sector-size 4096 -P --show -f disk.20T.img</span></span><br><span class="line">/dev/loop18</span><br><span class="line"><span class="comment"># blockdev --getss --getpbsz /dev/loop18</span></span><br><span class="line">4096</span><br><span class="line">4096</span><br><span class="line"></span><br><span class="line"><span class="comment">#align check</span></span><br><span class="line">(parted) align-check optimal 1</span><br><span class="line"></span><br><span class="line">$ losetup /dev/loop0 /opt/test_file</span><br><span class="line">$ losetup -D <span class="comment">## remove all loop dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get the partition</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1M count=0 seek=9600000 of=tempfile-sdb</span><br><span class="line">$ losetup -P -f tempfile-sdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=block-1 bs=1M count=5120</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=block-1 bs=1M count=0 seek=5120</span><br><span class="line"></span><br><span class="line">$ losetup -P /dev/loop0 /test/block-1</span><br><span class="line"></span><br><span class="line">$ parted /dev/loop0</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/loop0</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">&#x27;help&#x27;</span> to view a list of commands.</span><br><span class="line">(parted) mkpart</span><br><span class="line">Error: /dev/loop0: unrecognised disk label</span><br><span class="line">(parted) mklabel</span><br><span class="line">New disk label <span class="built_in">type</span>? gpt</span><br><span class="line">(parted) mkpart</span><br><span class="line">Partition name?  []?</span><br><span class="line">File system <span class="built_in">type</span>?  [ext2]? ext4</span><br><span class="line">Start? 2048s</span><br><span class="line">End? 100%</span><br><span class="line"></span><br><span class="line">$ mkfs.ext4 /dev/loop0p1</span><br><span class="line"></span><br><span class="line">$ parted /dev/loop0</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/loop0</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">&#x27;help&#x27;</span> to view a list of commands.</span><br><span class="line">(parted) unit s</span><br><span class="line">(parted) p</span><br><span class="line">Model: Loopback device (loopback)</span><br><span class="line">Disk /dev/loop0: 10485760s</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End        Size       File system  Name  Flags</span><br><span class="line"> 1      2048s  10483711s  10481664s  ext4         p1</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">10483711</span>-<span class="number">2047</span>))</span><br><span class="line">10481664</span><br><span class="line">[root@test2-1gbe ~]<span class="comment"># dmsetup create base &lt;&lt;EOF</span></span><br><span class="line">&gt; 0 10481664 linear /dev/loop0 2048</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">$ mount /dev/mapper/base /mnt</span><br><span class="line">$ <span class="built_in">df</span> -h /mnt</span><br><span class="line">Filesystem        Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/base  4.8G  793M  3.8G  18% /mnt</span><br><span class="line"></span><br><span class="line">$ umount /mnt</span><br><span class="line">$ losetup /dev/loop1 /test/block-2</span><br><span class="line">$ blockdev --getsz /dev/loop1</span><br><span class="line">$ dmsetup create mysnap --table <span class="string">&#x27;0 10481664 snapshot /dev/loop0p1 /dev/loop1p1 P 8&#x27;</span></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ blockdev --getsz /dev/loop0p1</span><br><span class="line">10481664</span><br><span class="line">$ <span class="built_in">echo</span> 0 $(blockdev --getsz /dev/loop0p1) snapshot /dev/loop0p1 /dev/loop1p1 P 8 | dmsetup create mysnap</span><br><span class="line"></span><br><span class="line">$ mount /dev/mapper/mysnap /mnt</span><br><span class="line">$ <span class="built_in">df</span> -h /mnt</span><br><span class="line">Filesystem          Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/mysnap  4.8G  793M  3.8G  18% /mnt</span><br><span class="line"></span><br><span class="line">$ dmsetup table mysnap</span><br><span class="line">$ dmsetup status mysnap</span><br><span class="line">$ dmsetup <span class="built_in">suspend</span> mysnap</span><br><span class="line">$ dmsetup table mysnap_dup | dmsetup load mysnap</span><br><span class="line">$ msetup resume mysnap</span><br><span class="line"></span><br><span class="line">https://blog.oddbit.com/post/2018-01-25-fun-with-devicemapper-snapshot/</span><br></pre></td></tr></table></figure>

<h4 id="export-tcmalloc"><a href="#export-tcmalloc" class="headerlink" title="export tcmalloc"></a>export tcmalloc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install gperftools-libs</span><br><span class="line">$ <span class="built_in">export</span> LD_PRELOAD=/usr/lib64/libtcmalloc.so.4</span><br></pre></td></tr></table></figure>

<h4 id="vi-paste-not-auto-inherit-the-file-type"><a href="#vi-paste-not-auto-inherit-the-file-type" class="headerlink" title="vi paste not auto inherit the file type"></a>vi paste not auto inherit the file type</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:set paste</span><br><span class="line">:set nopaste</span><br><span class="line"></span><br><span class="line">$ export TERM=xterm-256color</span><br><span class="line">$ export TERM=screen-256color</span><br></pre></td></tr></table></figure>

<h4 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ echo -e &#x27;Defaults !requiretty\nnobody ALL=(ALL) NOPASSWD: /usr/sbin/&#x27; | sudo EDITOR=&#x27;tee -a&#x27; visudo</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ echo -e &#x27;Defaults !requiretty\nnobody ALL=(ALL) NOPASSWD: /usr/sbin/&#x27; &gt; /etc/sudoers.d/nrpe</span><br><span class="line">$ visudo -c -f /etc/sudoers.d/nobody</span><br></pre></td></tr></table></figure>

<h5 id="NRPE-config"><a href="#NRPE-config" class="headerlink" title="NRPE config"></a>NRPE config</h5><ul>
<li>NRPE server<ul>
<li>nagios.cfg<ul>
<li>service_check_timeout&#x3D;300</li>
</ul>
</li>
<li>objects&#x2F;commands.cfg<ul>
<li>-t 300<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define command&#123;</span><br><span class="line">        command_name    check_nrpe</span><br><span class="line">        command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$ -t 300</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>NRPE client<ul>
<li>nrpe.cfg<ul>
<li>command_timeout&#x3D;300</li>
<li>connection_timeout&#x3D;300</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="printk-messages"><a href="#printk-messages" class="headerlink" title="printk messages"></a>printk messages</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="meta"># linux/kernel.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_EMERG <span class="string">&quot;&lt;0&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_ALERT <span class="string">&quot;&lt;1&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_CRIT <span class="string">&quot;&lt;2&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_ERR <span class="string">&quot;&lt;3&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_WARNING <span class="string">&quot;&lt;4&gt;&quot;</span> <span class="comment">//default level</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_NOTICE <span class="string">&quot;&lt;5&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_INFO <span class="string">&quot;&lt;6&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_DEBUG <span class="string">&quot;&lt;7&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line">#<span class="meta"># <span class="keyword">define</span> in kernel/printk.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KERN_DEFAULT <span class="string">&quot;&lt;d&gt;&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>DEFAULT_MESSAGE_LOGLEVEL   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/kernel/printk</span><br><span class="line">4(console level) 4(default) 1 7</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">kernel.printk = 4 4 1 7</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify the console log level</span></span><br><span class="line">$ <span class="built_in">echo</span> 5 &gt; /proc/sys/kernel/printk</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">echo</span> 8 &gt; /proc/sys/kernel/printk</span><br><span class="line"></span><br><span class="line"><span class="comment">## Some warning messages are rate limited. printk_ratelimit specifies the minimum length of time between these messages (in jiffies), by default we allow one every 5 seconds</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/printk_ratelimit</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line"><span class="comment">## While long term we enforce one message per printk_ratelimit seconds, we do allow a burst of messages to pass through</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/printk_ratelimit_burst</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#set the log level</span></span><br><span class="line">$ dmesg -n 5</span><br><span class="line">$ dmesg --follow</span><br><span class="line">$ <span class="built_in">echo</span> Some message &gt; /dev/kmsg <span class="comment">## write log to dmesg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The four values <span class="keyword">in</span> printk denote: console_loglevel, default_message_loglevel, minimum_console_loglevel and default_console_loglevel respectively.</span><br><span class="line">console_loglevel: messages with a higher priority than this will be printed to the console</span><br><span class="line">default_message_loglevel: messages without an explicit priority will be printed with this priority</span><br><span class="line">minimum_console_loglevel: minimum (highest) value to <span class="built_in">which</span> console_loglevel can be <span class="built_in">set</span></span><br><span class="line">default_console_loglevel: default value <span class="keyword">for</span> console_loglevel</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;0&quot;</span> → Emergency messages, system is about to crash or is unstable pr_emerg</span><br><span class="line"><span class="string">&quot;1&quot;</span> → Something bad happened and action must be taken immediately pr_alert</span><br><span class="line"><span class="string">&quot;2&quot;</span> → A critical condition occurred like a serious hardware/software failure pr_crit</span><br><span class="line"><span class="string">&quot;3&quot;</span> → An error condition, often used by drivers to indicate difficulties with the hardware pr_err</span><br><span class="line"><span class="string">&quot;4&quot;</span> → A warning, meaning nothing serious by itself but might indicate problems pr_warning</span><br><span class="line"><span class="string">&quot;5&quot;</span> → Nothing serious, but notably nevertheless. Often used to report security events. pr_notice</span><br><span class="line"><span class="string">&quot;6&quot;</span> → Informational message e.g. startup information at driver initialization pr_info</span><br><span class="line"><span class="string">&quot;7&quot;</span> → Debug messages pr_debug, pr_devel <span class="keyword">if</span> DEBUG is defined</span><br><span class="line">KERN_DEFAULT <span class="string">&quot;d&quot;</span> The default kernel loglevel</span><br><span class="line">KERN_CONT <span class="string">&quot;&quot;</span> <span class="string">&quot;continued&quot;</span> line of <span class="built_in">log</span> printout (only <span class="keyword">done</span> after a line that had no enclosing)</span><br></pre></td></tr></table></figure>

<p>centos 7.7 not report kenrel symbols   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/kptr_restrict</span><br></pre></td></tr></table></figure>

<h4 id="kill-sockets"><a href="#kill-sockets" class="headerlink" title="kill sockets"></a>kill sockets</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ss -K dst 192.168.1.214 dport = 49029</span><br><span class="line">       -K, --<span class="built_in">kill</span></span><br><span class="line">              Attempts to forcibly close sockets. This option displays sockets that are successfully closed and silently skips sockets that the kernel does not support closing. It sup‐</span><br><span class="line"></span><br><span class="line"><span class="comment">#create a socket file</span></span><br><span class="line">$ nc -lkU aSocket.sock</span><br><span class="line">or</span><br><span class="line">$ nc -lkU /dev/log</span><br></pre></td></tr></table></figure>

<h4 id="compress-by-xz"><a href="#compress-by-xz" class="headerlink" title="compress by xz"></a>compress by xz</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tar c <span class="variable">$dir</span> | pbzip2 -c &gt; <span class="variable">$&#123;dir&#125;</span>.tar.bz2</span><br><span class="line">$ tar cf - <span class="variable">$dir</span> | xz -T 8 &gt; <span class="variable">$&#123;dir&#125;</span>.tar.xz</span><br><span class="line"></span><br><span class="line">$ tar cf root.129.16.tar.bz2 --use-compress-prog=pbzip2 /root</span><br></pre></td></tr></table></figure>

<h4 id="systemd-limit"><a href="#systemd-limit" class="headerlink" title="systemd limit"></a>systemd limit</h4><h5 id="set-limit-by-systemd"><a href="#set-limit-by-systemd" class="headerlink" title="set limit by systemd"></a>set limit by systemd</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">$  <span class="built_in">cat</span> /proc/928119/limits</span><br><span class="line"></span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 379704</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 4096</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 379704</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line">Directive        <span class="built_in">ulimit</span> equivalent     Unit</span><br><span class="line">LimitCPU=        <span class="built_in">ulimit</span> -t             Seconds</span><br><span class="line">LimitFSIZE=      <span class="built_in">ulimit</span> -f             Bytes</span><br><span class="line">LimitDATA=       <span class="built_in">ulimit</span> -d             Bytes</span><br><span class="line">LimitSTACK=      <span class="built_in">ulimit</span> -s             Bytes</span><br><span class="line">LimitCORE=       <span class="built_in">ulimit</span> -c             Bytes</span><br><span class="line">LimitRSS=        <span class="built_in">ulimit</span> -m             Bytes</span><br><span class="line">LimitNOFILE=     <span class="built_in">ulimit</span> -n             Number of File Descriptors</span><br><span class="line">LimitAS=         <span class="built_in">ulimit</span> -v             Bytes</span><br><span class="line">LimitNPROC=      <span class="built_in">ulimit</span> -u             Number of Processes</span><br><span class="line">LimitMEMLOCK=    <span class="built_in">ulimit</span> -l             Bytes</span><br><span class="line">LimitLOCKS=      <span class="built_in">ulimit</span> -x             Number of Locks</span><br><span class="line">LimitSIGPENDING= <span class="built_in">ulimit</span> -i             Number of Queued Signals</span><br><span class="line">LimitMSGQUEUE=   <span class="built_in">ulimit</span> -q             Bytes</span><br><span class="line">LimitNICE=       <span class="built_in">ulimit</span> -e             Nice Level</span><br><span class="line">LimitRTPRIO=     <span class="built_in">ulimit</span> -r             Realtime Priority</span><br><span class="line">LimitRTTIME=     No equivalent</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">LimitNPROC=1048576</span><br><span class="line"></span><br><span class="line"><span class="comment">#custom service</span></span><br><span class="line">/etc/systemd/system/apm.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Local system resume actions</span><br><span class="line">After=suspend.target hybrid-sleep.target hibernate.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/hdparm -B 254 /dev/sda</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sleep.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -c unlimited</span><br><span class="line">-bash: <span class="built_in">ulimit</span>: core file size: cannot modify <span class="built_in">limit</span>: Operation not permitted</span><br><span class="line">$ <span class="built_in">ulimit</span> -Hc ; <span class="built_in">ulimit</span> -Sc</span><br><span class="line">unlimited</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -Sc 4000000</span><br><span class="line">$ <span class="built_in">ulimit</span> -Hc ; <span class="built_in">ulimit</span> -Sc</span><br><span class="line">unlimited</span><br><span class="line">4000000</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -Sc unlimited</span><br><span class="line">$ <span class="built_in">ulimit</span> -Hc ; <span class="built_in">ulimit</span> -Sc</span><br><span class="line">unlimited</span><br><span class="line">unlimited</span><br></pre></td></tr></table></figure>

<h4 id="custom-rc-local"><a href="#custom-rc-local" class="headerlink" title="custom rc-local"></a>custom rc-local</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/systemd/system/rc-local.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local Compatibility</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">TimeoutSec=60s</span><br><span class="line">StandardOutput=<span class="built_in">tty</span></span><br><span class="line">RemainAfterExit=<span class="built_in">yes</span></span><br><span class="line">SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;#!/bin/bash&quot; &gt; /etc/rc.local</span></span><br><span class="line"><span class="string">$ echo &quot;exit 0&quot; &gt; /etc/rc.local</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ sudo chmod +x /etc/rc.local</span></span><br><span class="line"><span class="string">$ sudo systemctl enable rc-local</span></span><br></pre></td></tr></table></figure>

<h4 id="Starting-udev-Kernel-Device-Manager"><a href="#Starting-udev-Kernel-Device-Manager" class="headerlink" title="Starting udev Kernel Device Manager"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6317011">Starting udev Kernel Device Manager</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[  OK  ] Stopped udev Kernel Device Manager.</span><br><span class="line">         Starting udev Kernel Device Manager...</span><br><span class="line">/etc/nsswitch.conf</span><br><span class="line">group:      sss nis files systemd</span><br><span class="line">group:      files sss nis systemd</span><br><span class="line"></span><br><span class="line">Add strace <span class="keyword">in</span> systemd-udevd.service unit file.</span><br><span class="line">ExecStart=/usr/bin/strace -fttTvyy -D -s 128 -- /usr/lib/systemd/systemd-udevd</span><br><span class="line"></span><br><span class="line">systemd[1]: systemd-udevd.service: start operation timed out. Terminating. &lt;&lt;&lt;----------- udev Kernel Device Manager timed out</span><br><span class="line">...</span><br><span class="line">strace[3429]: 10:59:07.333524 connect(10&lt;TCP:[70288]&gt;, &#123;sa_family=AF_INET, sin_port=htons(111), sin_addr=inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>)&#125;, 16) = ? ERESTARTSYS (To be restarted <span class="keyword">if</span> SA_RESTART is <span class="built_in">set</span>) &lt;89.931070&gt;</span><br><span class="line">...</span><br><span class="line">systemd[3435]: rpcbind.service: Executing: /usr/bin/rpcbind -w -f &lt;&lt;&lt;--------------------- RPC Bind starting</span><br></pre></td></tr></table></figure>

<h4 id="pipe-fifo"><a href="#pipe-fifo" class="headerlink" title="pipe, fifo"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8554568/add-a-big-buffer-to-a-pipe-between-two-commands">pipe, fifo</a></h4><p>dd modify pipe buffer block size  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ commandA | <span class="built_in">dd</span> status=none iflag=fullblock bs=1M | commandB</span><br><span class="line">$ process1 | mbuffer -m 1024M | process2</span><br><span class="line"></span><br><span class="line"><span class="comment">#F_SETPIPE_SZ F_GETPIPE_SZ</span></span><br><span class="line">$ <span class="built_in">echo</span> 104857600 &gt; /proc/sys/fs/pipe-max-size</span><br><span class="line">fs.pipe-max-size=104857600</span><br><span class="line"></span><br><span class="line"><span class="comment">#ulimit pipe size            (512 bytes, -p) 8 = 4096 bytes, it &#x27;s pipe buffer size in the ulimit, not pipe size</span></span><br><span class="line"><span class="comment">## POSIX.1-2001 says that write(2)s of less than PIPE_BUF  bytes  must  be atomic:  the  output  data  is  written  to  the  pipe  as a contiguous sequence.  Writes of more than PIPE_BUF bytes may  be  non-atomic:  the kernel  may  interleave the data with data written by other processes.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#here 2 tools for pipe</span></span><br><span class="line">$ pv - Pipe Viewer - is a terminal-based tool <span class="keyword">for</span> monitoring the progress of data through a pipeline.</span><br><span class="line">$ process1 | pv -pterbTCB 1G | process2</span><br><span class="line"></span><br><span class="line">$ pv -cN sources linux-image-unsigned-4.15.0-65-generic-dbgsym_4.15.0-65.74_amd64.ddeb | <span class="built_in">dd</span> of=/tmp/tmp bs=512 | pv -cN <span class="built_in">cat</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkfifo</span> -m 777 /tmp/lfs.log</span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## lfs 40MB log</span></span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.80.bin 80</span><br></pre></td></tr></table></figure>

<h4 id="RHEL-tuning"><a href="#RHEL-tuning" class="headerlink" title="RHEL tuning"></a><a target="_blank" rel="noopener" href="https://www.redhat.com/cms/managed-files/Handout%20Performance%20Analysis%20and%20Tuning%20Red%20Hat%20Enterprise%20Linux%202019.pdf">RHEL tuning</a></h4><h5 id="abrt-watch-log"><a href="#abrt-watch-log" class="headerlink" title="abrt-watch-log"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1424343">abrt-watch-log</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dnf install abrt-addon-kerneloops</span><br><span class="line">$ systemctl stop abrt-oops</span><br><span class="line">$ systemctl <span class="built_in">disable</span> abrt-oops</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>src&#x2F;plugins&#x2F;abrt-dump-oops.c<br>src&#x2F;lib&#x2F;kernel.c<br> 78 &#x2F;* In some comparisons, we skip 1st letter, to avoid dealing with<br> 79  * changes in capitalization in kernel. For example, I see that<br> 80  * current kernel git (at 2011-01-01) has both “kernel BUG at …”<br> 81  * and “Kernel BUG at …” messages, and I don’t want to change<br> 82  * the code below whenever kernel is changed to use “K” (or “k”)<br> 83  * uniformly.<br> 84  *&#x2F;<br> 85 static const char *const s_koops_suspicious_strings[] &#x3D; {<br> 86     “BUG:”,<br> 87     “WARNING: at”,<br> 88     “WARNING: CPU:”,<br> 89     “INFO: possible recursive locking detected”,<br> 90     &#x2F;<em>k</em>&#x2F;“ernel BUG at”,<br> 91     “list_del corruption”,<br> 92     “list_add corruption”,<br> 93     “do_IRQ: stack overflow:”,<br> 94     &#x2F;<em>n</em>&#x2F;“ear stack overflow (cur:”,<br> 95     &#x2F;<em>g</em>&#x2F;“eneral protection fault”,<br> 96     &#x2F;<em>u</em>&#x2F;“nable to handle kernel”,<br> 97     &#x2F;<em>d</em>&#x2F;“ouble fault:”,<br> 98     “RTNL: assertion failed”,<br> 99     &#x2F;<em>e</em>&#x2F;“eek! page_mapcount(page) went negative!”,<br>100     &#x2F;<em>b</em>&#x2F;“adness at”,<br>101     “NETDEV WATCHDOG”,<br>102     &#x2F;<em>s</em>&#x2F;“ysctl table check failed”,<br>103     “: nobody cared”,<br>104     “IRQ handler type mismatch”,<br>105     “Kernel panic - not syncing:”,<br> ….<br>134     “Machine Check Exception:”,<br>135     “Machine check events logged”,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ /usr/bin/abrt-dump-oops -m</span><br><span class="line">BUG:</span><br><span class="line">WARNING: at</span><br><span class="line">WARNING: CPU:</span><br><span class="line">INFO: possible recursive locking detected</span><br><span class="line">ernel BUG at</span><br><span class="line">list_del corruption</span><br><span class="line">list_add corruption</span><br><span class="line">do_IRQ: stack overflow:</span><br><span class="line">ear stack overflow (cur:</span><br><span class="line">eneral protection fault</span><br><span class="line">nable to handle kernel</span><br><span class="line">ouble fault:</span><br><span class="line">RTNL: assertion failed</span><br><span class="line">eek! page_mapcount(page) went negative!</span><br><span class="line">adness at</span><br><span class="line">NETDEV WATCHDOG</span><br><span class="line">ysctl table check failed</span><br><span class="line">: nobody cared</span><br><span class="line">IRQ handler type mismatch</span><br><span class="line">Kernel panic - not syncing:</span><br><span class="line">Machine Check Exception:</span><br><span class="line">Machine check events logged</span><br><span class="line">divide error:</span><br><span class="line">bounds:</span><br><span class="line">coprocessor segment overrun:</span><br><span class="line">invalid TSS:</span><br><span class="line">segment not present:</span><br><span class="line">invalid opcode</span><br><span class="line">alignment check:</span><br><span class="line">stack segment:</span><br><span class="line">fpu exception:</span><br><span class="line">simd exception:</span><br><span class="line">iret exception:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="tuned-adm"><a href="#tuned-adm" class="headerlink" title="tuned-adm"></a>tuned-adm</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..8&#125;; </span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">  <span class="built_in">echo</span> 192.168.0.<span class="variable">$i</span>;</span><br><span class="line">  scp tuned.service root@192.168.0.<span class="variable">$i</span>:/lib/systemd/system/tuned.service; </span><br><span class="line">  scp accelerator-performance      root@192.168.1.<span class="variable">$i</span>:/usr/lib/tuned/accelerator-performance/accelerator-performance</span><br><span class="line">  scp tuned.conf    root@192.168.1.<span class="variable">$i</span>:/usr/lib/tuned/accelerator-performance/tuned.conf ; </span><br><span class="line">  ssh -n 192.168.1.<span class="variable">$i</span> <span class="string">&quot;tuned-adm profile accelerator-performance&quot;</span>;  </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /lib/systemd/system/tuned.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Dynamic System Tuning Daemon</span><br><span class="line">After=systemd-sysctl.service network.target dbus.service NetworkManager.service</span><br><span class="line">Requires=dbus.service polkit.service</span><br><span class="line"><span class="comment">#Conflicts=cpupower.service auto-cpufreq.service tlp.service power-profiles-daemon.service</span></span><br><span class="line">Documentation=man:tuned(8) man:tuned.conf(5) man:tuned-adm(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=dbus</span><br><span class="line">PIDFile=/run/tuned/tuned.pid</span><br><span class="line">BusName=com.redhat.tuned</span><br><span class="line">ExecStart=/usr/sbin/tuned -l -P</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /usr/lib/tuned/accelerator-performance/tuned.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">sysctl -w kernel.unknown_nmi_panic = 1</span><br><span class="line">sysctl -w kernel.panic_on_unrecovered_nmi = 1</span><br><span class="line">sysctl -w kernel.panic_on_io_nmi = 1</span><br><span class="line">sysctl -w kernel.nmi_watchdog = 0</span><br><span class="line">sysctl -w dev.raid.speed_limit_max=8000000</span><br><span class="line">sysctl -w dev.raid.speed_limit_min=2000000</span><br><span class="line">sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=30000000</span><br><span class="line">sysctl -w net.ipv4.neigh.bond0.base_reachable_time_ms=30000000</span><br><span class="line">sysctl -w net.ipv4.tcp_slow_start_after_idle=0</span><br><span class="line">sysctl -w net.ipv4.tcp_fastopen=3</span><br><span class="line">sysctl -w net.core.netdev_max_backlog=4096</span><br><span class="line">sysctl -w net.core.somaxconn=4096</span><br><span class="line">sysctl -w net.core.dev_weight=128</span><br><span class="line">sysctl -w net.core.netdev_budget=600</span><br><span class="line">sysctl -w net.core.flow_limit_table_len=16384</span><br><span class="line">sysctl -w vm.min_free_kbytes=300000</span><br><span class="line">sysctl -w net.core.default_qdisc=fq</span><br><span class="line">sysctl -w net.ipv4.tcp_congestion_control=bbr</span><br><span class="line">modprobe lnet accept_backlog=1024 accept_timeout=15 lnet_retry_count=6 lnet_transaction_timeout=120 networks=tcp\(bond0\)</span><br><span class="line">modprobe ksocklnd credits=512 peer_credits=16</span><br><span class="line">modprobe ptlrpc at_early_margin=16 ldlm_enqueue_min=240 at_max=320 at_min=50</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /usr/lib/tuned/accelerator-performance/tuned.conf | grep -v \<span class="comment">#</span></span><br><span class="line">[main]</span><br><span class="line">summary=Throughput performance based tuning with disabled higher latency STOP states</span><br><span class="line"></span><br><span class="line">[cpu]</span><br><span class="line">governor=performance</span><br><span class="line">energy_perf_bias=performance</span><br><span class="line">min_perf_pct=100</span><br><span class="line">force_latency=99</span><br><span class="line"></span><br><span class="line">[vm]</span><br><span class="line">transparent_hugepages=always</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[sysctl]</span><br><span class="line">vm.dirty_ratio = 40</span><br><span class="line"></span><br><span class="line">vm.dirty_background_ratio = 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vm.swappiness=10</span><br><span class="line">net.core.default_qdisc=fq</span><br><span class="line">net.ipv4.tcp_congestion_control=bbr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[scheduler]</span><br><span class="line">sched_min_granularity_ns = 10000000</span><br><span class="line"></span><br><span class="line">sched_wakeup_granularity_ns = 15000000</span><br><span class="line"></span><br><span class="line">[script]</span><br><span class="line">script=/usr/lib/tuned/accelerator-performance/tuned.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># default config files</span></span><br><span class="line">$ <span class="built_in">ls</span> /usr/lib/tuned</span><br><span class="line">balanced  desktop  <span class="built_in">functions</span>  latency-performance  network-latency  network-throughput  powersave  recommend.d  throughput-performance  virtual-guest  virtual-host</span><br><span class="line"></span><br><span class="line">$ tuned-adm list</span><br><span class="line">$ tuned-adm profile network-throughput</span><br><span class="line">$ tuned-adm profile accelerator-performance</span><br><span class="line">$ tuned-adm active</span><br><span class="line"></span><br><span class="line">$ /etc/tuned/my-variables.conf</span><br><span class="line"></span><br><span class="line">[variables]</span><br><span class="line">include=/etc/tuned/my-variables.conf</span><br><span class="line"></span><br><span class="line">[bootloader]</span><br><span class="line"><span class="comment"># Isolated CPUs with the kernels scheduler load balancing:</span></span><br><span class="line">cmdline=isolcpus=0,1,2,3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolated CPUs without the kernels scheduler load balancing</span></span><br><span class="line">cmdline=no_balance_cores=0,1,2,3</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify default mode</span></span><br><span class="line">$ vi /usr/lib/tuned/accelerator-performance/tuned.conf</span><br><span class="line">$ vi /usr/lib/tuned/accelerator-performance/tuned.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">modprobe lnet accept_backlog=1024 accept_timeout=15 lnet_retry_count=6 lnet_transaction_timeout=120 networks=tcp\(bond0\)</span><br><span class="line">modprobe ksocklnd credits=512 peer_credits=16</span><br><span class="line">modprobe ptlrpc at_early_margin=16 ldlm_enqueue_min=240 at_max=320 at_min=50</span><br><span class="line"></span><br><span class="line">$ tuned-adm profile accelerator-performance</span><br><span class="line">$ tuned-adm list</span><br><span class="line">$ tuned-adm active</span><br><span class="line">Current active profile: accelerator-performance</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /lib/systemd/system/tuned.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Dynamic System Tuning Daemon</span><br><span class="line"><span class="comment">#add NetworkManager.service</span></span><br><span class="line">After=systemd-sysctl.service network.target dbus.service NetworkManager.service</span><br><span class="line">Requires=dbus.service polkit.service</span><br><span class="line"><span class="comment">#disable conflicts</span></span><br><span class="line"><span class="comment">#Conflicts=cpupower.service auto-cpufreq.service tlp.service power-profiles-daemon.service</span></span><br><span class="line">Documentation=man:tuned(8) man:tuned.conf(5) man:tuned-adm(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=dbus</span><br><span class="line">PIDFile=/run/tuned/tuned.pid</span><br><span class="line">BusName=com.redhat.tuned</span><br><span class="line">ExecStart=/usr/sbin/tuned -l -P</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/177953">sched_min_granularity_ns</a><ul>
<li>specifies the target minimum scheduler period in which a single task will run. This tunable is used only when running load is high. Unlike sched_latency_ns, this tunable specifies the target period allocated for each task to run rather than the time in which all tasks should be run once.</li>
</ul>
</li>
<li>kernel.sched_wakeup_granularity_ns<ul>
<li>it gives preemption granularity when tasks wake up</li>
</ul>
</li>
<li>kernel.sched_min_granularity_ns<ul>
<li>sched_min_granularity_ns specifies the target minimum scheduler period in which a single task will run. This tunable is used only when running load is high. Unlike sched_latency_ns, this tunable specifies the target period allocated for each task to run rather than the time in which all tasks should be run once</li>
</ul>
</li>
<li>kernel.sched_child_runs_first<ul>
<li>This parameter controls whether process scheduled next after fork is the parent or child. If set to 0, the parent is scheduled next</li>
</ul>
</li>
<li>kernel.sched_latency_ns<ul>
<li>sched_latency_ns is the initial value for the scheduler period. The scheduler period is a period of time during which all runnable tasks should be allowed to run at least once. While CFS has no concept of time slices, you can think of the period as the initial chunk of time which is then divided evenly into timeslices, one for each runnable process. Note that this tunable only specifies the initial value. When too many tasks become runnable the scheduler will use kernel.sched_min_granularity_ns instead</li>
</ul>
</li>
<li>kernel.sched_shares_ratelimit<ul>
<li>This parameter is used for updating the group shares</li>
</ul>
</li>
<li>kernel.sched_tunable_scaling<ul>
<li>sched_tunable_scaling controls whether the scheduler can adjust sched_latency_ns. The values are 0 &#x3D; do not adjust, 1 &#x3D; logarithmic adjustment, and 2 &#x3D; linear adjustment. The adjustment made is based on the number of CPUs, and increases logarithmically or linearly as implied in the available values. This is due to the fact that with more CPUs there’s an apparent reduction in perceived latency.</li>
</ul>
</li>
<li>kernel.sched_migration_cost<ul>
<li>Amount of time after the last execution that a task is considered to be “cache hot” in migration decisions. A “hot” task is less likely to be migrated, so increasing this variable reduces task migrations. The default value is 500000 (ns). If the CPU idle time is higher than expected when there are runnable processes, try reducing this value. If tasks bounce between CPUs or nodes too often, try increasing it.</li>
</ul>
</li>
<li>kernel.sched_nr_migrate<ul>
<li>If a SCHED_OTHER task spawns a large number of other tasks, they will all run on the same CPU. The migration task or softirq will try to balance these tasks so they can run on idle CPUs. The sched_nr_migrate option can be set to specify the number of tasks that will move at a time.</li>
</ul>
</li>
<li>kernel.sched_shares_thresh<ul>
<li>It works to inject some fuzzyness into changing the per-cpu group shares. This avoids remote rq-locks at the expense of fairness.</li>
</ul>
</li>
<li>kernel.sched_features</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NO_GENTLE_FAIR_SLEEPERS = 1</span><br><span class="line">NO_START_DEBIT = 2</span><br><span class="line">NO_WAKEUP_PREEMPT = 4</span><br><span class="line">NO_AFFINE_WAKEUPS = 8</span><br><span class="line">NEXT_BUDDY = 16</span><br><span class="line">NO_LAST_BUDDY = 32</span><br><span class="line">NO_CACHE_HOT_BUDDY = 64</span><br><span class="line">ARCH_POWER = 128</span><br><span class="line">HRTICK = 256</span><br><span class="line">DOUBLE_TICK = 512</span><br><span class="line">NO_LB_BIAS = 1024</span><br><span class="line">NO_OWNER_SPIN = 2048</span><br></pre></td></tr></table></figure>
<ul>
<li>kernel.sched_time_avg<ul>
<li>sched_time_avg is a period of time over which the average real-time task CPU consumption is averaged. The resulting average is used to adjust CPU power for non-real-time tasks to ensure that real-time tasks don’t have to fight for CPU time.</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Throughput</span><br><span class="line">    Scheduler quantum (default 4/10 ms,-&gt; 10/15 ms)</span><br><span class="line">        kernel.sched_min_granularity_ns=10000000</span><br><span class="line">        kernel_sched_wakeup _granularity_ns = 15000000</span><br><span class="line">    Weight function on how often to migrate - 5ms -&gt; 50ms</span><br><span class="line">        kernel.sched_migration_cost_ns=50000000</span><br><span class="line">Latency</span><br><span class="line">    Decrease quantum above to 4 /10 ms</span><br><span class="line">        Adjust power management - BIOS OS controlled</span><br><span class="line">        pstates - governor=performance</span><br><span class="line">        energy_perf_bias=performance</span><br><span class="line">        cstate - force_latency=1</span><br><span class="line">    Disable scaning tools for better determinism</span><br><span class="line">        Disable numa balance</span><br><span class="line">        kernel.numa_balancing = 0</span><br><span class="line">        Disable Transparent HugePages</span><br><span class="line">        mm.redhat_transparent_hugepage never</span><br><span class="line">VM Tunables</span><br><span class="line">    Reclaim Ratios</span><br><span class="line">    vm.swappiness</span><br><span class="line">    vm.vfs_cache_pressure</span><br><span class="line">    vm.min_free_kbytes</span><br><span class="line">    Writeback Parameters 30/10 -&gt; 10/3</span><br><span class="line">        vm.dirty_background_ratio</span><br><span class="line">        vm.dirty_ratio</span><br><span class="line">    Readahead parameters per device 512-&gt; 4k</span><br><span class="line">        /sys/block//queue/read_ahead_kb</span><br><span class="line">NUMA hugepage</span><br><span class="line">    Auto numa balancing at scheduling time</span><br><span class="line">        kernel.numa_balancing = 1</span><br><span class="line">        Adjust numa scan interval 1000 ms -&gt; 100 ms</span><br><span class="line">        vm.zone_reclaim_mode = 1 (reclaim local node vs spill)</span><br><span class="line">    Transparent HugePages</span><br><span class="line">        mm.redhat_transparent_hugepage enabled</span><br></pre></td></tr></table></figure>
<p>latency-performance  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">force_latency=1</span><br><span class="line">governor=performance</span><br><span class="line">energy_perf_bias=performance</span><br><span class="line">min_perf_pct=100</span><br><span class="line">vm.dirty_ratio=10</span><br><span class="line">vm.dirty_background_ratio=3</span><br><span class="line">vm.swappiness=10</span><br><span class="line">kernel.sched_min_granularity_ns=10000000</span><br><span class="line">kernel.sched_migration_cost_ns=5000000</span><br><span class="line"></span><br><span class="line">## EPYC AMD setting recommand</span><br><span class="line">kernel.sched_migration_cost_ns=5000000</span><br><span class="line">kernel.sched_min_granularity_ns=10000000</span><br></pre></td></tr></table></figure>
<p>network-latency  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">force_latency=1</span><br><span class="line">governor=performance</span><br><span class="line">energy_perf_bias=performance</span><br><span class="line">min_perf_pct=100</span><br><span class="line">vm.dirty_ratio=10</span><br><span class="line">vm.dirty_background_ratio=3</span><br><span class="line">vm.swappiness=10</span><br><span class="line">kernel.sched_min_granularity_ns=10000000</span><br><span class="line">kernel.sched_migration_cost_ns=5000000</span><br></pre></td></tr></table></figure>


<ul>
<li>RHEL 8 - Database tuning tips Oracle 12c</li>
<li>Implement huge pages<ul>
<li>Reduce TLB misses</li>
<li>For wiring down database pages</li>
<li>Prevent swapping</li>
</ul>
</li>
<li>Turn off Auto numa<ul>
<li>To prevent conflict with Oracle NUMA optimization</li>
</ul>
</li>
<li>Turn of transparent huge pages<ul>
<li>To reduce CPU overhead of THP scan</li>
</ul>
</li>
<li>Lower dirty background ratio<ul>
<li>Start flushing dirty blocks and reclaim</li>
</ul>
</li>
<li>Increase dirty ratio<ul>
<li>Delay the process of hitting dirty blocks threshold</li>
</ul>
</li>
<li>Use numa pinning in multiple instance environments (including listener process)<ul>
<li>To take advantage of NUMA localization</li>
</ul>
</li>
<li>Size SGA based on user connections (or use connection pooling)<ul>
<li>To prevent memory pressure</li>
</ul>
</li>
</ul>
<h4 id="sync-time"><a href="#sync-time" class="headerlink" title="sync time"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/using-chrony_configuring-basic-system-settings">sync time</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#local server chronyd, the others sync this sever</span></span><br><span class="line">vi /etc/chrony.conf</span><br><span class="line"><span class="comment">#add</span></span><br><span class="line"><span class="built_in">local</span> stratum 8</span><br><span class="line">manual</span><br><span class="line">allow 192.168.1.0/24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#the others modify sync ip</span></span><br><span class="line">server 192.168.1.1 iburst</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/chrony.conf</span><br><span class="line">server 192.168.0.1 iburst</span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#manually config chrony config</span></span><br><span class="line">$ systemctl stop chronyd</span><br><span class="line">$ chronyd -q</span><br><span class="line">$ systemctl start chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">#manually</span></span><br><span class="line">$ systemctl stop chronyd</span><br><span class="line">$ chronyd -q <span class="string">&#x27;server 192.168.0.1 iburst&#x27;</span></span><br><span class="line">$ chronyc -a <span class="string">&#x27;burst 4/4&#x27;</span></span><br><span class="line">$ <span class="built_in">sleep</span> 10; chronyc -a makestep</span><br><span class="line">$ systemctl start chronyd</span><br><span class="line"></span><br><span class="line">$ ntpdate <span class="variable">$ipaddr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#after sync</span></span><br><span class="line">$ hwclock -w</span><br></pre></td></tr></table></figure>

<h4 id="CentOS-7-upgrade-to-AlamLinux-8"><a href="#CentOS-7-upgrade-to-AlamLinux-8" class="headerlink" title="CentOS 7 upgrade to AlamLinux 8"></a>CentOS 7 upgrade to AlamLinux 8</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#remove some python2 epel modules</span></span><br><span class="line"><span class="comment">#install python3</span></span><br><span class="line">$ yum install http://repo.almalinux.org/elevate/elevate-release-latest-el7.noarch.rpm</span><br><span class="line">$ yum install -y leapp-upgrade leapp-data-almalinux</span><br><span class="line">$ leapp preupgrade</span><br><span class="line"><span class="comment">#show the green result</span></span><br><span class="line"></span><br><span class="line">$ rmmod pata_acpi</span><br><span class="line">$ <span class="built_in">echo</span> PermitRootLogin <span class="built_in">yes</span> | sudo <span class="built_in">tee</span> -a /etc/ssh/sshd_config</span><br><span class="line">$ leapp answer --section remove_pam_pkcs11_module_check.confirm=True</span><br><span class="line">$ package-cleanup --oldkernels --count=1</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> -p /var/lib/leapp/el8userspace/sys/fs/selinux</span><br><span class="line">$ vi /usr/share/leapp-repository/repositories/system_upgrade/common/libraries/dnfplugin.py </span><br><span class="line">except CalledProcessError as e:</span><br><span class="line">            <span class="keyword">if</span> six.PY2:  &lt;-----------PY3, not PY2</span><br><span class="line">                e.stdout = e.stdout.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;xmlcharrefreplace&#x27;</span>)</span><br><span class="line">                e.stderr = e.stdout.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;xmlcharrefreplace&#x27;</span>)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> LEAPP_OVL_SIZE=3000</span><br><span class="line">$ leapp upgrade</span><br></pre></td></tr></table></figure>

<h4 id="Software-Collections-SCL-Repository"><a href="#Software-Collections-SCL-Repository" class="headerlink" title="Software Collections ( SCL ) Repository"></a>Software Collections ( SCL ) Repository</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> <span class="built_in">source</span> /opt/rh/gcc-toolset-11/enable</span><br><span class="line"></span><br><span class="line">$ yum install centos-release-scl-rh</span><br><span class="line">$ yum install devtoolset-9-toolchain</span><br><span class="line">$ scl <span class="built_in">enable</span> devtoolset-9 bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#el8</span></span><br><span class="line">$ dnf install gcc-toolset-14.x86_64</span><br><span class="line">$ scl <span class="built_in">enable</span> gcc-toolset-14 bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#el9</span></span><br><span class="line">$ dnf install gcc-toolset-14</span><br><span class="line"></span><br><span class="line"><span class="comment">#el9 init</span></span><br><span class="line">$ dnf install gcc make autoconf automake libtool rpm-build libtirpc-devel libblkid-devel libuuid-devel libudev-devel openssl-devel zlib-devel libaio-devel libattr-devel elfutils-libelf-devel kernel-devel-$(<span class="built_in">uname</span> -r) python3 python3-devel libuuid-devel libtirpc-devel perl lsof rsync attr libmount-devel bison flex kernel-abi-stablelists kernel-devel kernel-rpm-macros libnl3-devel libselinux-devel libtool libyaml-devel openmpi-devel rpm-build nfs-utils smartmontools sg3_utils net-tools libaio-devel libattr-devel libffi-devel libudev-devel python3-cffi python3-devel python3-packaging zstd bc fio ksh crash sdparm iotop iftop sysstat vim NetworkManager-initscripts-updown screen pv mpich cmake attr lsof perl rsync libarchive-devel</span><br><span class="line"></span><br><span class="line">$ gfortran --version | <span class="built_in">head</span> -2</span><br><span class="line">GNU Fortran (GCC) 4.8.5 20150623 (Red Hat 4.8.5-36)</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">$ scl <span class="built_in">enable</span> devtoolset-9 bash</span><br><span class="line"></span><br><span class="line">$  gfortran --version | <span class="built_in">head</span> -2</span><br><span class="line">GNU Fortran (GCC) 8.2.1 20180905 (Red Hat 8.2.1-3)</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">https://www.softwarecollections.org/en/scls/rhscl/rh-varnish6/</span><br><span class="line"><span class="comment"># 1. Install a package with repository for your system:</span></span><br><span class="line"><span class="comment"># On CentOS, install package centos-release-scl available in CentOS repository:</span></span><br><span class="line">$ sudo yum install centos-release-scl</span><br><span class="line"></span><br><span class="line"><span class="comment"># On RHEL, enable RHSCL repository for you system:</span></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> rhel-server-rhscl-7-rpms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Install the collection:</span></span><br><span class="line">$ sudo yum install rh-varnish6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Start using software collections:</span></span><br><span class="line">$ scl <span class="built_in">enable</span> rh-varnish6 bash</span><br><span class="line"></span><br><span class="line">In order to view the individual components included <span class="keyword">in</span> this collection, including additional subpackages, you can run:</span><br><span class="line"></span><br><span class="line">$ sudo yum list rh-varnish6\*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">On CentOS 7 and RHEL 7 you can pull the image with the following <span class="built_in">command</span>:</span><br><span class="line">$ docker pull rhscl/varnish-6-rhel7</span><br></pre></td></tr></table></figure>

<h4 id="Nofile"><a href="#Nofile" class="headerlink" title="Nofile"></a>Nofile</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/fs/file-max</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br></pre></td></tr></table></figure>
<p>file-max is the maximum File Descriptors (FD) enforced on a kernel level, which cannot be surpassed by all processes without increasing.<br>The ulimit is enforced on a process level, which can be less than the file-max.   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/fs/file-nr</span><br><span class="line">This will <span class="built_in">return</span> three values denote the number of allocated file handles the number of allocated but unused file handles, and the maximum number of file handles.</span><br></pre></td></tr></table></figure>

<h4 id="show-parent-pid"><a href="#show-parent-pid" class="headerlink" title="show parent pid"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/153976/how-do-i-get-the-parent-process-id-of-a-given-child-process">show parent pid</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ pstree -aps 2492183</span><br><span class="line">systemd,1 --switched-root --system --deserialize 17</span><br><span class="line">  └─lustrefs_export,407047 -p 9169</span><br><span class="line">      └─lctl,2492183 get_param memused memused_max lnet_memused health_check mdt/*/exports/*/uuid osd-*/*/filesfree osd-*/*/filestotal osd-*/*/fstype osd-*/*/kbytesavail osd-*/*/kbytesfree ...</span><br><span class="line"></span><br><span class="line">$ ps -efj | grep lctl</span><br><span class="line">root     2611443  407047  407047  407047  0 16:49 ?        00:00:00 lctl get_param memused memused_max lnet_memused health_check mdt/*/exports/*/uuid osd-*/*/filesfree osd-*/*/filestotal osd-*/*/fstype osd-*/*/kbytesavail osd-*/*/kbytesfree osd-*/*/kbytestotal osd-*/*/brw_stats osd-*/*/quota_slave/acct_group osd-*/*/quota_slave/acct_user osd-*/*/quota_slave/acct_project mgs/*/mgs/stats mgs/*/mgs/threads_max mgs/*/mgs/threads_min mgs/*/mgs/threads_started mgs/*/num_exports obdfilter/*OST*/job_stats obdfilter/*OST*/stats obdfilter/*OST*/num_exports obdfilter/*OST*/tot_dirty obdfilter/*OST*/tot_granted obdfilter/*OST*/tot_pending obdfilter/*OST*/exports/*/stats ost.OSS.ost.stats ost.OSS.ost_io.stats ost.OSS.ost_create.stats ost.OSS.ost_out.stats ost.OSS.ost_seq.stats mds.MDS.mdt.stats mds.MDS.mdt_fld.stats mds.MDS.mdt_io.stats mds.MDS.mdt_out.stats mds.MDS.mdt_readpage.stats mds.MDS.mdt_seqm.stats mds.MDS.mdt_seqs.stats mds.MDS.mdt_setattr.stats mdt.*.job_stats mdt.*.md_stats mdt.*MDT*.num_exports mdt.*MDT*.exports.*.stats ldlm.namespaces.&#123;mdt-,filter-&#125;*.contended_locks ldlm.namespaces.&#123;mdt-,filter-&#125;*.contention_seconds ldlm.namespaces.&#123;mdt-,filter-&#125;*.ctime_age_limit ldlm.namespaces.&#123;mdt-,filter-&#125;*.early_lock_cancel ldlm.namespaces.&#123;mdt-,filter-&#125;*.lock_count ldlm.namespaces.&#123;mdt-,filter-&#125;*.lock_timeouts ldlm.namespaces.&#123;mdt-,filter-&#125;*.lock_unused_count ldlm.namespaces.&#123;mdt-,filter-&#125;*.lru_max_age ldlm.namespaces.&#123;mdt-,filter-&#125;*.lru_size ldlm.namespaces.&#123;mdt-,filter-&#125;*.max_nolock_bytes ldlm.namespaces.&#123;mdt-,filter-&#125;*.max_parallel_ast ldlm.namespaces.&#123;mdt-,filter-&#125;*.resource_count ldlm.services.ldlm_canceld.stats ldlm.services.ldlm_cbd.stats llite.*.stats mdd.*.changelog_users qmt.*.*.glb-usr qmt.*.*.glb-prj qmt.*.*.glb-grp</span><br><span class="line"></span><br><span class="line">$ ps aux |grep 407047</span><br><span class="line">root      407047  0.8  0.0 5427824 16192 ?       Ssl  Jul30 926:06 /usr/bin/lustrefs_exporter -p 9169</span><br><span class="line">root     2612408  0.0  0.0  14192  4848 ?        Ss   16:50   0:00 bash -c ps aux |grep 407047</span><br><span class="line">root     2612440  0.0  0.0  12144  1160 ?        S    16:50   0:00 grep 407047</span><br></pre></td></tr></table></figure>

<h4 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -C <span class="string">&#x27;linpack|stream&#x27;</span> -d 2 -rsuw</span><br></pre></td></tr></table></figure>

<h4 id="rand-file"><a href="#rand-file" class="headerlink" title="rand file"></a>rand file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -out 1G.file 1073741824</span><br></pre></td></tr></table></figure>

<h3 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h3><h4 id="Account"><a href="#Account" class="headerlink" title="Account"></a>Account</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /bin/false  <span class="variable">$USER</span></span><br><span class="line">PASSINPUT=`<span class="built_in">echo</span> <span class="variable">$USER</span>|<span class="built_in">cut</span> -c1-3`123</span><br><span class="line">(<span class="built_in">echo</span> <span class="variable">$PASSINPUT</span> ; <span class="built_in">echo</span> <span class="variable">$PASSINPUT</span>)  | smbpasswd -s -a <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">        workgroup = MYGROUP</span><br><span class="line">        server string = Samba Server Version %v</span><br><span class="line">        <span class="built_in">log</span> file = /var/log/samba/log.%m</span><br><span class="line">        max <span class="built_in">log</span> size = 50</span><br><span class="line">        security = user</span><br><span class="line">        passdb backend = tdbsam</span><br><span class="line">load printers = no</span><br><span class="line">printing = bsd</span><br><span class="line">printcap name = /dev/null</span><br><span class="line"><span class="built_in">disable</span> spoolss = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">[SMB_DATA]</span><br><span class="line">path = /samba/data</span><br><span class="line">valid <span class="built_in">users</span> =  test1,test2,test3,test4</span><br><span class="line">create mask = 0744</span><br><span class="line">force create mode = 0744</span><br><span class="line">security mask = 0744</span><br><span class="line">force security mode = 0744</span><br><span class="line">directory mask = 0755</span><br><span class="line">force directory mode = 0755</span><br><span class="line">directory security mask = 0755</span><br><span class="line">force directory security mode = 0755</span><br><span class="line">writable = <span class="built_in">yes</span></span><br><span class="line">fileid:mapping = smb_data</span><br><span class="line">use mmap = no</span><br><span class="line">nt acl support = <span class="built_in">yes</span></span><br><span class="line">ea support = <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p>Show status  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ smbclient -L localhost <span class="comment">#show share point</span></span><br><span class="line">$ pdbedit -L <span class="comment"># show users</span></span><br><span class="line">$ mount.cifs //<span class="variable">$domain_addr</span>/SMB_DATA -o username=test1,password=<span class="variable">$your_pass</span> /mnt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -l /var/lib/samba/private/</span><br><span class="line">total 936</span><br><span class="line">-rw------- 1 root root 528384 Aug 22 10:36 passdb.tdb</span><br><span class="line">-rw------- 1 root root 430080 Dec 29  2013 secrets.tdb</span><br><span class="line"><span class="comment"># backup data</span></span><br><span class="line">$ pdbedit -e smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># import</span></span><br><span class="line">$ pdbedit -i smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Please backup all users from /etc/passwd too</span></span><br></pre></td></tr></table></figure>

<h4 id="update-kernel-moduels-in-lib-moduels-uname-r"><a href="#update-kernel-moduels-in-lib-moduels-uname-r" class="headerlink" title="update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)"></a>update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># re-generate modules.alias modules.dep</span></span><br><span class="line">$ depmod -a</span><br></pre></td></tr></table></figure>

<h4 id="filter-syslog"><a href="#filter-syslog" class="headerlink" title="filter syslog"></a>filter syslog</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Created slice user-0.slice.</span><br><span class="line">Starting Session 150 of user root.</span><br><span class="line">Started Session 150 of user root.</span><br><span class="line">Created slice user-0.slice.</span><br><span class="line">Starting Session 151 of user root.</span><br><span class="line">Started Session 151 of user root.</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;l_getidentity.*&quot; then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-lustre-id-session.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;systemd&quot; and ($msg contains &quot;Starting Session&quot; or $msg contains &quot;Started Session&quot; or $msg contains &quot;Created slice&quot; or $msg contains &quot;Starting user-&quot; or $msg contains &quot;Starting User Slice of&quot; or $msg contains &quot;Removed session&quot; or $msg contains &quot;Removed slice User Slice of&quot; or $msg contains &quot;Stopping User Slice of&quot;) then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-systemd-session-slice.conf</span><br><span class="line"></span><br><span class="line">$ systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<h4 id="tmp-permission"><a href="#tmp-permission" class="headerlink" title="tmp permission"></a>tmp permission</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 1777 /tmp</span><br></pre></td></tr></table></figure>

<h4 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ taskset -p a 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity mask: ffffffffff</span></span><br><span class="line"><span class="string">pid 205344&#x27;</span>s new affinity mask: a</span><br><span class="line"></span><br><span class="line">$ taskset -c -p 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity list: 1,3</span></span><br><span class="line"><span class="string">$ taskset -cp 0-3 $pid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ echo &quot;obase=2; ibase=16; A&quot; | bc</span></span><br><span class="line"><span class="string">1010 # core 1,3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#limit cpu </span></span><br><span class="line"><span class="string">$ systemd-run --user --scope --slice=nocpuforfirefox --property=CPUWeight=20 /opt/google/chrome/google-chrome</span></span><br></pre></td></tr></table></figure>

<h4 id="ssh-SSH"><a href="#ssh-SSH" class="headerlink" title="ssh SSH"></a>ssh SSH</h4><p>jump setting</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Host j1</span><br><span class="line">    Hostname <span class="variable">$serverA</span></span><br><span class="line">    User log_IO1</span><br><span class="line">    Port 13933</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    LocalForward  7910 localhost:32701</span><br><span class="line">    ForwardX11 <span class="built_in">yes</span></span><br><span class="line">Host l1</span><br><span class="line">    Hostname <span class="variable">$serverB</span></span><br><span class="line">    User testuser</span><br><span class="line">    Port 32766</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    ForwardX11 <span class="built_in">yes</span></span><br><span class="line">Host j2</span><br><span class="line">    Hostname <span class="variable">$serverC</span></span><br><span class="line">    User yourusername</span><br><span class="line">    Port 1600</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    LocalForward  7910 localhost:32701</span><br><span class="line">    ForwardX11 <span class="built_in">yes</span></span><br><span class="line">Host *</span><br><span class="line">    HostkeyAlgorithms +ssh-rsa</span><br><span class="line">    PubkeyAcceptedKeyTypes +ssh-rsa</span><br><span class="line">    ForwardX11 <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">~/.ssh/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#login j1 forward j1 and then ssh serverD</span></span><br><span class="line">$ ssh -t -o <span class="string">&#x27;ProxyJump j1&#x27;</span> l1 ssh -Y root@<span class="variable">$serverD</span></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -Q cipher</span><br><span class="line">3des-cbc</span><br><span class="line">aes128-cbc</span><br><span class="line">aes192-cbc</span><br><span class="line">aes256-cbc</span><br><span class="line">rijndael-cbc@lysator.liu.se</span><br><span class="line">aes128-ctr</span><br><span class="line">aes192-ctr</span><br><span class="line">aes256-ctr</span><br><span class="line">aes128-gcm@openssh.com</span><br><span class="line">aes256-gcm@openssh.com</span><br><span class="line">chacha20-poly1305@openssh.com</span><br><span class="line"></span><br><span class="line">$ scp -c chacha20-poly1305@openssh.com user@server </span><br><span class="line"></span><br><span class="line">scp windows server to linux server</span><br><span class="line">$ scp testuser@192.168.123.8:/Users/user001/Downloads/test.rar /home/homerl/Downloads/</span><br></pre></td></tr></table></figure>


<p>ssh skip GSSAPIAuthentication</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-o GSSAPIAuthentication=no</span><br></pre></td></tr></table></figure>

<p>ssh login skip authorized key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-o PubkeyAuthentication=no</span><br><span class="line">or</span><br><span class="line">-o PasswordAuthentication=<span class="built_in">yes</span> -o PreferredAuthentications=keyboard-interactive,password -o PubkeyAuthentication=no</span><br></pre></td></tr></table></figure>

<p>sshfs  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sshfs -p <span class="variable">$port</span> <span class="variable">$&#123;user&#125;</span>@<span class="variable">$&#123;ipaddr&#125;</span>:/mnt/sshfs ~/Downloads -o noatime,nonempty,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3</span><br></pre></td></tr></table></figure>

<p>ssh key not work  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> 700 ~/.ssh </span><br><span class="line">$ <span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br><span class="line">$ <span class="built_in">chmod</span> go-w ~</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to localhost:7910</span></span><br><span class="line">$ ssh -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># to 0.0.0.0:7910</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># same with 0.0.0.0</span></span><br><span class="line">$ ssh -g -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># limit the client ip</span></span><br><span class="line">$ ssh -g -L 7910:<span class="variable">$&#123;ssh_client_ip&#125;</span>:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to $vnc_server_ip:7910 by $ssh_client</span></span><br><span class="line"><span class="comment"># modify -L to -R</span></span><br><span class="line">$ ssh -R 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># share all ip addr</span></span><br><span class="line"><span class="comment"># modify /etc/ssh/sshd_config &#x27;GatewayPorts clientspecified&#x27;</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip2 and ip1 in the same LAN, bind vnc_server_ip2 5910 to ssh client 7910 and forward by vnc_server_ip1</span></span><br><span class="line">$ ssh -L 7910:<span class="variable">$&#123;vnc_server_ip2&#125;</span>:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line">vnc_server_ip1 $ vncviewer localhost:7910</span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip1 access ssh_client_ip2 vnc service</span></span><br><span class="line">$ ssh -R 7910:ssh_client_ip2:5910 user@vnc_server_ip1</span><br><span class="line">vnc_server_ip1 $ vncviewer localhost::7910</span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 user@vnc_server_ip1</span><br><span class="line"></span><br><span class="line">ssh forward SSH forward[pass through another machine to forward sock5](https://superuser.com/questions/332850/ssh-as-socks-proxy-through-multiple-hosts)    </span><br><span class="line">A-&gt;B-&gt;C</span><br><span class="line">C could connecnt internet, A and B could not, A pass through B to forward sock5 port to <span class="variable">$A_local_sock_port</span></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># make these port have not block by firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### In A, you could set sock5 localhost:$A_local_sock_port to connect internnet</span></span><br><span class="line">client $ ssh -C -f -N -D <span class="variable">$local_sock_port</span> -oProxyCommand=<span class="string">&quot;ssh -C -W %h:%p username@<span class="variable">$B_ipaddr</span>&quot;</span> username@<span class="variable">$C_ipaddr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">client $ ssh -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> <span class="variable">$B_IPADDR</span></span><br><span class="line">A $ ssh -f -N -D <span class="variable">$PORT2</span> <span class="variable">$C_IPADDR</span></span><br><span class="line"><span class="comment">#merge dual command to single command</span></span><br><span class="line">client $ ssh -f -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> liyan@192.168.210.3 <span class="string">&quot;ssh -f -N -D <span class="variable">$PORT2</span> liyan@<span class="variable">$C_IPADDR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># forward remote port to local</span></span><br><span class="line">client $ ssh -fNT -R 1025:127.0.0.1:1025 -J user@<span class="variable">$B_IP</span> user@<span class="variable">$C_IP</span></span><br><span class="line">AllowTcpForwarding <span class="built_in">yes</span></span><br><span class="line">GatewayPorts <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p>pass through the firewall and connect the internet   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">server_A=192.168.0.199 <span class="comment">#desktop and connect the internet</span></span><br><span class="line">server_B=10.0.0.1</span><br><span class="line"><span class="comment"># server_A can login server_B 22 port and server_B could not access server_A(because firewall), how to create a socks5 proxy for the server_B ?</span></span><br><span class="line"><span class="comment"># enable server_A and server_B ssh server, and set the DNS for the server_B</span></span><br><span class="line"></span><br><span class="line">server_A_terminal $ ssh -R 7911:<span class="variable">$server_A</span>:22 root@<span class="variable">$server_B</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#login to server_B, and ssh 7911 means the my desktop ssh port, and the socks5 port is 5050</span></span><br><span class="line">server_B_terminal $ ssh -D 5050 -p 7911 username@localhost</span><br><span class="line"></span><br><span class="line">server_B_terminal $ git config --global http.proxy <span class="string">&#x27;socks5://127.0.0.1:5050&#x27;</span></span><br><span class="line">server_B_terminal $ git <span class="built_in">clone</span> ....</span><br><span class="line"><span class="comment">#worked in my test env</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#test sock5 worked ?</span></span><br><span class="line">$ curl --socks5-hostname 127.0.0.1:5055 https://www.google.com</span><br><span class="line"></span><br><span class="line">-L</span><br><span class="line">Specifies that connections to the given TCP port or Unix socket on the <span class="built_in">local</span> (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side.</span><br><span class="line"></span><br><span class="line">-R</span><br><span class="line">Specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be forwarded to the <span class="built_in">local</span> side.</span><br><span class="line"></span><br><span class="line">The difference is the direction. -L forwards <span class="built_in">local</span> to remote, -R the reverse.</span><br><span class="line">https://serverfault.com/questions/970335/ssh-whats-the-difference-between-l-and-r</span><br><span class="line"></span><br><span class="line"><span class="comment">#git config --global http.proxy &#x27;socks5://127.0.0.1:5050&#x27;</span></span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> xxxx</span><br><span class="line">....</span><br><span class="line">remote: Enumerating objects: 6115, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (1435/1435), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (282/282), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">$ git config http.sslVerify <span class="literal">false</span></span><br><span class="line">$ git -c http.sslVerify=<span class="literal">false</span> <span class="built_in">clone</span> https://domain.com/path/to/git</span><br><span class="line"></span><br><span class="line">$ git config --global http.http://domain.com.proxy http://proxyUsername:proxyPassword@proxy.server.com:port</span><br><span class="line">$ git config --global https.https://domain.com.proxy https://proxyUsername:proxyPassword@proxy.server.com:port</span><br><span class="line"></span><br><span class="line">$ git config --global --get http.proxy</span><br><span class="line">$ git config --global --get https.proxy</span><br><span class="line">$ git config --get http.sslVerify</span><br><span class="line"></span><br><span class="line">$ git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">$ git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line">$ git config --<span class="built_in">unset</span> https.proxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#after convert sock5(5050) to http proxy(8118)</span></span><br><span class="line"><span class="comment">#python</span></span><br><span class="line">$ pip3 install ./xxxxxxxxxxxxx.whl --proxy http://127.0.0.1:8118</span><br><span class="line">$ pip install --proxy userid:password@proxy.domain.com:yourport</span><br><span class="line"></span><br><span class="line">$ pip install --trusted-host <span class="variable">$hostname</span> -i http://<span class="variable">$hostname</span>:<span class="variable">$port</span>/repository/pypi/simple &#123;package name&#125;</span><br><span class="line"></span><br><span class="line">$ vi ~/.pip/pip.conf</span><br><span class="line">[global]</span><br><span class="line">index-url = http://<span class="variable">$hostname</span>:<span class="variable">$port</span>/repository/pypi/simple http://<span class="variable">$hostname</span>:<span class="variable">$port</span>/repository/pypi/simple</span><br><span class="line">    </span><br><span class="line">[install]</span><br><span class="line">trusted-host = <span class="variable">$host1</span> <span class="variable">$host2</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">convet the sock5 to http proxy</span><br><span class="line">$ yum install privoxy</span><br><span class="line">$ <span class="built_in">cat</span> /etc/privoxy/config</span><br><span class="line">forward-socks5 / 127.0.0.1:1080 .</span><br><span class="line"></span><br><span class="line">or python socks support </span><br><span class="line"><span class="comment">#https://github.com/LonamiWebs/Telethon/issues/1592#issuecomment-834560338</span></span><br><span class="line">For Python &gt;= 3.6 : install python-socks[asyncio]</span><br><span class="line">For Python &lt;= 3.5 : install PySocks</span><br><span class="line"></span><br><span class="line">TelegramClient(<span class="string">&#x27;anon&#x27;</span>, api_id, api_hash, proxy=(<span class="string">&quot;socks5&quot;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, 4444))</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://hsiaofongw.notion.site/SSH-a0be7c7ca69b433fa33d9992f71fd85d">ssh forward tips</a>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#forward ssh key to another localtion</span></span><br><span class="line"></span><br><span class="line">~/.ssh/config</span><br><span class="line">Host *</span><br><span class="line">    User root</span><br><span class="line">    IdentityFile /Users/myuser/.ssh/mykey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Client_A could not connect Server_B</span><br><span class="line">Server_C has the socks5 service to Client_A, Client_A pass the Server_C socks5 service to Server_B</span><br><span class="line"></span><br><span class="line">ssh -o <span class="string">&#x27;ProxyCommand /usr/bin/ncat --proxy 127.0.0.1:7890 --proxy-type socks5 %h %p&#x27;</span> \</span><br><span class="line">  loginUserName@remote-host \</span><br><span class="line">  -p portNumber \</span><br><span class="line">  -i /path/to/privateKey</span><br><span class="line">ncat 是一个连接命令，—-proxy 127.0.0.1:7890 表示 ncat 将通过 127.0.0.1:7890 这个 socks5 代理服务来发起连接（而不是直接连接），—-proxy-type socks5 声明 127.0.0.1:7890 提供的代理服务的类型（是 socks5），%h %p 将交由 ssh 并且会被分别替换为 ssh 想要连接到的主机名和端口号，这里就是 remote-host 和 portNumber.  </span><br><span class="line">替换了 %h 和 %p 之后执行时就可作为一个管道，ssh 将这个管道视作一个 tcp 连接，然后这个管道的出口实际上就是 127.0.0.1:7890 这个 socks5 服务的出口，ssh 流量将从这里被转发至 remote-host.</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">~/.ssh/config</span><br><span class="line">Host remote-host-mnemonic</span><br><span class="line">    Hostname remote-host-name</span><br><span class="line">    User root</span><br><span class="line">    Port portNumber</span><br><span class="line">    IdentityFile /path/to/privateKey</span><br><span class="line">    ProxyCommand /opt/homebrew/bin/ncat --proxy 127.0.0.1:7890 --proxy-type socks5 %h %p</span><br><span class="line"></span><br><span class="line">$ ssh remote-host-mnemonic</span><br><span class="line"></span><br><span class="line">公司内网机器不能直接登录，只能通过一台公网跳板机登录。</span><br><span class="line">假设这台跳板机器叫做 A, 想要登录上的内网机器叫做 B, 那么我们一般可能会这样</span><br><span class="line">~/.ssh/a.key 和 ~/.ssh/b.key</span><br><span class="line">~/.ssh/config</span><br><span class="line">Host a</span><br><span class="line">    Hostname a-ip-address</span><br><span class="line">    User a-user</span><br><span class="line">    Port a-port</span><br><span class="line">    IdentityFile ~/.ssh/a.key</span><br><span class="line">    LocalForward 8081 localhost:8081 &lt;---not working</span><br><span class="line"></span><br><span class="line">Host b</span><br><span class="line">    Hostname b-ip-address</span><br><span class="line">    User b-user</span><br><span class="line">    Port b-port</span><br><span class="line">    IdentityFile ~/.ssh/b.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#就可一次通过 a 跳转登录到 b.</span></span><br><span class="line">$ ssh -o <span class="string">&#x27;ProxyJump a&#x27;</span> b</span><br><span class="line"></span><br><span class="line">假如在 ~/.ssh/config 文件中还配有另一台只有 b 能连接到的内网中的内网的机器 c</span><br><span class="line">就可依次经由 a 和 b 最终登录到 c.</span><br><span class="line">ssh -o <span class="string">&#x27;ProxyJump a,b&#x27;</span> c</span><br><span class="line"></span><br><span class="line">公司特定服务只在内网主机 b 提供，但是有一台公网跳板机 a, 如果我们能连到 a, 我们就能从 a 连到 b. 当在家里时，我们希望通过 ssh 来实现把访问 b 的流量交由 a 来转发。  </span><br><span class="line">ssh -N              \ <span class="comment"># 不执行命令</span></span><br><span class="line">  -T                \ <span class="comment"># 不分配远程 terminal</span></span><br><span class="line">  -D 127.0.0.1:7991 \ <span class="comment"># 在本机 127.0.0.1:7991 建立 socks5 代理服务</span></span><br><span class="line">  a                 \ <span class="comment"># 将 socks5 代理收到的所有流量交由 a 转发</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:7991 设为 socks5 代理服务器，则可访问 b 的服务。</span><br><span class="line">a 是在 ~/.ssh/config 文件中配置的，如果我们在 a 的配置中加上 ProxyCommand 或者 ProxyJump 选项，那还可以增加一层流量包裹，实现更加隐蔽的流量转发。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://hsiaofongw.notion.site/ssh-layer3-cdc455168b4249e2a29a9093d8dbdf86</span><br><span class="line">机器 A 和机器 B 之间能够建立 ssh 连接，哪怕其中一方位于多道 NAT 之内的内网，只要能够建立 ssh 连接，只要你能够在机器 A 上用 ssh 登上机器 B 进行操作，或者在机器 B 用 ssh 登上机器 A 进行操作就可以了；</span><br><span class="line">但是无法建立UDP连接</span><br><span class="line"></span><br><span class="line">登录机器 B, 编辑 /etc/ssh/sshd_config. 将 PermitTunnel 选项设为 <span class="built_in">yes</span>, 登录 A, 也将 PermitTunnel 设为 <span class="built_in">yes</span>; 运行 systemctl restart sshd 使新的配置生效；</span><br><span class="line">在机器 A 创建一个 tun 设备：sudo ip tuntap add mode tun tun0 ; </span><br><span class="line">同样在机器 B 创建一个 tun 设备，激活这两个 tun 设备：sudo ip <span class="built_in">link</span> <span class="built_in">set</span> tun0 up</span><br><span class="line"></span><br><span class="line">用 ip addr 命令行工具给两个 tun 设备分配 IP 地址和子网掩码，例如 192.168.0.101/24 和 192.168.0.102/24;</span><br><span class="line">用 ip addr 命令行工具给两个 tun 设备分配 IP 地址和子网掩码，例如 192.168.0.101/24 和 192.168.0.102/24;</span><br><span class="line"></span><br><span class="line">ssh -i ~/.ssh/id_dsa -f -w <span class="variable">$LOCAL_TUN_NUM</span>:<span class="variable">$REMOTE_TUN_NUM</span> <span class="variable">$RUSER</span>@<span class="variable">$PEER</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">ssh -F /home/ubuntu/.ssh/config -vNT -w 0:0 peer</span></span><br></pre></td></tr></table></figure>
<p>ssh config allow users    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowUsers *@192.168.1.0/24 *@*.example.com *@1.2.3.4</span><br><span class="line">AllowGroups ssh</span><br></pre></td></tr></table></figure>

<h4 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">timeout</span> 5m strace -ttTvyy -o /tmp/systemd.strace -s 1024 -e sendmsg -p <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line">-ttt If given thrice, the time printed will include the microseconds and the leading portion will be printed as the number of seconds since the epoch</span><br><span class="line"></span><br><span class="line">-s strsize Specify the maximum string size to <span class="built_in">print</span> (the default is 32). Note that filenames are not considered strings and are always printed <span class="keyword">in</span> full.</span><br><span class="line"></span><br><span class="line">-f Trace child processes as they are created by currently traced processes as a result of the fork(2), vfork(2) and <span class="built_in">clone</span>(2) system calls. Note that -p PID -f will attach all threads of process PID <span class="keyword">if</span> it is multi-threaded, not only thread with thread_id = PID</span><br><span class="line"></span><br><span class="line">-T Show the time spent <span class="keyword">in</span> system calls. This records the time difference between the beginning and the end of each system call</span><br><span class="line"></span><br><span class="line">-c Count time, calls, and errors <span class="keyword">for</span> each system call and report a summary on program <span class="built_in">exit</span>, suppressing the regular output. This attempts to show system time (CPU time spent running <span class="keyword">in</span> the kernel) independent of wall clock time. If -c is used with -f, only aggregate totals <span class="keyword">for</span> all traced processes are kept.</span><br><span class="line">-C Like -c but also <span class="built_in">print</span> regular output <span class="keyword">while</span> processes are running.</span><br><span class="line"></span><br><span class="line">$ strace -f -c -p 49285</span><br><span class="line">% time     seconds  usecs/call     calls    errors syscall</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line"> 92.89   69.955928        2530     27640      1203 futex</span><br><span class="line">  2.33    1.754302       70172        25        25 restart_syscall</span><br><span class="line">  1.56    1.172474          52     22512           write</span><br><span class="line">  1.54    1.156547          63     18080           <span class="built_in">read</span></span><br><span class="line">  1.09    0.821847         119      6873           <span class="built_in">unlink</span></span><br><span class="line">  0.28    0.211894          30      6874           open</span><br><span class="line">  0.14    0.108041          15      6859           munmap</span><br><span class="line">  0.07    0.049564           7      6874           close</span><br><span class="line">  0.05    0.035222           2     13733           fstat</span><br><span class="line">  0.03    0.024198           3      6859           mmap</span><br><span class="line">  0.02    0.015568           2      5522           clock_gettime</span><br><span class="line">  0.01    0.006484           2      2208           getrusage</span><br><span class="line">  0.00    0.001998           3       552           mprotect</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line">100.00   75.314067                124611      1228 total</span><br><span class="line"></span><br><span class="line">$ strace -k cmd  <span class="comment">#show backtrace for each syscall</span></span><br><span class="line">$ strace -t cmd  <span class="comment">#prefix each syscall with walllock time</span></span><br><span class="line">$ strace -D cmd  strace process runs as detached grandchild of cmd</span><br><span class="line">$ strace -p 1234 -f <span class="comment">#addatch to all threads in process-group 1234</span></span><br><span class="line"></span><br><span class="line">strace -Tfe trace=open,<span class="built_in">read</span>,write  ./program</span><br><span class="line">$ strace -f -FF -tt -T -s 128 -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%memory -C -o ~/memory.log -f -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%desc -C -o ~/desc.log -f -p <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

<h4 id="calulate-CPU-usage"><a href="#calulate-CPU-usage" class="headerlink" title="calulate CPU usage"></a><a target="_blank" rel="noopener" href="https://github.com/Leo-G/DevopsWiki/wiki/How-Linux-CPU-Usage-Time-and-Percentage-is-calculated">calulate CPU usage</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">cpu usage=(idle2-idle1)/(cpu2-cpu1)*100 <span class="comment"># script example</span></span><br><span class="line">cpu usage=[(user_2 +sys_2+nice_2) - (user_1 + sys_1+nice_1)]/(total_2 - total_1)*100</span><br><span class="line"></span><br><span class="line"> <span class="built_in">cat</span> /proc/stat</span><br><span class="line">     user <span class="built_in">nice</span> system idle iowait  irq  softirq steal guest guest_nice</span><br><span class="line">cpu  4705 356  584    3699   23    23     0       0     0          0</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="comment"># by Paul Colby (http://colby.id.au), no rights reserved ;)</span></span><br><span class="line"></span><br><span class="line"> PREV_TOTAL=0</span><br><span class="line"> PREV_IDLE=0</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">   <span class="comment"># Get the total CPU statistics, discarding the &#x27;cpu &#x27; prefix.</span></span><br><span class="line">   CPU=(`sed -n <span class="string">&#x27;s/^cpu\s//p&#x27;</span> /proc/stat`)</span><br><span class="line">   IDLE=<span class="variable">$&#123;CPU[3]&#125;</span> <span class="comment"># Just the idle CPU time.</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the total CPU time.</span></span><br><span class="line">   TOTAL=0</span><br><span class="line">   <span class="keyword">for</span> VALUE <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;CPU[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">     ((TOTAL=<span class="variable">$TOTAL</span>+<span class="variable">$VALUE</span>))</span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the CPU usage since we last checked.</span></span><br><span class="line">   ((DIFF_IDLE=<span class="variable">$IDLE</span>-<span class="variable">$PREV_IDLE</span>))</span><br><span class="line">   ((DIFF_TOTAL=<span class="variable">$TOTAL</span>-<span class="variable">$PREV_TOTAL</span>))</span><br><span class="line"></span><br><span class="line">   <span class="comment">##</span></span><br><span class="line">   DIFF_USAGE=$(awk -v diff_idle=<span class="variable">$DIFF_IDLE</span> -v diff_total=<span class="variable">$DIFF_TOTAL</span> <span class="string">&#x27;BEGIN&#123;printf &quot;%.2f&quot;, (diff_total-diff_idle)/diff_total*100&#125;&#x27;</span>)</span><br><span class="line">   <span class="built_in">echo</span> -en <span class="string">&quot;\rCPU: <span class="variable">$DIFF_USAGE</span>%  \b\b&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Remember the total and idle CPU times for the next check.</span></span><br><span class="line">   PREV_TOTAL=<span class="string">&quot;<span class="variable">$TOTAL</span>&quot;</span></span><br><span class="line">   PREV_IDLE=<span class="string">&quot;<span class="variable">$IDLE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Wait before checking again.</span></span><br><span class="line">   usleep 100000</span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## the lib messages</span></span><br><span class="line">$ <span class="built_in">read</span>(3, <span class="string">&quot;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\273\0\0\0\0\0\0&quot;</span>..., 832) = 832</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">od</span> -bc /lib/x86_64-linux-gnu/libc.so.6 | <span class="built_in">head</span> -n4</span><br><span class="line">0000000 177 105 114 106 002 001 001 003 000 000 000 000 000 000 000 000</span><br><span class="line">        177   E   L   F 002 001 001 003  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000020 003 000 076 000 001 000 000 000 260 034 002 000 000 000 000 000</span><br><span class="line">        003  \0   &gt;  \0 001  \0  \0  \0 260 034 002  \0  \0  \0  \0  \0</span><br></pre></td></tr></table></figure>

<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL</span><br><span class="line"> 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE</span><br><span class="line"> 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2</span><br><span class="line">13) SIGPIPE     14) SIGALRM     15) SIGTERM     16) SIGSTKFLT</span><br><span class="line">17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU</span><br><span class="line">25) SIGXFSZ     26) SIGVTALRM   27) SIGPROF     28) SIGWINCH</span><br><span class="line">29) SIGIO       30) SIGPWR      31) SIGSYS      34) SIGRTMIN</span><br><span class="line">35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4</span><br><span class="line">39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12</span><br><span class="line">47) SIGRTMIN+13 48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14</span><br><span class="line">51) SIGRTMAX-13 52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10</span><br><span class="line">55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6</span><br><span class="line">59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ pkill -f test.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## send STOP signal for this user</span></span><br><span class="line">$ pkill --signal 19 -U testuser</span><br><span class="line"></span><br><span class="line"><span class="comment">## send CONT signal for this user</span></span><br><span class="line">$ pkill --signal 18 -U testuser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#process schduler</span></span><br><span class="line">$ chrt -p <span class="variable">$pid</span></span><br><span class="line">$ chrt -m</span><br><span class="line">$ chrt [-b/-f/-o/-r/-i/-d] -p <span class="variable">$priority</span> <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line">-b SCHED_BATCH</span><br><span class="line">-f SCHED_FIFO</span><br><span class="line">-o SCHED_OTHER</span><br><span class="line">-r SCHED_RR</span><br><span class="line">-i SCHED_IDLE</span><br><span class="line">-d SCHED_DEADLINE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nwchan     WCHAN     address of the kernel <span class="keyword">function</span> <span class="built_in">where</span> the process</span><br><span class="line">                     is sleeping (use wchan <span class="keyword">if</span> you want the kernel</span><br><span class="line">                     <span class="keyword">function</span> name).  Running tasks will display a</span><br><span class="line">                     dash (<span class="string">&#x27;-&#x27;</span>) <span class="keyword">in</span> this column.</span><br><span class="line">wchan      WCHAN     name of the kernel <span class="keyword">function</span> <span class="keyword">in</span> <span class="built_in">which</span> the process</span><br><span class="line">                     is sleeping, a <span class="string">&quot;-&quot;</span> <span class="keyword">if</span> the process is running, or</span><br><span class="line">                     a <span class="string">&quot;*&quot;</span> <span class="keyword">if</span> the process is multi-threaded and ps is</span><br><span class="line">                     not displaying threads.</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the single pid</span></span><br><span class="line">$ ps -uwwp 20164</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root     20164  0.5  0.0      0     0 ?        S    Mar06 380:33 [socknal_sd00_00]</span><br><span class="line"></span><br><span class="line"><span class="comment"># show full username</span></span><br><span class="line">$ ps axo user:20,pid,pcpu,pmem,vsz,rss,<span class="built_in">tty</span>,<span class="built_in">stat</span>,start,time,<span class="built_in">comm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show thread and whan</span></span><br><span class="line">$ ps axHo <span class="built_in">stat</span>,pid,tid,pgid,ppid,<span class="built_in">comm</span>,cls,cmd,wchan</span><br><span class="line">S&lt;      139    139      0      2 kblockd          TS [kblockd]                   rescuer_thread</span><br><span class="line">S&lt;      141    141      0      2 md               TS [md]                        rescuer_thread</span><br><span class="line">S&lt;      142    142      0      2 edac-poller      TS [edac-poller]               rescuer_thread</span><br><span class="line">S&lt;      143    143      0      2 watchdogd        TS [watchdogd]                 rescuer_thread</span><br><span class="line">S       152    152      0      2 kswapd0          TS [kswapd0]                   kswapd</span><br><span class="line">S       153    153      0      2 kswapd1          TS [kswapd1]                   kswapd</span><br><span class="line"></span><br><span class="line">$ ps -T -o <span class="built_in">stat</span>,pid,tid,pgid,ppid,<span class="built_in">comm</span>,cls,cmd,wchan,psr &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#get the tid cpu number</span></span><br><span class="line">$ ps -T -o <span class="built_in">stat</span>,pid,tid,pgid,ppid,<span class="built_in">comm</span>,cls,cmd,wchan,psr 2737</span><br><span class="line">STAT     PID     TID    PGID    PPID COMMAND         CLS CMD                         WCHAN  PSR</span><br><span class="line">Ssl     2737    2737    2737       1 zed              TS /sbin/zed -F                -        9</span><br><span class="line">Ssl     2737    2756    2737       1 agents           TS /sbin/zed -F                -        5</span><br><span class="line">Ssl     2737    2757    2737       1 udev monitor     TS /sbin/zed -F                -        8</span><br><span class="line">Ssl     2737    5467    2737       1 reap ZEDLETs     TS /sbin/zed -F                -       19</span><br><span class="line">$ <span class="built_in">cat</span> /proc/2737/task/2737/stat | awk <span class="string">&#x27;&#123;print $(NF-13)&#125;&#x27;</span></span><br><span class="line">9</span><br><span class="line">$ <span class="built_in">cat</span> /proc/2737/task/2756/stat | awk <span class="string">&#x27;&#123;print $(NF-13)&#125;&#x27;</span></span><br><span class="line">5</span><br><span class="line">$ <span class="built_in">cat</span> /proc/2737/task/5467/stat | awk <span class="string">&#x27;&#123;print $(NF-13)&#125;&#x27;</span></span><br><span class="line">19</span><br><span class="line">$ <span class="built_in">cat</span> /proc/2737/task/2757/stat | awk <span class="string">&#x27;&#123;print $(NF-13)&#125;&#x27;</span></span><br><span class="line">8</span><br><span class="line"><span class="comment">#https://docs.kernel.org/filesystems/proc.html</span></span><br><span class="line"><span class="comment">#Table 1-4: Contents of the stat fields (as of 2.6.30-rc7)</span></span><br><span class="line"><span class="comment">#task_cpu: which CPU the task is scheduled on</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#show the pid info process schdule and show the parent id ppid</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -r 99</span><br><span class="line">$ <span class="built_in">setcap</span>  cap_sys_nice=eip  /usr/bin/chrt <span class="comment">## for the non-root user</span></span><br><span class="line">$ chrt -p <span class="variable">$pid</span></span><br><span class="line">$ chrt -b -p <span class="variable">$priority</span> <span class="variable">$pid</span> <span class="comment">## the number higher ,the highest prority is 99</span></span><br><span class="line">$ chrt -m</span><br><span class="line">$ <span class="built_in">nice</span> -n 5 ./a.out -20~19 <span class="comment"># -19 is the highest prority , it not real-time</span></span><br><span class="line">$ renice 10 <span class="variable">$pid</span></span><br><span class="line">$ pstree -aps <span class="variable">$pid</span></span><br><span class="line">$ ps -efj</span><br><span class="line">$ ps -eo pid,ppid,cmd,%mem,rss,%cpu,policy,ni --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span></span><br><span class="line">$ ps -eo pid,ppid,cmd,%mem,%cpu --<span class="built_in">sort</span>=-%mem | <span class="built_in">head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check the process on which cpu cores</span></span><br><span class="line">$ ps -mo pid,tid,%cpu,psr -p 198851 | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> | <span class="built_in">sort</span> -n  | <span class="built_in">uniq</span> -c</span><br><span class="line">   PID    TID %CPU PSR</span><br><span class="line">198851      -  0.1   -</span><br><span class="line">     - 198851  0.1  15</span><br></pre></td></tr></table></figure>

<h5 id="others-process-tool"><a href="#others-process-tool" class="headerlink" title="others process tool"></a>others process tool</h5><p>atop -PMEM not got the right value, do it by yourself  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##process memory overhead</span></span><br><span class="line">awk <span class="string">&#x27;$0~/Pss/&#123;mem+=$2&#125;; END &#123;printf &quot;%.2f GiB\n&quot;, mem/1024/1024&#125;&#x27;</span> /proc/44833/smaps</span><br><span class="line"></span><br><span class="line"><span class="comment">##the system memory overhead</span></span><br><span class="line">awk <span class="string">&#x27;$0~/Pss/&#123;mem+=$2&#125;; END &#123;printf &quot;%.2f GiB\n&quot;, mem/1024/1024&#125;&#x27;</span> /proc/[1-9]*/smaps</span><br><span class="line"></span><br><span class="line"><span class="comment">#/proc/pid/smaps vmflags</span></span><br><span class="line">rd      readable</span><br><span class="line">wr      writeable</span><br><span class="line">ex      executable</span><br><span class="line">sh      shared</span><br><span class="line">mr      may <span class="built_in">read</span></span><br><span class="line">mw      may write</span><br><span class="line">me      may execute</span><br><span class="line">ms      may share</span><br><span class="line">gd      stack segment growns down</span><br><span class="line">pf      pure PFN range</span><br><span class="line">dw      disabled write to the mapped file</span><br><span class="line">lo      pages are locked <span class="keyword">in</span> memory</span><br><span class="line">io      memory mapped I/O area</span><br><span class="line">sr      sequential <span class="built_in">read</span> advise provided</span><br><span class="line">rr      random <span class="built_in">read</span> advise provided</span><br><span class="line">dc      <span class="keyword">do</span> not copy area on fork</span><br><span class="line">de      <span class="keyword">do</span> not <span class="built_in">expand</span> area on remapping</span><br><span class="line">ac      area is accountable</span><br><span class="line">nr      swap space is not reserved <span class="keyword">for</span> the area</span><br><span class="line">ht      area uses huge tlb pages</span><br><span class="line"><span class="built_in">nl</span>      non-linear mapping</span><br><span class="line">ar      architecture specific flag</span><br><span class="line"><span class="built_in">dd</span>      <span class="keyword">do</span> not include area into core dump</span><br><span class="line">mm      mixed map area</span><br><span class="line">hg      huge page advise flag</span><br><span class="line">nh      no-huge page advise flag</span><br><span class="line">mg      mergable advise flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Kill all processes with the ppid</span></span><br><span class="line">$ pkill -P $$</span><br><span class="line">$ <span class="built_in">kill</span> $(ps -o pid= --ppid $$)</span><br><span class="line"></span><br><span class="line">$ top -n 3 -b</span><br><span class="line">$ top -b -p 12345</span><br><span class="line">$ pstree -sg 25153 <span class="comment"># get process tree</span></span><br><span class="line">systemd(1)───sshd(3266)───sshd(32704)───hydra_pmi_proxy(32706)───test.sh(32725)</span><br><span class="line"></span><br><span class="line">$ pstree -sga 32725</span><br><span class="line">systemd,1 --switched-root --system --deserialize 22</span><br><span class="line">  └─sshd,3266 -D</span><br><span class="line">      └─sshd,32704</span><br><span class="line">          └─hydra_pmi_proxy,32706 --control-port centos7-test:38001 --rmk user --launcher ssh --demux poll --pgid 0 --retries 10--u</span><br><span class="line">              └─test.sh,32725 /root/test.sh /mnt</span><br><span class="line"></span><br><span class="line">$ pidstat -drsuw</span><br><span class="line">    * CPU utilization</span><br><span class="line">    * IO</span><br><span class="line">    * page faults and memory utilization</span><br><span class="line">    * stack utilization</span><br><span class="line">    * task switching</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt p<span class="variable">$pid</span> -oT</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt u<span class="variable">$uid</span> -oT</span><br><span class="line"></span><br><span class="line">$ iotop -b -n1 -o -P</span><br><span class="line"></span><br><span class="line">sys%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $9/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line">use%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print ($10+$11)/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">idle%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $12/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">wait</span>%</span><br><span class="line">$  atop -P CPU 2 | awk <span class="string">&#x27;$0~/CPU/&#123;print $13/($9+$10+$11+$12+$13+$14+$15+$16+$17)&quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | <span class="built_in">sort</span> -nr -k 13 -k 15  | <span class="built_in">head</span></span><br><span class="line">                                                                           reads    <span class="built_in">read</span> sec     writes write sec(512B)</span><br><span class="line">PRD kvm-manager-a23-1 1585239068 2020/03/27 00:11:08 4256 4006 (bash) S n y 1758081744 1758081744 64      64              48 4006 n y</span><br><span class="line">last line <span class="string">&#x27;y&#x27;</span> means not thread</span><br><span class="line">                                                                                                                         (2097152/1024=2048KB)</span><br><span class="line">$ atop -c -m 5 <span class="comment"># show cpu and mem, interval 5s                                                                          huge page size (bytes)</span></span><br><span class="line">$ atop -PCPU,MEM 5 <span class="comment"># Batch-mode output cpu and memory                                                                               |</span></span><br><span class="line">                                                        interval   total(page)          cache       slab  slab-rec  shmem  shswp hugesz hpfre</span><br><span class="line">                                                             |         |                  |           |          |      |     |    |      |</span><br><span class="line">MEM cngb-compute-h3c-amd-test 1608821373 2020/12/24 22:49:33 2 4096 264131575 217895897 230834 13135 222600 16 44190 0 2598 8 0 2097152 0 0 0</span><br><span class="line">                                                                |               |               |           |        |      |           |   |</span><br><span class="line">                                                             pagesize         free            fsbuff      dirty  vmball  shrss       hptot arc</span><br><span class="line">                                total       free           cache buff   slap dirty</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;printf &quot;%f GB\n&quot;, ((264131575-217895897)*4096-(230834+13135+222600+16+44190+2598)*4096)/1024/1024/1024&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## man page is wrong, source code is right, and I make sure with /proc/meminfo</span></span><br><span class="line">print_MEM(char *hp, struct sstat *ss, struct tstat *ps, int nact)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;%s %u %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld\n&quot;</span>,</span><br><span class="line">                        hp,</span><br><span class="line">                        pagesize,</span><br><span class="line">                        ss-&gt;mem.physmem,</span><br><span class="line">                        ss-&gt;mem.freemem,</span><br><span class="line">                        ss-&gt;mem.cachemem,</span><br><span class="line">                        ss-&gt;mem.buffermem,</span><br><span class="line">                        ss-&gt;mem.slabmem,</span><br><span class="line">                        ss-&gt;mem.cachedrt,</span><br><span class="line">                        ss-&gt;mem.slabreclaim,</span><br><span class="line">                        ss-&gt;mem.vmwballoon,</span><br><span class="line">                        ss-&gt;mem.shmem,</span><br><span class="line">                        ss-&gt;mem.shmrss,</span><br><span class="line">                        ss-&gt;mem.shmswp,</span><br><span class="line">                        ss-&gt;mem.hugepagesz,</span><br><span class="line">                        ss-&gt;mem.tothugepage,</span><br><span class="line">                        ss-&gt;mem.freehugepage,</span><br><span class="line">                        ss-&gt;mem.zfsarcsize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | awk <span class="string">&#x27;NF&gt;10 &#123;if($(NF-6)+$(NF-4)&gt;120000) &#123;if($NF==&quot;y&quot;) print $0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># show the proc/thread read or write &gt; 60MB</span></span><br></pre></td></tr></table></figure>

<h4 id="xattr"><a href="#xattr" class="headerlink" title="xattr"></a>xattr</h4><ul>
<li>If you files system support attr   <ul>
<li>Adds the attribute to the existing attribute of the files.</li>
<li>Removes the attribute to the existing attribute of the files.</li>
<li>Keep the existing attributes that the files have.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ chattr +i -R demo</span><br><span class="line">$ <span class="built_in">rm</span> -rf demo/</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;demo/0: Permission denied</span></span><br><span class="line"><span class="string">rm: cannot remove &#x27;</span>demo/1: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;demo/2: Permission denied</span></span><br><span class="line"><span class="string">rm: cannot remove &#x27;</span>demo/3: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;demo/4: Permission denied</span></span><br><span class="line"><span class="string">rm: cannot remove &#x27;</span>demo/5: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;demo/6: Permission denied</span></span><br><span class="line"><span class="string">rm: cannot remove &#x27;</span>demo/7: Permission denied</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;demo/8: Permission denied</span></span><br><span class="line"><span class="string">rm: cannot remove &#x27;</span>demo/9: Permission denied</span><br><span class="line"></span><br><span class="line">$ lsattr demo/</span><br><span class="line">----i----------- demo/0</span><br><span class="line">----i----------- demo/1</span><br><span class="line">----i----------- demo/2</span><br><span class="line">----i----------- demo/3</span><br><span class="line">----i----------- demo/4</span><br><span class="line">----i----------- demo/5</span><br><span class="line">----i----------- demo/6</span><br><span class="line">----i----------- demo/7</span><br><span class="line">----i----------- demo/8</span><br><span class="line">----i----------- demo/9</span><br><span class="line">$ chattr -i -R demo/</span><br><span class="line">$ <span class="built_in">rm</span> -f demo/*</span><br><span class="line"></span><br><span class="line"><span class="comment">### could be append</span></span><br><span class="line">$ chattr -R +a demo/</span><br><span class="line">$ <span class="built_in">cd</span> demo/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">0  1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; 0</span><br><span class="line">-bash: 0: Operation not permitted</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt;&gt; 0</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">$ lsattr 0</span><br><span class="line"></span><br><span class="line">----i----------- demo/0</span><br><span class="line">----i----------- demo/1</span><br><span class="line">----i----------- demo/2</span><br><span class="line">----i----------- demo/3</span><br><span class="line">----i----------- demo/4</span><br><span class="line">----i----------- demo/5</span><br><span class="line">----i----------- demo/6</span><br><span class="line">----i----------- demo/7</span><br><span class="line">----i----------- demo/8</span><br><span class="line">----i----------- demo/9</span><br><span class="line">$ chattr -i -R demo/</span><br><span class="line">$ <span class="built_in">rm</span> -f demo/*</span><br><span class="line"></span><br><span class="line"><span class="comment">### could be append</span></span><br><span class="line">$ chattr -R +a demo/</span><br><span class="line">$ <span class="built_in">cd</span> demo/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">0  1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; 0</span><br><span class="line">-bash: 0: Operation not permitted</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt;&gt; 0</span><br><span class="line">$ <span class="built_in">cat</span> 0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">$ lsattr 0</span><br><span class="line">-----a---------- 0</span><br><span class="line">$ <span class="built_in">rm</span> -f 0</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;0: Operation not permitted</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ chattr -R -a demo</span></span><br><span class="line"><span class="string">$ rm -f demo/*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A set : The atime record is not updated.</span></span><br><span class="line"><span class="string">S set : The changes are updated synchronously on the disk.</span></span><br><span class="line"><span class="string">a set : File can only be opened in append mode for writing.</span></span><br><span class="line"><span class="string">i set : File cannot be modified (immutable), the only superuser can unset the attribute.</span></span><br><span class="line"><span class="string">j set : All of files information is updated to the ext3 journal before being updated to the file itself.</span></span><br><span class="line"><span class="string">t set : No tail-merging is allowed.</span></span><br><span class="line"><span class="string">d set : No more candidate for backup when the dump process is run.</span></span><br><span class="line"><span class="string">u set : When such a file is deleted, its data is saved enabling the user to ask for its undeletion.</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="extended-file-attributes"><a href="#extended-file-attributes" class="headerlink" title="extended file attributes"></a>extended file attributes</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#backup and restore</span></span><br><span class="line">$ getfattr –R –d –m <span class="string">&#x27;.*&#x27;</span> –P &gt; /tmp/ea.bak </span><br><span class="line">$ setfattr –restore=/tmp/ea.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">$ <span class="built_in">touch</span> 12345</span><br><span class="line">$ setfattr --name <span class="string">&quot;user.test&quot;</span> --value <span class="string">&quot;Tested&quot;</span> 12345</span><br><span class="line">$ getfattr -n <span class="string">&quot;user.test&quot;</span> --only-value 12345</span><br><span class="line">Tested</span><br><span class="line">$ getfattr -n <span class="string">&quot;user.test&quot;</span> 12345</span><br><span class="line">$ getfattr -d 12345</span><br><span class="line"></span><br><span class="line">$ setfattr -n user.comment -v <span class="string">&quot;this is a comment&quot;</span> test.txt</span><br><span class="line">$ getfattr test.txt</span><br><span class="line">$ getfattr -n test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove</span></span><br><span class="line">$ setfattr -x user.comment test.txt</span><br><span class="line">$ getfattr -n user.comment test.txt</span><br><span class="line">test.txt: user.comment: No such attribute</span><br></pre></td></tr></table></figure>

<h4 id="SUID-SGID-and-sticky-bit"><a href="#SUID-SGID-and-sticky-bit" class="headerlink" title="SUID, SGID, and sticky bit"></a><a target="_blank" rel="noopener" href="https://www.redhat.com/sysadmin/suid-sgid-sticky-bit">SUID, SGID, and sticky bit</a></h4><p>user + s<br>a single function: A file with SUID always executes as the user who owns the file, regardless of the user passing the command  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -l $(<span class="built_in">which</span> passwd)</span><br><span class="line">-rwsr-xr-x 1 root root 63960 Feb  7  2020 /usr/bin/passwd</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> u+s /usr/bin/passwd</span><br></pre></td></tr></table></figure>
<p>group + s<br>If set on a file, it allows the file to be executed as the group that owns the file (similar to SUID)<br>If set on a directory, any files created in the directory will have their group ownership set to that of the directory owner   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> g+s </span><br></pre></td></tr></table></figure>

<p>other + t<br>The last special permission has been dubbed the “sticky bit.” This permission does not affect individual files. However, at the directory level, it restricts file deletion. Only the owner (and root) of a file can remove the file within that directory. A common example of this is the &#x2F;tmp directory:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> +t </span><br><span class="line">$ <span class="built_in">ls</span> -ld /tmp/</span><br><span class="line">drwxrwxrwt 26 root root 12288 Sep  1 08:56 /tmp/</span><br></pre></td></tr></table></figure>

<h4 id="tc"><a href="#tc" class="headerlink" title="tc"></a>tc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## fixed delay</span></span><br><span class="line">$ tc qdisc add dev eth0 root netem delay 100ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## fixed delay range 100ms ± 10ms</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## This causes the added delay to be 100ms ± 10ms with the next random element depending 25% on the last one. This isn&#x27;t true statistical correlation, but an approximation.</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% package loss</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.1%</span><br><span class="line"></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.3% 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1% duplicate package</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem duplicate 1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% randomly modify single bit</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem corrupt 0.1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order, 5,10,15,20,25... package send right now, the others delay 10ms, it &#x27;s fixed, not random</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem gap 5 delay 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order randomly, 25% will be transmit, the others will be delay 10ms, next and previos has the 50% relevance ??</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 10ms reorder 25% 50%</span><br><span class="line"></span><br><span class="line"><span class="comment">## delay time range at 100ms ± 75ms, it could cause the package out of order</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 75ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## flow control</span></span><br><span class="line">$ tc qdisc add dev eth0 root handle 1:0 netem delay 100ms</span><br><span class="line">$ tc qdisc add dev eth0 parent 1:1 handle 10: tbf rate 256kbit buffer 1600 <span class="built_in">limit</span> 3000</span><br><span class="line">$ tc -s qdisc <span class="built_in">ls</span> dev eth0</span><br></pre></td></tr></table></figure>

<h4 id="CentOS-VNC"><a href="#CentOS-VNC" class="headerlink" title="CentOS VNC"></a>CentOS VNC</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install GUI</span></span><br><span class="line"><span class="comment">#el7 install desktop</span></span><br><span class="line">yum groupinstall -y <span class="string">&quot;GNOME Desktop&quot;</span></span><br><span class="line"></span><br><span class="line">el8/9</span><br><span class="line">$ yum groupinstall base-x</span><br><span class="line">$ yum groupinstall GNOME base-x Fonts</span><br><span class="line">$ yum groupinstall <span class="string">&quot;Server with GUI&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#show info about base-x</span></span><br><span class="line">$ dnf -q group info base-x</span><br><span class="line"></span><br><span class="line">el7</span><br><span class="line">$ yum groupinstall gnome-desktop x11 fonts</span><br><span class="line"></span><br><span class="line">$ systemctl set-default graphical</span><br><span class="line"></span><br><span class="line">el6</span><br><span class="line">$ yum groupinstall Desktop <span class="string">&quot;X Window System&quot;</span> Fonts</span><br><span class="line"></span><br><span class="line"><span class="comment">#if there is no another data in this file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;exec gnome-session&quot;</span> &gt; ~/.xinitrc</span><br><span class="line"></span><br><span class="line">systemctl is-enabled vncserver@.service</span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@.service</span><br><span class="line"></span><br><span class="line">systemctl get-default</span><br><span class="line">systemctl set-default multi-user.target</span><br><span class="line">systemctl set-default graphical.target</span><br><span class="line"></span><br><span class="line"><span class="comment">#start desktop</span></span><br><span class="line">systemctl isolate graphical</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:4.service</span><br><span class="line">vi /etc/systemd/system/vncserver@:4.service <span class="comment">## replace root user to normal user</span></span><br><span class="line">ExecStart=/usr/sbin/runuser -l root -c <span class="string">&quot;/usr/bin/vncserver %i&quot;</span></span><br><span class="line">PIDFile=/root/.vnc/%H%i.pid</span><br><span class="line"></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="built_in">ln</span> -s <span class="string">&#x27;/etc/systemd/system/vncserver@:4.service&#x27;</span> <span class="string">&#x27;/etc/systemd/system/multi-user.target.wants/vncserver@:4.service&#x27;</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@:4.service</span><br><span class="line">systemctl start vncserver@:4.service</span><br></pre></td></tr></table></figure>
<p>&#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;timer&#x2F;timer_expire_entry&#x2F;enable<br>Vncserer was runing, but there is no desktop in centos 7   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ yum groupinstall Xfce</span><br><span class="line">$ yum install xorg-x11-twm xterm xorg-x11-xinit</span><br><span class="line">$ <span class="built_in">chmod</span>  755 ~/.vnc/xstartup</span><br><span class="line">$ <span class="built_in">cat</span> ~/.vnc/xstartup</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> SESSION_MANAGER</span><br><span class="line"><span class="built_in">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class="line"><span class="built_in">exec</span> startxfce4</span><br></pre></td></tr></table></figure>

<h5 id="KVM-guest-VNC-config"><a href="#KVM-guest-VNC-config" class="headerlink" title="KVM guest VNC config"></a><a target="_blank" rel="noopener" href="https://www.server-world.info/en/note?os=CentOS_Stream_9&p=kvm&f=6">KVM guest VNC config</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add like follows</span></span><br><span class="line"><span class="comment"># set any password for [passwd=***] section for VNC connection</span></span><br><span class="line"><span class="comment"># specify an unique number for [slot=&#x27;0x**&#x27;]</span></span><br><span class="line">&lt;graphics <span class="built_in">type</span>=<span class="string">&#x27;vnc&#x27;</span> port=<span class="string">&#x27;5900&#x27;</span> autoport=<span class="string">&#x27;no&#x27;</span> listen=<span class="string">&#x27;0.0.0.0&#x27;</span> passwd=<span class="string">&#x27;password&#x27;</span>&gt;</span><br><span class="line">  &lt;listen <span class="built_in">type</span>=<span class="string">&#x27;address&#x27;</span> address=<span class="string">&#x27;0.0.0.0&#x27;</span>/&gt;</span><br><span class="line">&lt;/graphics&gt;</span><br><span class="line">&lt;video&gt;</span><br><span class="line">  &lt;model <span class="built_in">type</span>=<span class="string">&#x27;vga&#x27;</span> vram=<span class="string">&#x27;16384&#x27;</span> heads=<span class="string">&#x27;1&#x27;</span> primary=<span class="string">&#x27;yes&#x27;</span>/&gt;</span><br><span class="line">  &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x02&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure>

<h4 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\&#x27;<span class="string">&quot;collectl --export graphite,<span class="variable">$ip</span>,d=2 -i60 -s CMDN --netfilt &quot;</span>\&quot;<span class="string">&quot;eth|en|p[0-9]|em&quot;</span>\&quot;<span class="string">&quot; --dskfilt &quot;</span>\&quot;<span class="string">&quot;nvme|sd&quot;</span>\&quot;\&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment">#root su</span></span><br><span class="line">su -s /bin/bash nrpe -c <span class="string">&quot;sudo test.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#exit reverse-i-search mode</span></span><br><span class="line">ctrl + g</span><br><span class="line"></span><br><span class="line">$ screen -L -Logfile screen.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># read</span></span><br><span class="line">$ less -R screen.log</span><br></pre></td></tr></table></figure>

<p>copy mode<br>ctrl + A + esc, press space, scroll up and select the text you want and press “space&#x2F;blank” to copied<br>ctrl + A + c, create a new session, and use vim open a file, press i go to insert mode, and press ctrl + a + ], it will copy all text to vim.<br>background running by screen  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\&#x27;<span class="string">&quot;collectl --export graphite,10.53.20.206:2003,d=1 -i60 -s CMDN --netfilt &quot;</span>\&quot;<span class="string">&quot;eth|en|p[0-9]|em&quot;</span>\&quot;<span class="string">&quot; --dskfilt &quot;</span>\&quot;<span class="string">&quot;nvme|sd&quot;</span>\&quot;\&#x27;</span><br><span class="line">$ ssh -n <span class="variable">$line</span> <span class="string">&quot;sh /home/test001/kill.sh;&quot;</span></span><br><span class="line">$ <span class="built_in">cat</span> /home/test001/kill.sh</span><br><span class="line">pstree -p | awk -F <span class="string">&#x27;[)( ]+&#x27;</span> <span class="string">&#x27;$0~/screen/&#123;print $3&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;to kill &quot;</span><span class="variable">$line</span></span><br><span class="line">   pkill -9 -P <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ ssh -n <span class="variable">$line</span> <span class="string">&quot;top -n 3 -b | head&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ssh and awk</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;timeout 60 ssh <span class="variable">$line</span> \&quot;echo ps auxn \\| awk \&#x27;\\\\\\\$1!=0\&#x27; | bash \&quot;&quot;</span></span><br><span class="line">$ ssh root@test_node1 <span class="string">&quot;echo cat /tmp/tmp  \| awk \&#x27;\\\$1!=0\&#x27; | bash &quot;</span></span><br><span class="line">1 1 1</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> hosts | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$line</span> ; ssh -n <span class="variable">$line</span> <span class="string">&quot;pkill lustre_exporter; ps aux | grep run.sh&quot;</span>; scp run.sh <span class="variable">$line</span>:/root/; ssh -n <span class="variable">$line</span> <span class="string">&quot;screen -dmS test_screen /root/run.sh&quot;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line">ssh <span class="variable">$line</span> <span class="string">&quot;screen -dmS test su -s /bin/bash -c \&quot;cd /<span class="variable">$&#123;i&#125;</span>/test/; source test.sh;sh ./run.sh;\&quot;&quot;</span> &amp;</span><br><span class="line">((i++))</span><br><span class="line"><span class="keyword">done</span> &lt; test_hosts</span><br></pre></td></tr></table></figure>

<h4 id="grub"><a href="#grub" class="headerlink" title="grub"></a>grub</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># el7 not work well, some kernel parameters key word could not be remove or add, el8 is OK</span></span><br><span class="line"><span class="comment">#  printk.time=1 el7,el8,el9 enabled by default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># console=tty0 console=ttyS0,115200</span></span><br><span class="line"><span class="comment"># https://access.redhat.com/articles/3166931</span></span><br><span class="line"></span><br><span class="line">$ grub2-editenv - list | grep kernelopts</span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --remove-args=<span class="string">&#x27;crashkernel=auto rhgb quiet intel_idle.max_cstate=0&#x27;</span> --args=<span class="string">&#x27;crashkernel=0M-2G:128M,2G-6G:256M,6G-8G:512M,8G-:768M log_buf_len=16M intel_iommu=on amd_iommu=on consoleblank=0 pcie_aspm=off pcie_port_pm=off psi=1 amd_iommu=on iommu=pt skew_tick=1,nohz=on,rcu_nocb=0-63,mce=ignore_ce,noibrs,noibpb,nopti,nospectre_v2,nospectre_v1,l1tf=off audit=0 log_buf_len=16M consoleblank=0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Unixbench-5.1.2 </span></span><br><span class="line"><span class="comment">#./Run syscall -c 1</span></span><br><span class="line"><span class="comment">#noibrs,noibpb,nopti,nospectre_v2,nospectre_v1; 比较性能</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#iommu=pt</span></span><br><span class="line">The pt option only enables IOMMU <span class="keyword">for</span> devices used <span class="keyword">in</span> passthrough and will provide better host performance</span><br><span class="line"></span><br><span class="line"><span class="comment">#cgroup.memory=nokmem !</span></span><br><span class="line">Kernel memory accounting is enabled <span class="keyword">for</span> all memory cgroups by default. But it can be disabled system-wide by passing cgroup.memory=nokmem to the kernel at boot time. In this <span class="keyword">case</span>, kernel memory will not be accounted at all</span><br><span class="line"></span><br><span class="line">$ grubby --info=/boot/vmlinuz-4.18.0-425.13.1.el8_7.x86_64</span><br><span class="line">index=0</span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-4.18.0-425.13.1.el8_7.x86_64&quot;</span></span><br><span class="line">args=<span class="string">&quot;ro resume=/dev/mapper/almalinux-swap rd.lvm.lv=almalinux/root rd.lvm.lv=almalinux/swap crashkernel=0M-2G:128M,2G-6G:256M,6G-8G:512M,8G-:768M log_buf_len=16M intel_iommu=on amd_iommu=on consoleblank=0 pcie_aspm=off pcie_port_pm=off psi=1 <span class="variable">$tuned_params</span>&quot;</span></span><br><span class="line">root=<span class="string">&quot;/dev/mapper/almalinux-root&quot;</span></span><br><span class="line">initrd=<span class="string">&quot;/boot/initramfs-4.18.0-425.13.1.el8_7.x86_64.img <span class="variable">$tuned_initrd</span>&quot;</span></span><br><span class="line">title=<span class="string">&quot;AlmaLinux (4.18.0-425.13.1.el8_7.x86_64) 8.7 (Stone Smilodon)&quot;</span></span><br><span class="line"><span class="built_in">id</span>=<span class="string">&quot;276b824fad154247ad86a08e71712806-4.18.0-425.13.1.el8_7.x86_64&quot;</span></span><br><span class="line"></span><br><span class="line">$ reboot</span><br><span class="line">$ <span class="built_in">cat</span> /proc/cmdline</span><br><span class="line">BOOT_IMAGE=(hd0,msdos2)/vmlinuz-4.18.0-425.13.1.el8_7.x86_64 root=/dev/mapper/almalinux-root ro resume=/dev/mapper/almalinux-swap rd.lvm.lv=almalinux/root rd.lvm.lv=almalinux/swap crashkernel=0M-2G:128M,2G-6G:256M,6G-8G:512M,8G-:768M log_buf_len=16M intel_iommu=on amd_iommu=on consoleblank=0 pcie_aspm=off pcie_port_pm=off psi=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable Pressure Stall Information(PSI), el8 and el9 support</span></span><br><span class="line">$ grep -i psi /boot/config-4.18.0-*.el8.x86_64 </span><br><span class="line">CONFIG_PSI=y</span><br><span class="line">CONFIG_PSI_DEFAULT_DISABLED=y</span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;psi=1&quot;</span></span><br><span class="line">$ <span class="built_in">ls</span> /proc/pressure/</span><br><span class="line">cpu  io  memory</span><br><span class="line">$ <span class="built_in">cat</span> /proc/pressure/cpu /proc/pressure/io /proc/pressure/memory</span><br><span class="line">some avg10=0.00 avg60=0.01 avg300=0.17 total=1821936</span><br><span class="line"></span><br><span class="line">some avg10=0.00 avg60=0.00 avg300=0.00 total=117679  &lt;----- some means the longest job waste the resource</span><br><span class="line">full avg10=0.00 avg60=0.00 avg300=0.00 total=97872   &lt;----- multiple <span class="built_in">jobs</span> waste the resource at the same time</span><br><span class="line"></span><br><span class="line">some avg10=0.00 avg60=0.00 avg300=0.00 total=0</span><br><span class="line">full avg10=0.00 avg60=0.00 avg300=0.00 total=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable pcie power save</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;pcie_aspm=off scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y consoleblank=0&#x27;</span></span><br><span class="line"></span><br><span class="line">grubby --remove-args=<span class="string">&quot;argX argY&quot;</span> --args=<span class="string">&quot;argA argB&quot;</span> --update-kernel /boot/kernel</span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## kernel boot blacklist</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;modprobe.blacklist=mpt2sas&#x27;</span></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/modprobe.d/anaconda-blacklist.conf</span><br><span class="line"><span class="comment"># Module blacklists written by anaconda</span></span><br><span class="line">blacklist mpt2sas</span><br><span class="line"></span><br><span class="line"><span class="comment">## disable screen saver,  The console blank (screen saver) timeout in seconds.</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;consoleblank=0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## debug boot information, Enabling this can be very useful for tracking down hardware issues.</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;earlyprintk=[ vga | serial ][,ttyS n [, baudrate ]][,keep]&#x27;</span></span><br><span class="line"></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&quot;crashkernel=0M-2G:128M,2G-6G:256M,6G-8G:512M,8G-:768M&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#AMD c0:08.1 PCI bridge: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B]</span></span><br><span class="line"><span class="comment">#kdump cause take a long time, and hang forever</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&quot;pcie_port_pm=off&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Disable consistent network device naming</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;biosdevname=0&#x27;</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;net.ifnames=0&#x27;</span></span><br><span class="line">or</span><br><span class="line"><span class="built_in">ln</span> -s /dev/null /etc/udev/rules.d/80-net-name-slot.rules</span><br><span class="line"></span><br><span class="line"><span class="comment">## disable hugepage and avoid vmware hang in ubuntu 20.04</span></span><br><span class="line">$ <span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">$ <span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;transparent_hugepage=never&#x27;</span></span><br><span class="line">$ sysctl -w vm.swappiness=5</span><br><span class="line">And Add swap to 2GB and <span class="built_in">disable</span> nvme write cache <span class="keyword">in</span> vmware disk setting, not the nvme block device</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## set boot order</span></span><br><span class="line">grubby --default-kernel</span><br><span class="line">grubby --default-index</span><br><span class="line">grubby --set-default /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br><span class="line">grubby --info=ALL</span><br><span class="line">grubby --info /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br></pre></td></tr></table></figure>

<p>set default boot  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">grubby --info=ALL</span><br><span class="line">index=0</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-514.6.1.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-514.6.1.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-514.6.1.el7.x86_64) 7 (Core)</span><br><span class="line">index=1</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-327.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-327.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)</span><br><span class="line">index=2</span><br><span class="line">kernel=/boot/vmlinuz-0-rescue-f614a3c482eb4b21add5ae750b3871bb</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-0-rescue-f614a3c482eb4b21add5ae750b3871bb.img</span><br><span class="line">title=CentOS Linux (0-rescue-f614a3c482eb4b21add5ae750b3871bb) 7 (Core)</span><br><span class="line">index=3</span><br><span class="line">non linux entry</span><br><span class="line"></span><br><span class="line">grubby --set-default /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br><span class="line">grubby --info /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>set debug parameters   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grubby --update-kernel=ALL --args=&#x27;mem=66G&#x27;</span><br><span class="line">## for debug</span><br><span class="line">grubby --update-kernel=ALL --args=&#x27;rd.debug rdudevdebug loglevel=7 systemd.log_level=debug systemd.log_target=console initcall_debug=1 console=ttyS1,115200n8&#x27;</span><br><span class="line"></span><br><span class="line">#module_initcall to parallel loading kernel module</span><br></pre></td></tr></table></figure>

<p>set kdump  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grubby --update-kernel=ALL --remove-args=<span class="string">&quot;crashkernel=auto&quot;</span> &lt;--- cause OOM-<span class="built_in">kill</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;crashkernel=256M@16M&#x27;</span></span><br><span class="line"><span class="comment">#an additional 64MB added for each TB of physical RAM present in the system. So for example if a system has 1TB of memory 192MB (128MB + 64MB) will be reserved</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#after you set 256M@16M</span></span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/kexec_crash_size</span><br><span class="line">268435456</span><br><span class="line"></span><br><span class="line">crashkernel=X@Y</span><br><span class="line">X: denotes how much memory to reserve <span class="keyword">for</span> the second kernel(capture kernel)</span><br><span class="line">Y: denotes what physical address the reserved memory section starts</span><br><span class="line">X-Y=Z: Capture kernel runs form reserved memory location(Z) </span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/3700611">set early kdump in RHEL 8</a></p>
<ul>
<li>Early kdump is a new feature of the kdump mechanism to capture the kernel crash dump of the booting kernel</li>
<li>In earlier releases of RHEL(5&#x2F;6&#x2F;7), the kdump service starts too late during the boot sequence, so early crashes will have no chance to get kdump kernel booting, this will cause crash information to be lost.</li>
<li>Early Kdump stores the vmlinuz and initramfs of the crash kernel inside the initramfs of the booting kernel and load them directly into the reserved memory (crashkernel) during early boot stage.</li>
<li>Two dracut modules are added in the kexec-tools package in order to load crash kernel and initramfs as early as possible during the boot sequence to capture the kernel crash dump of the booting kernel.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> kdump</span><br><span class="line">$ systemctl start kdump</span><br><span class="line">$ dracut --list-modules | grep earlykdump</span><br><span class="line">$ <span class="built_in">touch</span> /etc/systemd/system/sysrq.service</span><br><span class="line">$ <span class="built_in">chmod</span> 664 /etc/systemd/system/sysrq.service</span><br><span class="line">$ <span class="built_in">cat</span> /etc/systemd/system/sysrq.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Custom SysRq Service to <span class="built_in">test</span> early kdump</span><br><span class="line">Before=kdump.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/early-kdump-test.sh</span><br><span class="line">Type=simple</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /usr/local/early-kdump-test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/bin/grep <span class="string">&quot;early_panic&quot;</span> /proc/cmdline&gt; /dev/null</span><br><span class="line">output=$(<span class="built_in">echo</span> $?)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$output</span> -eq <span class="string">&quot;0&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> +x /usr/local/early-kdump-test.sh</span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl <span class="built_in">enable</span> sysrq.service</span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;early_panic&#x27;</span></span><br><span class="line">or</span><br><span class="line">$ dracut -f --add earlykdump</span><br><span class="line">$ journalctl -x | grep early-kdump</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6758921">RHEL 8 enable securetty PAM module</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">/etc/pam.d/login</span><br><span class="line"><span class="comment">#%PAM-1.0</span></span><br><span class="line">auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so     &lt;&lt;&lt;&lt;&lt;=====</span><br><span class="line">auth       substack     system-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line"></span><br><span class="line">/etc/pam.d/remote</span><br><span class="line">auth       required     pam_securetty.so     &lt;&lt;&lt;&lt;&lt;=====</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line"></span><br><span class="line">vi /etc/securetty</span><br><span class="line">console</span><br><span class="line">vc/1</span><br><span class="line">vc/2</span><br><span class="line">vc/3</span><br><span class="line">vc/4</span><br><span class="line">vc/5</span><br><span class="line">vc/6</span><br><span class="line">vc/7</span><br><span class="line">vc/8</span><br><span class="line">vc/9</span><br><span class="line">vc/10</span><br><span class="line">vc/11</span><br><span class="line">tty1</span><br><span class="line">tty2</span><br><span class="line">tty3</span><br><span class="line">tty4</span><br><span class="line">tty5</span><br><span class="line">tty6</span><br><span class="line">tty7</span><br><span class="line">tty8</span><br><span class="line">tty9</span><br><span class="line">tty10</span><br><span class="line">tty11</span><br><span class="line">ttyS0</span><br><span class="line">ttysclp0</span><br><span class="line">sclp_line0</span><br><span class="line">3270/tty1</span><br><span class="line">hvc0</span><br><span class="line">hvc1</span><br><span class="line">hvc2</span><br><span class="line">hvc3</span><br><span class="line">hvc4</span><br><span class="line">hvc5</span><br><span class="line">hvc6</span><br><span class="line">hvc7</span><br><span class="line">hvsi0</span><br><span class="line">hvsi1</span><br><span class="line">hvsi2</span><br><span class="line">xvc0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> 400 /etc/securetty</span><br></pre></td></tr></table></figure>

<p>set systemd journal not in the &#x2F;run&#x2F;log    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/journalctl --vacuum-size=200M #add it to the crond</span><br><span class="line"></span><br><span class="line">$ /etc/systemd/journald.conf</span><br><span class="line">Storage=persistent</span><br><span class="line">SystemMaxUse=2G</span><br><span class="line">SystemKeepFree=100G</span><br><span class="line"></span><br><span class="line">$ systemctl restart systemd-journald.service</span><br><span class="line"></span><br><span class="line">$ journalctl --vacuum-size=512M</span><br><span class="line">$ journalctl --vacuum-files=2</span><br><span class="line">$ journalctl --verify</span><br><span class="line"></span><br><span class="line">$ cd /usr/lib/tmpfiles.d/</span><br><span class="line">$ ls</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/ntpd</span><br><span class="line">ExecStart=/usr/sbin/ntpd -u ntp:ntp $OPTIONS</span><br><span class="line">PrivateTmp=true  &lt;--- tmp files</span><br><span class="line"></span><br><span class="line">sytemd-tmpfiles-setup.service</span><br><span class="line"></span><br><span class="line">## clean all</span><br><span class="line"># ExecStart=/usr/bin/systemd-tmpfiles --create --remove --boot --exclude-prefix=/dev</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">$ env SYSTEMD_LOG_LEVEL=debug systemd-tmpfiles --clean</span><br><span class="line"># http://bean-li.github.io/systemd-tmpfiles/</span><br></pre></td></tr></table></figure>

<h4 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a><a target="_blank" rel="noopener" href="https://gist.github.com/tuxfight3r/9ac030cb0d707bb446c7">tcpdump</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line">       -Q direction</span><br><span class="line">       --direction=direction</span><br><span class="line">              Choose send/receive direction direction <span class="keyword">for</span> <span class="built_in">which</span> packets should be captured. Possible values are `<span class="keyword">in</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">              `out&#x27;</span> and `inout<span class="string">&#x27;. Not available on all platforms.</span></span><br><span class="line"><span class="string">https://gmd20.github.io/blog/tcpdump%E5%92%8CAF_PACKET%E7%BC%96%E7%A8%8B%E5%8F%AA%E6%8A%93%E5%87%BA%E5%8E%BB%E6%88%96%E8%80%85%E8%BF%9B%E6%9D%A5%E6%96%B9%E5%90%91%E7%9A%84%E5%8C%85/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ tcpdump -i eth0 -s 0 -w /tmp/tcpdump.pcap host my-nfs-server-name-or-IP</span></span><br><span class="line"><span class="string">$ capinfos ./network.cap | grep &quot;Number of packets&quot;</span></span><br><span class="line"><span class="string">Number of packets:   302103</span></span><br><span class="line"><span class="string">$ tshark -tad -r tcpdump.cap -R &#x27;</span>nfs.procedure_v3 == READDIRPLUS<span class="string">&#x27; | wc</span></span><br><span class="line"><span class="string"> 116270 2034725 23480518</span></span><br><span class="line"><span class="string">$ tshark -tad -r ./network.cap -R &#x27;</span>nfs &amp;&amp; nfs.procedure_v3 != READDIRPLUS<span class="string">&#x27; | wc</span></span><br><span class="line"><span class="string">   1980   26987  241283</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#define ETH_P_PAUSE 0x8808 /* IEEE Pause frames</span></span><br><span class="line"><span class="string">$ tcpdump -w test.pcap -i bond0 ether proto 0x8808</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># get ack and syn packet</span></span><br><span class="line"><span class="string">$ tcpdump &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ tcpdump -n -i eth0 -A -x dst port 443 and greater 100</span></span><br><span class="line"><span class="string">$ tcpdump -i eth0 -nt -s 500 port 53 and udp</span></span><br><span class="line"><span class="string">$ tcpdump -ni enp97s0f0 -s0 -w /tmp/capture.pcap host $hostname1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ##TCP FLAGS##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Unskilled Attackers Pester Real Security Folks</span></span><br><span class="line"><span class="string">==============================================</span></span><br><span class="line"><span class="string">                     TCPDUMP FLAGS</span></span><br><span class="line"><span class="string">Unskilled =  URG  =  (Not Displayed in Flag Field, Displayed elsewhere)</span></span><br><span class="line"><span class="string">Attackers =  ACK  =  (Not Displayed in Flag Field, Displayed elsewhere)</span></span><br><span class="line"><span class="string">Pester    =  PSH  =  [P] (Push Data)</span></span><br><span class="line"><span class="string">Real      =  RST  =  [R] (Reset Connection)</span></span><br><span class="line"><span class="string">Security  =  SYN  =  [S] (Start Connection)</span></span><br><span class="line"><span class="string">Folks     =  FIN  =  [F] (Finish Connection)</span></span><br><span class="line"><span class="string">          SYN-ACK =  [S.] (SynAcK Packet)</span></span><br><span class="line"><span class="string">                     [.] (No Flag Set)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##USAGE##</span></span><br><span class="line"><span class="string">Basic communication // see the basics without many options</span></span><br><span class="line"><span class="string"># tcpdump -nS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Basic communication (very verbose) // see a good amount of traffic, with verbosity and no name help</span></span><br><span class="line"><span class="string"># tcpdump -nnvvS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A deeper look at the traffic // adds -X for payload but doesnt grab any more of the packet</span></span><br><span class="line"><span class="string"># tcpdump -nnvvXS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Heavy packet viewing // the final &quot;s&quot; increases the snaplength, grabbing the whole packet</span></span><br><span class="line"><span class="string"># tcpdump -nnvvXSs 1514</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">host // look for traffic based on IP address (also works with hostname if youre not using -n)</span></span><br><span class="line"><span class="string"># tcpdump host 1.2.3.4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">src, dst // find traffic from only a source or destination (eliminates one side of a host conversation)</span></span><br><span class="line"><span class="string"># tcpdump src 2.3.4.5</span></span><br><span class="line"><span class="string"># tcpdump dst 3.4.5.6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net // capture an entire network using CIDR notation</span></span><br><span class="line"><span class="string"># tcpdump net 1.2.3.0/24</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">proto // works for tcp, udp, and icmp. Note that you dont have to type proto</span></span><br><span class="line"><span class="string"># tcpdump icmp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port // see only traffic to or from a certain port</span></span><br><span class="line"><span class="string"># tcpdump port 3389</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">src, dst port // filter based on the source or destination port</span></span><br><span class="line"><span class="string"># tcpdump src port 1025 # tcpdump dst port 389</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">src/dst, port, protocol // combine all three</span></span><br><span class="line"><span class="string"># tcpdump src port 1025 and tcp</span></span><br><span class="line"><span class="string"># tcpdump udp and src port 53</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You also have the option to filter by a range of ports instead of declaring them individually, and to only see packets that are above or below a certain size.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Port Ranges // see traffic to any port in a range</span></span><br><span class="line"><span class="string">tcpdump portrange 21-23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Packet Size Filter // only see packets below or above a certain size (in bytes)</span></span><br><span class="line"><span class="string">tcpdump less 32</span></span><br><span class="line"><span class="string">tcpdump greater 128</span></span><br><span class="line"><span class="string">[ You can use the symbols for less than, greater than, and less than or equal / greater than or equal signs as well. ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// filtering for size using symbols</span></span><br><span class="line"><span class="string">tcpdump &gt; 32</span></span><br><span class="line"><span class="string">tcpdump &lt;= 128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ Note: Only the PSH, RST, SYN, and FIN flags are displayed in tcpdump&#x27;</span>s flag field output. URGs and ACKs are displayed, but they are shown elsewhere <span class="keyword">in</span> the output rather than <span class="keyword">in</span> the flags field ]</span><br><span class="line"></span><br><span class="line">Keep <span class="keyword">in</span> mind the reasons these filters work. The filters above find these various packets because tcp[13] looks at offset 13 <span class="keyword">in</span> the TCP header, the number represents the location within the byte, and the !=0 means that the flag <span class="keyword">in</span> question is <span class="built_in">set</span> to 1, i.e. its on.</span><br><span class="line"></span><br><span class="line">Show all URG packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 32 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all ACK packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 16 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all PSH packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 8 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all RST packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 4 != 0&#x27;</span></span><br><span class="line">Show all SYN packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 2 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all FIN packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] &amp; 1 != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all SYN-ACK packets:</span><br><span class="line"><span class="comment"># tcpdump &#x27;tcp[13] = 18&#x27;</span></span><br><span class="line"></span><br><span class="line">Show icmp <span class="built_in">echo</span> request and reply</span><br><span class="line"><span class="comment">#tcpdump -n icmp and &#x27;icmp[0] != 8 and icmp[0] != 0&#x27;</span></span><br><span class="line"></span><br><span class="line">Show all IP packets with a non-zero TOS field (one byte TOS field is at offset 1 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -v -n ip and ip[1]!=0</span></span><br><span class="line"></span><br><span class="line">Show all IP packets with TTL less than some value (on byte TTL field is at offset 8 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -v ip and &#x27;ip[8]&lt;2&#x27;</span></span><br><span class="line"></span><br><span class="line">Show TCP SYN packets:</span><br><span class="line"><span class="comment"># tcpdump -n tcp and port 80 and &#x27;tcp[tcpflags] &amp; tcp-syn == tcp-syn&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump tcp and port 80 and &#x27;tcp[tcpflags] == tcp-syn&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-syn) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP ACK packets:</span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-ack) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP SYN/ACK packets (typically, responses from servers):</span><br><span class="line"><span class="comment"># tcpdump -n tcp and &#x27;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) == (tcp-syn|tcp-ack)&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -n tcp and &#x27;tcp[tcpflags] &amp; tcp-syn == tcp-syn&#x27; and &#x27;tcp[tcpflags] &amp; tcp-ack == tcp-ack&#x27;</span></span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show TCP FIN packets:</span><br><span class="line"><span class="comment"># tcpdump -i &lt;interface&gt; &quot;tcp[tcpflags] &amp; (tcp-fin) != 0&quot;</span></span><br><span class="line"></span><br><span class="line">Show ARP Packets with MAC address</span><br><span class="line"><span class="comment"># tcpdump -vv -e -nn ether proto 0x0806</span></span><br><span class="line"></span><br><span class="line">Show packets of a specified length (IP packet length (16 bits) is located at offset 2 <span class="keyword">in</span> IP header):</span><br><span class="line"><span class="comment"># tcpdump -l icmp and &#x27;(ip[2:2]&gt;50)&#x27; -w - |tcpdump -r - -v ip and &#x27;(ip[2:2]&lt;60)&#x27;</span></span><br><span class="line"></span><br><span class="line">http://danielmiessler.com/study/tcpdump/</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment"># pcaplogwatch.sh</span></span><br><span class="line"><span class="comment"># - capture packets until a given string is seen in a given logfile</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line"><span class="comment">#   pcapLogwatch.sh DEVICE NUMBER-OF-FILES SIZE-OF-FILES DUMP-DIRECTORY DUMP-FILE-NAME FILTER LOG-FILE-NAME TRIGGER-STRING</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 8 ]</span><br><span class="line">     <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;Usage:&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> pcapLogwatch.sh DEVICE NUMBER-OF-FILES SIZE-OF-FILES \</span><br><span class="line">               DUMP-DIRECTORY DUMP-FILE-NAME FILTER LOG-FILE-NAME \</span><br><span class="line">               TRIGGER-STRING</span><br><span class="line">          <span class="built_in">echo</span> Where:</span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  DEVICE           name of the device used for capturing packets&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  NUMBER-OF-FILES number of files in the capture ring&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  SIZE-OF-FILES   size of each file (approximately)&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  DUMP-DIRECTORY  directory to put the files&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  DUMP-FILE-NAME  base name of the capture files&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  FILTER          tcpdump filter string, may be \&quot;\&quot;&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;  LOG-FILE-NAME   name of log file containing the trigger&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot; TRIGGER-STRING   when this string is seen tcpdump will be stopped&quot;</span>  </span><br><span class="line">          <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># After setting the parameters below, this script will run</span></span><br><span class="line"><span class="comment"># a rolling packet capture until the string in $LOG_STRING</span></span><br><span class="line"><span class="comment"># is found in $LOG_FILE. Set the optional $DUMP_FILTER with</span></span><br><span class="line"><span class="comment"># whatever libpcap filter as needed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Interface to capture on:</span></span><br><span class="line">DUMP_INTERFACE=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of capture files:</span></span><br><span class="line">DUMP_NUM=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of capture files:</span></span><br><span class="line">DUMP_SIZE=<span class="string">&quot;<span class="variable">$3</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory to save file to:</span></span><br><span class="line">DUMP_DIR=<span class="string">&quot;<span class="variable">$4</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filename to capture to:</span></span><br><span class="line">DUMP_NAME=<span class="string">&quot;<span class="variable">$5</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># libpcap Dump filter:</span></span><br><span class="line">DUMP_FILTER=<span class="string">&quot;<span class="variable">$6</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log file to monitor:</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;<span class="variable">$7</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># String to match in LOG_FILE:</span></span><br><span class="line">LOG_STRING=<span class="string">&quot;<span class="variable">$8</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time to wait after LOG_STRING found</span></span><br><span class="line"><span class="comment"># until the dump is stopped (in seconds):</span></span><br><span class="line">TIME_AFTER=1</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$DUMP_DIR</span>&quot;</span></span><br><span class="line"><span class="built_in">chmod</span> g+w <span class="string">&quot;<span class="variable">$DUMP_DIR</span>&quot;</span></span><br><span class="line"><span class="built_in">chgrp</span> tcpdump <span class="string">&quot;<span class="variable">$DUMP_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line">/usr/sbin/tcpdump -s 0 -w <span class="string">&quot;<span class="variable">$DUMP_DIR</span>/<span class="variable">$DUMP_NAME</span>&quot;</span> -W <span class="string">&quot;<span class="variable">$DUMP_NUM</span>&quot;</span> -C <span class="string">&quot;<span class="variable">$DUMP_SIZE</span>&quot;</span> -i <span class="string">&quot;<span class="variable">$DUMP_INTERFACE</span>&quot;</span> <span class="string">&quot;<span class="variable">$DUMP_FILTER</span>&quot;</span> &amp;DUMP_PID=$!</span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> --follow=name --pid=<span class="variable">$DUMP_PID</span> -n 0 <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | awk <span class="string">&quot;/<span class="variable">$LOG_STRING</span>/&#123;system(\&quot;sleep <span class="variable">$TIME_AFTER</span>; kill <span class="variable">$DUMP_PID</span>\&quot;)&#125;&quot;</span> &amp; </span><br><span class="line"><span class="built_in">disown</span> -a -h</span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"><span class="comment"># END pcapLogwatch.sh</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.wains.be/pub/networking/tcpdump_advanced_filters.txt">tcp filter</a>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- This rule will match any TCP traffic on port 80 (web) with 192.168.1.254 or 192.168.1.200 as destination host</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((tcp) and (port 80) and ((dst host 192.168.1.254) or (dst host 192.168.1.200)))&#x27;</span></span><br><span class="line"></span><br><span class="line">- Will match any ICMP traffic involving the destination with physical/MAC address 00:01:02:03:04:05</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((icmp) and ((ether dst host 00:01:02:03:04:05)))&#x27;</span></span><br><span class="line"></span><br><span class="line">- Will match any traffic <span class="keyword">for</span> the destination network 192.168 except destination host 192.168.1.200</span><br><span class="line"><span class="comment"># tcpdump -i eth1 &#x27;((tcp) and ((dst net 192.168) and (not dst host 192.168.1.200)))&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="MTU-problem-check"><a href="#MTU-problem-check" class="headerlink" title="MTU problem check"></a>MTU problem check</h4><p>Level 3 network, between 2 nodes pass through gateway<br>Tcpdump show some packets loss, nmap show 10.xx.xx.clent port is “open”.<br>There are some packages return, some are not.   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ping -f -c 20000 -M <span class="keyword">do</span> -s 8972 10.xx.xx.client</span><br><span class="line">PING 10.xx.xx.client (10.xx.xx.client) 8972(9000) bytes of data.</span><br><span class="line">...................................................................^C</span><br><span class="line">--- 10.xx.xx.client ping statistics ---</span><br><span class="line">67 packets transmitted, 0 received, 100% packet loss, time 1076ms</span><br></pre></td></tr></table></figure>

<p>You can got the issue from tcpdump, all larger than 1500 packets are loss.   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">client <span class="comment"># tcpdump -v host 10.53.19.52 and greater 1500</span></span><br><span class="line">tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes</span><br><span class="line">11:23:58.134708 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27071, offset 0, flags [DF], proto TCP (6), length 8532)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], <span class="built_in">cksum</span> 0x496d (incorrect -&gt; 0x5fe6), <span class="built_in">seq</span> 2359537411:2359545891, ack 3804990367, win 53, options [nop,nop,TS val 1203816317 ecr 81802289], length 8480</span><br><span class="line">11:23:58.136045 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27077, offset 0, flags [DF], proto TCP (6), length 7292)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [.], <span class="built_in">cksum</span> 0x4495 (incorrect -&gt; 0xe386), <span class="built_in">seq</span> 8480:15720, ack 1, win 53, options [nop,nop,TS val 1203816318 ecr 81802294], length 7240</span><br><span class="line">11:23:58.148023 IP (tos 0x0, ttl 63, <span class="built_in">id</span> 27083, offset 0, flags [DF], proto TCP (6), length 8588)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], <span class="built_in">cksum</span> 0x49a5 (incorrect -&gt; 0x4006), <span class="built_in">seq</span> 17016:25552, ack 1, win 53, options [nop,nop,TS val 1203816330 ecr 81802295], length 8536</span><br></pre></td></tr></table></figure>

<p>If client MTU is 1500, tcpdump(client) will not receive any large packages. they are loss in switch.      </p>
<h4 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ yum versionlock add docker-ce</span><br><span class="line">$ yum versionlock list</span><br><span class="line">$ yum versionlock delete docker-ce</span><br><span class="line">$ yum versionlock delete all</span><br><span class="line"></span><br><span class="line">$ yum install --enablerepo=<span class="string">&quot;epel&quot;</span> iotop</span><br><span class="line">$ yum update --exclude=kernel*</span><br><span class="line"></span><br><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">keepcache=0</span><br><span class="line">debuglevel=2</span><br><span class="line">logfile=/var/log/yum.log</span><br><span class="line">exclude=kernel* redhat-release* *.i?86</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10185">reference</a>  </p>
<p>Switch version, yum dnf versions</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ yum --showduplicates list kernel</span><br><span class="line">Installed Packages</span><br><span class="line">Installed Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       @anaconda-CentOS-201508042137.x86_64/6.7</span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   @update</span><br><span class="line">Available Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       base</span><br><span class="line">kernel.x86_64       2.6.32-573.1.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.3.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.7.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   update</span><br><span class="line">kernel.x86_64       2.6.32-573.12.1.el6  update</span><br><span class="line">kernel.x86_64       2.6.32-573.18.1.el6  update</span><br></pre></td></tr></table></figure>

<p>Yum.conf  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keepcache = 1</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10154">Download to local</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install yum-plugin-downloadonly</span><br><span class="line">$ yum install --downloadonly --downloaddir=&lt;directory&gt; &lt;package&gt;</span><br></pre></td></tr></table></figure>

<p>Resolve dependency resolution errors  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum update</span></span><br><span class="line">** Found 5 pre-existing rpmdb problem(s), <span class="string">&#x27;yum check&#x27;</span> output follows:</span><br><span class="line">MegaCli-8.04.10-1.noarch is a duplicate with MegaCli-8.04.07-1.noarch</span><br><span class="line">kernel-2.6.32-279.5.1.el6_lustre.gb16fe80.x86_64 has missing requires of kernel-firmware &gt;= (<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2.6.32&#x27;</span>, <span class="string">&#x27;279.5.1.el6_lustre.gb16fe80&#x27;</span>)</span><br><span class="line">kernel-firmware-2.6.32-279.5.1.el6.noarch is a duplicate with kernel-firmware-2.6.32-279.el6.noarch</span><br><span class="line">kernel-headers-2.6.32-279.5.1.el6.x86_64 is a duplicate with kernel-headers-2.6.32-279.el6.x86_64</span><br><span class="line">libcom_err-1.42.3.wc3-7.el6.x86_64 is a duplicate with libcom_err-1.41.12-12.el6.i686</span><br><span class="line">......</span><br><span class="line">You could try using --skip-broken to work around the problem</span><br><span class="line">You could try running: rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure>

<p>Uninstall rpm packages from rpmdb  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -e --justdb --nodeps <span class="string">&quot;bad rpm packages&quot;</span></span><br><span class="line">$ rpm -ivh --force <span class="string">&quot;replace normal rpm packages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rebuild rpmdb</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/rpm</span><br><span class="line">$ <span class="built_in">rm</span>  -f __db*</span><br><span class="line">$ rpm --rebuilddb</span><br><span class="line"></span><br><span class="line">$ yum clean all</span><br><span class="line">$ yum -y update</span><br></pre></td></tr></table></figure>
<h4 id="upgrade-kernel"><a href="#upgrade-kernel" class="headerlink" title="upgrade kernel"></a>upgrade kernel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://sourceware.org/elfutils/ftp/0.170/elfutils-0.170.tar.bz2</span><br><span class="line">$ tar xjvf elfutils-0.170.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> ./elfutils-0.170</span><br><span class="line">$ ./configire; make -j 8; make install</span><br><span class="line">$ <span class="built_in">export</span> C_INCLUDE_PATH=/sources/kernel/elfutils-0.170/libelf:/sources/lib/el7/mpich-3.2.1/include/:<span class="variable">$C_INCLUDE_PATH</span></span><br><span class="line">$ <span class="built_in">cp</span> -v /boot/config-3.10.0-693.21.1.el7.x86_64 .config</span><br><span class="line">make menuconfig</span><br><span class="line">make rpm-pkg</span><br><span class="line"><span class="comment">### enable what your want</span></span><br></pre></td></tr></table></figure>

<p>patch kernel  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.10.tar.xz</span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/patch-5.10.22.xz    <span class="comment">## size: 718K</span></span><br><span class="line"><span class="comment">## it &#x27;s the full patch from 5.10, not incr</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> linux-5.10</span><br><span class="line">$ patch -p1 --dry-run &lt; ../patch-5.10.22</span><br><span class="line"><span class="comment">### from 5.10 direct to 5.10.22</span></span><br><span class="line">$ patch -p1 &lt; ../path-5.10.22</span><br><span class="line">$ patch -p1 -R &lt; ../path-5.10.22</span><br><span class="line"></span><br><span class="line"><span class="comment">### from 5.10.21 to 5.10.22</span></span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.10.21.tar.xz</span><br><span class="line">$ wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/incr/patch-5.10.21-22.xz <span class="comment">## incr size: 15K</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> linux-5.10.21</span><br><span class="line">$ patch -p1 --dry-run &lt; ../patch-5.10.21-22</span><br><span class="line">...</span><br><span class="line">checking file security/tomoyo/network.c</span><br><span class="line">checking file sound/hda/intel-nhlt.c</span><br><span class="line">checking file sound/pci/ctxfi/cthw20k2.c</span><br><span class="line">checking file sound/pci/hda/patch_realtek.c</span><br><span class="line">Hunk <span class="comment">#1 succeeded at 6406 (offset -2 lines).</span></span><br><span class="line">Hunk <span class="comment">#2 succeeded at 7854 (offset -11 lines).</span></span><br><span class="line">Hunk <span class="comment">#3 succeeded at 7890 (offset -11 lines).</span></span><br><span class="line">checking file sound/usb/mixer.c</span><br><span class="line">checking file sound/usb/mixer_maps.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> -n 100 ../patch-5.10.21-22</span><br><span class="line">.....</span><br><span class="line">diff --git a/sound/usb/mixer_maps.c b/sound/usb/mixer_maps.c</span><br><span class="line">index a7212f16660ec..646deb6244b15 100644</span><br><span class="line">--- a/sound/usb/mixer_maps.c</span><br><span class="line">+++ b/sound/usb/mixer_maps.c</span><br><span class="line">@@ -536,6 +536,16 @@ static const struct usbmix_ctl_map usbmix_ctl_maps[] = &#123;</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">+       &#123;</span><br><span class="line">+               /* Corsair Virtuoso SE (wired mode) */</span><br><span class="line">+               .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3d),</span><br><span class="line">+               .map = corsair_virtuoso_map,</span><br><span class="line">+       &#125;,</span><br><span class="line">+       &#123;</span><br><span class="line">+               /* Corsair Virtuoso SE (wireless mode) */</span><br><span class="line">+               .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3e),</span><br><span class="line">+               .map = corsair_virtuoso_map,</span><br><span class="line">+       &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso (wired mode) */</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a41),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$  grep -A 6 <span class="string">&quot;USB_ID(0x05a7, 0x1020)&quot;</span> sound/usb/mixer_maps.c</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso (wired mode) */</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a41),</span><br><span class="line">                .map = corsair_virtuoso_map,</span><br><span class="line"></span><br><span class="line">$  patch -p1 &lt; ../patch-5.10.21-22</span><br><span class="line"></span><br><span class="line">$  grep -A 6 <span class="string">&quot;USB_ID(0x05a7, 0x1020)&quot;</span> sound/usb/mixer_maps.c</span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x05a7, 0x1020),</span><br><span class="line">                .map = bose_companion5_map,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                /* Corsair Virtuoso SE (wired mode) */  <span class="comment">### Add Virtuoso SE</span></span><br><span class="line">                .<span class="built_in">id</span> = USB_ID(0x1b1c, 0x0a3d),</span><br><span class="line">                .map = corsair_virtuoso_map,</span><br></pre></td></tr></table></figure>
<p>gen the patch, if you modify the kernel source  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ diff -urN <span class="built_in">arch</span>/x86/include/ ../linux-5.10.21/arch/x86/include/ &gt; patch-5.10.21-update</span><br><span class="line">or</span><br><span class="line">$ <span class="built_in">echo</span> patch1 &gt;&gt; patch2</span><br></pre></td></tr></table></figure>

<p>compile linux kernel ( build kernel debuginfo failed )<br><code>the easy way: &quot;adding -g into CXXFLAGS in your Makefile&quot; that debugging information is generated during build</code>   </p>
<p>You could disable randomize the address of the kernel image (KASLR)   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">https://unix.stackexchange.com/questions/717223/how-to-compile-linux-kernel-5-19-8-with-symbols-and-debugging-enabled</span><br><span class="line">make menuconfig --&gt; DEBUG_KERNEL --&gt; Debug information --&gt; choose the <span class="string">&quot;Rely on the toolchain&#x27;s implicit default DWARF version (DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT)&quot;</span></span><br><span class="line"></span><br><span class="line">CONFIG_RANDOMIZE_BASE=n</span><br><span class="line"></span><br><span class="line">$  /usr/lib/rpm/find-debuginfo.sh --strict-build-id /root/rpmbuild/BUILD/xxxx</span><br><span class="line">or Add to SPEC file</span><br><span class="line">%define debug_package 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `find /lib/modules/5.10.41 -name <span class="string">&#x27;*.ko&#x27;</span> -<span class="built_in">print</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        buildid=`eu-readelf -n <span class="variable">$file</span>| grep Build.ID: | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">        <span class="built_in">dir</span>=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c1-2`</span><br><span class="line">        fn=`<span class="built_in">echo</span> <span class="variable">$buildid</span> | <span class="built_in">cut</span> -c3-`</span><br><span class="line">        <span class="built_in">mkdir</span> -p /usr/lib/debug/.build-id/<span class="variable">$dir</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$fn</span></span><br><span class="line">        <span class="built_in">ln</span> -s <span class="variable">$file</span> /usr/lib/debug/.build-id/<span class="variable">$dir</span>/<span class="variable">$&#123;fn&#125;</span>.debug</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ dnf makecache --refresh</span><br><span class="line">$ dnf distro-sync</span><br><span class="line"></span><br><span class="line">$ dnf install nss nss-devel nspr nspr-devel file file-devel popt popt-devel libdb-devel libdb lua lua-devel libdb-devel libdb-cxx-devel libarchive-devel lua-devel redhat-rpm-config  rpmdevtools dwarves perl-ExtUtils-Embed asciidoc newt-devel xmlto audit-libs-devel libcap-devel ctl-devel slang-devel  pciutils-devel binutils-devel kernel-rpm-macros ncurses-devel elfutils-libelf-devel openssl-devel libgcrypt-devel  popt-devel lzo-devel lz4-devel bison flex dwarves</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cp</span> /boot/config-4.18.0-240.el8.x86_64 .config</span><br><span class="line">$ vi .config</span><br><span class="line"><span class="comment">#CONFIG_MODULE_SIG_KEY=&quot;certs/signing_key.pem&quot;</span></span><br><span class="line"><span class="comment">#CONFIG_SYSTEM_TRUSTED_KEYRING=n</span></span><br><span class="line"><span class="comment">#CONFIG_SYSTEM_TRUSTED_KEYS=&quot;certs/rhel.pem&quot;</span></span><br><span class="line"></span><br><span class="line">$ vi scripts/package/mkspec</span><br><span class="line"><span class="comment">## replace the line  %define debug_package %&#123;nil&#125; to %define with_debuginfo</span></span><br><span class="line">        %define __spec_install_post /usr/lib/rpm/brp-compress || :</span><br><span class="line">        %define with_debug 0</span><br><span class="line">        %define _enable_debug_packages 0</span><br><span class="line">        %define debuginfodir /usr/lib/debug <span class="comment">## not working</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"><span class="comment">#replace</span></span><br><span class="line">        %define __spec_install_post /usr/lib/rpm/brp-compress</span><br><span class="line"><span class="comment">#       %define __spec_install_post /usr/lib/rpm/brp-compress || :</span></span><br><span class="line"><span class="comment">#       %define debug_package %&#123;nil&#125;</span></span><br><span class="line">and</span><br><span class="line">        %install</span><br><span class="line">        <span class="built_in">mkdir</span> -p %&#123;buildroot&#125;/boot</span><br><span class="line">        %ifarch ia64</span><br><span class="line">        <span class="built_in">mkdir</span> -p %&#123;buildroot&#125;/boot/efi</span><br><span class="line">        <span class="built_in">cp</span> \$(<span class="variable">$MAKE</span> image_name) %&#123;buildroot&#125;/boot/efi/vmlinuz-<span class="variable">$KERNELRELEASE</span></span><br><span class="line">        <span class="built_in">ln</span> -s efi/vmlinuz-<span class="variable">$KERNELRELEASE</span> %&#123;buildroot&#125;/boot/</span><br><span class="line">        %<span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cp</span> \$(<span class="variable">$MAKE</span> image_name) %&#123;buildroot&#125;/boot/vmlinuz-<span class="variable">$KERNELRELEASE</span></span><br><span class="line">        %endif</span><br><span class="line">        /usr/lib/rpm/find-debuginfo.sh %&#123;_builddir&#125;/%&#123;?buildsubdir&#125;      &lt;-------------- add this line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try to</span><br><span class="line">        MAKE=<span class="string">&quot;<span class="variable">$MAKE</span> -j 8 -f <span class="variable">$srctree</span>/Makefile&quot;</span></span><br><span class="line">%build</span><br><span class="line">MAKE=<span class="string">&quot;<span class="variable">$MAKE</span> -j 8 -f <span class="variable">$srctree</span>/Makefile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### update dwarves-1.20</span></span><br><span class="line">$ dnf install cmake elfutils-devel elfutils-libs libbpf libdwarf</span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## at the last</span></span><br><span class="line">$ make menuconfig <span class="comment"># just save once, no many question</span></span><br><span class="line">Add <span class="built_in">enable</span> the compressed cache <span class="keyword">for</span> swap page by default</span><br><span class="line"></span><br><span class="line">└─&gt; Kernel hacking</span><br><span class="line">  └─&gt; Compile-time checks and compiler options</span><br><span class="line">    └─&gt; Compile the kernel with debug info</span><br><span class="line"></span><br><span class="line"><span class="comment">## rebuild rpm</span></span><br><span class="line">$ ./autogen.sh</span><br><span class="line">$ ./configure --prefix=/opt/rpm-4.16.1.3</span><br><span class="line">$ make -j 8</span><br><span class="line"></span><br><span class="line">$ make <span class="built_in">help</span></span><br><span class="line">$ make vmlinux -j 8</span><br><span class="line"></span><br><span class="line">https://unix.stackexchange.com/questions/293642/attempting-to-compile-kernel-yields-a-certification-error</span><br><span class="line">CONFIG_MODULE_SIG_KEY=<span class="string">&quot;&quot;</span> <span class="comment">#delete the key</span></span><br><span class="line"><span class="comment">#CONFIG_SYSTEM_TRUSTED_KEYRING=y</span></span><br><span class="line">CONFIG_SYSTEM_TRUSTED_KEYS=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ make bzImage -j 8</span><br><span class="line">$ make modules -j 8</span><br><span class="line">$ make modules_install -j 8</span><br><span class="line">$ make install -j 8</span><br><span class="line"><span class="comment">#has done in make install; dracut -f /boot/initramfs-5.10.41.el8.x86_64.img 5.10.41 #default path is /lib/modules</span></span><br><span class="line"></span><br><span class="line">$ grubby --set-default /boot/vmlinuz-5.10.41</span><br><span class="line">$ grubby --info=ALL</span><br><span class="line">or</span><br><span class="line">$ grub2-set-default 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="comment"># mrproper clean all</span></span><br><span class="line">$ sudo make mrproper</span><br><span class="line">$ sudo make clean</span><br><span class="line"></span><br><span class="line"><span class="comment">## contine complie kernel</span></span><br><span class="line">Add <span class="built_in">env</span> to bashrc</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/opt/rpm-4.16.1.3/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=/opt/rpm-4.16.1.3/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> C_INCLUDE_PATH=<span class="string">&quot;/usr/include&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HISTSIZE=50000</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=100000</span><br><span class="line"><span class="built_in">export</span> PS1=<span class="string">&quot;[\u@\h \A \w]# &quot;</span></span><br><span class="line"><span class="built_in">export</span> LS_COLORS=<span class="variable">$LS_COLORS</span>:<span class="string">&#x27;di=0;36&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> LS_COLORS=<span class="variable">$LS_COLORS</span>:<span class="string">&#x27;di=0;36m&#x27;</span></span><br><span class="line">                                   |</span><br><span class="line">                                the default the color is the cyan, <span class="keyword">if</span> you modify your termial color to red, it <span class="string">&#x27;s show the red color</span></span><br><span class="line"><span class="string">di	目录</span></span><br><span class="line"><span class="string">fi	文件</span></span><br><span class="line"><span class="string">ex	可执行文件</span></span><br><span class="line"><span class="string">ln	符号链接文件</span></span><br><span class="line"><span class="string">so	套接字</span></span><br><span class="line"><span class="string">bd	块设备</span></span><br><span class="line"><span class="string">cd	字符设备</span></span><br><span class="line"><span class="string">mi	丢失文件</span></span><br><span class="line"><span class="string">*.extension	例如：.mp3,.jpeg</span></span><br><span class="line"><span class="string">|      00      | None               |</span></span><br><span class="line"><span class="string">|      01      | Bold               |</span></span><br><span class="line"><span class="string">|      04      | Underscore         |</span></span><br><span class="line"><span class="string">|      05      | Blink              |</span></span><br><span class="line"><span class="string">|      07      | Reverse            |</span></span><br><span class="line"><span class="string">|      08      | Concealed          |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">|    Code      |      Text Color    |     |    Code      |      Text Color    |</span></span><br><span class="line"><span class="string">+--------------+--------------------+     +--------------+--------------------+</span></span><br><span class="line"><span class="string">|      30      | Black              |     |      90      | dark grey          |</span></span><br><span class="line"><span class="string">|      31      | Red                |     |      91      | light red          |</span></span><br><span class="line"><span class="string">|      32      | Green              |     |      92      | light green        |</span></span><br><span class="line"><span class="string">|      33      | Yellow             |     |      93      | yellow             |</span></span><br><span class="line"><span class="string">|      34      | Blue               |     |      94      | light blue         |</span></span><br><span class="line"><span class="string">|      35      | Magenta            |     |      95      | light purple       |</span></span><br><span class="line"><span class="string">|      36      | Cyan               |     |      96      | turquoise          |  &lt;----All colors depends your terminal setting, if 90 dark grey set to red, the 90 shows the red</span></span><br><span class="line"><span class="string">|      37      | White              |     |      97      | white              |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export LS_COLORS=$LS_COLORS:&#x27;</span>di=4;93<span class="string">&#x27;</span></span><br><span class="line"><span class="string">echo -e &quot;\033[04;41;37m  red background white string  \033[0m&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#PS1 color</span></span><br><span class="line"><span class="string">Front	Background	color</span></span><br><span class="line"><span class="string">30	40		black</span></span><br><span class="line"><span class="string">31	41		red</span></span><br><span class="line"><span class="string">32	42		green</span></span><br><span class="line"><span class="string">33	43		yellow</span></span><br><span class="line"><span class="string">34	44		blue</span></span><br><span class="line"><span class="string">35	45		purple</span></span><br><span class="line"><span class="string">36	46		cyan</span></span><br><span class="line"><span class="string">37	47		white</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export PS1=&quot;[\[\033[01;33m\]\t\[\033[00m\]]\[\033[01;31m\] \u\[\033[00m\]@\[\033[01;32m\]\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\n$ &quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ make rpm-pkg -j 8</span></span><br><span class="line"><span class="string">or</span></span><br><span class="line"><span class="string">$ yes &quot;&quot; | make rpm-pkg -j 8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## make kernel tools</span></span><br><span class="line"><span class="string">$ make -C tools/testing/selftests TARGETS=dma run_tests</span></span><br><span class="line"><span class="string">$ ls tools/testing/selftests | grep dma_map_benchmark</span></span><br><span class="line"><span class="string">## bind driver or you could not bind too</span></span><br><span class="line"><span class="string">$ echo dma_map_benchmark &gt; /sys/bus/pci/devices/0000:00:01.0/driver_override</span></span><br><span class="line"><span class="string">$ echo 0000:00:01.0 &gt; /sys/bus/pci/drivers/xxx/unbind</span></span><br><span class="line"><span class="string">$ echo 0000:00:01.0 &gt; /sys/bus/pci/drivers/dma_map_benchmark/bind</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cd /boot; bzip -dk vmlinux-5.10.41.bz2</span></span><br><span class="line"><span class="string">$ objcopy --only-keep-debug vmlinux-5.10.41 vmlinux-5.10.41.debug</span></span><br><span class="line"><span class="string">$ eu-readelf -n vmlinux-5.10.41 | grep Build.ID</span></span><br><span class="line"><span class="string">$ objcopy --strip-debug vmlinux-5.10.41</span></span><br><span class="line"><span class="string">crash add kernel module and could read the debug symbol, perf could get the source code too</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#or</span></span><br><span class="line"><span class="string">$ dma_map_benchmark -s 120 -t 16</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#not work in some AMD server</span></span><br><span class="line"><span class="string">$ grubby --update-kernel=ALL --remove-args=&quot;crashkernel=256M@16M&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#some report crashkernel=auto not working too. check the service status</span></span><br><span class="line"><span class="string">$ systemctl status kdump</span></span><br><span class="line"><span class="string">$ echo $?</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ grubby --update-kernel=ALL --args=&quot;crashkernel=384M-2G:64M,2G-:128M&quot;</span></span><br><span class="line"><span class="string">$ grubby --update-kernel=ALL --args=&quot;crashkernel=0M-2G:128M,2G-6G:256M,6G-8G:512M,8G-:768M&quot;</span></span><br></pre></td></tr></table></figure>


<h4 id="install-crash-7-3-0"><a href="#install-crash-7-3-0" class="headerlink" title="install crash-7.3.0"></a>install crash-7.3.0</h4><p>copy the gdb-7.6.0.tar.gz to the source code dir   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make lzo</span><br></pre></td></tr></table></figure>

<h4 id="Enable-BBR"><a href="#Enable-BBR" class="headerlink" title="Enable BBR"></a>Enable BBR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.core.default_qdisc=fq&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.tcp_congestion_control=bbr&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line">$ sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">net.ipv4.tcp_available_congestion_control = cubic bbr reno</span><br><span class="line"></span><br><span class="line">$ sysctl -n net.ipv4.tcp_congestion_control</span><br><span class="line">bbr</span><br></pre></td></tr></table></figure>

<h4 id="reinstall-grub2-from-boot-livecd"><a href="#reinstall-grub2-from-boot-livecd" class="headerlink" title="reinstall grub2 from boot livecd"></a>reinstall grub2 from boot livecd</h4><p>&#x2F;dev&#x2F;sdd2 is my linux root partition, OS is pinguyos(ubuntu) LVM partition  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## rescue mode</span></span><br><span class="line">$ pvscan</span><br><span class="line">$ vgscan</span><br><span class="line">$ lvscan</span><br><span class="line">$ lvchange -a y /dev/centos_vg/lv_root</span><br><span class="line"></span><br><span class="line"><span class="comment">## stripe mode</span></span><br><span class="line">$ lvcreate -i 2 -I 128k -n test_stripe_lv vg01</span><br><span class="line">              |</span><br><span class="line">              --- stripe count</span><br></pre></td></tr></table></figure>

<h5 id="test-under-ubuntu"><a href="#test-under-ubuntu" class="headerlink" title="test under ubuntu"></a>test under ubuntu</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdd2 /opt</span><br><span class="line">mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line"><span class="built_in">chroot</span> /opt</span><br><span class="line">grub-install /dev/sdd</span><br><span class="line">grub-install --root-directory=/mnt/sysimages/boot/efi /dev/sdd</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line">or</span><br><span class="line">grub2-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">### some md raid boot failed, and goto dracut env</span></span><br><span class="line">https://ahelpme.com/linux/centos7/centos-7-dracut-initqueue-timeout-and-could-not-boot-warning-dev-disk-by-id-md-uuid-does-not-exist/</span><br><span class="line"></span><br><span class="line">re-generate the grub.cfg</span><br><span class="line">Because some partition loss cause the system boot failed</span><br><span class="line">The system could be boot after delete the mduuid not exist</span><br></pre></td></tr></table></figure>

<h5 id="test-under-centos-7"><a href="#test-under-centos-7" class="headerlink" title="test under centos 7"></a>test under centos 7</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span>   /boot/grub2/grub.cfg | grep Windows</span><br><span class="line">menuentry <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-set-default  <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-editenv list</span><br><span class="line">saved_entry=Windows 7 (loader) (on /dev/sda1)</span><br><span class="line">or</span><br><span class="line">grub2-set-default <span class="string">&quot;windows&quot;</span></span><br><span class="line"></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.conf</span><br></pre></td></tr></table></figure>

<p>Re-install EFI under mdadm raid1 of the el7 and el8</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /opt/boot /opt/root</span><br><span class="line">$ mount /dev/sda1 /opt/root</span><br><span class="line">$ mount /dev/sda2 /opt/root/boot/efi</span><br><span class="line"></span><br><span class="line">$ mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">$ mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">$ mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chroot</span> /opt</span><br><span class="line"></span><br><span class="line">$ grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span><br><span class="line">$ yum install grub2-efi</span><br><span class="line">$ efibootmgr -c --disk /dev/sda --part 2 -l <span class="string">&#x27;\EFI\centos\shimx64.efi&#x27;</span> -L <span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">// --part 2 point EFI partition number,-l \\EFI\\FEDORA\\GRUBX64.EFI point the GRUB EFI boot loader</span><br><span class="line"></span><br><span class="line"><span class="comment">#under AlamLinux/CentOS 8.5</span></span><br><span class="line"><span class="comment">#reinstall efi boot entry on the mdadm RAID1</span></span><br><span class="line"><span class="comment">#https://github.com/rear/rear/issues/2524</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make sure the uefi boot</span></span><br><span class="line"><span class="comment"># https://www.redhat.com/sysadmin/bios-uefi</span></span><br><span class="line">$ <span class="built_in">ls</span> /sys/firmware/efi</span><br><span class="line">config_table  efivars  esrt  fw_platform_size  fw_vendor  mok-variables  runtime  runtime-map  systab  vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">df</span> -h /boot/ /boot/efi</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/md127      991M  212M  713M  23% /boot</span><br><span class="line">/dev/md124      201M  5.8M  195M   3% /boot/efi</span><br><span class="line"></span><br><span class="line"><span class="comment">#add a new device sdj to degraded raid1</span></span><br><span class="line">$ mdadm --manage /dev/md124 --add /dev/sdj3</span><br><span class="line">$ mdadm --manage /dev/md125 --add /dev/sdj2</span><br><span class="line">$ mdadm --manage /dev/md126 --add /dev/sdj4</span><br><span class="line">$ mdadm --manage /dev/md127 --add /dev/sdj1</span><br><span class="line"></span><br><span class="line"><span class="comment">#after rebuild</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/mdstats</span><br><span class="line">md124 : active raid1 sdx3[0] sdj3[1]</span><br><span class="line">      61756416 blocks super 1.2 [2/2] [UU]</span><br><span class="line">      bitmap: 1/1 pages [4KB], 65536KB chunk</span><br><span class="line"></span><br><span class="line">md127 : active raid1 sdx1[0] sdj1[1]</span><br><span class="line">      524288 blocks super 1.2 [2/2] [UU]</span><br><span class="line"></span><br><span class="line">$ grub2-install /dev/sdj</span><br><span class="line">ERROR: Failed to make bootable EFI image of GRUB2 (/usr/lib/grub/x86_64-efi/modinfo.sh)</span><br><span class="line"></span><br><span class="line"><span class="comment">#missing the grub2-efi-x64-modules</span></span><br><span class="line">$ dnf install grub2-efi-x64-modules</span><br><span class="line"></span><br><span class="line"><span class="comment">#reinstall packages</span></span><br><span class="line">$ yum reinstall grub2-efi shim-* grub2-efi-* grub2-common</span><br><span class="line">$ grub2-install /dev/sdj</span><br><span class="line">$ grub2-install --target=x86_64-efi /dev/sdj</span><br><span class="line">grub2-install: error: this utility cannot be used <span class="keyword">for</span> EFI platforms because it does not support UEFI Secure Boot.</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=sdx_10M bs=1M count=10</span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sdx bs=1M count=10</span><br><span class="line"></span><br><span class="line">                               -----md124 sdj3 /boot/efi</span><br><span class="line">                               |</span><br><span class="line">$ efibootmgr -c -d /dev/sdj -p 3 -w -L UEFI -l \EFI\almalinux\shimx64.efi -v</span><br><span class="line"><span class="comment">#https://bbs.archlinux.org/viewtopic.php?id=279445 worked for me</span></span><br><span class="line">$ reboot</span><br><span class="line"><span class="comment">#boot successful, if grub2-install no error, grub2-install is enough</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#remove</span></span><br><span class="line">$ efibootmgr -Bb 0000</span><br><span class="line"><span class="comment">#inactive</span></span><br><span class="line">$ efibootmgr -b 0002 -A</span><br><span class="line"><span class="comment">#active</span></span><br><span class="line">$ efibootmgr -b 0002 -a</span><br><span class="line"></span><br><span class="line">$ efibootmgr</span><br><span class="line"><span class="comment">#show the boot menu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#boot order</span></span><br><span class="line">$ efibootmgr -o 0000,0001,0006,0002,0004,0005,0003</span><br><span class="line">BootCurrent: 0005</span><br><span class="line">Timeout: 1 seconds</span><br><span class="line">BootOrder: 0000,0001,0006,0002,0004,0005,0003</span><br><span class="line">Boot0000* AlmaLinux</span><br><span class="line">Boot0001* AlmaLinux</span><br><span class="line">Boot0002  Network Card</span><br><span class="line">Boot0003* UEFI: Built-<span class="keyword">in</span> EFI Shell</span><br><span class="line">Boot0004  Hard Drive</span><br><span class="line">Boot0005* UEFI OS</span><br><span class="line">Boot0006* UEFI</span><br><span class="line"></span><br><span class="line"><span class="comment">#next boot</span></span><br><span class="line">$ efibootmgr -n 0001 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################&gt;&gt;&gt; centos7 issue under mdadm raid1 &lt;&lt;&lt;##################################</span></span><br><span class="line"><span class="comment">#https://tuxfixer.com/how-to-replace-a-volume-in-mdadm-software-raid-array</span></span><br><span class="line">$ grub2-install /dev/sda</span><br><span class="line">Installing <span class="keyword">for</span> i386-pc platform.</span><br><span class="line">grub2-install: error: disk `mduuid/13a75c2dd7275e4aedb6fb4acd9b9f7a<span class="string">&#x27; not found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ df -hT | grep /boot</span></span><br><span class="line"><span class="string">/dev/md127              xfs       973M  294M  679M  31% /boot</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cat /proc/mdstat</span></span><br><span class="line"><span class="string">Personalities : [raid1] </span></span><br><span class="line"><span class="string">md126 : active raid1 sda2[2] sdb2[3]</span></span><br><span class="line"><span class="string">      487252992 blocks super 1.2 [2/2] [UU]</span></span><br><span class="line"><span class="string">      bitmap: 3/4 pages [12KB], 65536KB chunk</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">md127 : active raid1 sda1[2] sdb1[3]</span></span><br><span class="line"><span class="string">      999424 blocks super 1.2 [2/2] [UU]</span></span><br><span class="line"><span class="string">      bitmap: 0/1 pages [0KB], 65536KB chunk</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">unused devices: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ umount /boot</span></span><br><span class="line"><span class="string">$ mdadm --stop /dev/md127</span></span><br><span class="line"><span class="string">$ mdadm --assemble --run /dev/md127 /dev/sda1 /dev/sdb1</span></span><br><span class="line"><span class="string">$ grub2-install /dev/sda</span></span><br><span class="line"><span class="string">$ grub2-install /dev/sdb</span></span><br><span class="line"><span class="string">#boot successful</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://forums.gentoo.org/viewtopic-t-1009410-start-0.html">Re-install i386-pc under mdadm error</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$ grub2-install --recheck /dev/sdx</span><br><span class="line">Installing <span class="keyword">for</span> i386-pc platform.</span><br><span class="line">grub2-install: error: disk `mduuid/xxxxxxxxxxxxxxxxxxxxxx<span class="string">&#x27; not found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ parted /dev/sdx</span></span><br><span class="line"><span class="string">GNU Parted 3.1</span></span><br><span class="line"><span class="string">Using /dev/sdx</span></span><br><span class="line"><span class="string">Welcome to GNU Parted! Type &#x27;</span><span class="built_in">help</span><span class="string">&#x27; to view a list of commands.</span></span><br><span class="line"><span class="string">(parted) p                                                                </span></span><br><span class="line"><span class="string">Model: Samsung Flash Drive FIT (scsi)</span></span><br><span class="line"><span class="string">Disk /dev/sdx: 128GB</span></span><br><span class="line"><span class="string">Sector size (logical/physical): 512B/512B</span></span><br><span class="line"><span class="string">Partition Table: gpt</span></span><br><span class="line"><span class="string">Disk Flags: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Number  Start   End     Size    File system  Name        Flags</span></span><br><span class="line"><span class="string"> 1      1049kB  4300MB  4299MB               Linux RAID  raid</span></span><br><span class="line"><span class="string"> 2      4300MB  4303MB  3146kB               Linux RAID  raid</span></span><br><span class="line"><span class="string"> 3      4303MB  64.0GB  59.7GB               Linux RAID  raid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ [ -d /sys/firmware/efi ] &amp;&amp; echo UEFI || echo BIOS</span></span><br><span class="line"><span class="string">BIOS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$  parted /dev/sdx</span></span><br><span class="line"><span class="string">GNU Parted 3.1</span></span><br><span class="line"><span class="string">Using /dev/sdx</span></span><br><span class="line"><span class="string">Welcome to GNU Parted! Type &#x27;</span><span class="built_in">help</span><span class="string">&#x27; to view a list of commands.</span></span><br><span class="line"><span class="string">(parted) set 1 bios_grub on                                               </span></span><br><span class="line"><span class="string">(parted) quit                                                             </span></span><br><span class="line"><span class="string">Information: You may need to update /etc/fstab.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ parted /dev/sdy</span></span><br><span class="line"><span class="string">GNU Parted 3.1</span></span><br><span class="line"><span class="string">Using /dev/sdy</span></span><br><span class="line"><span class="string">Welcome to GNU Parted! Type &#x27;</span><span class="built_in">help</span><span class="string">&#x27; to view a list of commands.</span></span><br><span class="line"><span class="string">(parted) set 1 bios_grub on                                               </span></span><br><span class="line"><span class="string">(parted) quit                                                             </span></span><br><span class="line"><span class="string">Information: You may need to update /etc/fstab.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ grub2-install /dev/sdx</span></span><br><span class="line"><span class="string">Installing for i386-pc platform.</span></span><br><span class="line"><span class="string">Installation finished. No error reported.</span></span><br><span class="line"><span class="string">$ grub2-install /dev/sdy</span></span><br><span class="line"><span class="string">Installing for i386-pc platform.</span></span><br><span class="line"><span class="string">Installation finished. No error reported.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---------------finish--------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#others command, if it &#x27;</span>s efi</span><br><span class="line">$ grub2-install --target=x86_64-efi --root-directory=/boot/efi /dev/sdy</span><br><span class="line">$ grub2-install --target=i386-pc --root-directory=/boot /dev/sdy</span><br></pre></td></tr></table></figure>


<h4 id="rdesktop-to-win10"><a href="#rdesktop-to-win10" class="headerlink" title="rdesktop to win10"></a><a target="_blank" rel="noopener" href="http://ubuntuforums.org/showthread.php?t=2287213">rdesktop to win10</a></h4><p>Enable remote desktop<br><img src="/img/e_desktop.png"><br><img src="/img/e_firewall.png"><br>Modify registry from win10  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\SecurityLayer</span><br><span class="line">from DWORD Hex <span class="string">&#x27;2 to a value of &#x27;</span>1</span><br></pre></td></tr></table></figure>

<h4 id="record-and-replay-linux-terminal"><a href="#record-and-replay-linux-terminal" class="headerlink" title="record and replay linux terminal"></a>record and replay linux terminal</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ script --timing=time.txt script.log</span><br><span class="line"><span class="comment"># record what you do</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ scriptreplay --timing=time.txt script.log</span><br><span class="line"><span class="comment"># replay</span></span><br></pre></td></tr></table></figure>

<h4 id="Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><a href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable" class="headerlink" title="Getting Error su: cannot set user id: Resource temporarily unavailable"></a>Getting Error su: cannot set user id: Resource temporarily unavailable</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -u</span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -u 10240</span><br><span class="line"></span><br><span class="line">$ /etc/security/limits.conf</span><br><span class="line">testuser         -      <span class="built_in">nproc</span>          10240</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/threads-max</span><br><span class="line">1026188</span><br></pre></td></tr></table></figure>

<h4 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lshw -c network -businfo</span><br><span class="line">Bus info          Device      Class          Description</span><br><span class="line">========================================================</span><br><span class="line">pci@0000:04:00.0  em1         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:04:00.1  em2         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:65:00.0  p2p1        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">pci@0000:65:00.1  p2p2        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">                  bond0       network        Ethernet interface</span><br></pre></td></tr></table></figure>

<h4 id="NMCLI-nmcli"><a href="#NMCLI-nmcli" class="headerlink" title="NMCLI nmcli"></a>NMCLI nmcli</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#static route</span></span><br><span class="line">$ nmcli connection modify bond1 +ipv4.routes <span class="string">&quot;192.168.23.0/24 192.168.0.247&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#restart in RHEL</span></span><br><span class="line">$ (<span class="built_in">sleep</span> 5; nmcli networking off; nmcli networking on) &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#VLAN with bond, vlan id 10</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> vlan ifname bond0.10 con-name bond0.10 <span class="built_in">id</span> 10 dev bond0</span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> vlan ifname bond0.10 con-name bond0.10 <span class="built_in">id</span> 10 dev bond0 ip4 10.20.30.10/24 gw4 10.20.30.1 ipv4.method manual</span><br><span class="line"><span class="comment"># if dhcp</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> vlan ifname bond0.10 con-name bond0.10 <span class="built_in">id</span> 10 dev bond0</span><br><span class="line"></span><br><span class="line"><span class="comment">#config file</span></span><br><span class="line">$ /etc/NetworkManager/NetworkManager.conf</span><br><span class="line"><span class="comment">#modify set DNS, In the [main]</span></span><br><span class="line">dns=none</span><br><span class="line">rc-manager=unmanaged</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/NetworkManager/system-connections/eno1.nmconnection</span><br><span class="line"></span><br><span class="line">$ nmcli conn down eno1</span><br><span class="line">$ nmcli conn up eno1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ mcli con add <span class="built_in">type</span> ethernet con-name static2 ifname enp0s3 ipv4.addresses 192.168.0.2/24 gw4 192.168.0.1 ipv4.method manual autoconnect <span class="built_in">yes</span></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ nmcli conn add <span class="built_in">type</span> ethernet con-name eno1</span><br><span class="line">$ nmcli conn up eno1</span><br><span class="line">$ nmcli dev status</span><br><span class="line"></span><br><span class="line"><span class="comment">#not working</span></span><br><span class="line">$ nmcli connection modify eno1 802-3-ethernet.auto-negotiate no 802-3-ethernet.speed 10000 802-3-ethernet.duplex full</span><br><span class="line">$ nmcli connection up eno1</span><br><span class="line">$ nmcli con mod eno1 ipv4.method manual</span><br><span class="line"></span><br><span class="line"><span class="comment">#not worked</span></span><br><span class="line">$ nmcli con edit <span class="string">&quot;Bond connection 1&quot;</span></span><br><span class="line">nmcli&gt; remove ipv4.addresses</span><br><span class="line">nmcli&gt; remove ipv4.gateway</span><br><span class="line"></span><br><span class="line">$ nmcli con mod eno1 connection.autoconnect <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#nmcli show all config </span></span><br><span class="line">$ nmcli connection show eno1</span><br><span class="line">$ nmcli connection delete eno1</span><br><span class="line"></span><br><span class="line"><span class="comment">#remove ip addr; remove ipaddr nmcli</span></span><br><span class="line"></span><br><span class="line">$ nmcli connection mod <span class="string">&quot;Bond connection 1&quot;</span> method auto</span><br><span class="line">$ nmcli connection mod <span class="string">&quot;Bond connection 1&quot;</span> method none</span><br><span class="line">$ nmcli connection mod <span class="string">&quot;Bond connection 1&quot;</span> connection.autoconnect <span class="built_in">yes</span></span><br><span class="line">$ nmcli conn modify <span class="string">&quot;Bond connection 1&quot;</span> -ipv4.addresses 192.168.1.2/24 -ipv4.gateway 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># set bonding sub device to the bridge</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> bridge con-name br129 ifname br129</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bridge-slave ifname eno2 master br129</span><br><span class="line">$ brctl show </span><br><span class="line">$ nmcli conn up bridge-slave-eno2</span><br><span class="line">$ nmcli conn up br129</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#modify</span></span><br><span class="line">$ nmcli connection modify br0  ipv4.addresses 192.168.0.2/24 gw4 192.168.0.1 ipv4.method manual autoconnect <span class="built_in">yes</span></span><br><span class="line">$ nmcli con mod &lt;connection&gt; ip4 &lt;new-ip-address&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#bridge</span></span><br><span class="line">$ nmcli connection show</span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> bridge con-name br3 ifname br3</span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> ethernet slave-type bridge con-name ens801f1 ifname ens801f1 master br3</span><br><span class="line">$ nmcli connection mod br3 ipv4.addresses <span class="string">&#x27;192.0.2.1/24&#x27;</span> ipv4.gateway <span class="string">&#x27;192.0.2.254&#x27;</span> ipv4.dns <span class="string">&#x27;192.0.2.253&#x27;</span> ipv4.dns-search <span class="string">&#x27;example.com&#x27;</span> ipv4.method manual</span><br><span class="line">or</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bridge-slave ifname ens801f1 master br3</span><br><span class="line"></span><br><span class="line">$ nmcli con up br3</span><br><span class="line">or modify</span><br><span class="line">$ nmcli connection modify enp7s0 master br0</span><br><span class="line"></span><br><span class="line"><span class="comment">#just add bond0 to br3</span></span><br><span class="line">$ nmcli con modify <span class="string">&quot;bond0&quot;</span> master <span class="string">&quot;br3&quot;</span> slave-type bridge</span><br><span class="line"></span><br><span class="line"><span class="comment">#disable ipv4</span></span><br><span class="line">$ nmcli connection modify bridge0 ipv4.method disabled</span><br><span class="line"></span><br><span class="line"><span class="comment"># set ipaddr</span></span><br><span class="line">$ nmcli connection modify bridge0 ipv4.addresses <span class="string">&#x27;192.0.2.1/24&#x27;</span> ipv4.gateway <span class="string">&#x27;192.0.2.254&#x27;</span> ipv4.dns <span class="string">&#x27;192.0.2.253&#x27;</span> ipv4.dns-search <span class="string">&#x27;example.com&#x27;</span> ipv4.method manual</span><br><span class="line"></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> bridge autoconnect <span class="built_in">yes</span> con-name br0 ifname br0</span><br><span class="line">$ nmcli connection modify br0 ipv4.addresses 192.168.0.2/24 gw4 192.168.0.1 ipv4.method manual autoconnect <span class="built_in">yes</span></span><br><span class="line">$ nmcli connection modify br0 ipv4.dns 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#delete the old config</span></span><br><span class="line">$ nmcli connection del enp0s3</span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> bridge-slave autoconnect <span class="built_in">yes</span> con-name enp0s3 ifname enp0s3 master br0</span><br><span class="line">$ nmcli connection up br0</span><br><span class="line">$ nmcli con modify br0 bridge.stp <span class="built_in">yes</span></span><br><span class="line"><span class="comment">#add another one</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> bridge-slave autoconnect <span class="built_in">yes</span> con-name enp0s4 ifname enp0s4 master br0</span><br><span class="line"></span><br><span class="line"><span class="comment">#Using DHCP for IP addressing:</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> vlan ifname bond0.10 con-name bond0.10 <span class="built_in">id</span> 10 dev bond0</span><br><span class="line"></span><br><span class="line"><span class="comment">#With a static IP of  192.168.1.10/24 and gateway of 192.168.1.1:</span></span><br><span class="line">$ nmcli connection add <span class="built_in">type</span> vlan ifname bond0.10 con-name bond0.10 <span class="built_in">id</span> 10 dev bond0 ip4 192.168.1.10/24 gw4 192.168.1.1</span><br></pre></td></tr></table></figure>
<p>pin mac by systemd   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/systemd/network</span><br><span class="line">vi /etc/systemd/network/00-match-mac.link</span><br><span class="line"></span><br><span class="line">[Match]</span><br><span class="line">MACAddress=aa:bb:cc:<span class="built_in">dd</span>:ee:ff</span><br><span class="line"></span><br><span class="line">[Link]</span><br><span class="line">Name=netxxx</span><br><span class="line"></span><br><span class="line"><span class="comment">#or</span></span><br><span class="line"></span><br><span class="line">/etc/systemd/network/10-phy0.link</span><br><span class="line">[Match]</span><br><span class="line"><span class="comment"># Match card&#x27;s MAC address</span></span><br><span class="line">PermanentMACAddress=74:d1:2c:2c:6e:d8</span><br><span class="line">    </span><br><span class="line">[Link]</span><br><span class="line">Description=Ethernet Port 1</span><br><span class="line"><span class="comment"># Rename interface to phy0</span></span><br><span class="line">Name=phy0</span><br><span class="line"><span class="comment"># Override MAC address (spoof MAC address)</span></span><br><span class="line">MACAddress=11:22:33:44:55:66</span><br><span class="line"></span><br><span class="line">/etc/systemd/network/phy0.network</span><br><span class="line">[Match]</span><br><span class="line"><span class="comment"># Match interface name</span></span><br><span class="line">Name=phy0    </span><br><span class="line">    </span><br><span class="line">[Network]</span><br><span class="line">Description=Interface phy0 (network)</span><br><span class="line">DHCP=no</span><br><span class="line"><span class="comment"># Static IPv4 or IPv6 address with CIDR</span></span><br><span class="line">Address=192.168.1.123/24</span><br><span class="line">Gateway=192.168.1.1</span><br><span class="line"><span class="comment"># DNS server address</span></span><br><span class="line">DNS=192.168.1.1</span><br><span class="line">Domains=mynetwork.lan</span><br><span class="line"></span><br><span class="line">https://unix.stackexchange.com/questions/501928/systemd-set-mac-address-and-ip-address</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /tmp/pin_mac </span><br><span class="line">device=<span class="variable">$1</span></span><br><span class="line">count=<span class="variable">$2</span></span><br><span class="line">[[ ! -d /etc/systemd/network ]] &amp;&amp; <span class="built_in">mkdir</span> /etc/systemd/network</span><br><span class="line">mac_addr=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$&#123;device&#125;</span>/address)</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/network/<span class="variable">$&#123;count&#125;</span>-<span class="variable">$&#123;device&#125;</span>-mac.link &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Match]</span></span><br><span class="line"><span class="string">MACAddress=$&#123;mac_addr&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Link]</span></span><br><span class="line"><span class="string">Name=$&#123;device&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>bonding  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f1</span><br><span class="line">$ nmcli connection reload</span><br><span class="line"></span><br><span class="line"><span class="comment">###bond0</span></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0  miimon 100 mode 802.3ad ip4 <span class="variable">$ip</span> gw4 <span class="variable">$gw</span></span><br><span class="line"></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond-slave ifname p1p1 master bond0</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> bond-slave ifname p1p1 master bond0</span><br><span class="line"></span><br><span class="line">$ nmcli con mod bond0 +bond.option xmit_hash_policy=layer3+4</span><br><span class="line">$ <span class="built_in">cat</span> /sys/class/net/bond0/bonding/xmit_hash_policy</span><br><span class="line">layer3+4 1</span><br><span class="line"></span><br><span class="line">$ nmcli con mod p1p1 802-3-ethernet.mtu 9000</span><br><span class="line">$ nmcli con mod p1p2 802-3-ethernet.mtu 9000</span><br><span class="line">$ nmcli con mod bond0 802-3-ethernet.mtu 9000</span><br><span class="line"></span><br><span class="line">$ nmcli con up bond-slave-p1p1</span><br><span class="line">$ nmcli con up bond-slave-p1p2</span><br><span class="line">$ nmcli con up bond0</span><br><span class="line"></span><br><span class="line">BONDING_OPTS=<span class="string">&quot;mode=4 miimon=100 lacp_rate=fast xmit_hash_policy=layer3+4 arp_validate=0 updelay=30000&quot;</span></span><br><span class="line">BONDING_OPTS=<span class="string">&quot;mode=1 arp_interval=1000 arp_ip_target=&#123;&#123; gateway &#125;&#125; arp_validate=all&quot;</span></span><br><span class="line"></span><br><span class="line">$ nmcli con down Myoffice1 ; nmcli con up static1</span><br><span class="line"></span><br><span class="line">static setting</span><br><span class="line">$ nmcli connection modify ens1 +ipv4.routes <span class="string">&quot;10.168.0.0/24 192.168.0.1&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#remove static </span></span><br><span class="line">$ nmcli con show ens1 | grep route</span><br><span class="line">$ nmcli connection modify ens1 -ipv4.routes <span class="string">&quot;10.168.0.0/24 192.168.0.1&quot;</span> </span><br><span class="line"></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> ethernet con-name Myhome1 ifname enp0s3</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> ethernet con-name static2 ifname enp0s3 ip4 192.168.1.50/24 gw4 192.168.1.1</span><br><span class="line">$ nmcli con mod static2 ipv4.dns <span class="string">&quot;8.8.8.8 8.8.4.4&quot;</span></span><br><span class="line">$ nmcli con down static1 ; nmcli con up static2</span><br><span class="line">$ nmcli con show static2</span><br><span class="line">$ nmcli con mod static2 connection.autoconnect no</span><br><span class="line">$ nmcli con mod static2 connection.permissions <span class="variable">$username</span></span><br><span class="line">$ nmcli con mod static2 connection.permissions user:<span class="variable">$username1</span>,<span class="variable">$username2</span></span><br><span class="line"></span><br><span class="line">$ nmcli connection delete <span class="built_in">id</span> &lt;connection name&gt;</span><br><span class="line">$ nmcli connection delete CONNECTION_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify and delete</span></span><br><span class="line">nmcli con mod bond1 ipv4.method auto</span><br><span class="line">nmcli con mod bond1 -ipv4.addresses 192.168.0.24/24</span><br><span class="line">nmcli con mod bond1 +ipv4.addresses 192.168.1.24/24</span><br><span class="line">nmcli con mod bond1 ipv4.method manual</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#direct set failed because ipv4.addresses</span></span><br><span class="line"><span class="comment">#direct remove ipv4.addresses failed because ipv4.method,so that modify it to auto</span></span><br><span class="line"></span><br><span class="line">$ nmcli con mod bond0 ipv4.method link-local</span><br><span class="line"></span><br><span class="line"><span class="comment">#show all parameters </span></span><br><span class="line">$ nmcli -p con show bond0</span><br><span class="line"></span><br><span class="line"><span class="comment">#add vlan</span></span><br><span class="line">$ nmcli con add <span class="built_in">type</span> vlan ifname VLAN10 dev enp1s0 <span class="built_in">id</span> 10</span><br><span class="line">$ nmcli con add <span class="built_in">type</span> vlan con-name vlan20 dev enp1s0 <span class="built_in">id</span> 20 ip4 10.10.10.10/24 gw4 10.10.10.254</span><br><span class="line"></span><br><span class="line"><span class="comment">#The MTU setting determines the maximum size of the network layer packet. The maximum size of the payload the link-layer frame can carry in turn limits the network layer MTU. For standard Ethernet frames this means an MTU of 1500 bytes. It should not be necessary to change the MTU when setting up a VLAN as the link-layer header is increased in size by 4 bytes to accommodate the 802.1Q tag</span></span><br><span class="line"></span><br><span class="line">$ nmcli connection modify vlan-VLAN10 802.mtu 1496</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify name</span></span><br><span class="line">nmcli con edit vlan-VLAN10</span><br><span class="line">nmcli&gt; <span class="built_in">set</span> vlan.interface-name superVLAN</span><br><span class="line">nmcli&gt; <span class="built_in">set</span> connection.interface-name superVLAN</span><br><span class="line">nmcli&gt; save</span><br><span class="line">nmcli&gt; quit</span><br></pre></td></tr></table></figure>

<h4 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h4><p>|-    |-R(Read)–|-W(Write)————-|-X(Execute)—<br>|file | read     |append&#x2F;del&#x2F;modify data| exectute file<br>|dir  | list dir |create&#x2F;del&#x2F;modify&#x2F;move| cd dir    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">SUID (Set owner User ID up on execution)</span><br><span class="line"><span class="built_in">chmod</span> 4555/u+s /test</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> -l /usr/bin/passwd  /etc/shadow</span><br><span class="line">----------  1 root root  1005 Feb 14 14:15 /etc/shadow</span><br><span class="line">-rwsr-xr-x. 1 root root 27856 Aug  9  2019 /usr/bin/passwd</span><br><span class="line"></span><br><span class="line">SUID is defined as giving temporary permissions to a user to run a program/file with the permissions of the file owner rather that the user <span class="built_in">who</span> runs it</span><br><span class="line"></span><br><span class="line">SGID</span><br><span class="line"><span class="built_in">chmod</span> 2555/g+s /dir</span><br><span class="line">similar with SUID, it <span class="string">&#x27;s the group bit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Sticky Bit</span></span><br><span class="line"><span class="string">chmod 1777/chmod +t /tmp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- T refers to when the execute permissions are off.</span></span><br><span class="line"><span class="string">- t refers to when the execute permissions are on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The sticky bit is primarily used on shared directories.</span></span><br><span class="line"><span class="string">[For example if user bob creates a file named /tmp/bob, other user tom can not delete this file even when the /tmp directory has permission of 777. If sticky bit is not set then tom can delete /tmp/bob, as the /tmp/bob file inherits the parent directory permissions.](https://www.thegeekdiary.com/what-is-suid-sgid-and-sticky-bit/)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### touch set time</span></span><br><span class="line"><span class="string">##### back access time</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">%z     time of last status change, human-readable</span></span><br><span class="line"><span class="string">%Z     time of last status change, seconds since Epoch</span></span><br><span class="line"><span class="string">$ ls -flsR --time=atime --time-style=&#x27;</span>+%s<span class="string">&#x27; /home/homerl/Downloads/test</span></span><br><span class="line"><span class="string">128 -rwxrwxrwx 1 root root 17 1684506902 /home/homerl/Downloads/test</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ls -flsR --time=ctime --time-style=&#x27;</span>+%s<span class="string">&#x27; /home/homerl/Downloads/test</span></span><br><span class="line"><span class="string">128 -rwxrwxrwx 1 root root 17 1684402188 /home/homerl/Downloads/test</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ stat -c &#x27;</span>%Z<span class="string">&#x27; ~/Downloads/test</span></span><br><span class="line"><span class="string">1684402188</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ atime=$(stat -c%X $filename)</span></span><br><span class="line"><span class="string">$ touch -a --date=@$&#123;atime&#125; $newpath</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ mtime=$(stat -c%Z $filename)</span></span><br><span class="line"><span class="string">$ touch -m --date=@$&#123;mtime&#125; $newpath</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#set the timestamp of a file named file5 using the timestamp value of file1 using the following command</span></span><br><span class="line"><span class="string">$ touch file5 -r file1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#set the date of a file named file4 to 15 Feb </span></span><br><span class="line"><span class="string">$ touch -d &#x27;</span>15 Feb<span class="string">&#x27; file4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#set the access and modification time of a file named file4 to 11:25 AM Jan 10 of the year 2020</span></span><br><span class="line"><span class="string">$ touch -c -t 202001101125 file4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#change the access and modification time of a file named file3 to the current time</span></span><br><span class="line"><span class="string">$ touch -am file3</span></span><br></pre></td></tr></table></figure>

<h4 id="static-route-config"><a href="#static-route-config" class="headerlink" title="static route config"></a>static route config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">subnet mask could be</span><br><span class="line">01011000  255.255.255.88</span><br><span class="line"></span><br><span class="line">just recommend against using noncontiguous subnet masks.</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/network-scripts/route-em1</span><br><span class="line">ADDRESS0=10.64.0.0</span><br><span class="line">NETMASK0=255.240.0.0</span><br><span class="line">GATEWAY0=192.168</span><br><span class="line">ADDRESS1=10.200.0.0</span><br><span class="line">NETMASK1=255.252.0.0</span><br><span class="line">GATEWAY1=10.0.0.1</span><br><span class="line">ADDRESS2=10.236.0.0</span><br><span class="line">NETMASK2=255.255.0.0</span><br><span class="line">GATEWAY2=10.0.0.1</span><br></pre></td></tr></table></figure>
<h4 id="collectl"><a href="#collectl" class="headerlink" title="collectl"></a>collectl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ collectl --top iokb</span><br><span class="line">$ collectl --vmstat</span><br><span class="line">$ collectl -sZ</span><br><span class="line">$ collectl -c10 -f /opt</span><br><span class="line"></span><br><span class="line"><span class="comment">## replay collectl</span></span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT</span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT --from 15:02:00 --thru 15:02:05</span><br><span class="line">$ collectl --<span class="built_in">export</span> graphite,locahost,d=9 -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz</span><br><span class="line">$ collectl -m -p /var/log/collectl/2daygeek-20170105-150152.raw.gz -oT --from <span class="string">&quot;03:30:18&quot;</span> --thru <span class="string">&quot;06:32:08&quot;</span></span><br><span class="line"></span><br><span class="line">$ collectl --showoptions</span><br><span class="line">$ collectl --showsubsys</span><br><span class="line">$ collectl --showsubopts</span><br><span class="line">$ collectl --showtopopts</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,b=test-node -sCMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -m -r00:00,7 -f /var/log/collectl --rawtoo</span><br><span class="line">$ collectl -i3 -P -sCMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -m -r00:00,7 -f /var/log/collectl --rawtoo</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,d=1,s=dn -sCMDNT --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -rawtoo -f /var/log/collectl</span><br><span class="line">$ collectl -i3 --<span class="built_in">export</span> graphite,192.168.1.1:2003,b=test-node -s CMDNt --netfilt <span class="string">&quot;eth|en|p[0-9]|em|bond&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> --rawtoo -f /var/log/collectl/</span><br><span class="line"><span class="comment">### tip - if you add 8 to the debug flag, eg d=9, this tells the graphite module not to actually establish the connection with graphite&#x27;s carbon listener but to only echo the data that would have been sent.</span></span><br><span class="line">$ collectl --all --<span class="built_in">export</span> graphite,locahost,d=9 --rawtoo -f /var/log/collectl/</span><br><span class="line">$ collectl -i3 -sCDNMJFt --<span class="built_in">export</span> graphite,locahost,d=9 --rawtoo -f /var/log/collectl/</span><br><span class="line"></span><br><span class="line"><span class="comment"># collectl.conf</span></span><br><span class="line">DaemonCommands = collectl -i30 -sCDEFJMNTXYZs --netfilt <span class="string">&quot;eth|en|p[0-9]|em&quot;</span> --dskfilt <span class="string">&quot;nvme|sd&quot;</span> -f /var/log/collectl -r00:00,7 -m -F60 --rawtoo -P</span><br></pre></td></tr></table></figure>

<h4 id="time"><a href="#time" class="headerlink" title="time"></a>time</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time -f <span class="string">&quot;%E real,%U user,%S sys&quot;</span> <span class="built_in">sleep</span> 2</span><br><span class="line">0:02.00 real,0.00 user,0.00 sys</span><br><span class="line"></span><br><span class="line">$ /usr/bin/time -f <span class="string">&quot;%e real&quot;</span> <span class="built_in">sleep</span> 70</span><br><span class="line">70.00 real</span><br></pre></td></tr></table></figure>

<h4 id="youtube-download"><a href="#youtube-download" class="headerlink" title="youtube download"></a>youtube download</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains4 youtube-dl -F https://www.youtube.com/watch?v=_xxxxxx</span><br><span class="line">[info] Available formats <span class="keyword">for</span> _12OJxATpsA:</span><br><span class="line">format code  extension  resolution note</span><br><span class="line">249          webm       audio only tiny   62k , opus @ 50k (48000Hz), 51.86MiB</span><br><span class="line">250          webm       audio only tiny   81k , opus @ 70k (48000Hz), 68.24MiB</span><br><span class="line">140          m4a        audio only tiny  136k , m4a_dash container, mp4a.40.2@128k (44100Hz), 139.88MiB</span><br><span class="line">251          webm       audio only tiny  158k , opus @160k (48000Hz), 136.13MiB</span><br><span class="line">278          webm       256x144    144p  103k , webm container, vp9, 30fps, video only, 100.43MiB</span><br><span class="line">160          mp4        256x144    144p  115k , avc1.4d400c, 30fps, video only, 83.46MiB</span><br><span class="line">242          webm       426x240    240p  250k , vp9, 30fps, video only, 202.66MiB</span><br><span class="line">133          mp4        426x240    240p  257k , avc1.4d4015, 30fps, video only, 168.64MiB</span><br><span class="line">243          webm       640x360    360p  611k , vp9, 30fps, video only, 377.13MiB</span><br><span class="line">134          mp4        640x360    360p  665k , avc1.4d401e, 30fps, video only, 442.58MiB</span><br><span class="line">244          webm       854x480    480p 1052k , vp9, 30fps, video only, 677.08MiB</span><br><span class="line">135          mp4        854x480    480p 1343k , avc1.4d401f, 30fps, video only, 868.67MiB</span><br><span class="line">247          webm       1280x720   720p 2410k , vp9, 30fps, video only, 1.35GiB</span><br><span class="line">136          mp4        1280x720   720p 2678k , avc1.4d401f, 30fps, video only, 1.66GiB</span><br><span class="line">248          webm       1920x1080  1080p 4356k , vp9, 30fps, video only, 2.42GiB</span><br><span class="line">137          mp4        1920x1080  1080p 4525k , avc1.640028, 30fps, video only, 3.06GiB</span><br><span class="line">271          webm       2560x1440  1440p 9330k , vp9, 30fps, video only, 7.15GiB</span><br><span class="line">18           mp4        640x360    360p  622k , avc1.42001E, mp4a.40.2@ 96k (44100Hz), 685.04MiB</span><br><span class="line">22           mp4        1280x720   720p 1673k , avc1.64001F, mp4a.40.2@192k (44100Hz) (best)</span><br><span class="line"></span><br><span class="line">$ proxychains4 youtube-dl -f 137+bestaudio --merge-output-format mkv https://www.youtube.com/watch?v=_xxxxxx</span><br></pre></td></tr></table></figure>

<h4 id="uptime-and-vmstat-running"><a href="#uptime-and-vmstat-running" class="headerlink" title="uptime and vmstat running"></a>uptime and vmstat running</h4><ul>
<li>(uptime) number of processes that are either in a runnable or uninterruptable state.<ul>
<li>runnable state is either using the CPU or waiting to use the CPU.</li>
<li>A process in uninterruptable state is waiting for some I&#x2F;O access.</li>
</ul>
</li>
<li>(vmstat) Procs r: The number of runnable processes (running or waiting for run time, no contains uninterruptable state)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/loadavg</span><br><span class="line">47.36 46.22 43.95 53/1682 249686</span><br><span class="line">                     |      |</span><br><span class="line">                     |      -------- the PID of the process that was most recently created on the system.</span><br><span class="line">                     --------------- it consists of two numbers separated by a slash (/)</span><br><span class="line">                                     The first of these is the number of currently runnable(active) kernel scheduling entities</span><br><span class="line">                                     (active task = nr_running + nr_uninterruptible, processes, threads)</span><br><span class="line">                                     The value after the slash is the number of kernel scheduling entities that currently exist on the system</span><br><span class="line"></span><br><span class="line">/proc/loadavg</span><br><span class="line">linux-3.10.0-1127.el7/fs/proc/loadavg.c</span><br><span class="line">   static int loadavg_proc_show(struct seq_file *m, void *v)</span><br><span class="line"></span><br><span class="line">linux-3.10.0-1127.el7/include/linux/sched.h</span><br><span class="line">/*</span><br><span class="line"> * These are the constant used to fake the fixed-point load-average</span><br><span class="line"> * counting. Some notes:</span><br><span class="line"> *  - 11 bit fractions <span class="built_in">expand</span> to 22 bits by the multiplies: this gives</span><br><span class="line"> *    a load-average precision of 10 bits <span class="built_in">integer</span> + 11 bits fractional</span><br><span class="line"> *  - <span class="keyword">if</span> you want to count load-averages more often, you need more</span><br><span class="line"> *    precision, or rounding will get you. With 2-second counting freq,</span><br><span class="line"> *    the EXP_n values would be 1981, 2034 and 2043 <span class="keyword">if</span> still using only</span><br><span class="line"> *    11 bit fractions.</span><br><span class="line"> */</span><br><span class="line">extern unsigned long avenrun[];         /* Load averages */</span><br><span class="line">extern void get_avenrun(unsigned long *loads, unsigned long offset, int <span class="built_in">shift</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#define FSHIFT          11              /* nr of bits of precision */</span></span><br><span class="line"><span class="comment">#define FIXED_1         (1&lt;&lt;FSHIFT)     /* 1.0 as fixed-point */</span></span><br><span class="line"><span class="comment">#define LOAD_FREQ       (5*HZ+1)        /* 5 sec intervals */</span></span><br><span class="line"><span class="comment">#define EXP_1           1884            /* 1/exp(5sec/1min) as fixed-point */  1mins weights</span></span><br><span class="line"><span class="comment">#define EXP_5           2014            /* 1/exp(5sec/5min) */    5 mins weights</span></span><br><span class="line"><span class="comment">#define EXP_15          2037            /* 1/exp(5sec/15min) */  15 mins weights</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define CALC_LOAD(load,exp,n) \</span></span><br><span class="line">        load *= exp; \</span><br><span class="line">        load += n*(FIXED_1-exp); \</span><br><span class="line">        load &gt;&gt;= FSHIFT;</span><br><span class="line"></span><br><span class="line">linux-3.10.0-1127.el7/kernel/sched/core.c</span><br><span class="line">/**</span><br><span class="line"> * get_avenrun - get the load average array</span><br><span class="line"> * @loads:      pointer to dest load array</span><br><span class="line"> * @offset:     offset to add</span><br><span class="line"> * @<span class="built_in">shift</span>:      <span class="built_in">shift</span> count to <span class="built_in">shift</span> the result left</span><br><span class="line"> *</span><br><span class="line"> * These values are estimates at best, so no need <span class="keyword">for</span> locking.</span><br><span class="line"> */</span><br><span class="line">void get_avenrun(unsigned long *loads, unsigned long offset, int <span class="built_in">shift</span>)</span><br><span class="line">&#123;</span><br><span class="line">        loads[0] = (avenrun[0] + offset) &lt;&lt; <span class="string">shift;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">linux-3.10.0-1127.el7/kernel/sched/core.c</span></span><br><span class="line"><span class="string">  calc_global_load</span></span><br><span class="line"><span class="string">    calc_load - update the avenrun load estimates 10 ticks after the CPUs have updated calc_load_tasks</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">avenrun[0]&#123;t&#125; = frac&#123;load&#123;t&#125; + load_&#123;t+5&#125; + load_&#123;t+10&#125; + &#x27;. + load_&#123;t+55&#125;&#125;&#123;60 / 5&#125;</span></span><br><span class="line"><span class="string">avenrun[0]&#123;t+5&#125; = avenrun[0]&#123;t&#125; - frac&#123;1&#125;&#123;60 / 5&#125; times load_&#123;t&#125; + frac&#123;1&#125;&#123;60 / 5&#125;times load_&#123;t+60&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">avgrun[] ---&gt; loadavg_proc_open(kernel) ---&gt; loadavg_proc_show(kernel) ---&gt; /proc/loadavg</span><br><span class="line"></span><br><span class="line">kernel/sched/core.c</span><br><span class="line">void get_avenrun(unsigned long *loads, unsigned long offset, int <span class="built_in">shift</span>)</span><br><span class="line">&#123;</span><br><span class="line"> loads[0] = (avenrun[0] + offset) &lt;&lt; <span class="string">shift;</span></span><br><span class="line"><span class="string"> loads[1] = (avenrun[1] + offset) &lt;&lt; shift</span>;</span><br><span class="line"> loads[2] = (avenrun[2] + offset) &lt;&lt; <span class="string">shift;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pre_cpu_queue pre_cpu_queue pre_cpu_queue pre_cpu_queue</span></span><br><span class="line"><span class="string">    |             |             |             |</span></span><br><span class="line"><span class="string">    |             |             |             |</span></span><br><span class="line"><span class="string">    V             V             V             V</span></span><br><span class="line"><span class="string"> running       running       running       running</span></span><br><span class="line"><span class="string">uninterrupt  uninterrupt   uninterrupt   uninterrupt</span></span><br><span class="line"><span class="string">    |             |             |             |</span></span><br><span class="line"><span class="string">    |             |             |             |</span></span><br><span class="line"><span class="string">    -------------------------------------------</span></span><br><span class="line"><span class="string">                         |</span></span><br><span class="line"><span class="string">                         V</span></span><br><span class="line"><span class="string">                   calc_load_tasks</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tick_sched_timer ---&gt; tick_sched_handle ---&gt; update_process_times ---&gt; scheduler_tick</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/sched/core.c</span></span><br><span class="line"><span class="string">void scheduler_tick(void)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> int cpu = smp_processor_id();</span></span><br><span class="line"><span class="string"> struct rq *rq = cpu_rq(cpu);</span></span><br><span class="line"><span class="string"> update_cpu_load_active(rq);</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/sched/core.c</span></span><br><span class="line"><span class="string">static void update_cpu_load_active(struct rq *this_rq)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string"> calc_load_account_active(this_rq);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//kernel/sched/core.c</span></span><br><span class="line"><span class="string">static void calc_load_account_active(struct rq *this_rq)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> delta  = calc_load_fold_active(this_rq);</span></span><br><span class="line"><span class="string"> if (delta)</span></span><br><span class="line"><span class="string">  atomic_long_add(delta, &amp;calc_load_tasks);</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/sched/core.c</span></span><br><span class="line"><span class="string">static long calc_load_fold_active(struct rq *this_rq)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> long nr_active, delta = 0;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> // R 和 D 状态的用户 task</span></span><br><span class="line"><span class="string"> nr_active = this_rq-&gt;nr_running;</span></span><br><span class="line"><span class="string"> nr_active += (long) this_rq-&gt;nr_uninterruptible;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> // 只返回变化的量</span></span><br><span class="line"><span class="string"> if (nr_active != this_rq-&gt;calc_load_active) &#123;</span></span><br><span class="line"><span class="string">  delta = nr_active - this_rq-&gt;calc_load_active;</span></span><br><span class="line"><span class="string">  this_rq-&gt;calc_load_active = nr_active;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> return delta;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Exponential Weighted Moving Average,EMWA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">arch/ia64/kernel/time.c</span></span><br><span class="line"><span class="string">void __init</span></span><br><span class="line"><span class="string">time_init (void)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> register_percpu_irq(IA64_TIMER_VECTOR, &amp;timer_irqaction);</span></span><br><span class="line"><span class="string"> ia64_init_itm();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">static struct irqaction timer_irqaction = &#123;</span></span><br><span class="line"><span class="string"> .handler = timer_interrupt,</span></span><br><span class="line"><span class="string"> .flags = IRQF_DISABLED | IRQF_IRQPOLL,</span></span><br><span class="line"><span class="string"> .name =  &quot;timer&quot;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/time/timekeeping.c</span></span><br><span class="line"><span class="string">void do_timer(unsigned long ticks)</span></span><br><span class="line"><span class="string">&#123; </span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string"> calc_global_load(ticks);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/sched/core.c</span></span><br><span class="line"><span class="string">void calc_global_load(unsigned long ticks)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string"> // 1.获取当前瞬时负载值</span></span><br><span class="line"><span class="string"> active = atomic_long_read(&amp;calc_load_tasks);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> // 2.平均负载的计算</span></span><br><span class="line"><span class="string"> avenrun[0] = calc_load(avenrun[0], EXP_1, active);</span></span><br><span class="line"><span class="string"> avenrun[1] = calc_load(avenrun[1], EXP_5, active);</span></span><br><span class="line"><span class="string"> avenrun[2] = calc_load(avenrun[2], EXP_15, active);</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel/sched/core.c</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"> * a1 = a0 * e + a * (1 - e)</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">static unsigned long</span></span><br><span class="line"><span class="string">calc_load(unsigned long load, unsigned long exp, unsigned long active)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> load *= exp;</span></span><br><span class="line"><span class="string"> load += active * (FIXED_1 - exp);</span></span><br><span class="line"><span class="string"> load += 1UL &lt;&lt; (FSHIFT - 1);</span></span><br><span class="line"><span class="string"> return load &gt;&gt; FSHIFT;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">https://mp.weixin.qq.com/s/zpLj1Z1jIMcwC8ruJln1sA</span></span><br></pre></td></tr></table></figure>


<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoqiaoq0/article/details/106932338">reference1</a><br><a target="_blank" rel="noopener" href="http://brytonlee.github.io/blog/2014/05/07/linux-kernel-load-average-calc/">reference2</a><br><a target="_blank" rel="noopener" href="https://www.ffutop.com/posts/2019-09-16-load-average/">reference3</a>   </p>
<h4 id="scan-file-size"><a href="#scan-file-size" class="headerlink" title="scan file size"></a>scan file size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#find the link</span></span><br><span class="line">$ find -L </span><br><span class="line"></span><br><span class="line"><span class="comment">## the diff performance in the diff file system</span></span><br><span class="line">$ find /tank -<span class="built_in">type</span> f \( -iname <span class="string">&quot;*high*&quot;</span> -o -iname <span class="string">&quot;*test*&quot;</span> -o -iname <span class="string">&quot;*.pub&quot;</span> \) -<span class="built_in">print</span> </span><br><span class="line">$ find /tank -<span class="built_in">printf</span> <span class="string">&#x27;%p\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span></span><br><span class="line">$ <span class="built_in">ls</span> -flsR --time=atime --time-style=<span class="string">&#x27;+%s&#x27;</span> /root/rpmbuild | awk <span class="string">&#x27;/:$/&amp;&amp;f&#123;f=0;&#125;;/:$/&amp;&amp;!f&#123;sub(/:$/,&quot;&quot;);s=$0;f=1;next&#125;;NF&amp;&amp;f&#123; print $0&quot; &quot;s &#125;&#x27;</span></span><br><span class="line">       |                                                               |                   |</span><br><span class="line">       |                                                               |                   --- first line trigger</span><br><span class="line">       |                                                               |</span><br><span class="line">       |                                                               ----- just change f value <span class="keyword">for</span> parent <span class="built_in">dirs</span> <span class="string">&quot;the last char is : , means no file, the next dir&quot;</span></span><br><span class="line">       |                                                                     next change the f value and try to the <span class="string">&quot;first line trigger&quot;</span> part to record the s val</span><br><span class="line">       --- the parameter could not out of order</span><br><span class="line"></span><br><span class="line"><span class="comment">## if you hava all dirs, just show ls info</span></span><br><span class="line">$ <span class="built_in">ls</span> -fls --time=atime --time-style=<span class="string">&#x27;+%s&#x27;</span> <span class="string">&quot;<span class="variable">$fpath</span>&quot;</span> | awk -v fpath=<span class="string">&quot;<span class="variable">$fpath</span>&quot;</span> <span class="string">&#x27;&#123;if(NF&gt;7) &#123;if($NF==&quot;.&quot; || $NF==&quot;..&quot;) &#123;next&#125; else &#123;a[$NF]=$0&#125; &#125; &#125; END&#123;for(i in a) &#123;print fpath&quot;/&quot;i,a[i]&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## you should find too many &quot;.&quot; files</span></span><br><span class="line">$ find /tank -name <span class="string">&quot;.*&quot;</span> -<span class="built_in">printf</span> <span class="string">&#x27;%P\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span> &gt; tank.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#exclude 2 dirs</span></span><br><span class="line">$ find /opt/test1 -<span class="built_in">type</span> f -not -path <span class="string">&quot;/opt/test1/linux1/*&quot;</span> -not -path <span class="string">&quot;/opt/test1/linux2/*&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="kernel-issue"><a href="#kernel-issue" class="headerlink" title="kernel issue"></a>kernel issue</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kernel:</span><br><span class="line">INFO: task xxx:xxx blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">kernel process or thread hang, could not be wake up at 120s</span><br><span class="line">        hungtask</span><br><span class="line">                hung_task_panic        0</span><br><span class="line">                hung_task_check_count  32768</span><br><span class="line">                hung_task_timeout_secs 120s</span><br><span class="line">                hung_task_warnings     10x <span class="built_in">times</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">softlockup</span><br><span class="line">NMI watchdog: BUG: soft lockup - CPU<span class="comment">#0 stuck for 23s! [cat:153]</span></span><br><span class="line">softlockup deadlock, check the kernel schdule is ok, <span class="keyword">if</span> trigger the softlockup, the kernel could not be schduled.</span><br><span class="line">When hrtimer wake up the kernel thread and update watchdog_touch_ts, <span class="keyword">if</span> time now - watchdog_touch_ts &gt; <span class="built_in">timeout</span> value, it will show this error, that mean schdule <span class="built_in">timeout</span>.</span><br><span class="line">/proc/sys/kernel/nmi_watchdog      hard lockup</span><br><span class="line">/proc/sys/kernel/soft_watchdog     soft lockup</span><br><span class="line">/proc/sys/kernel/watchdog          watchdog</span><br><span class="line">/proc/sys/kernel/watchdog_cpumask  watchdog cpumaks，</span><br><span class="line">/proc/sys/kernel/watchdog_thresh   watchdog timeoout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">softlockup : the kernel loop <span class="keyword">in</span> kernel mode without giving other tasks a chance to run, a kernel task won<span class="string">&#x27;t be unlock the CPU.</span></span><br><span class="line"><span class="string">             A soft lockup is when a running task is executing kernel code and wont yield the CPU to allow other tasks to run.</span></span><br><span class="line"><span class="string">             The default soft lockup threshold is 60 seconds for RHEL5/6 and 20 seconds on RHEL7.</span></span><br><span class="line"><span class="string">hardlockup : the kernel loop in kernel mode without letting other interrupts have change to run, the interrupts aren&#x27;</span>t being processes.</span><br><span class="line">             A hard lockup is when a CPU has interrupts disabled <span class="keyword">for</span> a long time, <span class="built_in">which</span> might block important communication between processes or hardware.</span><br><span class="line">             The default hard lockup threshold is 30 second on RHEL5/6 and 10 seconds on RHEL7.</span><br></pre></td></tr></table></figure>

<p>In redhat <a target="_blank" rel="noopener" href="https://access.redhat.com/articles/1353303">doc</a>   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    Each CPU has registered its own high resolution timer and both hard and soft lockup detection are closely connected with it.</span><br><span class="line">        This timer is fired approximately every [watchdog_thresh * 2 / 5]-seconds and does mainly three things:</span><br><span class="line">        Wakes up a CPU specific watchdog task with the highest possible priority, <span class="keyword">in</span> order to get scheduled as soon as possible. This tasks main job is to update a PER_CPU timestamp called watchdog_touch_ts.</span><br><span class="line">        Checks <span class="keyword">if</span> watchdog_touch_ts + watchdog_thresh is smaller than current actual time. If <span class="built_in">yes</span>, or <span class="keyword">in</span> other words, <span class="keyword">if</span> the watchdog task didnt run <span class="keyword">for</span> longer than watchdog_thresh, <span class="keyword">then</span> a soft lockup is reported.</span><br><span class="line">        Increments a CPU specific interrupt counter called hrtimer_interrupts, denoting that an interrupt happened on the CPU.</span><br><span class="line"></span><br><span class="line">Detecting a hard lockup is a bit trickier, since the CPU is stuck and has disabled interrupts. In order to detect it, each CPU has registered a watchdog perf event, <span class="built_in">which</span> ensures that the CPU hardware issues an NMI (non-maskable interrupt) every [hard lockup threshold]-seconds. Generally approximately 2-3 high resolution timer interrupts are supposed to happen in-between 2 of these NMIs.</span><br><span class="line">The handler <span class="keyword">function</span> of this NMI will check the hrtimer_interrupts counter and copy-save its current value. If it sees the same value as it has saved before, it reports a hard lockup, because it means that no interrupt happened during [hard lockup threshold]-seconds.</span><br><span class="line"></span><br><span class="line">Usually a CPU lockup is caused by a task stuck <span class="keyword">in</span> a loop. Sometimes its due to a code loop <span class="built_in">where</span> the termination condition has not yet been met. For example it may be an unbounded list (ie <span class="keyword">while</span> !list_empty()). In cases like this the code should <span class="built_in">limit</span> the maximum iterations of the loop before voluntarily yielding the CPU (ie cond_resched()).</span><br><span class="line"></span><br><span class="line">Often CPU lockups are caused by tasks trying to acquire a spinlock that <span class="keyword">for</span> some reason cannot be acquired <span class="keyword">in</span> a reasonable time. This could be due to current owner of the lock not relinquishing the lock or it may be a <span class="keyword">case</span> of starvation <span class="built_in">where</span> excessive activity on the lock delays some tasks long enough to exceed the watchdog threshold (ie RHEL5 spinlocks on ).</span><br><span class="line"></span><br><span class="line">Other cases involve a loop <span class="built_in">where</span> the termination condition is never going to be met. For example the code expects a state change that isnt going to happen.</span><br><span class="line"></span><br><span class="line">Its also possible to get <span class="literal">false</span> reports from the watchdog on virtual machines <span class="built_in">where</span> the host system stalls the guest <span class="keyword">for</span> longer than the watchdog threshold period. The watchdog will think the guest has been running during that time but the CPUs have not been able to make progress. </span><br><span class="line"></span><br><span class="line"><span class="comment">##default is enabled</span></span><br><span class="line">$ sysctl kernel.softlockup_panic kernel.hardlockup_panic</span><br><span class="line">kernel.softlockup_panic = 0</span><br><span class="line">kernel.hardlockup_panic = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">##disable, there is no soft lockup watchdog here</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/softlockup_panic</span><br></pre></td></tr></table></figure>

<h4 id="slowpath-and-fastpath"><a href="#slowpath-and-fastpath" class="headerlink" title="slowpath and fastpath"></a>slowpath and fastpath</h4><p><a target="_blank" rel="noopener" href="https://kernelnewbies.org/FAQ/FastpathAndSlowpath">In general</a>, “fast path” is the commonly run code that should finish very quickly. For example, when it comes to spinlocks the fast path is that nobody is holding the spinlock and the CPU that wants it can just take it.<br>Conversely, the slow path for spinlocks is that the lock is already taken by somebody else and the CPU will have to wait for the lock to be freed.<br>The first case is the common one that should be optimized.<br>The second one is not as important and does not need to be optimized much at all.    </p>
<h4 id="cgroup-limit-resource"><a href="#cgroup-limit-resource" class="headerlink" title="cgroup limit resource"></a>cgroup limit resource</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /sys/fs/cgroup/memory/</span><br><span class="line">$ <span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line">$ <span class="built_in">cd</span> /sys/fs/cgroup/memory/test</span><br><span class="line">$ <span class="built_in">echo</span> 5M &gt; memory.limit_in_bytes</span><br><span class="line">$ <span class="built_in">echo</span> $$ &gt;&gt; cgroup.procs <span class="comment">## add local bash </span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; memory.swappiness</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> memory.oom_control</span><br><span class="line"><span class="comment"># disable oom</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt;&gt; memory.oom_control<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>limit memory size  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cgcreate -g memory:DBLimitedGroup</span><br><span class="line">$ <span class="built_in">echo</span> 16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes</span><br><span class="line">$ <span class="built_in">sync</span>; <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ cgclassify -g memory:DBLimitedGroup $(pid)</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=<span class="string">&quot;test&quot;</span></span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/test/test 1234</span><br><span class="line">MemoryAccounting=<span class="literal">true</span></span><br><span class="line">MemoryHigh=1024K</span><br><span class="line">MemoryMax=4096K</span><br></pre></td></tr></table></figure>

<h4 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ldd /bin/ls</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007fff59353000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fa12b999000)</span><br><span class="line">        libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007fa12b794000)</span><br><span class="line">        libacl.so.1 =&gt; /lib64/libacl.so.1 (0x00007fa12b58b000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa12b1bd000)</span><br><span class="line">        libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fa12af5b000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fa12ad57000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fa12bbc0000)</span><br><span class="line">        libattr.so.1 =&gt; /lib64/libattr.so.1 (0x00007fa12ab52000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fa12a936000)</span><br></pre></td></tr></table></figure>

<p>Read ELF(Executable and Linking Format)  </p>
<p>Relocatable file (eg: xx.o)<br>Executable file<br>Dynamic Linking Library (eg: xx.so)<br>Static Linking Library (eg: xx.a)  </p>
<p>ELF Header<br>ELF Program Header Table&#x2F;Program Headers<br>ELF Section Header Table&#x2F;Section Headers<br>ELF Sections<br>multiple sections merge to a segment   </p>
<ul>
<li><a target="_blank" rel="noopener" href="http://tacy.github.io/post/binary/">To</a> retrieve a section header table:readelf -S <object></li>
<li>To retrieve a program header table: readelf -l <object></li>
<li>To retrieve a symbol table: readelf -s <object></li>
<li>To retrieve the ELF file header data: readelf -e <object></li>
<li>To retrieve relocation entries: readelf -r <object></li>
<li>To retrieve a dynamic segment: readelf -d <object></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -h /bin/ls</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2<span class="string">&#x27;s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              EXEC (Executable file)</span></span><br><span class="line"><span class="string">  Machine:                           Advanced Micro Devices X86-64</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x404324</span></span><br><span class="line"><span class="string">  Start of program headers:          64 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          115688 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x0</span></span><br><span class="line"><span class="string">  Size of this header:               64 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           56 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         9</span></span><br><span class="line"><span class="string">  Size of section headers:           64 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         30</span></span><br><span class="line"><span class="string">  Section header string table index: 29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$  readelf -S /bin/ls | grep debug</span></span><br><span class="line"><span class="string">  [27] .gnu_debuglink    PROGBITS         0000000000000000  0001b600</span></span><br><span class="line"><span class="string">  [28] .gnu_debugdata    PROGBITS         0000000000000000  0001b610 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -all /bin/ls</span></span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure>

<h4 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://stackoverflow.com/questions/34836775/compiler-standards-support-c11-c14-c17</span></span><br><span class="line">$ gcc -v --<span class="built_in">help</span> 2&gt; /dev/null | sed -n <span class="string">&#x27;/^ *-std=\([^&lt;][^ ]\+\).*/ &#123;s//\1/p&#125;&#x27;</span></span><br><span class="line">.......</span><br><span class="line">c++98</span><br><span class="line">c11</span><br><span class="line">c1x</span><br><span class="line">c89</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">$ objdump -i </span><br><span class="line"><span class="comment"># Display a list showing all architectures and object formats available for specification with -b or -m.</span></span><br><span class="line">...</span><br><span class="line">$ gcc -O2 -ggdb3 -c -o sort.o sort.c</span><br><span class="line">$ objdump -d sort.o</span><br><span class="line"><span class="comment">#Display the assembler mnemonics for the machine instructions from objfile</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;<span class="built_in">sort</span>&gt;:</span><br><span class="line">   0:   31 c0                   xor    %eax,%eax</span><br><span class="line">   2:   b9 01 00 00 00          mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">   7:   83 f8 1e                cmp    <span class="variable">$0x1e</span>,%eax</span><br><span class="line">   a:   7e 0b                   jle    17 &lt;<span class="built_in">sort</span>+0x17&gt;</span><br><span class="line">   c:   84 c9                   <span class="built_in">test</span>   %cl,%cl</span><br><span class="line">   e:   75 36                   jne    46 &lt;<span class="built_in">sort</span>+0x46&gt;</span><br><span class="line">  10:   b9 01 00 00 00          mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ objdump -t sort.o</span><br><span class="line"><span class="comment"># Print the symbol table entries of the file</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">SYMBOL TABLE:</span><br><span class="line">0000000000000000 l    <span class="built_in">df</span> *ABS*  0000000000000000 sort.c</span><br><span class="line">0000000000000000 l    d  .text  0000000000000000 .text</span><br><span class="line">0000000000000000 l    d  .data  0000000000000000 .data</span><br><span class="line">0000000000000000 l    d  .bss   0000000000000000 .bss</span><br><span class="line">0000000000000000 l    d  .rodata.str1.1 0000000000000000 .rodata.str1.1</span><br><span class="line">0000000000000000 l    d  .text.startup  0000000000000000 .text.startup</span><br><span class="line">0000000000000000 l    d  .debug_info    0000000000000000 .debug_info</span><br><span class="line">0000000000000000 l    d  .debug_abbrev  0000000000000000 .debug_abbrev</span><br><span class="line">0000000000000000 l    d  .debug_loc     0000000000000000 .debug_loc</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h4><p>list symbols from object files   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ nm ./walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br><span class="line"></span><br><span class="line">$ nm -e ./walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br></pre></td></tr></table></figure>

<h4 id="compile-process"><a href="#compile-process" class="headerlink" title="compile process"></a>compile process</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gcc -E -I ../include  test.c -o test.i</span><br><span class="line"><span class="comment">#Stop after the preprocessing stage; do not run the compiler proper.  The output is in the form of preprocessed source code, which is sent to the standard output</span></span><br><span class="line"></span><br><span class="line">gcc -S -I ../include  test.i -o test.s</span><br><span class="line"><span class="comment">#Stop after the stage of compilation proper; do not assemble.  The output is in the form of an assembler code file for each non-assembler input file specified</span></span><br><span class="line"></span><br><span class="line">gcc -c test.s -o test.o <span class="comment"># show info by objdump/readelf</span></span><br><span class="line"><span class="comment">#Compile or assemble the source files, but do not link.  The linking stage simply is not done.</span></span><br><span class="line"></span><br><span class="line">gcc -Wall -W -O2 -o <span class="built_in">test</span> test.o  ../lib/test.so -Wl,-rpath -Wl,../test/lib -Wl,-rpath -Wl,/usr/local/lib -I ../include</span><br><span class="line"><span class="comment">#link so</span></span><br></pre></td></tr></table></figure>


<p>kernel symbol table  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$  grep CONFIG_KALLSYMS /boot/config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_KALLSYMS=y</span><br><span class="line">CONFIG_KALLSYMS_ALL=y</span><br><span class="line"></span><br><span class="line">$ grep <span class="string">&quot; tcp_v4_do_rcv&quot;</span>  /proc/kallsyms</span><br><span class="line">ffffffff936c0c70 T tcp_v4_do_rcv</span><br><span class="line"><span class="comment">## Why addr is change ?</span></span><br><span class="line"></span><br><span class="line">$ grep CONFIG_RANDOMIZE_BASE /boot/config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_RANDOMIZE_BASE=y</span><br><span class="line"></span><br><span class="line"><span class="comment">## ALL info, the compiler optimize cause some symbols missing in kallsyms</span></span><br><span class="line">$ grep <span class="string">&quot; tcp_v4_do_rcv&quot;</span>  /boot/System.map-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">ffffffff816c0c70 T tcp_v4_do_rcv</span><br><span class="line"></span><br><span class="line">uppercase: global(external) symbol</span><br><span class="line">lowercase: <span class="built_in">local</span> symbol</span><br><span class="line">T The symbol is <span class="keyword">in</span> the text(code) section</span><br><span class="line">D The symbol is <span class="keyword">in</span> the initialized data section</span><br><span class="line">R The sysbol is <span class="keyword">in</span> a <span class="built_in">read</span> only data section</span><br><span class="line">t static</span><br><span class="line">d static</span><br><span class="line">R const</span><br><span class="line">r static const</span><br></pre></td></tr></table></figure>

<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">size add_lock</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">   5008     660       4    5672    1628 add_lock</span><br><span class="line"></span><br><span class="line">代码段： 只读，可共享; 代码段（code segment/text segment ）通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段&gt;为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。</span><br><span class="line">数据段： 储存已被初始化了的静态数据。数据段（data segment ）通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配。</span><br><span class="line">BSS 段：未初始化的数据段. BSS 段（bss segment ）通常是指用来存放程序中未初始化的全局变量的一块内存区域。BSS 是英文Block Started by Symbol 的简称。BSS 段属于静态内存分配。</span><br><span class="line">堆（heap ）：low to high, 堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）</span><br><span class="line">栈(stack) ： high to low, 栈又称堆栈，是用户存放程序临时创建的局部变量，也就是说我们函数括弧<span class="string">&quot;&#123;&#125; &quot;</span>中定义的变量（但不包括static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数&gt;被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出特点，所以栈特别方便用来保存/ 恢复调用现场。从这个意义上讲，我们可以把堆栈看成</span><br><span class="line">一个寄存、交换临时数据的内存区。</span><br><span class="line">另外, 在高地址还储存了命令行参数及环境变量.</span><br><span class="line"></span><br><span class="line">The heap is, generally speaking, one specific memory region created by the C runtime, and managed by malloc (<span class="built_in">which</span> <span class="keyword">in</span> turn uses the brk and sbrk system calls to grow and shrink).</span><br><span class="line">mmap is a way of creating new memory regions, independently of malloc (and so independently of the heap). munmap is simply its inverse, it releases these regions.</span><br><span class="line">Some picture show mmap high addr to low addr, same direction with stack</span><br></pre></td></tr></table></figure>

<h4 id="vim-jump-cursor"><a href="#vim-jump-cursor" class="headerlink" title="vim jump cursor"></a>vim jump cursor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:cal cursor(30, 5)</span><br></pre></td></tr></table></figure>

<h4 id="gpart-recovery-partition-table"><a href="#gpart-recovery-partition-table" class="headerlink" title="gpart recovery partition table"></a>gpart recovery partition table</h4><h5 id="boot-by-freebsd-livecd"><a href="#boot-by-freebsd-livecd" class="headerlink" title="boot by freebsd livecd"></a>boot by freebsd livecd</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ gpart disk list</span><br><span class="line">$ gpart recover /dev/sda</span><br><span class="line"></span><br><span class="line"><span class="comment">#backup and recoery</span></span><br><span class="line">$ yum install gdisk</span><br><span class="line">$ sgdisk --backup=vdb_part_1 /dev/vdb</span><br><span class="line">$ sgdisk --load-backup=vdb_part_1 /dev/vdb</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gdisk -l /dev/sda</span><br><span class="line">Sector size (logical): 512 bytes</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33 (first sector is reserve <span class="keyword">for</span> mbr)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=sda-gpt-partition-realtechtalk.img bs=$((<span class="number">33</span>*<span class="number">512</span>)) count=1</span><br></pre></td></tr></table></figure>



<h4 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#increase volume</span></span><br><span class="line">$ ffmpeg -i input.mp3 -af <span class="string">&#x27;volume=1.5&#x27;</span> output.mp3</span><br><span class="line"></span><br><span class="line">to mp3</span><br><span class="line">$ ffmpeg -i input.wav -vn -ar 44100 -ac 2 -b:a 192k output.mp3</span><br><span class="line"></span><br><span class="line">$ ffmpeg -i twiz-1080p.mkv -s 1280x720 -vcodec libx264 -crf 24 twiz-720p.mkv</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://superuser.com/questions/1324525/is-it-possible-to-speed-up-video-with-audio-using-ffmpeg-without-changing-audio</span></span><br><span class="line"><span class="comment">#The command above works if you want to multiply by 2 the speed. If you want to multiply by any &lt;x&gt;, the parameters become</span></span><br><span class="line">$ ffmpeg -i input.mkv -filter_complex <span class="string">&quot;[0:v]setpts=&lt;1/x&gt;*PTS[v];[0:a]atempo=&lt;x&gt;[a]&quot;</span> -map <span class="string">&quot;[v]&quot;</span> -map <span class="string">&quot;[a]&quot;</span> output.mkv</span><br><span class="line">$ ffmpeg -i input.mkv -filter_complex <span class="string">&quot;[0:v]setpts=0.87*PTS[v];[0:a]atempo=1.15[a]&quot;</span> -map <span class="string">&quot;[v]&quot;</span> -map <span class="string">&quot;[a]&quot;</span> output.mkv</span><br></pre></td></tr></table></figure>

<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h4><p><a target="_blank" rel="noopener" href="https://serverfault.com/questions/763582/how-to-configure-iptables-so-an-unwanted-port-is-not-reported-as-filtered">you could pretend 22 is the ssh port :) </a><br>change the ssh default port and set    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j drop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Don&#x27;t use DROP, that&#x27;s easily identified as &quot;filtered&quot; if you know the box is up. Instead, you may use the following to send a RST. (as if there is a service listening, but it doesn&#x27;t accept connections from you)</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j REJECT --reject-with tcp-reset</span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j REJECT</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run &#x27;chmod +x /etc/rc.d/rc.local&#x27; to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /var/lock/subsys/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset to a sane state, even if just temporarily</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Erase all the rules</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables --delete-chain</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -X</span><br><span class="line"></span><br><span class="line">nic=ems3</span><br><span class="line"><span class="comment"># disable icmp</span></span><br><span class="line"><span class="comment">#iptables -A INPUT  -p icmp --icmp-type echo-request -j DROP</span></span><br><span class="line"><span class="comment">#iptables -A OUTPUT -p icmp --icmp-type echo-reply -j DROP</span></span><br><span class="line">iptables -A INPUT -p icmp --icmp-type any -j DROP</span><br><span class="line">iptables -A OUTPUT -p icmp -j DROP</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -m state --state INVALID -j LOG --log-prefix <span class="string">&quot;DROP INVALID &quot;</span> --log-ip-options --log-tcp-options</span><br><span class="line">iptables -A INPUT -m state --state INVALID -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">## same with iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span></span><br><span class="line"><span class="comment"># Log attack</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; Null scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE  -m recent --name blacklist_60 --<span class="built_in">set</span> -m comment --comment <span class="string">&quot;Drop/Blacklist Null scan&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">## nmap -sX 192.168.0.2</span></span><br><span class="line"><span class="comment"># Log attacks</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS scan &quot;</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS-PSH scan &quot;</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; XMAS-ALL scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas/PSH scan&quot;</span> -j DROP <span class="comment"># Xmas-PSH scan</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas scan&quot;</span> -j DROP <span class="comment"># Against nmap -sX (Xmas tree scan)</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist Xmas/All scan&quot;</span> -j DROP <span class="comment"># Xmas All scan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### fin scan nmap -sF 192.168.0.2</span></span><br><span class="line"><span class="comment">#Log attack</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt; FIN scan &quot;</span></span><br><span class="line"><span class="comment"># Drop and blacklist for 60 seconds IP of attacker</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN -m recent --name blacklist_60 --<span class="built_in">set</span>  -m comment --comment <span class="string">&quot;Drop/Blacklist FIN scan&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">###ACK scan nmap -sA 192.168.0.2</span></span><br><span class="line">iptables   -A INPUT -p tcp ! --syn -m state --state NEW  -m comment --comment <span class="string">&quot;Drop TCP connection not starting by SYN&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">### SYN scan and TCP connect scan, nmap -sS 192.168.0.2, nmap -sT 192.168.0.2</span></span><br><span class="line"><span class="comment"># log  probable sS and full connect tcp scan</span></span><br><span class="line">iptables -A INPUT -p tcp  -m multiport --dports 23,79 --tcp-flags ALL SYN -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 3/m --limit-burst 5 -j LOG --log-prefix <span class="string">&quot;Firewall&gt;SYN scan trap:&quot;</span></span><br><span class="line"><span class="comment"># blacklist for three minuts</span></span><br><span class="line">iptables -A  INPUT -p tcp  -m multiport --dports 23,79 --tcp-flags ALL SYN -m recent --name blacklist_180 --<span class="built_in">set</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">### UDP scan</span></span><br><span class="line">iptables -A INPUT -p udp  -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 6/h --limit-burst 1 -m length --length 0:28 -j LOG --log-prefix <span class="string">&quot;Firewall&gt;0 length udp &quot;</span></span><br><span class="line">iptables -A INPUT -p udp -m length --length 0:28 -m comment --comment <span class="string">&quot;Drop UDP packet with no content&quot;</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simple NAT rule for outgoing traffic</span></span><br><span class="line"><span class="comment">#iptables -t nat -A POSTROUTING -o $nic -j MASQUERADE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allow established connections</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow loopback</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow the return half of established connections</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"><span class="comment"># Allow incoming and outgoing ssh</span></span><br><span class="line"><span class="comment">####  from Foreign ssh to this, eg: ssh port is 10000</span></span><br><span class="line">iptables -A INPUT -p tcp  --sport 30000:65535 --dport 10000 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">####  from this node ssh to the others</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 30000:65535 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#### vnc for 5901</span></span><br><span class="line">iptables -A INPUT -p tcp  --sport 30000:65535 --dport 5901 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#### ipmi web</span></span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp  --sport 30000:65535 --dport 5900 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># You probably want other stuff permitted here such as DNS on 53/udp and 53/tcp</span></span><br><span class="line"><span class="comment"># and maybe NTP on 123/udp</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p udp --dport 123 -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default policy is to discard all traffic</span></span><br><span class="line">iptables -P INPUT  DROP</span><br><span class="line">iptables -P OUTPUT DROP</span><br><span class="line">systemctl start fail2ban.service</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="comment">### block-scan </span></span><br><span class="line">iptables -N block-scan</span><br><span class="line">iptables -A block-scan -p tcp —tcp-flags SYN,ACK,FIN,RST RST -m <span class="built_in">limit</span> —<span class="built_in">limit</span> 1/s -j RETURN</span><br><span class="line">iptables -A block-scan -j DROP</span><br><span class="line"><span class="comment">### reset tcp</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 2049 -j REJECT --reject-with tcp-reset</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nmap.org/misc/defeat-nmap-osdetect.html">defeating Nmap OS-Fingerprinting</a><br><a target="_blank" rel="noopener" href="https://linuxhint.com/traceroute_nmap/">nmap traceroute</a><br><a target="_blank" rel="noopener" href="http://blog.sevagas.com/?Iptables-firewall-versus-nmap-and,31">iptables vs nmap</a>  </p>
<h4 id="fail2ban"><a href="#fail2ban" class="headerlink" title="fail2ban"></a>fail2ban</h4><p>Default firewalld policy maybe will conflicte with my iptables policy, disable firewalld and reset the policy   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">el7 and ubuntu 22.04</span><br><span class="line">$ yum install -y fail2ban</span><br><span class="line">$ <span class="built_in">cat</span> /etc/fail2ban/jail.local</span><br><span class="line">$ <span class="built_in">cat</span> /etc/fail2ban/jail.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># Ban hosts for one hour:</span></span><br><span class="line">bantime = 900</span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line">maxretry = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Override /etc/fail2ban/jail.d/00-firewalld.conf:</span></span><br><span class="line"><span class="comment"># banaction = iptables-multiport</span></span><br><span class="line">banaction = iptables</span><br><span class="line"></span><br><span class="line">[sshd]  <span class="comment">#ubuntu 22.04 has the default config for sshd, don&#x27;t write duplicate policy</span></span><br><span class="line">port    = 10000</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">logpath = /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line">filter    = sshd</span><br><span class="line"></span><br><span class="line">el8 </span><br><span class="line">$ <span class="built_in">cat</span> /etc/fail2ban/jail.d/01-sshd.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># Ban hosts for one hour:</span></span><br><span class="line">bantime = 10</span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line">maxretry = 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Override /etc/fail2ban/jail.d/00-firewalld.conf:</span></span><br><span class="line"><span class="comment"># banaction = iptables-multiport</span></span><br><span class="line">banaction = iptables</span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">port    = 10000</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">logpath = /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line">filter    = sshd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo fail2ban-client status sshd</span><br><span class="line">Status <span class="keyword">for</span> the jail: sshd</span><br><span class="line">|- Filter</span><br><span class="line">|  |- Currently failed: 0</span><br><span class="line">|  |- Total failed:     7</span><br><span class="line">|  `- Journal matches:  _SYSTEMD_UNIT=sshd.service + _COMM=sshd</span><br><span class="line">`- Actions</span><br><span class="line">   |- Currently banned: 1</span><br><span class="line">   |- Total banned:     1</span><br><span class="line">   `- Banned IP list:   192.168.1.10</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">tail</span> -f /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line">2021-01-22 10:42:38,088 fail2ban.actions        [1191]: INFO      banTime: 600</span><br><span class="line">2021-01-22 10:42:38,091 fail2ban.jail           [1191]: INFO    Jail <span class="string">&#x27;sshd&#x27;</span> started</span><br><span class="line">2021-01-22 10:43:27,767 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:57</span><br><span class="line">2021-01-22 10:43:27,768 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:58</span><br><span class="line">2021-01-22 10:43:27,768 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:58</span><br><span class="line">2021-01-22 10:43:27,769 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:42:59</span><br><span class="line">2021-01-22 10:43:27,769 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:00</span><br><span class="line">2021-01-22 10:43:27,770 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:02</span><br><span class="line">2021-01-22 10:43:27,770 fail2ban.filter         [1191]: INFO    [sshd] Found 192.168.1.10 - 2021-01-22 10:43:02</span><br><span class="line">2021-01-22 10:43:28,158 fail2ban.actions        [1191]: NOTICE  [sshd] Ban 192.168.1.10</span><br></pre></td></tr></table></figure>

<h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ lsof </span><br><span class="line">COMMAND    PID   USER   FD   TYPE        DEVICE SIZE/OFF      NODE NAME</span><br><span class="line"><span class="built_in">sched</span>        0   root  cwd   VDIR         136,8     1024         2 /</span><br><span class="line">init         1   root  cwd   VDIR         136,8     1024         2 /</span><br><span class="line">init         1   root  txt   VREG         136,8    49016      1655 /sbin/init</span><br><span class="line">init         1   root  txt   VREG         136,8    51084      3185 /lib/libuutil.so.1</span><br><span class="line">vi        2013   root    3u  VREG         136,8        0      8501 /var/tmp/ExXDaO7d</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the unix socket info</span></span><br><span class="line">$ lsof -aUc sshd</span><br><span class="line">COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">sshd     3199 root    1u  unix 0xffff8a8b39f96a40      0t0  43211 socket</span><br><span class="line">sshd     3199 root    2u  unix 0xffff8a8b39f96a40      0t0  43211 socket</span><br><span class="line">sshd    33510 root    4u  unix 0xffff8a7be8dac400      0t0 283548 socket</span><br><span class="line">sshd    78493 root    4u  unix 0xffff8a8b3a24d940      0t0 443790 socket</span><br><span class="line"></span><br><span class="line">$ ss -xp</span><br><span class="line"> ss -xp | grep sshd</span><br><span class="line">u_str  ESTAB      0      0       * 43211                 * 18675                 <span class="built_in">users</span>:((&quot;sshd&quot;,pid=<span class="number">3199</span>,fd=<span class="number">2</span>),(&quot;sshd&quot;,pid=<span class="number">3199</span>,fd=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/16300/whos-got-the-other-end-of-this-unix-socketpair">example</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof | grep whatever</span></span><br><span class="line">mysqld 14450 (...) unix 0xffff8801011e9600 (...) /var/run/mysqld/mysqld.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb /usr/lib/debug/boot/vmlinux-3.2.0-4-amd64 /proc/kcore</span></span><br><span class="line">(gdb) <span class="built_in">print</span> ((struct unix_sock*)<span class="number">0</span>xffff8801011e9600)-&gt;peer</span><br><span class="line"><span class="variable">$1</span> = (struct sock *) <span class="number">0</span>xffff880171f078c0</span><br><span class="line"></span><br><span class="line"># lsof | grep <span class="number">0</span>xffff880171f078c0</span><br><span class="line">mysql <span class="number">14815</span> (...) unix <span class="number">0</span>xffff880171f078c0 (...) socket</span><br></pre></td></tr></table></figure>

<h4 id="Process-accounting-on-Linux"><a href="#Process-accounting-on-Linux" class="headerlink" title="Process accounting on Linux"></a><a target="_blank" rel="noopener" href="https://www.networkworld.com/article/3571465/managing-process-accounting-on-linux.html">Process accounting on Linux</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/accton on</span><br><span class="line">Turning on process accounting, file <span class="built_in">set</span> to the default <span class="string">&#x27;/var/log/account/pacct&#x27;</span>.</span><br><span class="line">dump-acct /var/log/account/pacct | <span class="built_in">tail</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Command         vers  runtime   systime   elapsed    UID    GID   mem_use     chars      PID     PPID  ?    retcode  term     date/time&quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">sudo dump-acct /var/log/account/pacct | tail -5</span></span><br><span class="line"><span class="string">dump-acct /var/log/account/pacct | awk -F&#x27;|&#x27; &#x27;<span class="variable">$6</span> ~ / 1000$/&#x27;</span></span><br><span class="line"><span class="string">ls -ltr /var/log/account | tail -6</span></span><br><span class="line"><span class="string">/usr/sbin/accton off</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://developer.ibm.com/articles/au-lsof/">The Device, SIZE&#x2F;OFF, Node, and Name columns refer to the file itself, specifying the name of the disk, size of the file, inode (the files identification on the disk)</a>   </p>
<h4 id="git"><a href="#git" class="headerlink" title="git"></a>git</h4><h5 id="git-single-branch"><a href="#git-single-branch" class="headerlink" title="git single branch"></a>git single branch</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> -b  linux-5.10.y  --single-branch  https://mirrors.tuna.tsinghua.edu.cn/git/linux-stable.git</span><br></pre></td></tr></table></figure>

<h5 id="token"><a href="#token" class="headerlink" title="token"></a>token</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify pass</span></span><br><span class="line">$ git config --global --<span class="built_in">unset</span> user.password</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35942754/how-to-save-username-and-password-in-git/51164322#51164322">Use token replace password</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git add README.md</span><br><span class="line">$ git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">$ git remote add origin https://github.com/xxxx/xxxx.git</span><br><span class="line">$ git pull</span><br><span class="line">$ git push -u origin master </span><br><span class="line"></span><br><span class="line"><span class="comment">## got the token from the web</span></span><br><span class="line">$ git remote add tools https://<span class="variable">$&#123;username&#125;</span>:<span class="variable">$&#123;token_key&#125;</span>@github.com/xxxx/xxxx</span><br><span class="line">$ vi README.md</span><br><span class="line">$ git add --all</span><br><span class="line">$ git commit -m <span class="string">&quot;update readme&quot;</span></span><br><span class="line">$ git push tools master</span><br><span class="line"></span><br><span class="line"><span class="comment">## show repo</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment">## delete</span></span><br><span class="line">$ git remote <span class="built_in">rm</span> tools</span><br></pre></td></tr></table></figure>

<h4 id="Tick"><a href="#Tick" class="headerlink" title="Tick"></a>Tick</h4><p>Disable Tick to save power in some embedded device   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_NO_HZ</span><br><span class="line">CONFIG_NO_HZ_IDLE</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /boot/config-3.10.0-1127.el7.x86_64 | grep -Ei <span class="string">&quot;CONFIG_NO_HZ | CONFIG_NO_HZ_IDLE&quot;</span></span><br><span class="line"><span class="comment"># CONFIG_NO_HZ_IDLE is not set</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#io_ticks: the IO service wall-clock time in this device</span></span><br><span class="line">in_flight: The number of I/Os incomplete <span class="keyword">in</span> the queue, entry the queue +1, when the IO fininshed -1.</span><br><span class="line">time_in_queue = in_flight * wall-clock time</span><br><span class="line"></span><br><span class="line">time=100ms, nothing, in_flight=0, stamp=100, stamp_delta=nothing, io_tickes=0, time_in_queue=0</span><br><span class="line">time=100.1ms, the request <span class="keyword">in</span> the queue, in_flight=1, stamp=100, stamp_delta=100.1-100=0.1, io_tickes=0.1, time_in_queue=0.1*1=0.1</span><br><span class="line">time=101.2ms, the request <span class="keyword">in</span> the queue, in_flight=2, stamp=100.1, stamp_delta=101.2-100.1=1.1, io_tickes=1.1+0.1=1.2, time_in_queue=0.1*1+1.1*2=2.3</span><br><span class="line">time=103.6ms, 1x request finish, in_flight=1, stamp=101.2, stamp_delta=103.6-101.2=2.4, io_tickes=1.1+0.1+2.4=3.6, time_in_queue=0.1*1+1.1*2+2.4*1=4.7</span><br><span class="line">time=153.6ms, 1x request finish, in_flight=0, stamp=103.6, stamp_delta=nothing, io_tickes=1.1+0.1+2.4=3.6, time_in_queue=0.1*1+1.1*2+2.4*1=4.7</span><br><span class="line">time=153.9ms, 1x request <span class="keyword">in</span>, in_flight=1, stamp=153.6, stamp_delta=153.9-153.6=0.3, io_tickes=1.1+0.1+2.4+0.3=3.9, time_in_queue=0.1*1+1.1*2+2.4*1+0.3*1=5</span><br></pre></td></tr></table></figure>
<p>In this case, the time_in_queue &#x3D; sum(in_flight)<br>The_wall-clock_total_time means the interval time for this calculate<br>The iostat utils &#x3D; io_tickes&#x2F;The_wall-clock_total_time &#x3D; utils xx %   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_NO_HZ_COMMON=y</span><br><span class="line"><span class="comment"># CONFIG_HZ_PERIODIC is not set</span></span><br><span class="line"><span class="comment"># CONFIG_NO_HZ_IDLE is not set</span></span><br><span class="line">CONFIG_NO_HZ_FULL=y</span><br><span class="line"><span class="comment"># CONFIG_NO_HZ_FULL_ALL is not set</span></span><br><span class="line">CONFIG_NO_HZ=y</span><br><span class="line"><span class="comment"># CONFIG_RCU_FAST_NO_HZ is not set</span></span><br><span class="line"><span class="comment"># CONFIG_HZ_100 is not set</span></span><br><span class="line"><span class="comment"># CONFIG_HZ_250 is not set</span></span><br><span class="line"><span class="comment"># CONFIG_HZ_300 is not set</span></span><br><span class="line">CONFIG_HZ_1000=y</span><br><span class="line">CONFIG_HZ=1000</span><br></pre></td></tr></table></figure>

<h4 id="Dynticks"><a href="#Dynticks" class="headerlink" title="Dynticks"></a><a target="_blank" rel="noopener" href="http://www.lenky.info/archives/2013/07/2317">Dynticks</a></h4><ul>
<li><p>PREEMPT_RT kernel for latency</p>
</li>
<li><p>grub GRUB</p>
<ul>
<li>skew_tick&#x3D;1<ul>
<li>boot parameter reduces contention on these kernel locks</li>
</ul>
</li>
<li>nohz&#x3D;on,nohz_full&#x3D;2-39,rcu_nocbs&#x3D;2-39,rcu_nocb_poll&#x3D;2-39<ul>
<li>rcu_nocbs allow the user to move all RCU offload threads to a housekeeping CPU;</li>
<li>rcu_nocb_poll to relieve each CPU from the responsibility awakening their RCU offload threads</li>
</ul>
</li>
<li>mce&#x3D;off<ul>
<li>disable MCE(Machine Check Exception)<ul>
<li>an error detected by your system’s processor. There are 2 major types of MCE errors, a notice or warning error, and a fatal exception. The warning will be logged by a “Machine Check Event logged” notice in your system logs</li>
</ul>
</li>
</ul>
</li>
<li>idle&#x3D;poll<ul>
<li>idle&#x3D;poll is somewhat drastic in many cases, as preventing idle CPUs from saving almost any energy at all may not be the only effect of it. <ul>
<li>For example, on Intel hardware it effectively prevents CPUs from using P-states (see CPU Performance Scaling) that require any number of CPUs in a package to be idle, </li>
<li>so it very well may hurt single-thread computations performance as well as energy-efficiency. Thus using it for performance reasons may not be a good idea at all.</li>
</ul>
</li>
</ul>
</li>
<li>intel_pstate&#x3D;disable<ul>
<li>intel_pstate is a part of the CPU performance scaling subsystem in the Linux kernel (CPUFreq). It is a scaling driver for the Sandy Bridge and later generations of Intel processors. Note, however, that some of those processors may not be supported</li>
</ul>
</li>
<li>processor.max_cstate<ul>
<li>the intel_idle.max_cstate&#x3D;<n> and processor.max_cstate&#x3D;<n> parameters, where <n> is an idle state index also used in the name of the given states directory in sysfs (see Representation of Idle States), causes the intel_idle and acpi_idle drivers, respectively, to discard all of the idle states deeper than idle state</li>
</ul>
</li>
<li>noibrs<ul>
<li>Disables the Indirect Branch Restricted Speculation (IBRS) mitigation. IBRS is a feature that protects against certain Spectre vulnerabilities by preventing speculative execution of indirect branches.</li>
</ul>
</li>
<li>noibpb<ul>
<li>Disables the Indirect Branch Predictor Barrier (IBPB) mitigation. IBPB is another Spectre mitigation that helps prevent speculative execution of indirect branches.</li>
</ul>
</li>
<li>nopti<ul>
<li>Disables the Page Table Isolation (PTI) mitigation. PTI is a security feature that isolates kernel and user page tables to mitigate certain variants of the Meltdown vulnerability.</li>
</ul>
</li>
<li>nospectre_v2<ul>
<li>Disables the Spectre Variant 2 mitigation. Spectre Variant 2, also known as Branch Target Injection, is a vulnerability that can allow unauthorized access to sensitive information.</li>
</ul>
</li>
<li>nospectre_v1<ul>
<li>Disables the Spectre Variant 1 mitigation. Spectre Variant 1, also known as Bounds Check Bypass, is another vulnerability that can lead to unauthorized access to data</li>
</ul>
</li>
<li>l1tf&#x3D;off<ul>
<li>Turns off the L1 Terminal Fault (L1TF) mitigation. L1TF is a vulnerability that allows unauthorized access to data in the L1 cache</li>
</ul>
</li>
<li>nospec_store_bypass_disable<ul>
<li>Disables the Speculative Store Bypass (SSB) mitigation. SSB is a vulnerability that can allow unauthorized access to sensitive data stored in the cache</li>
</ul>
</li>
<li>no_stf_barrier<ul>
<li>isables the Single Thread Indirect Branch Predictors (STIBP) mitigation. STIBP is a feature that prevents speculation across different threads, mitigating certain Spectre vulnerabilities.</li>
</ul>
</li>
<li>mds&#x3D;off<ul>
<li>Disables the Microarchitectural Data Sampling (MDS) mitigation. MDS is a vulnerability that can lead to data leakage across various microarchitectural buffers</li>
</ul>
</li>
<li>tsx&#x3D;on<ul>
<li>Enables Intel Transactional Synchronization Extensions (TSX). TSX is an Intel feature that provides support for transactional memory, allowing for efficient and concurrent execution of certain code segments.</li>
</ul>
</li>
<li>tsx_async_abort<ul>
<li>Disables asynchronous aborts in Intel TSX. Asynchronous aborts are a mechanism that can terminate transactions and undo their effects in certain cases</li>
</ul>
</li>
<li>tsc<ul>
<li>x86 only<ul>
<li>reliable<ul>
<li>mark tsc clocksource as reliable, this disables clocksource verification at runtime, as well as the stability checks done at bootup. Used to enable high-resolution timer mode on older hardware, and in virtualized environment.</li>
</ul>
</li>
<li>noirqtime<ul>
<li>Do not use TSC to do irq accounting. Used to run time disable IRQ_TIME_ACCOUNTING on any platforms where RDTSC is slow and this accounting can add overhead</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>mitigations&#x3D;off<ul>
<li>Turns off all generic mitigations for security vulnerabilities. This parameter disables all known hardware and software mitigations for various vulnerabilities, prioritizing performance over security</li>
</ul>
</li>
<li>nosoftlockup <ul>
<li>disables logging of backtraces when a process executes on a CPU for longer than the softlockup threshold (default 120 seconds)</li>
</ul>
</li>
<li>mce&#x3D;ignore_ce<ul>
<li>ignores corrected errors and associated scans that can cause periodic latency spikes.</li>
</ul>
</li>
</ul>
</li>
<li><p>DynTicks, NOHZ, tickless</p>
<ul>
<li>reduce overhead, better performance</li>
<li><a target="_blank" rel="noopener" href="http://www.wowotech.net/timer_subsystem/tick-device-layer.html">http://www.wowotech.net/timer_subsystem/tick-device-layer.html</a></li>
<li>RHEL7 nohz_full support</li>
<li>If nr_running&#x3D;1, then scheduler&#x2F;tick can avoid that core<ul>
<li>Default disabled</li>
</ul>
</li>
</ul>
</li>
<li><p>kernel ticks</p>
<ul>
<li>timekeeping S(gettimeofday)</li>
<li>schduler loading balancing</li>
<li>memory statistics (vmstat)</li>
</ul>
</li>
<li><p>kernel boot parameters example:</p>
<ul>
<li>move all users tasks off the isolated cpu cores<ul>
<li>include all children of systemd (pid 1)</li>
<li>All future processes too. as default system cpu affinity is changed</li>
</ul>
</li>
</ul>
</li>
<li><p>kvm</p>
<ul>
<li>disable ksm, watchdog<ul>
<li>echo 0 &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;ksm&#x2F;merge_across_nodes</li>
<li>echo 0 &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;ksm&#x2F;run</li>
<li>echo 0 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;watchdog</li>
<li>echo 0 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;nmi_watchdog</li>
</ul>
</li>
</ul>
</li>
<li><p>isolation cpu core ksoftirqd and rcuc only</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">  host_isolcpus=&quot;1-4&quot;</span><br><span class="line">  startVal=$(echo $&#123;host_isolcpus&#125; | cut -f1 -d-)</span><br><span class="line">  endVal=$(echo $&#123;host_isolcpus&#125; | cut -f2 -d-)</span><br><span class="line">  i=0</span><br><span class="line">  while [ $&#123;startVal&#125; -le $&#123;endVal&#125; ]; do</span><br><span class="line">    tid=`pgrep -a ksoftirq | grep &quot;ksoftirqd/$&#123;startVal&#125;$&quot; | cut -d &#x27; &#x27; -f 1`</span><br><span class="line">    chrt -fp 2 $&#123;tid&#125;</span><br><span class="line"></span><br><span class="line">    tid=`pgrep -a rcuc | grep &quot;rcuc/$&#123;startVal&#125;$&quot; | cut -d &#x27; &#x27; -f 1`</span><br><span class="line">    chrt -fp 3 $&#123;tid&#125;</span><br><span class="line"></span><br><span class="line">    cpu[$i]=$&#123;startVal&#125;</span><br><span class="line">    i=`expr $i + 1`</span><br><span class="line">    startVal=`expr $startVal + 1`</span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">   echo -1 &gt; /proc/sys/kernel/sched_rt_period_us</span><br><span class="line">   echo -1 &gt; /proc/sys/kernel/sched_rt_runtime_us</span><br><span class="line"></span><br><span class="line">#All irq to core 0 ???</span><br><span class="line">  for irq in /proc/irq/* ; do</span><br><span class="line">   echo 0 &gt; $&#123;irq&#125;/smp_affinity_list</span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">#kvm pin core</span><br><span class="line">    &lt;cputune&gt;</span><br><span class="line">       &lt;vcpupin vcpu=&quot;0&quot; cpuset=&quot;1&quot;/&gt;</span><br><span class="line">       &lt;vcpupin vcpu=&quot;1&quot; cpuset=&quot;2&quot;/&gt;</span><br><span class="line">       &lt;vcpupin vcpu=&quot;2&quot; cpuset=&quot;3&quot;/&gt;</span><br><span class="line">       &lt;vcpupin vcpu=&quot;3&quot; cpuset=&quot;4&quot;/&gt;</span><br><span class="line">    &lt;/cputune&gt;</span><br><span class="line"></span><br><span class="line">#kvm disable tsc</span><br><span class="line">   &lt;clock offset=&#x27;utc&#x27;&gt;</span><br><span class="line">      &lt;timer name=&#x27;kvmclock&#x27; present=&#x27;no&#x27;/&gt;</span><br><span class="line">   &lt;/clock&gt;a</span><br><span class="line"></span><br><span class="line">#kvm gust </span><br><span class="line"> echo 0 &gt; /sys/kernel/mm/ksm/merge_across_nodes</span><br><span class="line"> echo 0 &gt; /sys/kernel/mm/ksm/run</span><br><span class="line"> echo 0 &gt; /proc/sys/kernel/watchdog</span><br><span class="line"> echo 0 &gt; /proc/sys/kernel/nmi_watchdog</span><br><span class="line"> echo -1 &gt; /proc/sys/kernel/sched_rt_period_us</span><br><span class="line"> echo -1 &gt; /proc/sys/kernel/sched_rt_runtime_us</span><br><span class="line"> echo 0 &gt; /proc/sys/kernel/timer_migration</span><br><span class="line"></span><br><span class="line"># compare cpu_dma_latency</span><br><span class="line">[The second method, which has a bit more fine-grained control of the power management features, is to use the Power Management Quality of Service interface (PM QOS). The file /dev/cpu_dma_latency is the interface which when opened registers a quality-of-service request for latency with the operating system. A program should open /dev/cpu_dma_latency, write a 32-bit number to it representing a maximum response time in microseconds and then keep the file descriptor open while low-latency operation is desired.  Writing a zero means that you want the fastest response time](https://access.redhat.com/articles/65410)</span><br><span class="line">[Set the cpu_dma_latency](https://gist.github.com/SaveTheRbtz/f5e8d1ca7b55b6a7897b)</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;skew_tick=1,nohz=on,nohz_full=0-63,mce=ignore_ce,nosoftlockup,noibrs,noibpb,nopti,nospectre_v2,nospectre_v1,l1tf=off,nospec_store_bypass_disable,no_stf_barrier,mds=off,tsx=on,tsx_async_abort=off,mitigations=off&quot;</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;skew_tick=1,nohz=on,nohz_full=0-63,rcu_nocbs=0-63,tuned.non_isolcpus=0000000003,intel_pstate=disable,nosoftlockup,noibrs,noibpb,nopti,nospectre_v2,nospectre_v1,l1tf=off,nospec_store_bypass_disable,no_stf_barrier,mds=off,tsx=on,tsx_async_abort=off,mitigations=off&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ubuntu</span></span><br><span class="line">$ vi /etc/default/grub</span><br><span class="line"><span class="comment">#modify  GRUB_CMDLINE_LINUX_DEFAULT=&quot;... intel_pstate=disable p4-clockmod&quot;</span></span><br><span class="line">$ sudo update-grub</span><br><span class="line">$ sudo grub-mkconfig -o /boot/efi/EFI/ubuntu/grub.cfg</span><br><span class="line">or</span><br><span class="line">$ sudo grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolated CPUs with the kernels scheduler load balancing:</span></span><br><span class="line">isolated_cores=2-23</span><br><span class="line"><span class="comment"># Isolated CPUs without the kernels scheduler load balancing:</span></span><br><span class="line">no_balance_cores=2,3</span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;skew_tick=1,nohz=on,nohz_full=2-39,rcu_nocbs=2-39,tuned.non_isolcpus=0000000003,intel_pstate=disable,nosoftlockup&quot;</span></span><br><span class="line"></span><br><span class="line">// linux-3.10.0-1127.el7/include/linux/genhd.h</span><br><span class="line">struct disk_stats &#123;</span><br><span class="line">        unsigned long sectors[2];       /* READs and WRITEs */</span><br><span class="line">        unsigned long ios[2];</span><br><span class="line">        unsigned long merges[2];</span><br><span class="line">        unsigned long ticks[2];</span><br><span class="line">        unsigned long io_ticks;</span><br><span class="line">        unsigned long time_in_queue;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static int diskstats_show(struct seq_file *seqf, void *v)</span><br><span class="line">&#123;</span><br><span class="line">        struct gendisk *gp = v;</span><br><span class="line">        struct disk_part_iter piter;</span><br><span class="line">        struct hd_struct *hd;</span><br><span class="line">        char buf[BDEVNAME_SIZE];</span><br><span class="line">        unsigned int inflight[2];</span><br><span class="line">        int cpu;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">        <span class="keyword">if</span> (&amp;disk_to_dev(gp)-&gt;kobj.entry == block_class.devices.next)</span><br><span class="line">                seq_puts(seqf,  <span class="string">&quot;major minor name&quot;</span></span><br><span class="line">                                <span class="string">&quot;     rio rmerge rsect ruse wio wmerge &quot;</span></span><br><span class="line">                                <span class="string">&quot;wsect wuse running use aveq&quot;</span></span><br><span class="line">                                <span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        disk_part_iter_init(&amp;piter, gp, DISK_PITER_INCL_EMPTY_PART0);</span><br><span class="line">        <span class="keyword">while</span> ((hd = disk_part_iter_next(&amp;piter))) &#123;</span><br><span class="line">                cpu = part_stat_lock();</span><br><span class="line">                part_round_stats(gp-&gt;queue, cpu, hd);</span><br><span class="line">                part_stat_unlock();</span><br><span class="line">                part_in_flight(gp-&gt;queue, hd, inflight);</span><br><span class="line">                seq_printf(seqf, <span class="string">&quot;%4d %7d %s %lu %lu %lu &quot;</span></span><br><span class="line">                           <span class="string">&quot;%u %lu %lu %lu %u %u %u %u\n&quot;</span>,</span><br><span class="line">                           MAJOR(part_devt(hd)), MINOR(part_devt(hd)),</span><br><span class="line">                           disk_name(gp, hd-&gt;partno, buf),</span><br><span class="line">                           part_stat_read(hd, ios[READ]),</span><br><span class="line">                           part_stat_read(hd, merges[READ]),</span><br><span class="line">                           part_stat_read(hd, sectors[READ]),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, ticks[READ])),</span><br><span class="line">                           part_stat_read(hd, ios[WRITE]),</span><br><span class="line">                           part_stat_read(hd, merges[WRITE]),</span><br><span class="line">                           part_stat_read(hd, sectors[WRITE]),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, ticks[WRITE])),</span><br><span class="line">                           inflight[0],</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, io_ticks)),</span><br><span class="line">                           jiffies_to_msecs(part_stat_read(hd, time_in_queue))</span><br><span class="line">                        );</span><br><span class="line">        &#125;</span><br><span class="line">        disk_part_iter_exit(&amp;piter);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cpu-partitioning-–-after-reboot"><a href="#Cpu-partitioning-–-after-reboot" class="headerlink" title="Cpu-partitioning – after reboot"></a>Cpu-partitioning – after reboot</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kernel.hung_task_timeout_secs = 600</span><br><span class="line">kernel.nmi_watchdog = 0</span><br><span class="line">vm.stat_interval = 10</span><br><span class="line">kernel.timer_migration = 1</span><br><span class="line">net.core.busy_read = 50</span><br><span class="line">net.core.busy_poll = 50</span><br><span class="line">kernel.numa_balancing = 0</span><br><span class="line">kernel.sched_min_granularity_ns = 10000000</span><br><span class="line">vm.dirty_ratio = 10</span><br><span class="line">vm.dirty_background_ratio = 3</span><br><span class="line">vm.swappiness = 10</span><br><span class="line">kernel.sched_migration_cost_ns = 5000000</span><br><span class="line">Disables Transparent Hugepages</span><br></pre></td></tr></table></figure>

<h4 id="blacklist-kernel-module"><a href="#blacklist-kernel-module" class="headerlink" title="blacklist kernel module"></a>blacklist kernel module</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## kernel boot blacklist</span></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;modprobe.blacklist=mpt2sas&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#after install OS</span></span><br><span class="line">$ <span class="built_in">rm</span> -f /etc/modprobe.d/anaconda-blacklist.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># modprobe -r module_name                                                      #step1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;blacklist module_name&quot;</span> &gt;&gt; /etc/modprobe.d/local-dontload.conf            <span class="comment">#step2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;install module_name /bin/false&quot;</span> &gt;&gt; /etc/modprobe.d/local-dontload.conf   <span class="comment">#step3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak                       #step4</span></span><br><span class="line"><span class="comment"># dracut --omit-drivers module_name -f                                                                               #step5</span></span><br><span class="line"><span class="comment"># grub2-editenv - list | grep kernelopts                                                                             #step6</span></span><br><span class="line"><span class="comment"># grub2-editenv - set kernelopts=&quot;&lt;&gt; module_name.blacklist=1 rd.driver.blacklist=module_name&quot;                        #step7</span></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak             #step8</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^KDUMP_COMMANDLINE_APPEND=/s/&quot;$/ rd.driver.blacklist=module_name&quot;/&#x27; /etc/sysconfig/kdump                  #step9</span></span><br><span class="line"><span class="comment"># kdumpctl restart                                                                                                   #step10</span></span><br><span class="line"><span class="comment"># mkdumprd -f /boot/initramfs-$(uname -r)kdump.img                                                                   #step11</span></span><br><span class="line"><span class="comment"># reboot                                                                                                             #step12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak                       #step4</span></span><br><span class="line"><span class="comment"># dracut --omit-drivers module_name -f                                                                               #step5</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^GRUB_CMDLINE_LINUX=/s/&quot;$/ module_name.blacklist=1 rd.driver.blacklist=module_name&quot;/&#x27; /etc/default/grub   #step6</span></span><br><span class="line"><span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg                                                                             #step7</span></span><br><span class="line"><span class="comment"># cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak             #step8</span></span><br><span class="line"><span class="comment"># sed -i &#x27;/^KDUMP_COMMANDLINE_APPEND=/s/&quot;$/ rd.driver.blacklist=module_name&quot;/&#x27; /etc/sysconfig/kdump                  #step9</span></span><br><span class="line"><span class="comment"># kdumpctl restart                                                                                                   #step10</span></span><br><span class="line"><span class="comment"># mkdumprd -f /boot/initramfs-$(uname -r)kdump.img                                                                   #step11</span></span><br><span class="line"><span class="comment"># reboot                                                                                                             #step12</span></span><br></pre></td></tr></table></figure>

<h4 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">timeout</span> 5 iftop  -F 192.168.* -i bond0 -t  -B -n</span><br><span class="line">Got the top10</span><br><span class="line">$ awk <span class="string">&#x27;&#123;if($1~/10.[0-9]+/) &#123;a[$1]++&#125;; if($2~/10.[0-9]+/) &#123;a[$2]++&#125;&#125; END&#123;for(i in a) &#123;if(a[i]!=20) &#123;print i&#125;&#125;&#125;&#x27;</span> /tmp/tmp1</span><br></pre></td></tr></table></figure>

<h4 id="NMI"><a href="#NMI" class="headerlink" title="NMI"></a>NMI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Non-Maskable Interrupt(NMI) is the highest priority interrupt that can not be masked by any software</span><br><span class="line">The NMI watchdog base the APIC(Advanced Programmable Interrupt Controller) protocol</span><br><span class="line"></span><br><span class="line">kernel.nmi_watchdog=1 →(I/O APIC)</span><br><span class="line">kernel.nmi_watchdog=2 → (Locall APIC)</span><br><span class="line"></span><br><span class="line"><span class="comment">## or add the parameter to grub</span></span><br><span class="line">nmi_watchdog=0</span><br></pre></td></tr></table></figure>

<h4 id="dmidecode"><a href="#dmidecode" class="headerlink" title="dmidecode"></a>dmidecode</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ dmidecode -t system -s Manufacturer</span><br><span class="line">Invalid string keyword: Manufacturer</span><br><span class="line">Valid string keywords are:</span><br><span class="line">  bios-vendor</span><br><span class="line">  bios-version</span><br><span class="line">  bios-release-date</span><br><span class="line">  bios-revision</span><br><span class="line">  firmware-revision</span><br><span class="line">  system-manufacturer</span><br><span class="line">  system-product-name</span><br><span class="line">  system-version</span><br><span class="line">  system-serial-number</span><br><span class="line">  system-uuid</span><br><span class="line">  system-sku-number</span><br><span class="line">  system-family</span><br><span class="line">  baseboard-manufacturer</span><br><span class="line">  baseboard-product-name</span><br><span class="line">  baseboard-version</span><br><span class="line">  baseboard-serial-number</span><br><span class="line">  baseboard-asset-tag</span><br><span class="line">  chassis-manufacturer</span><br><span class="line">  chassis-type</span><br><span class="line">  chassis-version</span><br><span class="line">  chassis-serial-number</span><br><span class="line">  chassis-asset-tag</span><br><span class="line">  processor-family</span><br><span class="line">  processor-manufacturer</span><br><span class="line">  processor-version</span><br><span class="line">  processor-frequency</span><br><span class="line"></span><br><span class="line">$ dmidecode -s system-manufacturer</span><br><span class="line">Dell Inc.</span><br><span class="line">Type    Information</span><br><span class="line">0       BIOS</span><br><span class="line">1       System</span><br><span class="line">2       Baseboard</span><br><span class="line">3       Chassis</span><br><span class="line">4       Processor</span><br><span class="line">5       Memory Controller</span><br><span class="line">6       Memory Module</span><br><span class="line">7       Cache</span><br><span class="line">8       Port Connector</span><br><span class="line">9       System Slots</span><br><span class="line">10      On Board Devices</span><br><span class="line">11      OEM Strings</span><br><span class="line">12      System Configuration Options</span><br><span class="line">13      BIOS Language</span><br><span class="line">14      Group Associations</span><br><span class="line">15      System Event Log</span><br><span class="line">16      Physical Memory Array</span><br><span class="line">17      Memory Device</span><br><span class="line">18      32-bit Memory Error</span><br><span class="line">19      Memory Array Mapped Address</span><br><span class="line">20      Memory Device Mapped Address</span><br><span class="line">21      Built-<span class="keyword">in</span> Pointing Device</span><br><span class="line">22      Portable Battery</span><br><span class="line">23      System Reset</span><br><span class="line">24      Hardware Security</span><br><span class="line">25      System Power Controls</span><br><span class="line">26      Voltage Probe</span><br><span class="line">27      Cooling Device</span><br><span class="line">28      Temperature Probe</span><br><span class="line">29      Electrical Current Probe</span><br><span class="line">30      Out-of-band Remote Access</span><br><span class="line">31      Boot Integrity Services</span><br><span class="line">32      System Boot</span><br><span class="line">33      64-bit Memory Error</span><br><span class="line">34      Management Device</span><br><span class="line">35      Management Device Component</span><br><span class="line">36      Management Device Threshold Data</span><br><span class="line">37      Memory Channel</span><br><span class="line">38      IPMI Device</span><br><span class="line">39      Power Supply</span><br><span class="line">40      Additional Information</span><br><span class="line">41      Onboard Devices Extended Information</span><br><span class="line">42      Management Controller Host Interface</span><br></pre></td></tr></table></figure>

<h4 id="netstat-show-port"><a href="#netstat-show-port" class="headerlink" title="netstat show port"></a>netstat show port</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -nap | grep 8081</span><br><span class="line">tcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      9836/nginx </span><br></pre></td></tr></table></figure>

<h4 id="How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><a href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd" class="headerlink" title="How to got the info from the pipe fd and socke fd"></a>How to got the info from the pipe fd and socke fd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$ strace <span class="built_in">ls</span> -l /proc/pid/fd</span><br><span class="line"><span class="built_in">readlink</span>(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;socket:[4248017]&quot;</span>, 65)   = 16</span><br><span class="line">lrwx------ 1 nobody nobody 64 Apr 25 11:04 6 -&gt; socket:[4248017]</span><br><span class="line"></span><br><span class="line">$ netstat -alep | grep 4248017</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name</span><br><span class="line">unix  3      [ ]         STREAM                                   CONNECTED               4248017     31233/test</span><br><span class="line"><span class="comment">## it &#x27;s means unix domain socket connectted with another local inter-process</span></span><br><span class="line"><span class="comment">## if it &#x27;s the remote socket connection you could see the ip adddr, grep xxx /proc/net/tcp /proc/net/udp</span></span><br><span class="line">```bash</span><br><span class="line">$ netstat -alep | grep 5522546</span><br><span class="line">tcp        0      0 0.0.0.0:chimera-hwm     0.0.0.0:*               LISTEN      root       5522546    160890/qperf</span><br><span class="line">$ grep 5522546 /proc/net/tcp</span><br><span class="line">   0: 00000000:0FA9 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 5522546 1 ffff952fb5be07c0 100 0 0 10 0</span><br><span class="line"><span class="comment">## local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## remote</span></span><br><span class="line">$ netstat -alep | grep 5866595</span><br><span class="line">tcp        0      0 test-2643-2:ssh         10.0.0.73:47702         ESTABLISHED root       5866595    147135/sshd: root@p</span><br><span class="line">$ grep 5866595 /proc/net/tcp</span><br><span class="line">  31: 0x0100a8c1:0016 0200a8c1:BA56 01 00000000:00000000 02:000AC753 00000000     0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> dec2ip</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">dec2ip</span></span> ()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">local</span> v=<span class="variable">$1</span></span><br><span class="line">   <span class="built_in">local</span> i1=$((v&gt;&gt;<span class="number">24</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i2=$((v&gt;&gt;<span class="number">16</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i3=$((v&gt;&gt;<span class="number">8</span>&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">local</span> i4=$((v&amp;<span class="number">255</span>))</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">&#x27;%d.%d.%d.%d\n&#x27;</span> <span class="variable">$i4</span> <span class="variable">$i3</span> <span class="variable">$i2</span> <span class="variable">$i1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dec2ip <span class="variable">$1</span></span><br><span class="line"><span class="comment">####</span></span><br><span class="line"></span><br><span class="line">$ sh dec2ip $(<span class="built_in">printf</span> <span class="string">&quot;%d \n&quot;</span> 0x0200a8c1)</span><br><span class="line">193.168.0.2</span><br><span class="line"></span><br><span class="line">// https://gist.github.com/jkstill/5095725</span><br><span class="line">31: 0x0100a8c1:0016 0200a8c1:BA56 01 00000000:00000000 02:000AC753 00000000     0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line">31:0x0100a8c1:0016 0200a8c1:BA56 01</span><br><span class="line"> |   |         |   |        |    |--&gt; connection state</span><br><span class="line"> |   |         |   |        |------&gt; remote TCP port number</span><br><span class="line"> |   |         |   |-------------&gt; remote IPv4 address</span><br><span class="line"> |   |         |--------------------&gt; <span class="built_in">local</span> TCP port number</span><br><span class="line"> |   |---------------------------&gt; <span class="built_in">local</span> IPv4 address</span><br><span class="line"> |----------------------------------&gt; number of entry</span><br><span class="line"></span><br><span class="line">00000000:00000000 02:000AC753 00000000</span><br><span class="line"> |        |        |  |        |--&gt; number of unrecovered RTO timeouts</span><br><span class="line"> |        |        |  |----------&gt; number of jiffies <span class="keyword">until</span> timer expires</span><br><span class="line"> |        |        |----------------&gt; timer_active (see below)</span><br><span class="line"> |        |----------------------&gt; receive-queue</span><br><span class="line"> |-------------------------------&gt; transmit-queue</span><br><span class="line"></span><br><span class="line">0        0 5866595 4 ffff95283ca10f80 20 4 25 10 22</span><br><span class="line">|        | |                | |        |  | |  |  |--&gt; slow start size threshold,</span><br><span class="line">|        | |                | |        |  | |  |       or -1 <span class="keyword">if</span> the treshold</span><br><span class="line">|        | |                | |        |  | |  |       is &gt;= 0xFFFF</span><br><span class="line">|        | |                | |        |  | |  |----&gt; sending congestion window</span><br><span class="line">|        | |                | |        |  | |-------&gt; (ack.quick&lt;&lt;<span class="string">1)|ack.pingpong</span></span><br><span class="line"><span class="string">|        | |                | |        |  |---------&gt; Predicted tick of soft clock</span></span><br><span class="line"><span class="string">|        | |                | |        |               (delayed ACK control data)</span></span><br><span class="line"><span class="string">|        | |                | |        |------------&gt; retransmit timeout</span></span><br><span class="line"><span class="string">|        | |                | |------------------&gt; location of socket in memory</span></span><br><span class="line"><span class="string">|        | |                |-----------------------&gt; socket reference count</span></span><br><span class="line"><span class="string">|        | |-----------------------------&gt; inode</span></span><br><span class="line"><span class="string">|        |----------------------------------&gt; unanswered 0-window probes</span></span><br><span class="line"><span class="string">|---------------------------------------------&gt; uid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net/socket.c</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"> * sockfs_dname() is called from d_path().</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">static char *sockfs_dname(struct dentry *dentry, char *buffer, int buflen)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">return dynamic_dname(dentry, buffer, buflen, &quot;socket:[%lu]&quot;,</span></span><br><span class="line"><span class="string">dentry-&gt;d_inode-&gt;i_ino);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                          ----&gt; you get the inode number from pipe or socketfs, you could these processes list</span></span><br><span class="line"><span class="string">                                          |</span></span><br><span class="line"><span class="string">$ strace ls -lR /proc 2&gt;&amp;1</span> | grep -Ei <span class="string">&#x27;4301922|4248015&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="process-schdule"><a href="#process-schdule" class="headerlink" title="process schdule"></a><a target="_blank" rel="noopener" href="http://abcdxyzk.github.io/blog/2014/05/22/kernel-sched-tick/">process schdule</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;NF &gt; 7 &#123; if ($1 == &quot;task&quot;) &#123; if (h == 0) &#123; print; h=1 &#125; &#125; else &#123; print &#125; &#125;&#x27;</span> /proc/sched_debug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    RHEL CFS Scheduler !!! important</span><br><span class="line">        Implements multiple red/black trees as run queues <span class="keyword">for</span> sockets and cores (asopposed to one run queue per processor or per system)</span><br><span class="line">        sched_min_granularity_ns</span><br><span class="line">        sched_wakeup_granularity_ns</span><br><span class="line">        sched_migration_cost</span><br><span class="line">        sched_child_runs_first</span><br><span class="line">        sched_latency_ns</span><br><span class="line">    Tuned-adm will increase quantum</span><br><span class="line">        <span class="built_in">echo</span> 10000000 &gt; /proc/sys/kernel/sched_min_granularity_ns</span><br><span class="line">            Minimal preemption granularity <span class="keyword">for</span> CPU bound tasks</span><br><span class="line">            See sched_latency_ns <span class="keyword">for</span> details. The default value is 4000000 (ns)</span><br><span class="line">        <span class="built_in">echo</span> 15000000 &gt; /proc/sys/kernel/sched_wakeup_granularity_ns</span><br><span class="line">            The wake-up preemption granularity</span><br><span class="line">            Increasing this variable reduces wake-up preemption, reducing disturbance of compute bound tasks</span><br><span class="line">            Decreasing it improves wake-up latency and throughput <span class="keyword">for</span> latency critical tasks</span><br><span class="line">                particularly when a short duty cycle load component must compete with CPU bound components. The default value is 5000000 (ns)</span><br><span class="line">    loading balancing</span><br><span class="line">        Scheduler tries to keep all CPUs busy by moving tasks form overloaded CPUs to idle CPUs</span><br><span class="line">        Detect using <span class="string">&quot;perf stat&quot;</span>, look <span class="keyword">for</span> excessive <span class="string">&quot;migrations&quot;</span></span><br><span class="line">        /proc/sys/kernel/sched_migration_cost_ns</span><br><span class="line">            Amount of time after the last execution that a task is considered to be <span class="string">&quot;cache hot&quot;</span> <span class="keyword">in</span> migration decisions.</span><br><span class="line">                A <span class="string">&quot;hot&quot;</span> task is less likely to be migrated, so increasing this variable reduces task migrations. The default value is 500000 (ns)</span><br><span class="line">            If the CPU idle time is higher than expected when there are runnable processes, try reducing this value.</span><br><span class="line">                If tasks bounce between CPUs or nodes too often, try increasing it</span><br><span class="line">        Rule of thumb – increase by 2-10x to reduce load balancing (tuned does this)</span><br><span class="line">            Use 10x on large systems when many CGROUPs are actively used (ex: RHEV/KVM/RHOS)</span><br><span class="line">    Fork behavior</span><br><span class="line">        sched_child_runs_first</span><br><span class="line">            Controls whether parent or child runs first</span><br><span class="line">            Default is 0: parent continues before children run</span><br><span class="line">            Default is different than RHEL5</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2988101">sched: RT throttling activated</a><br>Enable RT_RUNTIME_GREED with the following command:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/kernel/sched_rt_period_us</span><br><span class="line">Defines the period <span class="keyword">in</span> μs (microseconds) to be considered as 100% of CPU bandwidth. The default value is 1,000,000 μs (1 second). Changes to the value of the period must be very well thought out as a period too long or too small are equally dangerous.</span><br><span class="line"></span><br><span class="line">/proc/sys/kernel/sched_rt_runtime_us</span><br><span class="line">The total bandwidth available to all real-time tasks. The default values is 950,000 μs (0.95 s) or, <span class="keyword">in</span> other words, 95% of the CPU bandwidth. Setting the value to -1 means that real-time tasks may use up to 100% of CPU <span class="built_in">times</span>. This is only adequate when the real-time tasks are well engineered and have no obvious caveats such as unbounded polling loops.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> RT_RUNTIME_GREED &gt; /sys/kernel/debug/sched_features</span><br><span class="line"></span><br><span class="line">To keep all CPUs with the same rt_runtime, <span class="built_in">disable</span> the NO_RT_RUNTIME_SHARE logic:</span><br><span class="line">$ <span class="built_in">echo</span> NO_RT_RUNTIME_SHARE &gt; /sys/kernel/debug/sched_features</span><br><span class="line"></span><br><span class="line"><span class="comment">### it could cause some issue in pin the linux process to cpu core</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">That means some guy <span class="built_in">enable</span> the linux process real-time schdule</span><br><span class="line">```bash</span><br><span class="line"><span class="comment">## interval</span></span><br><span class="line"></span><br><span class="line">|----&gt;do_timer()   更新jiffies_64</span><br><span class="line">|----&gt;update_process_times()</span><br><span class="line">        |----&gt;scheduler_tick()</span><br><span class="line">        |----&gt;update_rq_clock()  更新当前调度队列rq的clock</span><br><span class="line">        |----&gt;curr-&gt;sched_class-&gt;task_tick()</span><br><span class="line">        |         对于普通进程，即task_tick_fair()</span><br><span class="line">        |         task_struct: struct sched_class *sched_class</span><br><span class="line"></span><br><span class="line">update_rq_clock()----delta = sched_clock_cpu(cpu_of(rq)) - rq-&gt;clock</span><br><span class="line">        |-----两次相邻两次周期性调度器运行的时间差</span><br><span class="line">        |----rq-&gt;clock += delta; 更新运行队列上的时钟</span><br><span class="line">                |----&gt;update_rq_clock_task(rq, delta)</span><br><span class="line">                |     即rq-&gt;clock_task += delta</span><br><span class="line"></span><br><span class="line"><span class="comment">## normal</span></span><br><span class="line">task_tick_fair()----&gt;entity_tick()   没有考虑组调度</span><br><span class="line">  |----&gt;update_curr() 更新相关统计量</span><br><span class="line">  |----&gt;check_preempt_tick()</span><br><span class="line">  |        检查进程本次获得CPU使用权的执行时间是否超过了</span><br><span class="line">  |        它对应的ideal_runtime值，如果超过了，则将当前进</span><br><span class="line">  |        程的TIF_NEED_RESCHED标志位置位</span><br><span class="line"></span><br><span class="line">update_curr()</span><br><span class="line">  |----delta_exec = (unsigned long)(now - curr-&gt;exec_start);</span><br><span class="line">  |            exec_start当前进程开始获得</span><br><span class="line">  |            cpu使用权时的时间戳;</span><br><span class="line">  |            进程本次所获得的CPU执行权的时间;</span><br><span class="line">  |----&gt;__update_curr(cfs_rq, curr, delta_exec);</span><br><span class="line">      |----&gt;curr-&gt;sum_exec_runtime += delta_exec;</span><br><span class="line">      |     更新该进程获得CPU执行权总时间</span><br><span class="line">      |</span><br><span class="line">      |----&gt;curr-&gt;vruntime += delta_exec_weighted;</span><br><span class="line">      |     更新该进程获得CPU执行权的虚拟时间</span><br><span class="line">      |</span><br><span class="line">      |----&gt;update_min_vruntime()</span><br><span class="line">      |     更新cfs_rq-&gt;min_vruntime</span><br><span class="line">      |</span><br><span class="line">  |----&gt;curr-&gt;exec_start = now</span><br><span class="line">  |        更新进程下次运行起始时间</span><br><span class="line">  |        (如果被抢占，下次被调度时将会更新)</span><br><span class="line"></span><br><span class="line">check_preempt_tick()</span><br><span class="line">  |----ideal_runtime = sched_slice(cfs_rq, curr);</span><br><span class="line">  |----delta_exec = curr-&gt;sum_exec_runtime</span><br><span class="line">  |                 - curr-&gt;prev_sum_exec_runtime;</span><br><span class="line">  |----<span class="keyword">if</span>(delta_exec &gt; ideal_runtime)</span><br><span class="line">  |          resched_task(rq_of(cfs_rq)-&gt;curr);</span><br><span class="line">  |          把当前进程的TIF_NEED_RESCHED标志位置位</span><br><span class="line">  |----<span class="keyword">else</span></span><br><span class="line">  |    delta = curr-&gt;vruntime - se-&gt;vruntime;  //这是什么？</span><br><span class="line">  |    <span class="keyword">if</span> (delta &gt; ideal_runtime)</span><br><span class="line">  |        resched_task(rq_of(cfs_rq)-&gt;curr);</span><br><span class="line">  |        把当前进程的TIF_NEED_RESCHED标志位置位</span><br><span class="line"></span><br><span class="line"><span class="comment">## real time</span></span><br><span class="line">task_tick_rt()</span><br><span class="line">  |----&gt;update_curr_rt();</span><br><span class="line">  |----&gt;<span class="keyword">if</span> (p-&gt;policy != SCHED_RR) <span class="built_in">return</span>;  SCHED_FIFO只有主动放弃CPU使用权</span><br><span class="line">  |----&gt;rt.timeslice值减一，若没有运行完时间则直接返回，</span><br><span class="line">  |     否则再次分配时间片，加入队列尾部，设置TIF_NEED_RESCHED</span><br><span class="line"></span><br><span class="line">update_curr_rt()</span><br><span class="line">  |----delta_exec = rq-&gt;clock - curr-&gt;se.exec_start; //本次运行时间</span><br><span class="line">  |----curr-&gt;se.sum_exec_runtime += delta_exec; //更新总得运行时间</span><br><span class="line">  |----curr-&gt;se.exec_start = rq-&gt;clock; //更新下次进程运行的起始时间</span><br><span class="line">  |----<span class="keyword">if</span> (sched_rt_runtime(rt_rq) != RUNTIME_INF)</span><br><span class="line">  |-------&#123;</span><br><span class="line">  |           rt_rq-&gt;rt_time += delta_exec;</span><br><span class="line">  |                <span class="keyword">if</span> (sched_rt_runtime_exceeded(rt_rq))</span><br><span class="line">  |                   resched_task(curr);</span><br><span class="line">  |       &#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://abcdxyzk.github.io/blog/2014/05/22/kernel-sched-tick/">in non real time linux kernel, dmesg show the “sched: RT throttling activated”</a>  </p>
<h4 id="Linux-watchdog"><a href="#Linux-watchdog" class="headerlink" title="Linux watchdog"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/ericstarmars/article/details/81750919">Linux watchdog</a></h4><p>The kernel code and the SCHED_FIFO(pro&#x3D;99) process cause the lockup, and the kernel preemption disabled</p>
<ul>
<li>softlockup<ul>
<li>The kernel code not release the CPU resource in the time interval</li>
<li>[watchdog&#x2F;0] [watchdog&#x2F;1], it depends hrtimer interrupts could be responded</li>
</ul>
</li>
<li>hardlockup<ul>
<li>It depends the NMI perf event of x86 PMU, CPU lockup and not respond the hrtimer interrupt</li>
<li>NMI interrupt Watchdog</li>
</ul>
</li>
<li>hardware watchdog<ul>
<li>systemctl start ipmidog</li>
<li>You could custom the timeout action</li>
<li>ipmitool mc watchdog get; &#x2F;dev&#x2F;watchdog</li>
</ul>
</li>
<li>Intel TCO WatchDog Timer Driver<ul>
<li>lsmod | grep wdt</li>
</ul>
</li>
<li>userspace watchdog<ul>
<li>&#x2F;usr&#x2F;sbin&#x2F;watchdog</li>
</ul>
</li>
</ul>
<h4 id="lockdep"><a href="#lockdep" class="headerlink" title="lockdep"></a><a target="_blank" rel="noopener" href="http://www.lenky.info/archives/2013/04/2253">lockdep</a></h4><p>CONFIG_LOCKDEP_SUPPORT&#x3D;y</p>
<ul>
<li>if a new hardirq-safe lock is discovered, we check whether it took any hardirq-unsafe lock in the past.</li>
<li>if a new softirq-safe lock is discovered, we check whether it took any softirq-unsafe lock in the past.</li>
<li>if a new hardirq-unsafe lock is discovered, we check whether any hardirq-safe lock took it in the past.</li>
<li>if a new softirq-unsafe lock is discovered, we check whether any softirq-safe lock took it in the past.</li>
</ul>
<h2 id="IO-Type"><a href="#IO-Type" class="headerlink" title="IO Type"></a><a target="_blank" rel="noopener" href="https://lzz5235.github.io/2015/08/25/block.html">IO Type</a></h2><ul>
<li><p>Synchronous blocking (normal)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf;</span><br><span class="line">fd = open(<span class="string">&quot;/dev/ttyS1&quot;</span>,O_RDWR);</span><br><span class="line">...</span><br><span class="line">res = read(fd,&amp;buf,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(res == <span class="number">1</span>)</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,buf);</span><br></pre></td></tr></table></figure></li>
<li><p>Synchronous non-blocking (intel loved)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf;</span><br><span class="line">fd = open(<span class="string">&quot;/dev/ttyS1&quot;</span>,O_RDWR | O_NONBLOCK);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">while</span>(read(fd,&amp;buf,<span class="number">1</span>)!= <span class="number">1</span>)</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,buf);</span><br></pre></td></tr></table></figure></li>
<li><p>Asynchronous blocking</p>
</li>
<li><p>Asynchronous non-blocking (AIO)</p>
<ul>
<li>异步通知的全程是”信号驱动的异步I&#x2F;O”，也就是说一旦设备准备就绪，主动通知应用程序，这样应用程序根本就不需要查询设备状态。</li>
<li>O_ASYNC<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; sys/types.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; sys/stat.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; stdio.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; fcntl.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; signal.h &gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt; unistd.h &gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LEN 100</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">input_handler</span><span class="params">(<span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">char</span> data[MAX_LEN];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">        len = read(STDIN_FILENO,&amp;data,MAX_LEN);</span><br><span class="line">        data[len] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;input:%s\n&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> oflags;</span><br><span class="line">        signal(SIGIO,input_handler);</span><br><span class="line">        fcntl(STDIN_FILENO,F_SETOWN,getpid());</span><br><span class="line">        oflags = fcntl(STDIN_FILENO,F_GETFL);</span><br><span class="line">        fcntl(STDIN_FILENO,F_SETFL,oflags | O_ASYNC);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>blocking IO</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    app recvfrom--- syscall---&gt;       kernel (no data ready)</span><br><span class="line">  ------|                                 |------</span><br><span class="line">  |     |                                 |     |</span><br><span class="line">  |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">  |     |                                 |     |</span><br><span class="line">block <span class="keyword">in</span>|call to recvfrom                 |------</span><br><span class="line">  |     |                              datagram ready</span><br><span class="line">  |     |                              copy datagram</span><br><span class="line">  |     |                                 |-----</span><br><span class="line">  |     |                                 |    |</span><br><span class="line">  |     |                                 |  copy data from kernel to user</span><br><span class="line">  |     |                                 |    |</span><br><span class="line">  |     |                                 |-----</span><br><span class="line">  ------|                                 v</span><br><span class="line">    process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure></li>
<li><p>non-blocking IO</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)</span><br><span class="line">   ------|                                 |-----------------------</span><br><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)     |</span><br><span class="line">   |     |                                 |                  <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">     app recvfrom--- syscall---&gt;       kernel (no data ready)     |</span><br><span class="line">process repeatedly call recvfrom,          |-----------------------</span><br><span class="line">waiting <span class="keyword">for</span> ok, <span class="built_in">return</span>(polling)            |     |</span><br><span class="line">   |     |                              datagram ready</span><br><span class="line">   |     |                              copy datagram</span><br><span class="line">   |     |                                 |-----</span><br><span class="line">   |     |                                 |    |</span><br><span class="line">   |     |                                 |  copy data from kernel to user</span><br><span class="line">   |     |                                 |    |</span><br><span class="line">   |     |                                 |-----</span><br><span class="line">   ------|                                 v</span><br><span class="line">     process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure>
</li>
<li><p>IO multiplexing</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                        app <span class="keyword">select</span> --- syscall---&gt;       kernel (no data ready)</span><br><span class="line">                      ------|                                 |------</span><br><span class="line">                      |     |                                 |     |</span><br><span class="line">                      |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">                      |     |                                 |     |</span><br><span class="line">        process block <span class="keyword">in</span> call to <span class="keyword">select</span>                       |     |</span><br><span class="line"><span class="built_in">wait</span> <span class="keyword">for</span> one of possible many sockets to become readable      |------</span><br><span class="line">                      ------|     &lt;---<span class="built_in">return</span> readable     datagram ready</span><br><span class="line">                      recvfrom    system call---&gt;         copy datagram</span><br><span class="line">                      ------|                                 |-----</span><br><span class="line">                      |     |                                 |    |</span><br><span class="line"> process block <span class="keyword">while</span> data copied to the user buff             |  copy data from kernel to user</span><br><span class="line">                      |     |                                 |    |</span><br><span class="line">                      |     |                                 |-----</span><br><span class="line">                      ------|                                 v</span><br><span class="line">                        process datagram &lt;---<span class="built_in">return</span> ok--- copy complete</span><br></pre></td></tr></table></figure>
</li>
<li><p>asynchronous IO</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                 app aio_read ---syscall---&gt;       kernel (no data ready)</span><br><span class="line">               ------|         &lt;---<span class="built_in">return</span>---           |------</span><br><span class="line">               |     |                                 |     |</span><br><span class="line">               |     |                                 |   <span class="built_in">wait</span> <span class="keyword">for</span> data</span><br><span class="line">               |     |                                 |     |</span><br><span class="line">         process <span class="built_in">continue</span> excuting                     |------</span><br><span class="line">               |     |                              datagram ready</span><br><span class="line">               |     |                              copy datagram</span><br><span class="line">               |     |                                 |-----</span><br><span class="line">               |     |                                 |    |</span><br><span class="line">               |     |                                 |  copy data from kernel to user</span><br><span class="line">               |     |                                 |    |</span><br><span class="line">               |     |                                 |-----</span><br><span class="line">               ------|                                 v</span><br><span class="line">sinalal handler process datagram &lt;---deliver sinal--- copy complete</span><br><span class="line">                                 specified aio_read</span><br></pre></td></tr></table></figure>
</li>
<li><p>select 3个问题</p>
<ul>
<li>被监控的fds集合限制为1024，1024太小了，我们希望能够有个比较大的可监控fds集合(poll, epoll)</li>
<li>fds集合需要从用户空间拷贝到内核空间的问题，我们希望不需要拷贝(epoll)</li>
<li>当被监控的fds中某些有数据可读的时候，我们希望通知更加精细一点，就是我们希望能够从通知中得到有可读事件的fds列表，而不是需要遍历整个fds来收集。(epoll)</li>
</ul>
</li>
<li><p>epoll</p>
<ul>
<li>功能分离，select中维护等待队列(socket列表)和阻塞进程两个步骤结合在一起了，对于频繁调用select的进程来说，socket列表变化的可能性很小，基本固定，并不需要每次都修改。EPoll将两个操作分开。</li>
<li>维护就绪列表，select低效的另一个原因在于程序不知道哪些socket收到数据，只能一个个遍历。如果内核维护一个”就绪列表”，引用收到数据的 socket，就能避免遍历。</li>
</ul>
</li>
<li><p>可以看到epoll高效原因，主要是维护了两个队列，一个是监视队列，一个是就绪队列。监视队列解决了select中fds频繁拷贝的问题，就绪队列解决了select中需要遍历列表才能知道哪个socket接收到数据的问题</p>
</li>
</ul>
<h4 id="tmp-file-clean"><a href="#tmp-file-clean" class="headerlink" title="tmp file clean"></a>tmp file clean</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /usr/lib/tmpfiles.d/tmp.conf</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See tmpfiles.d(5) for details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clear tmp directories separately, to make them easier to override</span></span><br><span class="line">D /tmp 1777 root root -</span><br><span class="line"><span class="comment">#q /var/tmp 1777 root root 30d</span></span><br></pre></td></tr></table></figure>

<h4 id="dkms"><a href="#dkms" class="headerlink" title="dkms"></a>dkms</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dkms remove -m lustre-zfs -v 2.12.8_6_g5457c37 --all --rpm_safe_upgrade</span><br></pre></td></tr></table></figure>

<h4 id="glibc"><a href="#glibc" class="headerlink" title="glibc"></a>glibc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in glibc-x.xx/build/</span></span><br><span class="line">CC=<span class="string">&quot;gcc&quot;</span> CXX=<span class="string">&quot;g++&quot;</span> \</span><br><span class="line">    CFLAGS=<span class="string">&quot;-g -g3 -ggdb -gdwarf-4 -Og -Wno-error -fno-stack-protector&quot;</span> \</span><br><span class="line">    CXXFLAGS=<span class="string">&quot;-g -g3 -ggdb -gdwarf-4 -Og -Wno-error -fno-stack-protector&quot;</span> \</span><br><span class="line">    ../configure --prefix=/path/to/install/glibc/x64 --disable-werror</span><br><span class="line"></span><br><span class="line">make -j 8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="setfacl"><a href="#setfacl" class="headerlink" title="setfacl"></a>setfacl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ setfacl -Rm g:nobody:rwx dir_or_file </span><br><span class="line"></span><br><span class="line"><span class="comment">#remove single</span></span><br><span class="line">$ setfacl -x user:george,user:test1 ch4.doc</span><br><span class="line"></span><br><span class="line"><span class="comment">#remove all</span></span><br><span class="line">$ setfacl -b file</span><br></pre></td></tr></table></figure>

<h4 id="vmlinux-h-and-ebpf"><a href="#vmlinux-h-and-ebpf" class="headerlink" title="vmlinux.h and ebpf"></a><a target="_blank" rel="noopener" href="https://blog.aquasec.com/vmlinux.h-ebpf-programs">vmlinux.h and ebpf</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bpftool btf dump file /sys/kernel/btf/vmlinux format c &gt; vmlinux.h</span><br></pre></td></tr></table></figure>

<h4 id="sysctl-p-not-work-for-etc-sysctl-d"><a href="#sysctl-p-not-work-for-etc-sysctl-d" class="headerlink" title="sysctl -p not work for &#x2F;etc&#x2F;sysctl.d"></a>sysctl -p not work for &#x2F;etc&#x2F;sysctl.d</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl --system</span><br></pre></td></tr></table></figure>

<h4 id="rpm-spec"><a href="#rpm-spec" class="headerlink" title="rpm spec"></a><a target="_blank" rel="noopener" href="https://www.golinuxhub.com/2018/05/how-to-execute-script-at-pre-post-preun-postun-spec-file-rpm/">rpm spec</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">~/.rpmmacros</span><br><span class="line"></span><br><span class="line">To override a macro</span><br><span class="line">%_topdir /opt/some/working/directory/rpmbuild</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rpm --<span class="built_in">eval</span> %&#123;_MACRO&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#To display the raw RPM macro definitions</span></span><br><span class="line">rpm --showrc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_usr&#125;&quot;</span></span><br><span class="line">/usr</span><br><span class="line"></span><br><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_libdir&#125;&quot;</span></span><br><span class="line">/usr/lib64</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify /usr/lib/rpm/macros from lib64 to lib</span></span><br><span class="line"><span class="comment">#%_lib                   lib64</span></span><br><span class="line">%_lib                   lib</span><br><span class="line">%_libdir                %&#123;_exec_prefix&#125;/%&#123;_lib&#125;</span><br><span class="line"></span><br><span class="line">$ rpm --<span class="built_in">eval</span> <span class="string">&quot;%&#123;_libdir&#125;&quot;</span></span><br><span class="line">/usr/lib</span><br><span class="line"></span><br><span class="line">%pre</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is pre&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line">%post</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is post&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line">%preun</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is preun&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line">%postun</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is postun&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upgrade Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Uninstall Value: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm -ivh /tmp/rpmbuild/RPMS/x86_64/deepak-1.0.0-1.x86_64.rpm</span></span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is pre</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:deepak-1.0.0-1                   <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is post</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm -Uvh /tmp/rpmbuild/RPMS/x86_64/deepak-2.0.0-1.x86_64.rpm</span></span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is pre</span><br><span class="line">Install Value: 2</span><br><span class="line">Upgrade Value: 2</span><br><span class="line">Uninstall Value: 2</span><br><span class="line">-------------</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:deepak-2.0.0-1                   <span class="comment">################################# [ 50%]</span></span><br><span class="line">-------------</span><br><span class="line">This is post</span><br><span class="line">Install Value: 2</span><br><span class="line">Upgrade Value: 2</span><br><span class="line">Uninstall Value: 2</span><br><span class="line">-------------</span><br><span class="line">-------------</span><br><span class="line">This is preun</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line">Cleaning up / removing...</span><br><span class="line">   2:deepak-1.0.0-1                   <span class="comment">################################# [100%]</span></span><br><span class="line">-------------</span><br><span class="line">This is postun</span><br><span class="line">Install Value: 1</span><br><span class="line">Upgrade Value: 1</span><br><span class="line">Uninstall Value: 1</span><br><span class="line">-------------</span><br><span class="line"><span class="comment"># rpm -e deepak</span></span><br><span class="line">-------------</span><br><span class="line">This is preun</span><br><span class="line">Install Value: 0</span><br><span class="line">Upgrade Value: 0</span><br><span class="line">Uninstall Value: 0</span><br><span class="line">-------------</span><br><span class="line">-------------</span><br><span class="line">This is postun</span><br><span class="line">Install Value: 0</span><br><span class="line">Upgrade Value: 0</span><br><span class="line">Uninstall Value: 0</span><br><span class="line">-------------</span><br></pre></td></tr></table></figure>

<h4 id="setcap-set-file-capabilities"><a href="#setcap-set-file-capabilities" class="headerlink" title="setcap - set file capabilities"></a>setcap - set file capabilities</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wireshark work for non-root user</span></span><br><span class="line">$ <span class="built_in">setcap</span> <span class="string">&#x27;CAP_NET_RAW+eip CAP_NET_ADMIN+eip&#x27;</span> /usr/sbin/dumpcap</span><br><span class="line"></span><br><span class="line"><span class="comment"># set uid</span></span><br><span class="line">$ <span class="built_in">chmod</span> u+s /path/to/application</span><br><span class="line"></span><br><span class="line"><span class="comment"># use ping</span></span><br><span class="line">$ <span class="built_in">setcap</span> <span class="string">&#x27;cap_net_admin,cap_net_raw+ep&#x27;</span> /bin/ping</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear</span></span><br><span class="line">$ <span class="built_in">setcap</span> -r /bin/ping</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">setcap</span> cap_net_bind_service=+eip /opt/openport_under1024.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## found all setcap files</span></span><br><span class="line">$ <span class="built_in">getcap</span> -r  /</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">chmod</span> u+s /bin/vi</span><br><span class="line">$ find /bin -perm -u=s -<span class="built_in">type</span> f</span><br><span class="line"></span><br><span class="line"><span class="comment">### if you set CAP_SETUID cause python switch to root shell</span></span><br><span class="line"><span class="comment"># ALL the capabilites permitted (p) and effective (e)</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">setcap</span> CAP_SETUID+ep /usr/bin/python</span><br><span class="line">$ python -c <span class="string">&#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><h5 id="tasklist-hang-desktop-hang-when-start-another-program"><a href="#tasklist-hang-desktop-hang-when-start-another-program" class="headerlink" title="tasklist hang, desktop hang when start another program"></a>tasklist hang, desktop hang when start another program</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c:\WINDOWS\SYSTEM32&gt; DISM.exe /Online /Cleanup-image /Restorehealth</span><br><span class="line"></span><br><span class="line"><span class="comment">#the game coule be exit normaly, else the tasklist and desktop will hang</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#fix some error file</span></span><br><span class="line">&gt; sfc /scannow</span><br></pre></td></tr></table></figure>

<h5 id="auto-start-vmware-player"><a href="#auto-start-vmware-player" class="headerlink" title="auto start vmware player"></a>auto start vmware player</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start <span class="string">&quot;C:\Program Files (x86)\VMware\VMware Player\vmplayer.exe&quot;</span> <span class="string">&quot;%USERPROFILE%\Documents\Virtual Machines\&lt;vm&gt;.vmx&quot;</span></span><br><span class="line">VBoxManage startvm vm001 --<span class="built_in">type</span> gui</span><br></pre></td></tr></table></figure>

<h5 id="terminal"><a href="#terminal" class="headerlink" title="terminal"></a>terminal</h5><p>change the colorScheme in json config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                <span class="string">&quot;guid&quot;</span>: <span class="string">&quot;&#123;58ad8b0c-3ef8-5f4d-bc6f-13e4c00f2530&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;hidden&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Debian&quot;</span>,</span><br><span class="line">                <span class="string">&quot;colorScheme&quot;</span>: <span class="string">&quot;One Half Dark&quot;</span>,  &lt;-------- add this line</span><br><span class="line">                <span class="string">&quot;source&quot;</span>: <span class="string">&quot;Windows.Terminal.Wsl&quot;</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h4 id="aws-command"><a href="#aws-command" class="headerlink" title="aws command"></a>aws command</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --no-verify-ssl --endpoint http://xx.xx.xx.xx:9100 --profile default s3api head-object --bucket huada-test4 --key copy7/test_file</span><br></pre></td></tr></table></figure>

<h4 id="rclone"><a href="#rclone" class="headerlink" title="rclone"></a><a target="_blank" rel="noopener" href="https://bruxy.regnet.cz/web/linux/EN/rsync-rclone/">rclone</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sync source:/mnt/tools; dest: /tank/tools</span></span><br><span class="line">$ rclone <span class="built_in">sync</span> --links /mnt/tools/ /tank/tools/</span><br><span class="line"></span><br><span class="line">$ rclone copy --links /sources/ ./</span><br><span class="line"><span class="comment">#keep link, not tranlate the link to file</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> ~/.config/rclone/rclone.conf</span><br><span class="line">[remote_server]</span><br><span class="line"><span class="built_in">type</span> = sftp</span><br><span class="line">host = 172.102.0.123</span><br><span class="line">user = bruxy</span><br><span class="line">key_file = /home/bruxy/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">$ rclone -v <span class="built_in">sync</span> <span class="built_in">source</span>/directory/ remote_server:/destination/directory/</span><br></pre></td></tr></table></figure>

<h4 id="interrput-the-tcp-link"><a href="#interrput-the-tcp-link" class="headerlink" title="interrput the tcp link"></a>interrput the tcp link</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$ tcpkill -i eth0 host 192.168.0.1</span><br><span class="line">or</span><br><span class="line">$ ss -K dst 192.168.0.1 dport = 2049</span><br><span class="line">or</span><br><span class="line">$ iptables -A INPUT -p tcp -m tcp --dport 2049 -j REJECT --reject-with tcp-reset</span><br><span class="line">or</span><br><span class="line">iptables -I INPUT  -p tcp --dport 9001 -j REJECT --reject-with tcp-reset</span><br><span class="line">iptables -I OUTPUT -p tcp --sport 9001 -j REJECT --reject-with tcp-reset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">cat</span> kill.hosts)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">                                  <span class="comment">#(your source port)</span></span><br><span class="line">seq_num=$(hping3 <span class="variable">$i</span> -a 10.53.3.194 -s 1021 -p 988 --syn -V -c 1  2&gt; /dev/null| awk -F= <span class="string">&#x27;$0~/ack/&#123;print $3&#125;&#x27;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">                                       <span class="comment">#(your des port)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$i</span> <span class="variable">$seq_num</span></span><br><span class="line">hping3 <span class="variable">$i</span> -a 10.53.3.194 -s 1021 -p 988 --rst --win 0 --setseq <span class="variable">$seq_num</span> -c 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#hpign3 useage; https://ravi73079.medium.com/attacks-to-be-performed-using-hping3-packet-crafting-98bc25584745#:~:text=Some%20Useful%20Techniques%20to%20preform,V%20%E2%80%94%20tos%20%E2%80%94%20frag%2032%20Target</span></span><br><span class="line">$ hping3 -S — scan 21–500 Target</span><br><span class="line">$ hping3 -S -p 80 Target</span><br><span class="line"></span><br><span class="line"><span class="comment">#SYN Flood Attack</span></span><br><span class="line">$ hping3 -S -p 80 Target — flood</span><br><span class="line"></span><br><span class="line"><span class="comment">#LAND Attack</span></span><br><span class="line">$ hping3 -S -p 80 127.0.0.1 -a 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#SMURF Attack</span></span><br><span class="line">$ hping3 — icmp — flood 127.0.0.1 -a 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Random Source Attack</span></span><br><span class="line">$ hping3 -S -p 80 Target — flood — rand-source</span><br><span class="line"></span><br><span class="line"><span class="comment">#TCP Sequence Prediction Attack (ISN Prediction)</span></span><br><span class="line">$ hping3 -S -p 80 -Q 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#ICMP</span></span><br><span class="line">$ hping3 — icmp /-1 Target (Simple ICMP Echo Request)</span><br><span class="line">$ hping3 — icmp -c 8 -V Target (Packets Count and Verbose)</span><br><span class="line">$ hping3 — icmp -c 4 -d 300 Target (data is send with 300 bytes of data)</span><br><span class="line">$ hping3 — icmp -c 4 -t 56 Target (<span class="built_in">set</span> TTL value of 56)</span><br><span class="line">$ hping3 — icmp -t 56 -c 5 — mtu 8 -d 300 -V — tos — frag 32 Target</span><br><span class="line"></span><br><span class="line"><span class="comment">#Customizing SYN Packet</span></span><br><span class="line">$ hping3 -S -p 80 Target (Sending SYN packet on port 80)</span><br><span class="line">$ hping3 -S -p 80 -s 1234 –k Target (Sending SYN packet on port 80 from port 1234)</span><br><span class="line">$ hping3 -S -p ++21 Target (Incrementing Destination Port by 1 after each sent packet)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Setting Different Flags</span></span><br><span class="line">$ hping3 -p 80 -s 1234 -F Target</span><br><span class="line">$ hping3 -p 80 -s 1234 -A Target</span><br><span class="line">$ hping3 -p 80 -s 1234 -FUP -d 200 Target</span><br><span class="line">$ hping3 -p 80 -s 1234 -Y -mtu 8 Target</span><br></pre></td></tr></table></figure>

<h4 id="bash-history-env"><a href="#bash-history-env" class="headerlink" title="bash history env"></a>bash history env</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HISTSIZE=10000</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=100000</span><br><span class="line">$ <span class="built_in">env</span> SYSTEMD_LOG_LEVEL=debug systemd-tmpfiles --clean</span><br><span class="line">CPLUS_INCLUDE_PATH/C_INCLUDE_PATH: include</span><br><span class="line">LD_LIBRARY_PATH: lib</span><br></pre></td></tr></table></figure>

<h4 id="delete-file-by-inode"><a href="#delete-file-by-inode" class="headerlink" title="delete file by inode"></a>delete file by inode</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -inum [inode-number] -<span class="built_in">exec</span> <span class="built_in">rm</span> -i &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<h4 id="got-the-node-ip-addr"><a href="#got-the-node-ip-addr" class="headerlink" title="got the node ip addr"></a>got the node ip addr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ip r g 1.1.1.1 | awk <span class="string">&#x27;/src/&#123;print $NF&#125;&#x27;</span></span><br><span class="line">$ ip r g 1.1.1.1 | awk <span class="string">&#x27;/src/&#123;print $(NF-2)&quot;_&quot;$NF&#125;&#x27;</span></span><br><span class="line"><span class="comment"># becuase there is the diff output in el7 and el8, el7 match $NF, el8 match $(NF-2)</span></span><br><span class="line"></span><br><span class="line">$ ip -s -s a  | grep -A 2 <span class="string">&quot;UP group&quot;</span> | grep -oP <span class="string">&#x27;(?&lt;=inet\s)\d+(\.\d+)&#123;3&#125;&#x27;</span> | grep -Ev <span class="string">&quot;255$|127.0.0.1&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="route-info"><a href="#route-info" class="headerlink" title="route info"></a>route info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl net.ipv&#123;4,6&#125;.route.max_size</span><br><span class="line">$ ip route show table all</span><br><span class="line">$ ip route show cache</span><br><span class="line">$ ip -6 route show cache</span><br></pre></td></tr></table></figure>

<h4 id="java-parameters"><a href="#java-parameters" class="headerlink" title="java parameters"></a>java parameters</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -J-d64 -dump:format=b,file=dump.bin PID</span><br><span class="line">$ jstat -gcold</span><br><span class="line">$ jstat -gcnew [pid]</span><br><span class="line">$ jstat -gc [pid]</span><br><span class="line">$ jmap -histo [pid]</span><br><span class="line">-XX:+HeapDumpOnOutOfMemeryError</span><br><span class="line">-XX:HeapDumpPath=/home/logs -Xloggc:/home/log/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps</span><br><span class="line">-server -Xms4000m -Xmx4000m -Xmn1500m -Xss256k -XX:PermSize=340m -XX:MaxPermSize=340m -XX:+UseConcMarkSweepGC</span><br><span class="line">XX:+DisableAttachMechanism</span><br><span class="line"></span><br><span class="line"><span class="comment">## java temp file</span></span><br><span class="line">/tmp/.java_pid217893</span><br><span class="line">/tmp/hsperfdata_yourname</span><br></pre></td></tr></table></figure>

<h4 id="ISO"><a href="#ISO" class="headerlink" title="ISO"></a>ISO</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dir to iso and show the full name</span></span><br><span class="line">$ mkisofs -r -iso-level 4 -o dvd.iso &lt;<span class="built_in">dir</span>&gt;</span><br><span class="line"></span><br><span class="line">$ mkisofs -J -l -R -V <span class="string">&quot;Label CD&quot;</span> -iso-level 4 -o output.iso input_directory</span><br></pre></td></tr></table></figure>

<h4 id="intel-boot-agent-message"><a href="#intel-boot-agent-message" class="headerlink" title="intel boot agent message"></a><a target="_blank" rel="noopener" href="https://www.supermicro.com/wdl/ISO_Extracted/CDR-APLUS2_2.02_for_A+_AMD_SP5100_platform/Intel/LAN/v18.0.1/APPS/BOOTAGNT/DOCS/ba_msgs.htm">intel boot agent message</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## uefi set bootutil64e</span></span><br><span class="line">FS0:\&gt;bootutil64e -up=efi -all</span><br></pre></td></tr></table></figure>

<h3 id="Draw-kernel-boot-dmesg-image"><a href="#Draw-kernel-boot-dmesg-image" class="headerlink" title="Draw kernel boot dmesg image"></a><a target="_blank" rel="noopener" href="http://tinylab.org/measure-and-draw-the-boot-up-time-of-linux-kernel/">Draw kernel boot dmesg image</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | perl bootgraph.pl &gt; bootgraph.svg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dmesg | perl dmesg-initcall.pl &gt; boot-initcall.log</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/brendangregg/FlameGraph.git</span><br><span class="line">$ <span class="built_in">cd</span> FlameGraph</span><br><span class="line">$ <span class="built_in">cat</span> boot-initcall.log | ./FlameGraph/flamegraph.pl --color=mem &gt; linux-boot-flamegraph.svg</span><br><span class="line"></span><br><span class="line"><span class="comment">#el8/el9</span></span><br><span class="line">$ yum install js-d3-flame-graph</span><br><span class="line">$ perf script flamegraph -a -F 99 <span class="built_in">sleep</span> 60</span><br><span class="line"><span class="built_in">which</span> will be stored <span class="keyword">in</span> the current active directory as flamegraph.html</span><br><span class="line">$ xdg-open flamegraph.html</span><br><span class="line">or</span><br><span class="line">$ perf script flamegraph -a -F 99 -p ID1,ID2 <span class="built_in">sleep</span> 60</span><br><span class="line">$ xdg-open flamegraph.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo apt-get install gnuplot-x11</span><br><span class="line">$ <span class="built_in">cat</span> linux-boot.gnuplot</span><br><span class="line"><span class="built_in">set</span> terminal svg size 800,300 fsize 4</span><br><span class="line"><span class="built_in">set</span> output <span class="string">&#x27;linux-boot-gnuplot.svg&#x27;</span></span><br><span class="line"><span class="built_in">set</span> style data histograms</span><br><span class="line"><span class="built_in">set</span> style histogram clustered gap 1 title offset character 0, 0, 0</span><br><span class="line"><span class="built_in">set</span> style fill solid 0.4 border</span><br><span class="line"><span class="built_in">set</span> xtics rotate by -45</span><br><span class="line"><span class="built_in">set</span> boxwidth 0.9 absolute</span><br><span class="line">plot <span class="string">&#x27;./boot-initcall.log&#x27;</span> using 2:xticlabels(1)</span><br><span class="line"></span><br><span class="line">$ gnuplot &lt; linux-boot.gnuplot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/tinyclub/tinydraw.git</span><br><span class="line">$  ./tinydraw/histogram/histogram.sh boot-initcall.log &gt; linux-boot-histogram.svg</span><br></pre></td></tr></table></figure>

<h4 id="Highcharts"><a href="#Highcharts" class="headerlink" title="Highcharts"></a>Highcharts</h4><p><a target="_blank" rel="noopener" href="https://jsfiddle.net/gh/get/library/pure/highcharts/highcharts/tree/master/samples/highcharts/chart/height/">set highcharts high</a>  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Highcharts</span>.<span class="title function_">chart</span>(<span class="string">&#x27;container&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">chart</span>: &#123;</span><br><span class="line">        <span class="attr">height</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="google-slide"><a href="#google-slide" class="headerlink" title="google slide"></a>google slide</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">该选项不是明确的，但是您可以做到。</span><br><span class="line">转到插入-&gt;文本框并在其中需要页脚的位置创建一个框，其中包含所需的内容（我建议将其水平居中）。</span><br><span class="line"></span><br><span class="line">然后在框上右键单击并选择添加到主题-&gt;主菜单/ [...]。</span><br><span class="line"></span><br><span class="line">添加到母版会将其放置在所有幻灯片上。</span><br><span class="line">如果您选择其他选项，它将放到该主题的所有幻灯片上（，例如<span class="string">&quot;标题和正文&quot;</span>主题）。</span><br></pre></td></tr></table></figure>


<h4 id="centos-7-auto-login"><a href="#centos-7-auto-login" class="headerlink" title="centos 7 auto login"></a>centos 7 auto login</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/gdm/custom.conf</span><br><span class="line">[daemon]</span><br><span class="line">AutomaticLoginEnable=<span class="literal">true</span></span><br><span class="line">AutomaticLogin=username</span><br></pre></td></tr></table></figure>

<h4 id="restart-udev"><a href="#restart-udev" class="headerlink" title="restart udev"></a>restart udev</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ udevadm control --reload-rules &amp;&amp; udevadm trigger</span><br><span class="line"><span class="comment">#or just trigger add</span></span><br><span class="line">$ udevadm control --reload-rules; udevadm trigger --action=add</span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">$ sudo systemctl stop systemd-udevd systemd-udevd-kernel.socket systemd-udevd-control.socket</span><br><span class="line">$ <span class="built_in">sleep</span> 5</span><br><span class="line">$ sudo systemctl start systemd-udevd systemd-udevd-kernel.socket systemd-udevd-control.socket</span><br></pre></td></tr></table></figure>

<h4 id="Terminal-setting"><a href="#Terminal-setting" class="headerlink" title="Terminal setting"></a>Terminal setting</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HISTSIZE=10000</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=100000</span><br><span class="line"></span><br><span class="line"><span class="comment">## if your system is the another language</span></span><br><span class="line"><span class="built_in">export</span> LANGUAGE=en_US.UTF-8</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure>

<h4 id="overlayer-test"><a href="#overlayer-test" class="headerlink" title="overlayer test"></a>overlayer test</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$ tree lower</span><br><span class="line">lower</span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">└── <span class="built_in">dir</span></span><br><span class="line">    ├── c</span><br><span class="line">    └── d</span><br><span class="line"></span><br><span class="line">5 directories, 0 files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree upper</span><br><span class="line">upper</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">└── f</span><br><span class="line"></span><br><span class="line">4 directories, 0 files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree work</span><br><span class="line">work</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br><span class="line"></span><br><span class="line">$ tree merged</span><br><span class="line">merged</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br><span class="line"></span><br><span class="line">$ mount -t overlay overlay -olowerdir=lower,upperdir=upper,workdir=work merged</span><br><span class="line">$ mount | grep overlay</span><br><span class="line">overlay on /tmp/merged <span class="built_in">type</span> overlay (rw,relatime,lowerdir=lower,upperdir=upper,workdir=work,xino=off)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ tree work</span><br><span class="line">work</span><br><span class="line">└── work</span><br><span class="line"></span><br><span class="line">1 directory, 0 files</span><br><span class="line"></span><br><span class="line">$ sudo tree work merged/</span><br><span class="line">work</span><br><span class="line">└── work</span><br><span class="line">merged/</span><br><span class="line"></span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   ├── c</span><br><span class="line">│   ├── d</span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">└── f</span><br><span class="line"></span><br><span class="line">9 directories, 0 files</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> testfile &gt; merged/testfile</span><br><span class="line">$ tree upper/</span><br><span class="line">upper/</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   └── g</span><br><span class="line">├── e</span><br><span class="line">├── f</span><br><span class="line">└── testfile</span><br><span class="line"></span><br><span class="line">4 directories, 1 file</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> upper/</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  e  f  testfile</span><br><span class="line">$ <span class="built_in">rm</span> -rf e</span><br><span class="line">$ tree ../merged</span><br><span class="line">../merged</span><br><span class="line">├── a</span><br><span class="line">├── b</span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">│   ├── c</span><br><span class="line">│   ├── d</span><br><span class="line">│   └── g</span><br><span class="line">├── f</span><br><span class="line">└── testfile</span><br><span class="line"></span><br><span class="line">7 directories, 1 file</span><br><span class="line"></span><br><span class="line"><span class="comment">#if you delete all lower dirs files, the merged dir could not show uppper dirs</span></span><br></pre></td></tr></table></figure>

<h4 id="rsync-mirrors"><a href="#rsync-mirrors" class="headerlink" title="rsync mirrors"></a>rsync mirrors</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RSYNC_PROXY=<span class="string">&quot;192.168.1.1:8080&quot;</span></span><br><span class="line"><span class="built_in">export</span> http_proxy=http://192.168.1.1:8080; <span class="built_in">export</span> https_proxy=https://192.168.1.1:8080; <span class="built_in">export</span> RSYNC_PROXY=<span class="string">&quot;192.168.1.1:8080&quot;</span></span><br><span class="line">rsync -avzP --exclude ppc64le --exclude aarch64 --delete  rsync://mirrors.tuna.tsinghua.edu.cn/centos/8-stream /centos/</span><br><span class="line">rsync -avzP --exclude ppc64le --exclude aarch64 --delete  rsync://ftp.riken.jp/Linux/centos/8-stream /centos/</span><br></pre></td></tr></table></figure>

<h4 id="http-proxy"><a href="#http-proxy" class="headerlink" title="http proxy"></a>http proxy</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> http_proxy=http://<span class="variable">$&#123;proxy_server_ip&#125;</span>:3128; <span class="built_in">export</span> https_proxy=https://<span class="variable">$&#123;proxy_server_ip&#125;</span>:3128; <span class="built_in">export</span> RSYNC_PROXY=<span class="string">&quot;<span class="variable">$&#123;proxy_server_ip&#125;</span>:3128&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="get-the-driver-support-info"><a href="#get-the-driver-support-info" class="headerlink" title="get the driver support info"></a>get the driver support info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ find linux-3.10.0-1127.el7/drivers/net/ethernet/mellanox | grep Kconfig | xargs grep -i support</span><br><span class="line">$ $ find linux-3.10.0-1127.el7/drivers/net/ethernet/broadcom/ | grep Kconfig | xargs grep -i support</span><br><span class="line">        tristate <span class="string">&quot;Broadcom 440x/47xx ethernet support&quot;</span></span><br><span class="line"><span class="comment"># Auto-select SSB PCI-HOST support, if possible</span></span><br><span class="line">        tristate <span class="string">&quot;Broadcom 63xx internal mac support&quot;</span></span><br><span class="line">          This driver supports the ethernet MACs <span class="keyword">in</span> the Broadcom 63xx</span><br><span class="line">        tristate <span class="string">&quot;QLogic bnx2 support&quot;</span></span><br><span class="line">          This driver supports QLogic bnx2 gigabit Ethernet cards.</span><br><span class="line">        tristate <span class="string">&quot;QLogic CNIC support&quot;</span></span><br><span class="line">          This driver supports offload features of QLogic bnx2 gigabit</span><br><span class="line">        tristate <span class="string">&quot;SB1250 Gigabit Ethernet support&quot;</span></span><br><span class="line">          This driver supports Gigabit Ethernet interfaces based on the</span><br><span class="line">$ find linux-3.10.0-1127.el7/drivers/net/ethernet/marvell/ | grep Kconfig | xargs grep -i support</span><br><span class="line">        tristate <span class="string">&quot;Marvell Discovery (643XX) and Orion ethernet support&quot;</span></span><br><span class="line">          This driver supports the gigabit ethernet MACs <span class="keyword">in</span> the</span><br><span class="line">        tristate <span class="string">&quot;Marvell MDIO interface support&quot;</span></span><br><span class="line">          This driver supports the MDIO interface found <span class="keyword">in</span> the network</span><br><span class="line">        tristate <span class="string">&quot;Marvell Armada 370/XP network interface support&quot;</span></span><br><span class="line">          This driver supports the network interface units <span class="keyword">in</span> the</span><br></pre></td></tr></table></figure>
<h4 id="disable-USB-Attached-Storage-UAS"><a href="#disable-USB-Attached-Storage-UAS" class="headerlink" title="disable USB Attached Storage UAS"></a><a target="_blank" rel="noopener" href="https://leo.leung.xyz/wiki/How_to_disable_USB_Attached_Storage_(UAS)">disable USB Attached Storage UAS</a></h4><ul>
<li>Slow transfer speeds, sometimes even stalling<ul>
<li>Kernel messages are full of errors similar to the ones listed below. However, the drive is still healthy.<ul>
<li>Error messages from uas_eh_abort_handler<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ lsusb</span><br><span class="line">Bus 002 Device 005: ID 0bc2:3343 Seagate RSS LLC</span><br><span class="line"></span><br><span class="line">$ rmmod usb-storage</span><br><span class="line">modprobe usb-storage quirks=0bc2:3343:u</span><br><span class="line"></span><br><span class="line">[947347.271519] usb 2-3.2: New USB device found, idVendor=0bc2, idProduct=3343, bcdDevice= 1.00</span><br><span class="line">[947955.635329] usb-storage 2-3.2:1.0: Quirks match <span class="keyword">for</span> vid 0bc2 pid 3343: 800000</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/modprobe.d/disable-uas.conf</span><br><span class="line">options usb-storage quirks=0bc2:3322:u</span><br><span class="line">$ update-initramfs -u</span><br><span class="line"></span><br><span class="line">or add it to grub</span><br><span class="line">$ <span class="built_in">cat</span> /etc/default/grub</span><br><span class="line">GRUB_CMDLINE_LINUX=usb-storage.quirks=0bc2:3322:u</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="cgroup"><a href="#cgroup" class="headerlink" title="cgroup"></a>cgroup</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/proc/sys/kernel/sched_autogroup_enabled</span><br><span class="line">/proc/PID/autogroup</span><br><span class="line"></span><br><span class="line">/sys/fs/cgroup/memory/memory.stat</span><br><span class="line">systemd-run -p MemoryMax=512M --scope pacman -Syu</span><br><span class="line">systemd-run -p MemoryMax=256M --scope ./backup-my-system</span><br><span class="line"></span><br><span class="line">systemd-run --user --slice=limit-mem.slice --shell</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> ~/.config/systemd/user/limit-mem.slice</span><br><span class="line">[Slice]</span><br><span class="line">MemoryHigh=3G</span><br><span class="line">MemoryMax=4G</span><br><span class="line">MemorySwapMax=2G</span><br><span class="line"></span><br><span class="line">systemd.unified_cgroup_hierarchy=1</span><br><span class="line"><span class="comment"># systemctl edit user@1000.service</span></span><br><span class="line">[Service]</span><br><span class="line">Delegate=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">memory.min</span><br><span class="line">memory.low</span><br><span class="line">memory.high</span><br><span class="line">memory.max</span><br><span class="line">memory.swap.high</span><br><span class="line">memory.swap.max</span><br></pre></td></tr></table></figure>

<h4 id="kvm-KVM"><a href="#kvm-KVM" class="headerlink" title="kvm KVM"></a>kvm KVM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#show vt-d support</span></span><br><span class="line">dmesg -T | grep IOMMU -i</span><br><span class="line">[Wed May 28 02:05:08 2025] Command line: BOOT_IMAGE=(hd0,gpt2)/vmlinuz-5.14.0-503.26.1.el9_5.x86_64 root=UUID=a090d867-7e54-463b-a4c6-4f66c047fe26 ro crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M resume=UUID=df233b86-6a58-46f0-bfc4-53e821d197de video=matroxfb:vesa:0x1BB intel_iommu=on iommu=pt</span><br><span class="line">[Wed May 28 02:05:08 2025] DMAR: IOMMU enabled</span><br><span class="line">[Wed May 28 02:05:08 2025] DMAR-IR: IOAPIC <span class="built_in">id</span> 10 under DRHD base  0xfbffc000 IOMMU 0</span><br><span class="line">[Wed May 28 02:05:08 2025] DMAR-IR: IOAPIC <span class="built_in">id</span> 8 under DRHD base  0xc7ffc000 IOMMU 1</span><br><span class="line">[Wed May 28 02:05:08 2025] DMAR-IR: IOAPIC <span class="built_in">id</span> 9 under DRHD base  0xc7ffc000 IOMMU 1</span><br><span class="line">[Wed May 28 02:05:08 2025] iommu: Default domain <span class="built_in">type</span>: Passthrough (<span class="built_in">set</span> via kernel <span class="built_in">command</span> line)</span><br><span class="line">[Wed May 28 02:05:08 2025] pci 0000:80:01.0: Adding to iommu group 0</span><br><span class="line">[Wed May 28 02:05:08 2025] pci 0000:80:02.0: Adding to iommu group 1 &lt;----pcie dev group</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">find /sys/kernel/iommu_groups/ -<span class="built_in">type</span> l</span><br><span class="line"></span><br><span class="line"><span class="comment">#test in Alamlinux 9.5</span></span><br><span class="line"><span class="comment">#SR-IOV mlx5_0 and mlx5_1</span></span><br><span class="line"><span class="comment">#BIOS setting , enable VT-D and VMX</span></span><br><span class="line"><span class="comment">#install Mellanox OFED lib</span></span><br><span class="line"></span><br><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&quot;intel_iommu=on iommu=pt&quot;</span></span><br><span class="line">$ <span class="built_in">echo</span> 8 &gt; /sys/class/net/ens2f0np0/device/mlx5_num_vfs</span><br><span class="line">$ <span class="built_in">echo</span> 8 &gt; /sys/class/net/ens2f1np1/device/mlx5_num_vfs</span><br><span class="line"></span><br><span class="line">ens2f0v0..v7 has the different mac address</span><br><span class="line"></span><br><span class="line"><span class="comment">#All guest is base an el8 base image </span></span><br><span class="line"><span class="comment">#after start , all client has the same mac address</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####modify in kvm guest, for fix dev name</span></span><br><span class="line"><span class="comment">#use systemd fix the NIC name fix mac with dev name</span></span><br><span class="line"><span class="comment">#all kvm guset has the same MAC address</span></span><br><span class="line"><span class="built_in">cat</span> /etc/systemd/network/00-ens2f0.link /etc/systemd/network/01-ens2f1.link</span><br><span class="line">[Match]</span><br><span class="line">MACAddress=be:c3:94:17:0b:69  </span><br><span class="line"></span><br><span class="line">[Link]</span><br><span class="line">Name=ens2f0</span><br><span class="line">[Match]</span><br><span class="line">MACAddress=86:19:78:3a:5a:52</span><br><span class="line"></span><br><span class="line">[Link]</span><br><span class="line">Name=ens2f1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Add it to kvm guest , after modify , the kvm guest will be onlined</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f0 down</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f1 down</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f0 address be:c3:94:17:0b:30</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f1 address 4e:9b:12:53:01:30</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f0 up</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens2f1 up</span><br><span class="line"></span><br><span class="line">KVM-guest $ systemctl <span class="built_in">disable</span> NetworkManager-wait-online.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#modify ipaddr by nmtui</span></span><br><span class="line"><span class="comment">#modify hostname</span></span><br><span class="line"><span class="comment">#moidfy rc.local mac addrss</span></span><br><span class="line"><span class="comment">#if ens2f1 not working , modify systemd/network/01-ens2f1.link again</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line">$ sudo virsh start win10 </span><br><span class="line">error: Failed to start domain <span class="string">&#x27;win10&#x27;</span></span><br><span class="line">error: Cannot access storage file <span class="string">&#x27;/win10.qed&#x27;</span> (as uid:64055, gid:64055): Permission denied</span><br><span class="line"></span><br><span class="line">$ sudo usermod -a -G libvirt $(<span class="built_in">whoami</span>)</span><br><span class="line">or </span><br><span class="line">$ sudo nano /etc/libvirt/qemu.conf</span><br><span class="line">user = <span class="string">&quot;username&quot;</span></span><br><span class="line">group = <span class="string">&quot;libvirt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Network &#x27;default&#x27; is not active</span></span><br><span class="line">$ virsh net-autostart default</span><br><span class="line">Network default marked as autostarted</span><br><span class="line"></span><br><span class="line">$ virsh domifaddr win2k16</span><br><span class="line"> Name       MAC address          Protocol     Address</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"> vnet1      52:54:00:83:f2:a9    ipv4         192.168.122.128/24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ qemu-img create -f qcow2 windows-master.qcow2 10G</span><br><span class="line">$ qemu-img convert -f raw -O qcow2 <span class="variable">$INPUT_FILE</span> <span class="variable">$OUTPUT_FILE</span></span><br><span class="line">                                 ---<span class="built_in">source</span> file</span><br><span class="line">                                 |</span><br><span class="line">$ qemu-img create -b windows-master.qcow2 -f qcow2 windows-clone.qcow2</span><br><span class="line">                                                               |</span><br><span class="line">                                                               ---increment file</span><br><span class="line"></span><br><span class="line"><span class="comment">#in the newer version qemu </span></span><br><span class="line">$ qemu-img create -f qcow2 -b base-imgs/el9.qcow2 -F qcow2 el7-test-1.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment">#RHEL 8 not working connect by the old version vrit-manager</span></span><br><span class="line"><span class="comment">#Failed to connect socket to &#x27;/var/run/libvirt/virtqemud-sock&#x27;: No such file or directory</span></span><br><span class="line">$ vi /etc/libvirt/libvirt.conf </span><br><span class="line">mode = <span class="string">&quot;legacy&quot;</span></span><br><span class="line">$ systemctl restart libvirtd</span><br><span class="line"></span><br><span class="line"><span class="comment">#el9 restart libvirtd</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span>  libvirtd-ro.socket libvirtd.socket  libvirtd-admin.socket libvirtd</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  systemctl stop <span class="variable">$i</span></span><br><span class="line">  systemctl start <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ systemct start libvirtd <span class="comment">#failed</span></span><br><span class="line">$ journalctl -u libvirtd</span><br><span class="line">internal error: Failed to load module <span class="string">&#x27;/usr/lib64/libvirt/storage-backend/libvirt_storage_backend_iscsi-direct.so&#x27;</span>: librdmacm.so.1: cannot open shared objec&gt;</span><br><span class="line">Failed to start Virtualization daemon.</span><br><span class="line"></span><br><span class="line">$ dnf provides librdmacm.so.1</span><br><span class="line">Last metadata expiration check: 1:38:06 ago on Sun 14 Jul 2024 02:56:19 PM CST.</span><br><span class="line">librdmacm-46.0-1.el8.1.i686 : Userspace RDMA Connection Manager</span><br><span class="line">Repo        : BaseOS</span><br><span class="line">Matched from:</span><br><span class="line">Provide    : librdmacm.so.1</span><br><span class="line"></span><br><span class="line">$ dnf install librdmacm-devel</span><br><span class="line"></span><br><span class="line">$ systemct start libvirtda <span class="comment">#OK</span></span><br></pre></td></tr></table></figure>

<p>Add SR-IOV dev from virsh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 8 &gt; /sys/class/net/ens2f0/device/mlx5_num_vfs</span><br><span class="line">$ lspci  | grep Ethernet</span><br><span class="line">19:00.0 Ethernet controller: Intel Corporation Ethernet Connection X722 <span class="keyword">for</span> 10GBASE-T (rev 09)</span><br><span class="line">19:00.1 Ethernet controller: Intel Corporation Ethernet Connection X722 <span class="keyword">for</span> 10GBASE-T (rev 09)</span><br><span class="line">65:00.0 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx]</span><br><span class="line">65:00.1 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx]</span><br><span class="line">65:00.2 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:00.3 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:00.4 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:00.5 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:00.6 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:00.7 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.0 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.1 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.2 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.3 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.4 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.5 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.6 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:01.7 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:02.0 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line">65:02.1 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx Virtual Function]</span><br><span class="line"></span><br><span class="line">$ virsh nodedev-list | grep pci_0000_65</span><br><span class="line">pci_0000_65_00_0</span><br><span class="line">pci_0000_65_00_1</span><br><span class="line">pci_0000_65_00_2</span><br><span class="line">pci_0000_65_00_3</span><br><span class="line">pci_0000_65_00_4</span><br><span class="line">pci_0000_65_00_5</span><br><span class="line">pci_0000_65_00_6</span><br><span class="line">pci_0000_65_00_7</span><br><span class="line">pci_0000_65_01_0</span><br><span class="line">pci_0000_65_01_1</span><br><span class="line">pci_0000_65_01_2</span><br><span class="line">pci_0000_65_01_3</span><br><span class="line">pci_0000_65_01_4</span><br><span class="line">pci_0000_65_01_5</span><br><span class="line">pci_0000_65_01_6</span><br><span class="line">pci_0000_65_01_7</span><br><span class="line">pci_0000_65_02_0</span><br><span class="line">pci_0000_65_02_1</span><br><span class="line"></span><br><span class="line">$ virsh nodedev-dumpxml pci_0000_65_00_3</span><br><span class="line">&lt;device&gt;</span><br><span class="line">  &lt;name&gt;pci_0000_65_00_3&lt;/name&gt;</span><br><span class="line">  &lt;path&gt;/sys/devices/pci0000:64/0000:64:00.0/0000:65:00.3&lt;/path&gt;</span><br><span class="line">  &lt;parent&gt;pci_0000_64_00_0&lt;/parent&gt;</span><br><span class="line">  &lt;driver&gt;</span><br><span class="line">    &lt;name&gt;vfio-pci&lt;/name&gt;</span><br><span class="line">  &lt;/driver&gt;</span><br><span class="line">  &lt;capability <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span>&gt;</span><br><span class="line">    &lt;class&gt;0x020000&lt;/class&gt;</span><br><span class="line">    &lt;domain&gt;0&lt;/domain&gt;  &lt;---- 0</span><br><span class="line">    &lt;bus&gt;101&lt;/bus&gt;      &lt;---- 101</span><br><span class="line">    &lt;slot&gt;0&lt;/slot&gt;      &lt;---- 0</span><br><span class="line">    &lt;<span class="keyword">function</span>&gt;3&lt;/function&gt;  &lt;---- 3</span><br><span class="line">    &lt;product <span class="built_in">id</span>=<span class="string">&#x27;0x1016&#x27;</span>&gt;MT27710 Family [ConnectX-4 Lx Virtual Function]&lt;/product&gt;</span><br><span class="line">    &lt;vendor <span class="built_in">id</span>=<span class="string">&#x27;0x15b3&#x27;</span>&gt;Mellanox Technologies&lt;/vendor&gt;</span><br><span class="line">    &lt;capability <span class="built_in">type</span>=<span class="string">&#x27;phys_function&#x27;</span>&gt;</span><br><span class="line">      &lt;address domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x65&#x27;</span> slot=<span class="string">&#x27;0x00&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/capability&gt;</span><br><span class="line">    &lt;iommuGroup number=<span class="string">&#x27;98&#x27;</span>&gt;</span><br><span class="line">      &lt;address domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x65&#x27;</span> slot=<span class="string">&#x27;0x00&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x3&#x27;</span>/&gt;</span><br><span class="line">    &lt;/iommuGroup&gt;</span><br><span class="line">    &lt;numa node=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">    &lt;pci-express&gt;</span><br><span class="line">      &lt;<span class="built_in">link</span> validity=<span class="string">&#x27;cap&#x27;</span> port=<span class="string">&#x27;0&#x27;</span> speed=<span class="string">&#x27;8&#x27;</span> width=<span class="string">&#x27;8&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">link</span> validity=<span class="string">&#x27;sta&#x27;</span> width=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/pci-express&gt;</span><br><span class="line">  &lt;/capability&gt;</span><br><span class="line">&lt;/device&gt;</span><br><span class="line"></span><br><span class="line">$ virsh nodedev-detach pci_0000_65_00_3</span><br><span class="line">Device pci_0000_65_00_3 detached</span><br><span class="line"></span><br><span class="line"><span class="comment">#create a hostdev.xml file</span></span><br><span class="line">$ vi hostdev.xml</span><br><span class="line">&lt;interface <span class="built_in">type</span>=<span class="string">&#x27;hostdev&#x27;</span>&gt;</span><br><span class="line"> &lt;mac address=<span class="string">&#x27;52:54:00:28:29:33&#x27;</span>/&gt;</span><br><span class="line"> &lt;<span class="built_in">source</span>&gt;</span><br><span class="line">  &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0&#x27;</span> bus=<span class="string">&#x27;101&#x27;</span> slot=<span class="string">&#x27;0&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;3&#x27;</span> /&gt;</span><br><span class="line"> &lt;/source&gt;</span><br><span class="line">&lt;/interface&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#not wokring</span></span><br><span class="line">$ virsh attach-device <span class="variable">$GUST</span> hostdev.xml</span><br><span class="line">error: Failed to attach device from hostdev.xml</span><br><span class="line">error: Requested operation is not valid: domain is not running</span><br><span class="line"></span><br><span class="line">$ virsh edit <span class="variable">$GUST</span> </span><br><span class="line"><span class="comment">#add the same text is OK</span></span><br><span class="line"></span><br><span class="line">$ virsh edit <span class="variable">$GUST</span> </span><br><span class="line"><span class="comment">#libvirt will re-gen the xml file, and modify the mac addr edit again</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/appliedprivacy/technical-issues/issues/1">Add multiple queue for virtio-net</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;driver name=&#x27;vhost&#x27; queues=&#x27;8&#x27;/&gt;</span><br><span class="line"></span><br><span class="line">$ virsh domiflist el7-test1 </span><br><span class="line"> Interface   Type     Source   Model    MAC</span><br><span class="line">-----------------------------------------------------------</span><br><span class="line"> vnet20      bridge   br2      virtio   52:54:00:ee:0d:b5</span><br><span class="line"></span><br><span class="line">$ virsh domifstat el7-test1 vnet20</span><br><span class="line">vnet20 rx_bytes 103897684187</span><br><span class="line">vnet20 rx_packets 18139266</span><br><span class="line">vnet20 rx_errs 0</span><br><span class="line">vnet20 rx_drop 0</span><br><span class="line">vnet20 tx_bytes 2315870861</span><br><span class="line">vnet20 tx_packets 18082041</span><br><span class="line">vnet20 tx_errs 0</span><br><span class="line">vnet20 tx_drop 0</span><br><span class="line"></span><br><span class="line">$ virsh net-list</span><br><span class="line"> Name      State    Autostart   Persistent</span><br><span class="line">--------------------------------------------</span><br><span class="line"> default   active   yes         yes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="PCIE-pass-through"><a href="#PCIE-pass-through" class="headerlink" title="PCIE pass through"></a><a target="_blank" rel="noopener" href="https://bean-li.github.io/KVM-installation-in-RHEL7/">PCIE pass through</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 iommu=pt pci-stub.ids=1000:0097&#x27;</span></span><br><span class="line">or</span><br><span class="line">$ vim /lib/modprobe.d/pci-stub.conf</span><br><span class="line">options pci-stub ids=10de:1381,10de:0fbc</span><br><span class="line">softdep drm pre: pci-stub</span><br><span class="line">$ update-initramfs -u</span><br><span class="line"></span><br><span class="line">$ lspci | grep LSI</span><br><span class="line">02:00.0 RAID bus controller: Broadcom / LSI MegaRAID SAS-3 3108 [Invader] (rev 02)</span><br><span class="line">82:00.0 Serial Attached SCSI controller: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 (rev 02)</span><br><span class="line"></span><br><span class="line">$ lspci -vvvnn -s 82:00.0</span><br><span class="line">82:00.0 Serial Attached SCSI controller [0107]: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 [1000:0097] (rev 02)</span><br><span class="line">                                                                                                        |</span><br><span class="line">                                                                                                        V</span><br><span class="line">                                                                                             pci-stub.ids=1000:0097</span><br><span class="line"></span><br><span class="line">$ virsh nodedev-list  |grep pci_0000_82</span><br><span class="line">pci_0000_82_00_0</span><br><span class="line"></span><br><span class="line"><span class="comment">#parent</span></span><br><span class="line">$ virsh nodedev-list  |grep pci_0000_80_03_0</span><br><span class="line">pci_0000_80_03_0</span><br></pre></td></tr></table></figure>

<p>Add to xml file, if wrong, the virt-manager will genarate the xml codes.  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;device&gt;</span><br><span class="line">  &lt;name&gt;pci_0000_82_0_0&lt;/name&gt;</span><br><span class="line">  &lt;path&gt;/sys/devices/pci0000:80/0000:80:03.0/0000:82:00.0&lt;/path&gt;</span><br><span class="line">  &lt;parent&gt;pci_0000_80_03_0&lt;/parent&gt;</span><br><span class="line">  &lt;driver&gt;</span><br><span class="line">    &lt;name&gt;mpt3sas&lt;/name&gt;</span><br><span class="line">  &lt;/driver&gt;</span><br><span class="line">  &lt;capability <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span>&gt;</span><br><span class="line">    &lt;domain&gt;0&lt;/domain&gt;</span><br><span class="line">    &lt;bus&gt;82&lt;/bus&gt;</span><br><span class="line">    &lt;slot&gt;0&lt;/slot&gt;</span><br><span class="line">    &lt;<span class="keyword">function</span>&gt;0&lt;/function&gt;</span><br><span class="line">    &lt;product <span class="built_in">id</span>=<span class="string">&#x27;0x0097&#x27;</span>&gt;Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3&lt;/product&gt;</span><br><span class="line">    &lt;vendor <span class="built_in">id</span>=<span class="string">&#x27;0x1000&#x27;</span>&gt;Serial Attached SCSI controller&lt;/vendor&gt;</span><br><span class="line">    &lt;numa node=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">  &lt;/capability&gt;</span><br><span class="line">&lt;/device&gt;</span><br></pre></td></tr></table></figure>

<p>the iommu&#x3D;pt could avoid some of kernel driver bugs<br><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/4393391">tg3 driver</a> A bug has been identified in the tg3 driver, it is likely a race&#x2F;timing issue with the system kexec-ing, and the IOMMU still being used by a device for active DMA.<br><a target="_blank" rel="noopener" href="https://github.com/void-linux/void-packages/issues/32241">latest Nvidia drivers cause system freeze on exit of Chromium</a>   </p>
<h5 id="bind-dev"><a href="#bind-dev" class="headerlink" title="bind dev"></a><a target="_blank" rel="noopener" href="https://gist.github.com/kaapstorm/4e51ff5f500eb7e93820d2e630dfdbbc">bind dev</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /usr/local/bin/vfio-bind</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">modprobe vfio-pci</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dev <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    vendor=$(<span class="built_in">cat</span> /sys/bus/pci/devices/<span class="variable">$dev</span>/vendor)</span><br><span class="line">    device=$(<span class="built_in">cat</span> /sys/bus/pci/devices/<span class="variable">$dev</span>/device)</span><br><span class="line">    <span class="keyword">if</span> [ -e /sys/bus/pci/devices/<span class="variable">$dev</span>/driver ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$dev</span> &gt; /sys/bus/pci/devices/<span class="variable">$dev</span>/driver/unbind</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$vendor</span> <span class="variable">$device</span> &gt; /sys/bus/pci/drivers/vfio-pci/new_id</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ lspci -nnk</span><br><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM107 [GeForce GTX 750] [10de:1381] (rev a2)</span><br><span class="line">    Subsystem: Gigabyte Technology Co., Ltd GM107 [GeForce GTX 750] [1458:362e]</span><br><span class="line">    Kernel driver <span class="keyword">in</span> use: nvidia</span><br><span class="line">    Kernel modules: nvidiafb, nouveau, nvidia_384_drm, nvidia_384</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation Device [10de:0fbc] (rev a1)</span><br><span class="line">    Subsystem: Gigabyte Technology Co., Ltd Device [1458:362e]</span><br><span class="line">    Kernel driver <span class="keyword">in</span> use: snd_hda_intel</span><br><span class="line">    Kernel modules: snd_hda_intel</span><br><span class="line">$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/vfio-bind</span><br><span class="line"></span><br><span class="line">vfio-bind 0000:01:00.0 0000:01:00.1</span><br></pre></td></tr></table></figure>


<p>why iommu&#x3D;pt (pass through)<br>for linux kenrel driver module   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">qemu -device pci-assign,host=01:00.0</span><br><span class="line">kvm_iommu_map_pages</span><br><span class="line">  └─iommu_map</span><br><span class="line">      └─intel_iommu_map(domain-&gt;ops-&gt;map)</span><br><span class="line">          └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line">qemu -device vfio-pci,host=b1:00.0</span><br><span class="line">vfio_iommu_type1_ioctl</span><br><span class="line">  └─vfio_dma_do_map</span><br><span class="line">      └─vfio_pin_map_dma</span><br><span class="line">          └─vfio_iommu_map</span><br><span class="line">              └─iommu_map</span><br><span class="line">                  └─intel_iommu_map(domain-&gt;ops-&gt;map)</span><br><span class="line">                     └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line">i40e</span><br><span class="line">i40e_alloc_mapped_page</span><br><span class="line">  └─dma_map_page &lt;--------------In the i40e driver</span><br><span class="line">      └─intel_map_page</span><br><span class="line">          └─__intel_map_single</span><br><span class="line">              ├─<span class="keyword">if</span>(iommu_no_mapping) <span class="built_in">return</span> paddr;</span><br><span class="line">              ├─intel_alloc_iova</span><br><span class="line">              └─domain_pfn_mapping</span><br><span class="line"></span><br><span class="line"><span class="comment">#iommu=pt means the iommu_no_mapping=1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> hw_pass_through==0</span><br><span class="line">   hardware identity mapping</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   software identity mapping</span><br><span class="line"></span><br><span class="line">那是不是如果配置了intel_iommu=on，内核驱动都会被影响（不仅仅是i40e），不能直接使用paddr，而是需要走intel_alloc_iova，domain_pfn_mapping</span><br><span class="line"><span class="comment">#iommu=pt并不会影响kvm/dpdk/spdk的性能，这三者本质上都是用户态驱动，iommu=pt只会影响内核驱动，能让内核驱动设备性能更高。</span></span><br><span class="line">https://zhuanlan.zhihu.com/p/365408539</span><br><span class="line"></span><br><span class="line">kvm一定要用intel_iommu=on，DPDK/SPDK如果绑定vfio-pci那也一定要求intel_iommu=on，如果绑定uio/igb_uio那么就不需要intel_iommu=on，推荐都用vfio-pci，后面kvm中的pci-assign，DPDK/SPDK用到的igb_uio都得淘汰。</span><br><span class="line">还有一个内核参数是nointremap，iommu实现了dma remapping和intr remaping，kvm二者都要用，但DPDK/SPDK用轮询模式，可以不用int remapping功能，那nointremap就派上用场了(Do not <span class="built_in">enable</span> interrupt remapping)</span><br></pre></td></tr></table></figure>
<p>remove   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virsh nodedev-detach pci_0000_82_00_0</span><br></pre></td></tr></table></figure>

<h3 id="Re-import-lvm-LVM"><a href="#Re-import-lvm-LVM" class="headerlink" title="Re-import lvm LVM"></a>Re-import lvm LVM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ storcli64 /call/fall show</span><br><span class="line">$ storcli64 /c0/fall import</span><br><span class="line">$ vgscan</span><br><span class="line"> Reading all physical volumes.  This may take a <span class="keyword">while</span>...</span><br><span class="line">  Found volume group <span class="string">&quot;xx&quot;</span> using metadata <span class="built_in">type</span> lvm2</span><br><span class="line">$ vgchange -ay</span><br><span class="line">  1 logical volume(s) <span class="keyword">in</span> volume group <span class="string">&quot;xx&quot;</span> now active</span><br><span class="line">$ lvs</span><br><span class="line">xx_lv  xx_vg -wi-a-----  1t</span><br><span class="line">$ lvdisplay</span><br></pre></td></tr></table></figure>

<h3 id="hot-plugin-pci-device"><a href="#hot-plugin-pci-device" class="headerlink" title="hot plugin pci device"></a>hot plugin pci device</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[test_server /sys/devices/pci0000:00/0000:00:02.0/0000:03:00.0/host1/scsi_host/host1]$ <span class="built_in">cd</span> ../../../</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">broken_parity_status      current_link_width  driver_override  iommu_group     max_link_width  pools   resource        subsystem         vpd</span><br><span class="line">class                     d3cold_allowed      <span class="built_in">enable</span>           irq             modalias        power   resource0       subsystem_device</span><br><span class="line">config                    device              firmware_node    local_cpulist   msi_bus         remove  resource1       subsystem_vendor</span><br><span class="line">consistent_dma_mask_bits  dma_mask_bits       host1            local_cpus      msi_irqs        rescan  sriov_numvfs    uevent</span><br><span class="line">current_link_speed        driver              iommu            max_link_speed  numa_node       reset   sriov_totalvfs  vendor</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line"> /sys/devices/pci0000:00/0000:00:02.0/0000:03:00.0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -l reset remove</span><br><span class="line">--w------- 1 root root 4096 Apr 10 11:57 reset</span><br><span class="line">--w--w---- 1 root root 4096 Apr 10 11:56 remove</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; reset</span><br><span class="line"></span><br><span class="line">or remove and rescan</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; remove</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/rescan</span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-nspawn-container"><a href="#Creating-a-nspawn-container" class="headerlink" title="Creating a nspawn container"></a><a target="_blank" rel="noopener" href="https://docs.fedoraproject.org/en-US/fedora-server/container-nspawn-install/">Creating a nspawn container</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">machinectl start <span class="built_in">arch</span></span><br><span class="line">machinectl login <span class="built_in">arch</span></span><br><span class="line">machinectl shell <span class="built_in">arch</span> /usr/bin/pwd</span><br><span class="line">machinectl poweroff <span class="built_in">arch</span></span><br><span class="line"></span><br><span class="line">machinectl reboot container_name</span><br><span class="line">machinectl terminate container_name</span><br><span class="line">machinectl <span class="built_in">kill</span> container_name</span><br><span class="line"></span><br><span class="line">machinectl list</span><br><span class="line">machinectl status container_name</span><br><span class="line">machinectl show container_name</span><br><span class="line">machinectl <span class="built_in">enable</span> container_name</span><br><span class="line">machinectl <span class="built_in">disable</span> container_name</span><br><span class="line"></span><br><span class="line">machinectl <span class="built_in">bind</span> container_name PATH [PATH]</span><br><span class="line">machinectl copy-to container_name PATH [PATH]</span><br><span class="line">machinectl copy-from container_name PATH [PATH]</span><br><span class="line"></span><br><span class="line">如果启用了--private-users参数，原有文件依旧会保持原有uid/gid，只有在容器内发生读写的时候，产生新的文件才会映射到新的拥有者，通过开启--private-users-chown参数，强行迫使原有文件全部映射到新的用户和用户组。同理，也可以反向操作，将发生偏移的容器内的文件，全部修改回正常的uid/gid</span><br><span class="line">--network-interface 参数指定一个网络给容器，这个参数不是共享网卡，而是直接从宿主机中移除这个网卡，并添加到容器中，在停用容器之后才会返回这个网卡。参数对应配置文件中[Network]Interface。注意：不能直接把无线网卡分配给容器，如果要分配无线网卡给容器，无线网卡必须支持命名空间。</span><br><span class="line"></span><br><span class="line">--network-macvlan/--network-ipvlan，相当于桥接，网卡的前缀是<span class="built_in">mv</span>-/iv-，macvlan是同个网卡不同MAC地址，ipvlan是同个MAC地址不同IP地址。这两个方法都有一个缺点，那就是无法直接于宿主机通讯，即使处于同一个网段下面。</span><br><span class="line">--network-veth，在主机和容器之间创建一个虚拟网卡，网卡前缀是ve-，--network-bridge把主机上的桥接网卡映射到容器里面，不能直接指定主机上的物理网卡，必须在主机端建立bridge之后，把这个bridge分配给容器，这个参数会间接启用--network-veth。</span><br><span class="line">其他的网络相关参数还有 --network-zone=或是--port，用于批量管理容器网络，后者用于暴露端口到主机，不过都是在开启私有网络并且配置完整的时候可以启用，具体可以去看手册。</span><br><span class="line">要禁用私有网络，设定参数--network-veth=no/--private-network=no或是在配置文件里面添加:</span><br></pre></td></tr></table></figure>

<h3 id="ddrescue"><a href="#ddrescue" class="headerlink" title="ddrescue"></a>ddrescue</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#backup</span></span><br><span class="line">             input file------               ------output file          ------<span class="built_in">log</span> file</span><br><span class="line">                            |               |                          |</span><br><span class="line">$ ddrescue -n -r3 -f /dev/sd<span class="variable">$&#123;bad_dev&#125;</span> /mnt/sd<span class="variable">$&#123;bad_dev&#125;</span>.img /mnt/sd<span class="variable">$&#123;bad_dev&#125;</span>.<span class="built_in">log</span></span><br><span class="line">or</span><br><span class="line">$ ddrescue -n -r3 -f /dev/sd<span class="variable">$&#123;bad_dev&#125;</span> /mnt/sd<span class="variable">$&#123;replace_dev&#125;</span>.img /mnt/sd<span class="variable">$&#123;bad_dev&#125;</span>.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#restore</span></span><br><span class="line">$ ddrescue -n -f /mnt/sd<span class="variable">$&#123;bad_dev&#125;</span>.img /dev/sd<span class="variable">$&#123;replace_dev&#125;</span> /mnt/sd<span class="variable">$&#123;replace_dev&#125;</span>.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">       -d, --idirect</span><br><span class="line">              use direct disc access <span class="keyword">for</span> input file</span><br><span class="line"></span><br><span class="line">       -D, --odirect</span><br><span class="line">              use direct disc access <span class="keyword">for</span> output file</span><br><span class="line"></span><br><span class="line">       -b, --sector-size=&lt;bytes&gt;</span><br><span class="line">              sector size of input device [default 512]</span><br><span class="line"></span><br><span class="line">       -r, --retry-passes=&lt;n&gt;</span><br><span class="line">              <span class="built_in">exit</span> after &lt;n&gt; retry passes (-1=infinity) [0]</span><br><span class="line"></span><br><span class="line">       -i, --input-position=&lt;bytes&gt;</span><br><span class="line">              starting position of domain <span class="keyword">in</span> input file [0]</span><br><span class="line"></span><br><span class="line">       -o, --output-position=&lt;bytes&gt;</span><br><span class="line">              starting position <span class="keyword">in</span> output file [ipos]</span><br></pre></td></tr></table></figure>

<h4 id="resume-breakpoint"><a href="#resume-breakpoint" class="headerlink" title="resume breakpoint"></a>resume breakpoint</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ ddrescue -n -f test.file test.file.tmp</span><br><span class="line">GNU ddrescue 1.26</span><br><span class="line">Press Ctrl-C to interrupt</span><br><span class="line">     ipos:   16065 MB, non-trimmed:        0 B,  current rate:   1885 MB/s</span><br><span class="line">     opos:   16065 MB, non-scraped:        0 B,  average rate:   3213 MB/s</span><br><span class="line">non-tried:   58325 MB,  bad-sector:        0 B,    error rate:       0 B/s</span><br><span class="line">  rescued:   16065 MB,   bad areas:        0,        run time:          4s</span><br><span class="line">pct rescued:   21.59%, <span class="built_in">read</span> errors:        0,  remaining time:         19s</span><br><span class="line">                              time since last successful <span class="built_in">read</span>:         n/a</span><br><span class="line">Copying non-tried blocks... Pass 1 (forwards)^C</span><br><span class="line">  Interrupted by user</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -<span class="built_in">ls</span></span><br><span class="line">total 88336768</span><br><span class="line">72647680 -rw-r--r-- 1 root root 74391224320 Dec 30 21:30 test.file</span><br><span class="line">15689088 -rw-r--r-- 1 root root 16065626112 Dec 30 21:40 test.file.tmp</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">wc</span> -c test.file.tmp</span><br><span class="line">16065626112 test.file.tmp</span><br><span class="line"></span><br><span class="line">                        ----could be &lt;=16065626112 or <span class="keyword">select</span> a lower value(re-write some of previous data)</span><br><span class="line">                        |</span><br><span class="line">$ ddrescue -n -f -i 10000000000 -o 10000000000 test.file test.file.tmp</span><br><span class="line">GNU ddrescue 1.26</span><br><span class="line">Press Ctrl-C to interrupt</span><br><span class="line">     ipos:   74391 MB, non-trimmed:        0 B,  current rate:   3194 MB/s</span><br><span class="line">     opos:   74391 MB, non-scraped:        0 B,  average rate:   3389 MB/s</span><br><span class="line">non-tried:        0 B,  bad-sector:        0 B,    error rate:       0 B/s</span><br><span class="line">  rescued:   64391 MB,   bad areas:        0,        run time:         18s</span><br><span class="line">pct rescued:  100.00%, <span class="built_in">read</span> errors:        0,  remaining time:         n/a</span><br><span class="line">                              time since last successful <span class="built_in">read</span>:         n/a</span><br><span class="line">Copying non-tried blocks... Pass 1 (forwards)</span><br><span class="line">Finished                                 </span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -<span class="built_in">ls</span></span><br><span class="line">total 147056996</span><br><span class="line">72647680 -rw-r--r-- 1 root root 74391224320 Dec 30 21:30 test.file</span><br><span class="line">74409316 -rw-r--r-- 1 root root 74391224320 Dec 30 21:42 test.file.tmp</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sha256sum</span> test.file.tmp</span><br><span class="line">e71a4013887bdf8becc1c0f54a28d83b94328eb9dc020d4987ce55bd0ecff549  test.file.tmp</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sha256sum</span> test.file</span><br><span class="line">e71a4013887bdf8becc1c0f54a28d83b94328eb9dc020d4987ce55bd0ecff549  test.file</span><br></pre></td></tr></table></figure>

<h3 id="KVM"><a href="#KVM" class="headerlink" title="KVM"></a><a target="_blank" rel="noopener" href="https://www.linuxtechi.com/how-to-install-kvm-on-rhel-9/">KVM</a></h3><p>add bridge</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brctl addbr br0</span><br><span class="line">$ ip addr show</span><br><span class="line">$ brctl addif br0 eth0 eth1</span><br><span class="line">$ brctl show</span><br></pre></td></tr></table></figure>

<p>enable UEFI, test under el8    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ dnf install edk2-ovmf</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">os</span> <span class="attr">firmware</span>=<span class="string">&quot;efi&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span> <span class="attr">arch</span>=<span class="string">&quot;x86_64&quot;</span> <span class="attr">machine</span>=<span class="string">&quot;pc-q35-5.1&quot;</span>&gt;</span>hvm<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loader</span> <span class="attr">secure</span>=<span class="string">&quot;no&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">boot</span> <span class="attr">dev</span>=<span class="string">&quot;hda&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>enable numa for the vm, el9 worked</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">cpu</span> <span class="attr">mode</span>=<span class="string">&#x27;host-passthrough&#x27;</span> <span class="attr">check</span>=<span class="string">&#x27;none&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">mode</span>=<span class="string">&#x27;passthrough&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">numa</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">cell</span> <span class="attr">id</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">cpus</span>=<span class="string">&#x27;0-3,8-11&#x27;</span> <span class="attr">memory</span>=<span class="string">&#x27;8388608&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">cell</span> <span class="attr">id</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cpus</span>=<span class="string">&#x27;4-7,12-15&#x27;</span> <span class="attr">memory</span>=<span class="string">&#x27;8388608&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">numa</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cpu</span>&gt;</span></span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line">vcputune worked on el8</span><br><span class="line">topology and iothreadpin not working on el8 </span><br><span class="line"><span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">&#x27;static&#x27;</span>&gt;</span>8<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iothreads</span>&gt;</span>1<span class="tag">&lt;/<span class="name">iothreads</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cputune</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;2&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;8&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;2&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;3&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;3&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;9&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;4&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;4&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;5&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;10&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;6&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;5&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;7&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;11&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">emulatorpin</span> <span class="attr">cpuset</span>=<span class="string">&#x27;0,6&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iothreadpin</span> <span class="attr">iothread</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;0,6&#x27;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">cputune</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">topology</span> <span class="attr">sockets</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cores</span>=<span class="string">&#x27;4&#x27;</span> <span class="attr">threads</span>=<span class="string">&#x27;2&#x27;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">or </span><br><span class="line">working online VM</span><br><span class="line">virsh vcpupin $guest 0 0,1,2,3,8,9,10,11</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install qemu-kvm libvirt virt-install bridge-utils virt-viewer virt-manager virt-top libguestfs-tools</span><br><span class="line">$ systemctl start libvirtd</span><br><span class="line">$ systemctl <span class="built_in">enable</span> libvirtd</span><br><span class="line">$ systemctl status libvirtd</span><br></pre></td></tr></table></figure>

<p>pin CPU and memory</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">$ virsh emulatorpin rhel7 3-4</span><br><span class="line">virsh numatune rhel7 --nodeset 0-10</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cputune</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;16&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;17&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;2&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;18&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;3&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;19&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;4&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;20&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;5&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;21&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;6&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;22&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&#x27;7&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;23&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cputune</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">numatune</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">memory</span> <span class="attr">mode</span>=<span class="string">&#x27;strict&#x27;</span> <span class="attr">nodeset</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">numatune</span>&gt;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"><span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">&#x27;auto&#x27;</span>&gt;</span>8<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">&#x27;static&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&#x27;0-10,ˆ5&#x27;</span>&gt;</span>8<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"><span class="tag">&lt;<span class="name">cputune</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;1-4,ˆ2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;0,1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;2&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;2,3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;3&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;0,4&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cputune</span>&gt;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">numatune</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">memory</span> <span class="attr">mode</span>=<span class="string">&#x27;strict&#x27;</span> <span class="attr">placement</span>=<span class="string">&#x27;auto&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">numatune</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">numatune</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">memory</span> <span class="attr">mode</span>=<span class="string">&#x27;strict&#x27;</span> <span class="attr">nodeset</span>=<span class="string">&#x27;0,2-3&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">numatune</span>&gt;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"><span class="tag">&lt;<span class="name">cputune</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;2&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">&quot;3&quot;</span> <span class="attr">cpuset</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cputune</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">numatune</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">memory</span> <span class="attr">mode</span>=<span class="string">&quot;strict&quot;</span> <span class="attr">nodeset</span>=<span class="string">&quot;1-2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">numatune</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cpu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">numa</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cell</span> <span class="attr">id</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cpus</span>=<span class="string">&quot;0-1&quot;</span> <span class="attr">memory</span>=<span class="string">&quot;3&quot;</span> <span class="attr">unit</span>=<span class="string">&quot;GiB&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cell</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cpus</span>=<span class="string">&quot;2-3&quot;</span> <span class="attr">memory</span>=<span class="string">&quot;3&quot;</span> <span class="attr">unit</span>=<span class="string">&quot;GiB&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">numa</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cpu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The share dev in the a pair kvm config, qcow2 not support, raw image  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">device</span>=<span class="string">&#x27;disk&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;qemu&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;raw&#x27;</span> <span class="attr">cache</span>=<span class="string">&#x27;writethrough&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&#x27;/tank/test0.raw&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">&#x27;sda&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;scsi&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">shareable</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">serial</span>&gt;</span>0001<span class="tag">&lt;/<span class="name">serial</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;drive&#x27;</span> <span class="attr">controller</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;0&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">device</span>=<span class="string">&#x27;disk&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;qemu&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;raw&#x27;</span> <span class="attr">cache</span>=<span class="string">&#x27;writethrough&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&#x27;/tank/test1.raw&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">&#x27;sdb&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;scsi&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">shareable</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">serial</span>&gt;</span>0002<span class="tag">&lt;/<span class="name">serial</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;drive&#x27;</span> <span class="attr">controller</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The multipath config  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">device</span>=<span class="string">&#x27;disk&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;qemu&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&#x27;/kvm/fileA.qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">&#x27;sda&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;scsi&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">serial</span>&gt;</span>0002<span class="tag">&lt;/<span class="name">serial</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;drive&#x27;</span> <span class="attr">controller</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;0&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">device</span>=<span class="string">&#x27;disk&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;qemu&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&#x27;/kvm/fileA.qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">&#x27;sdb&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;scsi&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">serial</span>&gt;</span>0002<span class="tag">&lt;/<span class="name">serial</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;drive&#x27;</span> <span class="attr">controller</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>snapshot  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list</span></span><br><span class="line">qemu-img snapshot -l /kvm/fileA.qcow2</span><br><span class="line">ID ...</span><br><span class="line">1 ...  </span><br><span class="line"></span><br><span class="line"><span class="comment"># create</span></span><br><span class="line">qemu-img snapshot -c first /kvm/fileA.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># recovery</span></span><br><span class="line">qemu-img snapshot -a 1 /kvm/fileA.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete</span></span><br><span class="line">qemu-img snapshot -d 1 /kvm/fileA.qcow2</span><br></pre></td></tr></table></figure>

<p>base image  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ qemu-img create -f qed vm1.qed 80G</span><br><span class="line">$ qemu-img convert -f vmdk -O raw centos7.vmdk centos7.img</span><br><span class="line"></span><br><span class="line"><span class="comment">#Base images el8,el9</span></span><br><span class="line">$ qemu-img create -f qcow2 -b base-img/linux.qcow2 -F qcow2 linux_test01.qcow2</span><br><span class="line">$ qemu-img create -f qcow2 -b base-img/linux.qcow2 -F qcow2 linux_test02.qcow2</span><br><span class="line">$ qemu-img create -f qcow2 -b base-img/linux.qcow2 -F qcow2 linux_test03.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment">#Base images el6,el7 </span></span><br><span class="line">$ qemu-img create -b centos6-base.qed -f  qed  centos6-tmp.qed</span><br><span class="line">$ qemu-img rebase  -u -b centos-6.qed ./kvm1.qed</span><br></pre></td></tr></table></figure>

<p>Virt-manager show unreadable code     </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install dejavu-sans-fonts</span><br><span class="line">$ yum -y install ghostscript-chinese-zh_CN</span><br></pre></td></tr></table></figure>

<p>NIC SR-IOV<br>If intel_iommu&#x3D;on or amd_iommu&#x3D;on works, you can try replacing them with iommu&#x3D;pt or amd_iommu&#x3D;pt. The pt option only enables IOMMU for devices used in passthrough and will provide better host performance. However, the option may not be supported on all hardware. Revert to previous option if the pt option doesn’t work for your host.<br>If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the allow_unsafe_interrupts option if the virtual machines are trusted. The allow_unsafe_interrupts is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:     </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ grubby --update-kernel=ALL --args=<span class="string">&#x27;intel_iommu=pt&#x27;</span></span><br><span class="line">$ vi /etc/modprobe.d</span><br><span class="line">options vfio_iommu_type1 allow_unsafe_interrupts=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># mellanox connect-x 3 pro driver sr-iov and rocev2, rr_proto is change the port number </span></span><br><span class="line">options mlx4_core  roce_mode=2 rr_proto=23456 port_type_array=2,2 num_vfs=2 probe_vf=0 enable_64b_cqe_eqe=0  log_num_mgm_entry_size=-1</span><br><span class="line"></span><br><span class="line"><span class="comment">#worked</span></span><br><span class="line"><span class="comment">#options mlx4_core roce_mode=2 port_type_array=2,2 probe_vf=1 num_vfs=4,4,0 probe_vf=4,4,0 enable_64b_cqe_eqe=0 log_num_mgm_entry_size=-1</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenxiangneu/article/details/78955462">x86 AlmaLinux 8.7 platform to emulate the ARM guest</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://download.qemu.org/qemu-6.2.0.tar.xz</span><br><span class="line">$ wget https://www.kraxel.org/repos/jenkins/edk2/edk2.git-aarch64-0-20220719.209.gf0064ac3af.EOL.no.nore.updates.noarch.rpm</span><br><span class="line">$ wget http://releases.linaro.org/components/kernel/uefi-linaro/16.02/release/qemu64/QEMU_EFI.fd</span><br><span class="line">$ wget http://releases.linaro.org/components/kernel/uefi-linaro/16.02/release/qemu64/QEMU_EFI.img.gz</span><br><span class="line"></span><br><span class="line">$ dnf install zlib-devel glib2-devel pixman-devel ninja-build.x86_64 bzip2-devel zstd virt-manager pixman-devel.x86_64</span><br><span class="line">$ <span class="built_in">cd</span> qemu-6.2.0</span><br><span class="line">$ ./configure --target-list=aarch64-softmmu </span><br><span class="line">$ make -j 24</span><br><span class="line">$ make install</span><br><span class="line">$ <span class="built_in">which</span> qemu-system-aarch64 </span><br><span class="line">/usr/local/bin/qemu-system-aarch64</span><br><span class="line"></span><br><span class="line">$ qemu-img create -f raw -o size=52G aarch64-vm1.img</span><br><span class="line"></span><br><span class="line">$ vi /etc/libvirt/qemu.conf</span><br><span class="line"><span class="comment">#add</span></span><br><span class="line">nvram = [</span><br><span class="line">   <span class="string">&quot;/usr/share/edk2.git/aarch64/QEMU_EFI-pflash.raw:/usr/share/edk2.git/aarch64/vars-template-pflash.raw&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ systemctl restart libvirtd</span><br><span class="line"></span><br><span class="line"><span class="comment">### test failed by cmd</span></span><br><span class="line"><span class="comment">#create vm</span></span><br><span class="line">$ qemu-system-aarch64 -m 4096 -cpu cortex-a72 -smp 4 -M virt -bios QEMU_EFI.fd -nographic -drive <span class="keyword">if</span>=none,file=CentOS-7-aarch64-Everything-1810.iso,<span class="built_in">id</span>=cdrom,media=cdrom -device virtio-scsi-device -device scsi-cd,drive=cdrom -drive <span class="keyword">if</span>=none,file=aarch64-vm1.img,<span class="built_in">id</span>=hd0 -device virtio-blk-device,drive=hd0</span><br><span class="line"></span><br><span class="line"><span class="comment">#start vm</span></span><br><span class="line">$ qemu-system-aarch64 -m 4096-cpu cortex-a72 -smp 4-M virt -bios QEMU_EFI.fd -nographic -drive <span class="keyword">if</span>=none,file=aarch64-vm1.img,<span class="built_in">id</span>=hd0 -device virtio-blk-device,drive=hd0</span><br><span class="line"><span class="comment"># grub could not be show(need to add vga dev)</span></span><br></pre></td></tr></table></figure>

<p>create it by virt-manager</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -Y <span class="built_in">test</span>@test-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#local X by ssh</span></span><br><span class="line">$ virt-manager </span><br><span class="line"></span><br><span class="line"><span class="comment">#right click QEMU/KVM---&gt; new---&gt; architecture options---&gt; x86_64/aarch64(machine type---&gt;virt)---&gt; import existing disk image---&gt; browser the existing storage path</span></span><br><span class="line">---&gt; Choose memory and CPU setting---&gt; Customize configuration before install---&gt; Add cdrom <span class="keyword">for</span> install (AlmaLinux-8.7-aarch64-dvd.iso)---&gt; Boot options(<span class="built_in">set</span> cdrom, <span class="built_in">enable</span> boot menu)</span><br><span class="line">---&gt; Choose Overview ---&gt; machine <span class="built_in">type</span>---&gt; virt-6.2---&gt; firmware(UEFI aarch64)</span><br><span class="line">---&gt; Begin installation---&gt;modify cpu to cortex-a72</span><br><span class="line"></span><br><span class="line"><span class="comment"># or if you want like x86 kvm, there is no driver when the keyboard and mouse go to the kvm screen, the shortcuts not working in the VNC, I have to kill the virt-manager</span></span><br><span class="line">---&gt;Add usb keyboard/mouse ---&gt;Add video(ramfb)---&gt;Add Display VNC</span><br><span class="line"></span><br><span class="line"><span class="comment"># When you go to UEFI shell</span></span><br><span class="line">shell&gt; <span class="built_in">exit</span> </span><br><span class="line"><span class="comment"># go to BIOS or show the boot dev</span></span><br><span class="line"><span class="comment"># I&#x27;m setting the cdrom boot by virt-manager</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://bugzilla.redhat.com/show_bug.cgi?id=1998820">qemu high version cause the libguestfs bugs</a><br><a target="_blank" rel="noopener" href="https://github.com/libguestfs/libguestfs/commit/45de287447bb18d59749fbfc1ec5072413090109">git the libguestfs bugs</a><br><a target="_blank" rel="noopener" href="https://repo.almalinux.org/vault/8.7/AppStream/Source/Packages/">almalinux source el8</a></p>
<h5 id="sanlock"><a href="#sanlock" class="headerlink" title="sanlock"></a><a target="_blank" rel="noopener" href="http://ssdxiao.github.io/linux/2017/04/12/Libvirt-Sanlock.html">sanlock</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">LOCKSPACE = &lt;lockspace_name&gt;:&lt;host_id&gt;:&lt;path&gt;:&lt;offset&gt;</span><br><span class="line">  &lt;lockspace_name&gt;	name of lockspace</span><br><span class="line">  &lt;host_id&gt;		<span class="built_in">local</span> host identifier <span class="keyword">in</span> lockspace</span><br><span class="line">  &lt;path&gt;		disk to storage reserved <span class="keyword">for</span> leases</span><br><span class="line">  &lt;offset&gt;		offset on path (bytes)</span><br><span class="line"></span><br><span class="line">RESOURCE = &lt;lockspace_name&gt;:&lt;resource_name&gt;:&lt;path&gt;:&lt;offset&gt;[:&lt;lver&gt;]</span><br><span class="line">  &lt;lockspace_name&gt;	name of lockspace</span><br><span class="line">  &lt;resource_name&gt;	name of resource</span><br><span class="line">  &lt;path&gt;		disk to storage reserved <span class="keyword">for</span> leases</span><br><span class="line">  &lt;offset&gt;		offset on path (bytes)</span><br><span class="line">  &lt;lver&gt;        optional leader version or SH <span class="keyword">for</span> shared lease</span><br><span class="line"></span><br><span class="line">lockspace_name ：<span class="built_in">test</span></span><br><span class="line">host_id ：1（sanlock的host_id支持1-2000之间，0一般用来初始化时使用）</span><br><span class="line">path : /mnt/nfs/test_lockspace （用来存储LOCKSPACE的空间,这个空间需要是在共享存储上）</span><br><span class="line">offset ： 0（用来表示这个文件的起始位置）</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>:1:/mnt/nfs/test_lockspace：0</span><br><span class="line"></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1048576 count=1 of=/mnt/nfs/test_lockspace</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1048576 count=1 of=/mnt/nfs/test_resource</span><br><span class="line"><span class="built_in">chown</span> sanlock:sanlock /mnt/nfs/test_lockspace</span><br><span class="line"><span class="built_in">chown</span> sanlock:sanlock /mnt/nfs/test_resource</span><br><span class="line">sanlock client init -s LS:0:/mnt/nfs/test_lockspace:0</span><br><span class="line">sanlock client init -r LS:RS:/mnt/nfs/test_resource:0</span><br><span class="line"></span><br><span class="line"><span class="comment">#hostA</span></span><br><span class="line">$ sanlock client add_lockspace -s  LS:1:/mnt/nfs/test_lockspace:0</span><br><span class="line"><span class="comment">#hostB</span></span><br><span class="line">$ sanlock client add_lockspace -s  LS:2:/mnt/nfs/test_lockspace:0   </span><br><span class="line"></span><br><span class="line">$ sanlock client acquire -r LS:RS:/mnt/nfs/test_resource:0 -p (pid)</span><br><span class="line"></span><br><span class="line"> /etc/libvirt/qemu-sanlock.conf</span><br><span class="line">auto_disk_leases = 1（1为开启自动加锁，0为关闭自动加锁）</span><br><span class="line">host_id = 1</span><br><span class="line">disk_lease_dir = <span class="string">&quot;/var/lib/libvirt/sanlock&quot;</span></span><br><span class="line"></span><br><span class="line">因为libvirt中默认的LOCKSPACE文件所在目录是/var/lib/libvirt/sanlock，所以我们在该目录下进行LOCKSPACE文件和RESOURCE文件的创建。</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1048576 count=1 of=/var/lib/libvirt/sanlock/LS</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1048576 count=1 of=/var/lib/libvirt/sanlock/RS</span><br><span class="line"><span class="built_in">chown</span> sanlock:sanlock /var/lib/libvirt/sanlock/LS</span><br><span class="line"><span class="built_in">chown</span> sanlock:sanlock /var/lib/libvirt/sanlock/RS</span><br><span class="line">sanlock client init -s LS:0:/var/lib/libvirt/sanlock/LS:0</span><br><span class="line">sanlock client init -r LS:RS:/var/lib/libvirt/sanlock/RS:0</span><br><span class="line"></span><br><span class="line"><span class="comment">#hostA</span></span><br><span class="line">   sanlock client add_lockspace -s  LS:1:/var/lib/libvirt/sanlock/LS:0</span><br><span class="line"><span class="comment">#hostB</span></span><br><span class="line">   sanlock client add_lockspace -s  LS:2:/var/lib/libvirt/sanlock/LS:0  </span><br><span class="line"></span><br><span class="line"> &lt;lease&gt;</span><br><span class="line">        &lt;lockspace&gt;LS&lt;/lockspace&gt;</span><br><span class="line">        &lt;key&gt;RS&lt;/key&gt;</span><br><span class="line">        &lt;target path=<span class="string">&#x27;/var/lib/libvirt/sanlock/RS&#x27;</span> offset=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">     &lt;/lease&gt;</span><br><span class="line"></span><br><span class="line">lockspace中填的内容，既是LOCKSPACE的名字，也是LOCKSPACE文件的名字。</span><br><span class="line">key是RESOURCE的名字</span><br><span class="line">path是RESOURCE文件的路径。</span><br><span class="line">offset是RESOURCE在磁盘上的偏移。因为我们使用单独文件，偏移就是0</span><br></pre></td></tr></table></figure>

<h4 id="clear-icetea-cache"><a href="#clear-icetea-cache" class="headerlink" title="clear icetea cache"></a>clear icetea cache</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">rm</span> -rf ~/.cache/icedtea-web/cache</span><br></pre></td></tr></table></figure>

<h3 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># not be OOM kill</span></span><br><span class="line">$ <span class="built_in">echo</span> -1000 &gt; /proc/&#123;pid&#125;/oom_score_adj</span><br></pre></td></tr></table></figure>

<h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><p><a target="_blank" rel="noopener" href="https://www.kawabangga.com/posts/4870">curl 3x requestes in the same tcp connection</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">  -w <span class="string">&quot;\ntest string %&#123;local_ip&#125;:%&#123;local_port&#125; %&#123;method&#125; %&#123;remote_ip&#125;:%&#123;remote_port&#125;\n&quot;</span> --request GET \</span><br><span class="line">  --url http://httpbin.org/headers \</span><br><span class="line">  --header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  --data <span class="string">&#x27;&#123;&quot;N&quot;: 8&#125;&#x27;</span> \</span><br><span class="line">  --next \</span><br><span class="line">  -w <span class="string">&quot;\ntest string %&#123;local_ip&#125;:%&#123;local_port&#125; %&#123;method&#125; %&#123;remote_ip&#125;:%&#123;remote_port&#125;\n&quot;</span> --request GET \</span><br><span class="line">  --url http://httpbin.org/headers \</span><br><span class="line">  --header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  --data <span class="string">&#x27;&#123;&quot;N&quot;: 8&#125;&#x27;</span> \</span><br><span class="line">  --next \</span><br><span class="line">  -w <span class="string">&quot;\ntest string %&#123;local_ip&#125;:%&#123;local_port&#125; %&#123;method&#125; %&#123;remote_ip&#125;:%&#123;remote_port&#125;\n&quot;</span> --request GET \</span><br><span class="line">  --url http://httpbin.org/headers \</span><br><span class="line">  --header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  --data <span class="string">&#x27;&#123;&quot;N&quot;: 8&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Fonts-fonts"><a href="#Fonts-fonts" class="headerlink" title="Fonts fonts"></a>Fonts fonts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iTerm2</span><br><span class="line">zenBurn color</span><br><span class="line">MacOS Monaco</span><br><span class="line">Linux Monospace</span><br><span class="line">Office online Calibri</span><br></pre></td></tr></table></figure>

<h3 id="Argument-list-too-long"><a href="#Argument-list-too-long" class="headerlink" title="Argument list too long"></a>Argument list too long</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -S -s unlimited</span><br><span class="line"><span class="comment">#not working for el8</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -S -s $((<span class="number">1024</span>*<span class="number">256</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Disable-randomization-of-memory-addresses"><a href="#Disable-randomization-of-memory-addresses" class="headerlink" title="Disable randomization of memory addresses"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5194666/disable-randomization-of-memory-addresses">Disable randomization of memory addresses</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line"></span><br><span class="line"><span class="comment">#Specifies whether GDB should disable the address space randomization provided by Linux kernel before starting the debugged program.</span></span><br><span class="line"><span class="built_in">set</span> disable-randomization on</span><br><span class="line"><span class="built_in">set</span> disable-randomization off</span><br><span class="line">show disable-randomization</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int <span class="function"><span class="title">main</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    int localVar;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Address of a stack variable: %08X\n&quot;</span>, &amp;localVar);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BFFFF6CC</span><br><span class="line">[Inferior 1 (process 8368) exited normally]</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BFFFF6CC</span><br><span class="line">[Inferior 1 (process 8371) exited normally]</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BFFFF6CC</span><br><span class="line">[Inferior 1 (process 8372) exited normally]</span><br><span class="line"></span><br><span class="line">(gdb) <span class="built_in">set</span> disable-randomization off</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BF92FB3C</span><br><span class="line">[Inferior 1 (process 8376) exited normally]</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BFE16CFC</span><br><span class="line">[Inferior 1 (process 8377) exited normally]</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/testuser/randtest</span><br><span class="line">Address of a stack variable: BF93FE5C</span><br><span class="line">[Inferior 1 (process 8378) exited normally]</span><br></pre></td></tr></table></figure>

<h3 id="make-module-under-centos"><a href="#make-module-under-centos" class="headerlink" title="make module under centos"></a><a target="_blank" rel="noopener" href="https://github.com/Chikage0o0/Linux-NetSpeed/blob/master/tcp.sh">make module under centos</a></h3><p>Add bbr kernel module under centos 7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> bbrmod &amp;&amp; <span class="built_in">cd</span> bbrmod</span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/bbr/centos/tcp_nanqinlang.c</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;obj-m := tcp_nanqinlang.o&quot;</span> &gt; Makefile</span><br><span class="line">make -C /lib/modules/$(<span class="built_in">uname</span> -r)/build M=`<span class="built_in">pwd</span>` modules CC=/usr/bin/gcc</span><br><span class="line"><span class="built_in">chmod</span> +x ./tcp_nanqinlang.ko</span><br><span class="line"><span class="built_in">cp</span> -rf ./tcp_nanqinlang.ko /lib/modules/$(<span class="built_in">uname</span> -r)/kernel/net/ipv4</span><br><span class="line">insmod tcp_nanqinlang.ko</span><br><span class="line">depmod -a</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;release&#125;</span>&quot;</span> == <span class="string">&quot;ubuntu&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$&#123;version&#125;</span>&quot;</span> = <span class="string">&quot;14&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	apt-get -y install build-essential</span><br><span class="line">	apt-get -y install software-properties-common</span><br><span class="line">	add-apt-repository ppa:ubuntu-toolchain-r/test -y</span><br><span class="line">	apt-get update</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">apt-get -y install make gcc-4.9</span><br><span class="line"><span class="built_in">mkdir</span> bbrmod &amp;&amp; <span class="built_in">cd</span> bbrmod</span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/bbr/tcp_nanqinlang.c</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;obj-m := tcp_nanqinlang.o&quot;</span> &gt; Makefile</span><br><span class="line">make -C /lib/modules/$(<span class="built_in">uname</span> -r)/build M=`<span class="built_in">pwd</span>` modules CC=/usr/bin/gcc-4.9</span><br><span class="line">install tcp_nanqinlang.ko /lib/modules/$(<span class="built_in">uname</span> -r)/kernel</span><br><span class="line"><span class="built_in">cp</span> -rf ./tcp_nanqinlang.ko /lib/modules/$(<span class="built_in">uname</span> -r)/kernel/net/ipv4</span><br><span class="line">depmod -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_congestion_control=nanqinlang&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="detect-port"><a href="#detect-port" class="headerlink" title="detect port"></a>detect port</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ 2&gt;/dev/null &gt;/dev/tcp/192.168.0.17/111</span><br><span class="line">$ nc -z 192.168.0.17 111</span><br></pre></td></tr></table></figure>

<h3 id="dnf"><a href="#dnf" class="headerlink" title="dnf"></a>dnf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ dnf module <span class="built_in">enable</span> -y perl</span><br><span class="line">$ dnf module reset perl-*</span><br><span class="line">$ grep . /etc/*-release</span><br><span class="line">$ dnf module list perl</span><br><span class="line">$ dnf module reset perl</span><br><span class="line">$ dnf module <span class="built_in">enable</span> perl:5.26</span><br><span class="line">$ dnf module list php</span><br><span class="line"></span><br><span class="line">$ dnf module switch-to perl:5.30</span><br><span class="line">$ dnf module <span class="built_in">enable</span> perl:5.30</span><br><span class="line">$ dnf module install perl:5.30</span><br><span class="line"></span><br><span class="line">$ dnf module list</span><br><span class="line"></span><br><span class="line"><span class="comment">#reset</span></span><br><span class="line">$ dnf update --refresh</span><br><span class="line">$ dnf distro-sync</span><br></pre></td></tr></table></figure>

<h3 id="deploy-IBM-Spectrum-Scale-GPFS-client"><a href="#deploy-IBM-Spectrum-Scale-GPFS-client" class="headerlink" title="deploy IBM Spectrum Scale(GPFS) client"></a>deploy IBM Spectrum Scale(GPFS) client</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server and client $ <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">server and client $ ssh-copy-id</span><br><span class="line"></span><br><span class="line">client $ rpm -Uvh --force gpfs.afm.cos-1.0.0-5.x86_64.rpm gpfs.compression-5.1.3-1.x86_64.rpm gpfs.gpl-5.1.3-1.noarch.rpm gpfs.license.da-5.1.3-1.x86_64.rpm gpfs.base-5.1.3-1.x86_64.rpm gpfs.docs-5.1.3-1.noarch.rpm gpfs.gskit-8.0.55-19.1.x86_64.rpm gpfs.java-5.1.3-1.x86_64.rpm gpfs.msg.en_US-5.1.3-1.noarch.rpm</span><br><span class="line"></span><br><span class="line">client $ /usr/lpp/mmfs/bin/mmbuildgpl </span><br><span class="line">server $ /usr/lpp/mmfs/bin/mmaddnode -N <span class="variable">$client01</span></span><br><span class="line">server $ /usr/lpp/mmfs/bin/mmchlicense client --accept -N <span class="variable">$client01</span></span><br><span class="line">server or client $ /usr/lpp/mmfs/bin/mmstartup -N <span class="variable">$client01</span></span><br><span class="line">client $  /usr/lpp/mmfs/bin/mmmount <span class="variable">$fsname</span></span><br><span class="line">client $ <span class="built_in">df</span> -h /<span class="variable">$fsname</span></span><br><span class="line">server $ /usr/lpp/mmfs/bin/mmlslicense  -L</span><br><span class="line">server $ /usr/lpp/mmfs/bin/mmgetstate -N <span class="variable">$client01</span></span><br><span class="line"></span><br><span class="line"> Node number  Node name     GPFS state  </span><br><span class="line">----------------------------------------</span><br><span class="line">          13  <span class="variable">$client01</span>  active</span><br><span class="line"></span><br><span class="line">client $ /usr/lpp/mmfs/bin/mmchlicense client --accept -N <span class="variable">$client01</span></span><br><span class="line">server $ /usr/lpp/mmfs/bin/mmlslicense  -L</span><br></pre></td></tr></table></figure>

<h3 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a>gitlab</h3><h4 id="certificate-issue"><a href="#certificate-issue" class="headerlink" title="certificate issue"></a>certificate issue</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n | openssl s_client -showcerts -connect gitlab.test.cn:443 | sed -ne <span class="string">&#x27;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#x27;</span> 2&gt;/dev/null &gt; gitlab-test-cn.pem</span><br><span class="line">$ sudo <span class="built_in">ln</span> -s ./gitlab-test-cn.pem /etc/ssl/certs/gitlab-test-cn.pem</span><br></pre></td></tr></table></figure>

<h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#show NVIDIA GPU info</span></span><br><span class="line">$ nvidia-smi</span><br><span class="line">$ rocm-smi</span><br><span class="line"></span><br><span class="line">$ nvidia-smi nvlink -gt d -i 0</span><br><span class="line">$ nvidia-smi nvlink -gt r -i 0</span><br></pre></td></tr></table></figure>


<h3 id="time-1"><a href="#time-1" class="headerlink" title="time"></a><a target="_blank" rel="noopener" href="https://www.suse.com/c/cpu-isolation-nohz_full-troubleshooting-tsc-clocksource-by-suse-labs-part-6/">time</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Jul 04 16:08:19 nas kernel: clocksource: timekeeping watchdog on CPU1: hpet wd-wd read-back delay of 1025200ns</span><br><span class="line">Jul 04 16:08:19 nas kernel: clocksource: wd-tsc-wd read-back delay of 578355ns, clock-skew <span class="built_in">test</span> skipped!</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /sys/devices/system/clocksource/clocksource0/available_clocksource</span><br><span class="line">tsc hpet acpi_pm</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $(($(getconf _NPROCESSORS_ONLN)/<span class="number">2</span>))</span><br><span class="line">user_loop-1412 [007] ..s. 241.700979: timer_expire_entry: timer=00000000621eeca1 <span class="keyword">function</span>=clocksource_watchdog now=4294952320 baseclk=4294952320</span><br><span class="line"></span><br><span class="line">This is a machine with 8 CPUs, so the timer runs every 4 seconds on the isolated CPU. The name of the clocksource watchdogs timer callback is clocksource_watchdog and it is easily spotted when the timer_expire_entry trace event is enabled:</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/events/timer/timer_expire_entry/enable</span><br><span class="line"></span><br><span class="line">kernel ver&gt;= 5.1 </span><br><span class="line"><span class="string">&quot;tsc=nowatchdog&quot;</span> boot parameter</span><br><span class="line"></span><br><span class="line">kernel ver&lt;5.1</span><br><span class="line">tsc=reliable</span><br><span class="line"></span><br><span class="line">An unreliable TSC means there is a suspicion that something bad can happen with the clocksource.</span><br><span class="line">An unstable TSC means that something bad has eventually happened with the clocksource.</span><br></pre></td></tr></table></figure>

<h3 id="copy-file"><a href="#copy-file" class="headerlink" title="copy file"></a><a target="_blank" rel="noopener" href="https://www.zylk.net/en/web-2-0/blog/-/blogs/how-to-copy-files-in-linux-faster-and-safer-than-cp">copy file</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tar cf - . | (<span class="built_in">cd</span> /dst; tar xvf -)</span><br><span class="line">$ tar cf - . | pv | (<span class="built_in">cd</span> /dst; tar xf -)</span><br></pre></td></tr></table></figure>

<h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a><a target="_blank" rel="noopener" href="https://alexandrnikitin.github.io/blog/transparent-hugepages-measuring-the-performance-impact/">JVM</a></h3><ul>
<li>JVM supports Transparent Hugepages via the -XX:+UseTransparentHugePages flag. Although they warn about possible performance problems:<ul>
<li>-XX:+UseTransparentHugePages On Linux, enables the use of large pages that can dynamically grow or shrink. This option is disabled by default. You may encounter performance problems with transparent huge pages as the OS moves other pages around to create huge pages; this option is made available for experimentation.</li>
<li>-XX:+UseLargePagesInMetaspace Use large page memory in metaspace. Only used if UseLargePages is enabled.</li>
<li>-XX:+AlwaysPreTouch Enables touching of every page on the Java heap during JVM initialization. This gets all pages into the memory before entering the main() method. The option can be used in testing to simulate a long-running system with all virtual memory mapped to physical memory. By default, this option is disabled and all pages are committed as JVM heap space fills.</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure>

<h3 id="APCI-power-status"><a href="#APCI-power-status" class="headerlink" title="APCI power status"></a>APCI power status</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /sys/power/mem_sleep</span><br><span class="line">[s2idle] shallow deep</span><br></pre></td></tr></table></figure>

<h3 id="TIME-time"><a href="#TIME-time" class="headerlink" title="TIME time"></a>TIME time</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ timedatectl set-time <span class="string">&#x27;16:10:40 2015-11-20&#x27;</span></span><br><span class="line">$ timedatectl set-time 20151120</span><br><span class="line">$ timedatectl set-timezone UTC</span><br><span class="line">$ timedatectl set-timezone <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">$ timedatectl list-timezones | grep <span class="string">&quot;Shanghai&quot;</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">$ hwclock --systohc --localtime <span class="comment">#sync localtime to RTC time</span></span><br><span class="line"></span><br><span class="line">$ timedatectl </span><br><span class="line">               Local time: Tue 2023-05-16 16:16:54 CST</span><br><span class="line">           Universal time: Tue 2023-05-16 08:16:54 UTC</span><br><span class="line">                 RTC time: Tue 2023-05-16 08:17:00</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: no</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br><span class="line">$ hwclock --systohc --localtime</span><br><span class="line">$ timedatectl </span><br><span class="line">               Local time: Tue 2023-05-16 16:17:27 CST</span><br><span class="line">           Universal time: Tue 2023-05-16 08:17:27 UTC</span><br><span class="line">                 RTC time: Tue 2023-05-16 16:17:27</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: no</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Warning: The system is configured to <span class="built_in">read</span> the RTC time <span class="keyword">in</span> the <span class="built_in">local</span> time zone.</span><br><span class="line">         This mode cannot be fully supported. It will create various problems</span><br><span class="line">         with time zone changes and daylight saving time adjustments. The RTC</span><br><span class="line">         time is never updated, it relies on external facilities to maintain it.</span><br><span class="line">         If at all possible, use RTC <span class="keyword">in</span> UTC by calling</span><br><span class="line">         <span class="string">&#x27;timedatectl set-local-rtc 0&#x27;</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">#recovery RTC time</span></span><br><span class="line">$ timedatectl set-local-rtc 0</span><br></pre></td></tr></table></figure>

<h3 id="cron"><a href="#cron" class="headerlink" title="cron"></a>cron</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * BASH_ENV=/etc/profile bash -c <span class="string">&quot;printenv &gt; /tmp/print_envs_result&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="my-desktop"><a href="#my-desktop" class="headerlink" title="my desktop"></a>my desktop</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uptime</span></span><br><span class="line"> 14:48:57 up 55 days, 21:24,  1 user,  load average: 1.10, 0.93, 0.84</span><br><span class="line"></span><br><span class="line">      .:++++ooooosssoo:.       ----------------- </span><br><span class="line">    .+o++::.      `.:oos+.     OS: LMDE 5 (elsie) x86_64 </span><br><span class="line">   :oo:.`             -+oo:    Host: XPS 13 7390 </span><br><span class="line"> `+o/`    .::::::-.    .++-`   Kernel: 5.10.0-21-amd64 </span><br><span class="line">`/s/    .yyyyyyyyyyo:   +o-`   Uptime: 55 days, 21 hours, 26 mins </span><br><span class="line">`so     .ss       ohyo` :s-:   Packages: 2630 (dpkg), 7 (snap) </span><br><span class="line">`s/     .ss  h  m  myy/ /s``   Shell: bash 5.1.4 </span><br><span class="line">`s:     `oo  s  m  Myy+-o:`    Resolution: 1920x1080 </span><br><span class="line">`oo      :+sdoohyoydyso/.      DE: Cinnamon 5.6.8 </span><br><span class="line"> :o.      .:////////++:        WM: Mutter (Muffin) </span><br><span class="line"> `/++        -:::::-           WM Theme: Mint-Y-Dark-Aqua (Mint-Y) </span><br><span class="line">  `++-                         Theme: Mint-Y-Aqua [GTK2/3] </span><br><span class="line">   `/+-                        Icons: Mint-Y-Aqua [GTK2/3] </span><br><span class="line">     .+/.                      Terminal: gnome-terminal </span><br><span class="line">       .:+-.                   CPU: Intel i7-10510U (6) @ 4.900GHz </span><br><span class="line">          `--.``               GPU: Intel CometLake-U GT2 [UHD Graphics] </span><br><span class="line">                               Memory: 5166MiB / 7774MiB </span><br></pre></td></tr></table></figure>

<h3 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h3><ul>
<li>How to Digitally Sign a Google Doc<ul>
<li>Insert -&gt; Drawing -&gt; +New</li>
<li>Click the arrow next to the Line icon</li>
<li>Select Scribble</li>
<li>Draw your signature</li>
<li>Adjust as you see fit</li>
<li>Click Save and Close</li>
<li>Move your signature to where it needs to be</li>
</ul>
</li>
</ul>
<h3 id="ping-PING"><a href="#ping-PING" class="headerlink" title="ping PING"></a>ping PING</h3><p><a target="_blank" rel="noopener" href="https://colobu.com/2023/05/07/ping-and-record-route/">返回的包中显示缓存的路由。注意IPV4的头部只能最多存9个这样的路由地址。很多节点会忽略或者丢弃这个选项。</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-R Record route. Includes the RECORD_ROUTE option <span class="keyword">in</span> the ECHO_REQUEST packet and displays the route buffer on returned packets. Note that the IP header is only large enough <span class="keyword">for</span> nine such routes. Many hosts ignore or discard this option.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ifconfig eth0 </span><br><span class="line">inet 192.168.0.71</span><br><span class="line"></span><br><span class="line">$ ping -R -c 1 -W 1 192.168.1.1</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) 56(124) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=493 ms</span><br><span class="line">RR: 	192.168.0.71</span><br><span class="line">	192.168.1.254</span><br><span class="line">	192.168.1.1</span><br><span class="line">	192.168.1.1</span><br><span class="line">	192.168.0.254</span><br><span class="line">	192.168.0.71</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--- 192.168.1.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 492.898/492.898/492.898/0.000 ms</span><br></pre></td></tr></table></figure>

<h3 id="LVM"><a href="#LVM" class="headerlink" title="LVM"></a>LVM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#lvm test demo, LVM</span></span><br><span class="line">$ pvcreate /dev/sdb1 /dev/sdc1</span><br><span class="line">$ pvs</span><br><span class="line">$ pvdisplay</span><br><span class="line">$ vgcreate vg1 /dev/sdb1 /dev/sdc1</span><br><span class="line">$ vgcreate vg1 /dev/sdb1 /dev/sdc1</span><br><span class="line">$ lvcreate -l 100%FREE -n test_vol vg1</span><br><span class="line"></span><br><span class="line"><span class="comment">#disable alloc PE</span></span><br><span class="line">$ pvchange -x n /dev/sdc1</span><br><span class="line"></span><br><span class="line"><span class="comment">#del pv</span></span><br><span class="line">$ vgreduce vg1 /dev/sdc</span><br><span class="line">$ pvremove /dev/sdc</span><br><span class="line"></span><br><span class="line"><span class="comment">## extend</span></span><br><span class="line">$ vgextend vg1 /dev/sdd1</span><br><span class="line">$ vgs</span><br><span class="line">$ lvextend -L +2GB /dev/vg1/test_vol</span><br><span class="line">or use 100% free</span><br><span class="line">$ lvextend -l +100%FREE /dev/vg1/test_vol</span><br><span class="line">$ lvs</span><br><span class="line">$ lvdisplay</span><br><span class="line">$ xfs_grow /</span><br><span class="line"></span><br><span class="line"><span class="comment"># others</span></span><br><span class="line">$ vgcfgbackup</span><br><span class="line">$ vgcfgrestore</span><br><span class="line">$ lvm dumpconfig</span><br><span class="line">$ lvm devtypes</span><br><span class="line">$ lvm formats</span><br><span class="line">$ lvm segtypes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#create a mirror</span></span><br><span class="line">$ lvcreate -l +100%FREE -m 1 -n test_vol vg1</span><br><span class="line">$ lvcreate --<span class="built_in">type</span> mirror -m 1 -l +100%FREE -R 2 -n test_vol vg1</span><br><span class="line"></span><br><span class="line"><span class="comment">#convert -m1 = mirror, -m0=default</span></span><br><span class="line">$ lvconvert -m1 /dev/vg1/test_vol</span><br><span class="line">$ lvconvert -m0 /dev/vg1/test_vol</span><br><span class="line"></span><br><span class="line"><span class="comment">#replace</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/class/block/sdb/device/delete</span><br><span class="line">$ pvs</span><br><span class="line">  PV         VG        Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda   vg-mirror lvm2 a--  &lt;52.00g    0 </span><br><span class="line">  /dev/vda2  almalinux lvm2 a--  &lt;51.00g    0 </span><br><span class="line">  [unknown]  vg-mirror lvm2 a-m  &lt;52.00g    0 </span><br><span class="line"></span><br><span class="line">$ lvs</span><br><span class="line">  WARNING: Couldn<span class="string">&#x27;t find device with uuid OfnxCm-nOvt-PQzS-1czN-tLHi-ND1O-CP391k.</span></span><br><span class="line"><span class="string">  WARNING: VG vg-mirror is missing PV OfnxCm-nOvt-PQzS-1czN-tLHi-ND1O-CP391k (last written to /dev/sdb).</span></span><br><span class="line"><span class="string">  LV             VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span></span><br><span class="line"><span class="string">  root           almalinux -wi-ao---- &lt;47.04g                                                    </span></span><br><span class="line"><span class="string">  swap           almalinux -wi-ao----  &lt;3.96g                                                    </span></span><br><span class="line"><span class="string">  test_mirror_lv vg-mirror rwi-aor-p-  51.99g                                    100.00          </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ vgreduce --removemissing --mirrorsonly --force vg1</span></span><br><span class="line"><span class="string">#after replace</span></span><br><span class="line"><span class="string">$ vgextend vg1 /dev/sdc1</span></span><br><span class="line"><span class="string">$ lvconvert --repair /dev/vg1/test_vol</span></span><br><span class="line"><span class="string">$ lvconvert -m1 /dev/vg1/test_vol /dev/sdc1 /dev/sde1 /dev/sdf1</span></span><br><span class="line"><span class="string">#not suggest in the enterprise, just avoid mdadm raid 1 resync</span></span><br></pre></td></tr></table></figure>
<h4 id="lvm-metadata-full"><a href="#lvm-metadata-full" class="headerlink" title="lvm metadata full"></a><a target="_blank" rel="noopener" href="https://ibug.io/blog/2022/06/lvm-metadata-full/">lvm metadata full</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lvcreate -L 4M -n test-1721 test</span></span><br><span class="line">  VG <span class="built_in">test</span> 1723 metadata on /dev/sdc1 (521759 bytes) exceeds maximum metadata size (521472 bytes)</span><br><span class="line">  Failed to write VG <span class="built_in">test</span>.</span><br><span class="line"></span><br><span class="line">root@iBug-Server:~<span class="comment"># pvdisplay -C -o name,mda_size,mda_free</span></span><br><span class="line">  PV         PMdaSize  PMdaFree</span><br><span class="line">  /dev/sdc1   1020.00k        0</span><br><span class="line">root@iBug-Server:~<span class="comment"># vgdisplay -C -o name,mda_size,mda_free</span></span><br><span class="line">  VG   VMdaSize  VMdaFree</span><br><span class="line">  <span class="built_in">test</span>  1020.00k        0</span><br><span class="line"></span><br><span class="line"><span class="comment">#created a new LUN </span></span><br><span class="line">$ iscsiadm -m session --rescan</span><br><span class="line"><span class="comment"># I turn the new block device into a PV and add it to the problematic VG</span></span><br><span class="line">$ pvcreate --metadatasize 64m /dev/sdd</span><br><span class="line">$ vgextend <span class="built_in">test</span> /dev/sdd</span><br><span class="line"></span><br><span class="line">VG <span class="built_in">test</span> 1723 metadata on /dev/sdc1 (521615 bytes) exceeds maximum metadata size (521472 bytes)</span><br><span class="line">WARNING: Failed to write an MDA of VG <span class="built_in">test</span>.</span><br><span class="line">Volume group <span class="string">&quot;test&quot;</span> successfully extended</span><br><span class="line"></span><br><span class="line"><span class="comment">#Next I exclude the original PV from storing metadata</span></span><br><span class="line">$ pvchange --metadataignore y /dev/sdc1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Now I can add another LV inside this VG without error:</span></span><br><span class="line">root@iBug-Server:~<span class="comment"># lvcreate -L 1M -n test-1721 test</span></span><br><span class="line">  Rounding up size to full physical extent 4.00 MiB</span><br><span class="line">  Logical volume <span class="string">&quot;test-1721&quot;</span> created.</span><br><span class="line"></span><br><span class="line">root@iBug-Server:~<span class="comment"># pvs -o name,mda_size,mda_free</span></span><br><span class="line">  PV         PMdaSize  PMdaFree</span><br><span class="line">  /dev/sdc1   1020.00k        0</span><br><span class="line">  /dev/sdd     &lt;65.00m   &lt;32.00m</span><br></pre></td></tr></table></figure>

<h3 id="wipefs"><a href="#wipefs" class="headerlink" title="wipefs"></a>wipefs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wipefs --all --backup /dev/vdh</span><br><span class="line">$ wipefs --all --force /dev/vdb</span><br><span class="line">$ wipefs --all --force --backup /dev/vdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#after backup, restore</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=~/wipefs-sda-0x000001fe.bak of=/dev/sda1 bs=1 seek=$((<span class="number">0</span>x000001fe)) conv=notrunc</span><br></pre></td></tr></table></figure>

<h3 id="apache-httpda-list-dir-and-link"><a href="#apache-httpda-list-dir-and-link" class="headerlink" title="apache httpda list dir and link"></a>apache httpda list dir and link</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory  <span class="string">&quot;/var/www/html&quot;</span>&gt;</span><br><span class="line">Options +Indexes  +FollowSymLinks</span><br><span class="line">AllowOverride  None</span><br><span class="line">Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<h3 id="centos-6-upgrade-to-almalinux-8"><a href="#centos-6-upgrade-to-almalinux-8" class="headerlink" title="centos 6 upgrade to almalinux 8"></a>centos 6 upgrade to almalinux 8</h3><ul>
<li>centos 6.9<ul>
<li>centos 7.0<ul>
<li>centos 7.9<ul>
<li>alamlinux 8.8</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="upgrade-el6-to-el7"><a href="#upgrade-el6-to-el7" class="headerlink" title="upgrade el6 to el7"></a>upgrade el6 to el7</h4><p>after upgrade</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ln</span> -s /lib64/libpcre.so.1 /lib64/libpcre.so.0</span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/lib64/libsasl2.so.3.0.0 /usr/lib64/libsasl2.so.2</span><br></pre></td></tr></table></figure>
<ul>
<li>remove many packages for the deps issues</li>
<li>upgrade grub1 to grub2, after the upgrade, the centos 7 boot under the grub1, upgrade to grub2 for el8</li>
<li>upgrade to network config to the NetworkManager</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://vivithemage.com/2020/03/31/upgrading-centos-6-to-centos-7/">el6 upgrade to el7</a><br><a target="_blank" rel="noopener" href="https://www.owned-networks.net/client_area/knowledgebase/41/How-to-upgrade-CentOS-6-to-CentOS-7.html">el6 upgrade to el7</a><br><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2643721">upgrade grub1 to grub2</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ yum install grub2 grub2-tools grubby</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/default/grub &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">GRUB_TIMEOUT=5</span></span><br><span class="line"><span class="string">GRUB_DISTRIBUTOR=&quot;\$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)&quot;</span></span><br><span class="line"><span class="string">GRUB_DEFAULT=saved</span></span><br><span class="line"><span class="string">GRUB_DISABLE_SUBMENU=true</span></span><br><span class="line"><span class="string">GRUB_TERMINAL_OUTPUT=&quot;console&quot;</span></span><br><span class="line"><span class="string">GRUB_CMDLINE_LINUX=&quot;$(grep &#x27;^\s*kernel /vmlinuz-3&#x27; /boot/grub/grub.conf | head -1 | sed -r -e &#x27;s,^\s*kernel /vmlinuz\S+ ,,&#x27; -e &#x27;s,\&lt;root=\S+ ,,&#x27; -e &#x27;s,\&lt;ro ,,&#x27;)&quot;</span></span><br><span class="line"><span class="string">GRUB_DISABLE_RECOVERY=&quot;true&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">$ grub2-install /dev/InsertDeviceHere</span><br><span class="line"></span><br><span class="line">$ grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line">$ <span class="built_in">mv</span> /boot/grub /boot/grub_bak</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6989732">Upgrade requires links in root directory to be relative</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -l / | grep ^l</span><br><span class="line">lrwxrwxrwx.   1 root root    5 Dec  8 13:08 softlink</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">unlink</span> /softlink</span><br><span class="line">$ <span class="built_in">ln</span> -s data /softlink</span><br><span class="line">$ ll / | grep ^l</span><br><span class="line">lrwxrwxrwx.   1 root root    4 Dec  8 13:10 softlink -&gt; data &lt;----remove the <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">Leapp does not allow upgrades to <span class="built_in">continue</span> <span class="keyword">if</span> a softlink <span class="keyword">in</span> / is pointing to a full path target since leapp operates from outside of a <span class="built_in">chroot</span> environment, the softlink would have an incorrect target unless it is relative.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://linuxiac.com/centos-7-to-almalinux-8-migration-guide/">el7-to-el8</a><br><a target="_blank" rel="noopener" href="https://leapp.readthedocs.io/en/latest/el7toel8/envars.html">set proxy for LEAPP and dnf</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LEAPP_PROXY_HOST=http://&lt;ADDRESS&gt;:&lt;PORT&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/leapp/files/leapp_upgrade_repositories.repo</span><br><span class="line">[almalinux9-baseos]</span><br><span class="line">name=AlmaLinux 9 - BaseOS</span><br><span class="line">mirrorlist=https://mirrors.almalinux.org/mirrorlist/9/baseos</span><br><span class="line"><span class="comment"># baseurl=https://repo.almalinux.org/almalinux/9/BaseOS/$basearch/os/</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux</span><br><span class="line">proxy=http://<span class="variable">$your_proxy</span>:1080</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/discussions/6955010">Failed to create directory &#x2F;var&#x2F;lib&#x2F;leapp&#x2F;el8userspace&#x2F;&#x2F;sys&#x2F;fs&#x2F;selinux: Read-only file system</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to create directory /var/lib/leapp/el8userspace//sys/fs/selinux: Read-only file system</span><br><span class="line">I resolved it by setting the following environment variable:</span><br><span class="line"><span class="built_in">export</span> LEAPP_OVL_SIZE=3000</span><br></pre></td></tr></table></figure>

<h4 id="upgrade-to-el8"><a href="#upgrade-to-el8" class="headerlink" title="upgrade to el8"></a>upgrade to el8</h4><p><a target="_blank" rel="noopener" href="https://www.frangarcia.me/posts/upgrading-satellite-611-from-rhel7-to-rhel8/">upgrade el6 to el7</a><br><a target="_blank" rel="noopener" href="https://bugzilla.redhat.com/show_bug.cgi?id=1943678">Bug 1943678</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">It seems that the original <span class="built_in">command</span>: leapp answer --section remove_pam_pkcs11_module_check.confirm=True  was not modifying /var/log/leapp/answerfile as it was empty (it becomes populated after you run the `leapp preupgrade` or `leap upgrade` commands).</span><br><span class="line"></span><br><span class="line">The fix is to add the `--add` option when running the `leapp answer` <span class="built_in">command</span> as follows: `leapp answer --add --section  remove_pam_pkcs11_module_check.confirm=True`</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/5697541">el8 not support the mbr(el6) partition, boot failed</a><br><a target="_blank" rel="noopener" href="https://forums.fedoraforum.org/showthread.php?274701-GRUB2-core-img-not-fitting-between-MBR-and-sector-63">GRUB2 core.img not fitting between MBR and sector 63</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">link</span> to this item - Bugzilla: <span class="comment">#737508</span></span><br><span class="line"></span><br><span class="line">Versions of Fedora prior to Fedora 16, and many other operating systems, will by default use the MS-DOS disk label format, and create the first partition on a hard disk at sector 63. This leaves a gap of 32KiB between the MBR and the first partition. This is the space into <span class="built_in">which</span> the core of the system bootloader must be installed on an MS-DOS labelled disk.</span><br><span class="line"></span><br><span class="line">The core part of Fedora 16<span class="string">&#x27;s bootloader, grub2, may not fit into this 32KiB space, if the required configuration to boot the system is complex. One known problematic case comes when the /boot partition is on a software or firmware (not hardware) RAID-1 device. In this case, the core grub2 image must include RAID support, and the inclusion of this makes the core image larger than 32KiB in size.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In more &#x27;</span>straightforward<span class="string">&#x27; cases, grub2&#x27;</span>s core image is smaller than 32KiB <span class="keyword">in</span> size, so this bug will often not be encountered. Also, <span class="keyword">if</span> you install Fedora 16 <span class="keyword">in</span> such a way that the target drive is re-formatted, Fedora will use a GPT disk label and create a 1MiB <span class="string">&#x27;BIOS Boot&#x27;</span> partition. With the GPT disk label format, the bootloader core must reside on such a <span class="string">&#x27;BIOS Boot&#x27;</span> partition, and the 1MB size provides comfortably enough room <span class="keyword">for</span> any necessary grub2 core image. The bug only occurs when installing Fedora 16 to an existing partition layout (and hence also when upgrading an existing configuration) <span class="built_in">which</span> requires a complex grub2 core image.</span><br><span class="line"></span><br><span class="line">When you encounter the bug, Fedora<span class="string">&#x27;s installer may warn you that bootloader installation failed, but the installation will complete. However, the installed system will fail to boot. If you examine the installer logs you may find the message grub2-setup: warn: your core.img is unusually large, it won&#x27;</span>t fit <span class="keyword">in</span> the embedding area.</span><br><span class="line"></span><br><span class="line">The safest workaround <span class="keyword">for</span> the issue is to resize the first disk on the partition so that there is more empty space <span class="keyword">in</span> front of it. A very small change will be sufficient - just having the partition start at 1MiB rather than 32KiB should suffice. Some partition types can be non-destructively resized from the beginning <span class="keyword">in</span> this way, but <span class="keyword">in</span> some cases it may be necessary to archive all the data on the partition, delete it, re-create it with a slightly later starting sector, and <span class="keyword">then</span> restore the data. If you have to <span class="keyword">do</span> this, you will likely wish to note the partition<span class="string">&#x27;s UUID and partition label before destroying the partition, and ensure that they match when re-creating it. There are parameters you can pass to the various mkfs commands to force the UUID of the created partition: for instance, the parameter is -U for the mke2fs command.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">An alternative workaround may be to manually install grub-legacy (rather than grub2) as the bootloader. However, the use of grub-legacy on Fedora 16 is not officially supported, and grub-legacy may well be removed entirely from future Fedora releases, so this is likely to be feasible only in the short term.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You may also compare Arch Linux&#x27;</span>s note on the same issue.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux rescue mode</span></span><br><span class="line">$ grub2-install /dev/vda</span><br><span class="line">Installing <span class="keyword">for</span> i386-pc platform.</span><br><span class="line">grub2-install: warning: your embedding area is unusually small.  core.img won<span class="string">&#x27;t fit in it..</span></span><br><span class="line"><span class="string">grub2-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..</span></span><br><span class="line"><span class="string">grub2-install: error: will not proceed with blocklists.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ tar cf /root/boot.tar -C /boot .</span></span><br><span class="line"><span class="string">$ findmnt -o UUID,FSTYPE /boot</span></span><br><span class="line"><span class="string">UUID                                 FSTYPE</span></span><br><span class="line"><span class="string">cefc0a57-da4c-4b54-93b5-05815e7ebb0a ext4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ umount /boot</span></span><br><span class="line"><span class="string">$ parted /dev/vda rm 1 #vda1 is the /boot</span></span><br><span class="line"><span class="string">$ parted /dev/vda mkpart p1 ext4 2048s $your_size</span></span><br><span class="line"><span class="string">$ mkfs.ext4 -U cefc0a57-da4c-4b54-93b5-05815e7ebb0a /dev/vda1</span></span><br><span class="line"><span class="string">$ mount /boot</span></span><br><span class="line"><span class="string">$ tar xf /root/boot.tar -C /boot</span></span><br><span class="line"><span class="string">$ grub2-install /dev/vda</span></span><br><span class="line"><span class="string">Installing for i386-pc platform.</span></span><br><span class="line"><span class="string">Installation finished. No error reported.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure>

<h3 id="Centos-7-upgrade-glibc-2-31-and-install-lustre-2-15-4-client"><a href="#Centos-7-upgrade-glibc-2-31-and-install-lustre-2-15-4-client" class="headerlink" title="Centos 7 upgrade glibc 2.31 and install lustre 2.15.4 client"></a><a target="_blank" rel="noopener" href="https://roy.wang/centos7-upgrade-glibc/">Centos 7 upgrade glibc 2.31 and install lustre 2.15.4 client</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">$ yum install centos-release-scl -y</span><br><span class="line"></span><br><span class="line">$ yum install -y bridge-utils iputils nfs-utils pciutils e2fsprogs net-tools rpm-build vim nfs-utils screen sysstat lsof wget rsync openssh-clients libselinux-python crontabs rsync strace autofs perf parted bind-utils sg3_utils procps-ng smp_utils-devel iperf3 lsscsi smartmontools expect resource-agents ksh net-snmp net-snmp-devel gcc net-snmp-utils net-snmp-agent-libs ntpdate kernel-devel kernel-abi-whitelists kernel-headers linux-firmware mysql libyaml-devel libss-devel libcom_err-devel dracut dracut-kernel OpenIPMI ipmitool xz-devel xz-libs rpm-build zlib-devel libuuid-devel libattr-devel openmpi-devel attr yum-utils systemd-devel libpmemblk-devel kexec-tools crash texinfo nrpe numactl pbzip2 nvme-cli lshw libaio-devel sdparm qperf fio grub2-efi-modules kabi-dw kabi-yum-plugins java libyaml-devel yum-utils libtool axel hping3 gmp-devel mpfr-devel libmpc-devel ncurses-devel libpmemblk prename bc daxctl-libs libgfortran5 mdadm ndctl-libs rng-tools libpmem libpmemblk libreport-filesystem libblkid-devel chrony sos environment-modules hwloc-libs libtool-ltdl mpich iftop iotop bcc-tools nmap elfutils-libelf-devel libunwind-devel audit-libs-devel slang-devel python2-devel python-setuptools python-cffi libffi-devel devtoolset-9-toolchain ncurses ncurses-devel bpftool wget bzip2 gcc gcc-c++ glibc-headers bison devtoolset-8-* devtoolset-9-* python3 python3-devel pciutils-develperl numactl-devel libcap-devel java-1.8.0-openjdk-devel git binutils-devel xmlto newt-devel asciidoc perl-ExtUtils-Embed libnl3-devel libmount-devel</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;source /opt/rh/devtoolset-8/enable&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line">$ . ~/.bashrc</span><br><span class="line"></span><br><span class="line">$ tar xzvf make-4.3.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> make-4.3</span><br><span class="line">$ <span class="built_in">mkdir</span> build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ ../configure --prefix=/usr/local/make &amp;&amp; make &amp;&amp; make install</span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/local/make4.3/bin/make /usr/local/make4.3/bin/gmake</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;export PATH=/usr/local/make4.3/bin:<span class="variable">$PATH</span>&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line">$ . ~/.bashrc</span><br><span class="line"></span><br><span class="line">$ tar xzvf openssl-1.1.1w.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> openssl-1.1.1w</span><br><span class="line">$ install_dir=/usr/local/openssl-1.1.1w; ./config --prefix=<span class="variable">$install_dir</span> --openssldir=<span class="variable">$install_dir</span></span><br><span class="line">$ make -j 16</span><br><span class="line">$ make install</span><br><span class="line">$ <span class="built_in">cp</span> ./demos/cms/cacert.pem /usr/local/openssl-1.1.1w/cert.pem</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;/usr/local/openssl-1.1.1w/lib&quot;</span> &gt; /etc/ld.so.conf.d/openssl-1.1.1w-x86_64.conf</span><br><span class="line">$ ldconfig</span><br><span class="line"></span><br><span class="line">$ tar xJvf Python-3.11.8.tar.xz</span><br><span class="line">$ <span class="built_in">cd</span> Python-3.11.8</span><br><span class="line">$ ./configure --prefix=/usr/local/python-3.11.8 --enable-optimizations --with-openssl=/usr/local/openssl-1.1.1w/</span><br><span class="line">$ make -j 16</span><br><span class="line">$ make install </span><br><span class="line">......</span><br><span class="line">Successfully installed pip-24.0 setuptools-65.5.0</span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/local/python-3.11.8 /usr/local/python3</span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/local/python-3.11.8/bin/python3.11 /usr/bin/python3</span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/local/python-3.11.8/bin/pip3.11 /usr/bin/pip3</span><br><span class="line"></span><br><span class="line">$ tar xJvf glibc-2.31.tar</span><br><span class="line">$ <span class="built_in">cd</span> glibc-2.31</span><br><span class="line"></span><br><span class="line"><span class="comment">#for &quot;cannot find -lnss_test2&quot; error</span></span><br><span class="line"><span class="comment">#https://nestealin.com/28244582/</span></span><br><span class="line">$ sed -i <span class="string">&#x27;128s/.*/         \&amp;\&amp; \$name ne &quot;nss_test1&quot; \&amp;\&amp; \$name ne &quot;nss_test2&quot; \&amp;\&amp; \$name ne &quot;libgcc_s&quot;) &#123;/&#x27;</span> scripts/test-installation.pl</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ ../configure --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin --enable-obsolete-nsl</span><br><span class="line">$ make -j 16</span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#for &quot;cannot change locale&quot; error</span></span><br><span class="line">$ make localedata/install-locales -j 16</span><br><span class="line">$ strings /lib64/libc.so.6 | grep GLIBC</span><br><span class="line"></span><br><span class="line">$ ldd --version</span><br><span class="line">ldd (GNU libc) 2.31</span><br><span class="line"></span><br><span class="line">$ reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">#find the default rpm macros variable</span></span><br><span class="line">$ vi /usr/lib/rpm/macros</span><br><span class="line">$ rpm --showrc | grep <span class="string">&#x27;XXX&#x27;</span></span><br><span class="line"></span><br><span class="line">$ wget  https://elrepo.org/linux/kernel/el7/SRPMS/kernel-lt-5.4.271-1.el7.elrepo.nosrc.rpm</span><br><span class="line">$ wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.4.271.tar.xz</span><br><span class="line">$ rpm -ivh kernel-lt-5.4.271-1.el7.elrepo.nosrc.rpm</span><br><span class="line">$ <span class="built_in">mv</span> linux-5.4.271.tar.xz ~/rpmbuild/SOURCES</span><br><span class="line"></span><br><span class="line">$ vi kernel-lt-5.4.spec</span><br><span class="line"><span class="comment">#custom modify optflags from spec file</span></span><br><span class="line">%global optflags %&#123;optflags&#125; -g</span><br><span class="line"></span><br><span class="line"><span class="comment">#show the variable or you could write to ~/.rpmrc #not test</span></span><br><span class="line">$ rpm --<span class="built_in">eval</span> %&#123;optflags&#125;</span><br><span class="line">-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic</span><br><span class="line"></span><br><span class="line">$ rpmbuild -bb -v kernel-lt-5.4.spec</span><br><span class="line">$ <span class="built_in">ls</span> -l RPMS/x86_64/</span><br><span class="line">total 69468</span><br><span class="line">-rw-r--r--. 1 root root 52931572 Mar 11 03:01 kernel-lt-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 13505932 Mar 11 03:01 kernel-lt-devel-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  1401960 Mar 11 03:01 kernel-lt-headers-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   234240 Mar 11 03:01 kernel-lt-tools-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   121048 Mar 11 03:01 kernel-lt-tools-libs-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root    98352 Mar 11 03:01 kernel-lt-tools-libs-devel-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  2206052 Mar 11 03:01 perf-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   614476 Mar 11 03:01 python-perf-5.4.271-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#here is the problem, there is no debuginfo</span></span><br><span class="line">$ reboot</span><br><span class="line"></span><br><span class="line">$ rpmbuild --rebuild --without servers lustre-2.15.4-1.src.rpm</span><br><span class="line">$ <span class="built_in">ls</span> -l /root/rpmbuild/RPMS/x86_64/</span><br><span class="line">total 114884</span><br><span class="line">-rw-r--r--. 1 root root 52931788 Mar 11 00:55 kernel-lt-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 13505980 Mar 11 00:55 kernel-lt-devel-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  1401944 Mar 11 00:55 kernel-lt-headers-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   234240 Mar 11 00:55 kernel-lt-tools-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   121040 Mar 11 00:55 kernel-lt-tools-libs-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root    98348 Mar 11 00:55 kernel-lt-tools-libs-devel-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  2341324 Mar 11 01:17 kmod-lustre-client-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root    45180 Mar 11 01:17 kmod-lustre-client-tests-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   587220 Mar 11 01:17 lustre-client-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 26935988 Mar 11 01:17 lustre-client-debuginfo-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   193512 Mar 11 01:17 lustre-client-devel-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 16341732 Mar 11 01:17 lustre-client-tests-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root    41708 Mar 11 01:17 lustre-iokit-2.15.4-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  2206008 Mar 11 00:55 perf-5.4.271-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   614628 Mar 11 00:55 python-perf-5.4.271-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">https://unix.stackexchange.com/questions/717223/how-to-compile-linux-kernel-5-19-8-with-symbols-and-debugging-enabled</span><br><span class="line">make menuconfig --&gt; DEBUG_KERNEL --&gt; Debug information --&gt; choose the <span class="string">&quot;Rely on the toolchain&#x27;s implicit default DWARF version (DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT)&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="disable-acpi-power-meter"><a href="#disable-acpi-power-meter" class="headerlink" title="disable acpi_power_meter"></a><a target="_blank" rel="noopener" href="https://cloudlinux.zendesk.com/hc/en-us/articles/4410078369170-ACPI-Error-No-handler-for-Region-">disable acpi_power_meter</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Tue Sep  5 02:04:32 2023] power_meter ACPI000D:00: Found ACPI power meter.</span><br><span class="line">[Tue Sep  5 02:04:33 2023] power_meter ACPI000D:00: Found ACPI power meter.</span><br><span class="line">[Tue Sep  5 02:04:34 2023] power_meter ACPI000D:00: Found ACPI power meter.</span><br><span class="line">[Tue Sep  5 02:04:35 2023] power_meter ACPI000D:00: Found ACPI power meter.</span><br><span class="line">[Tue Sep  5 02:04:36 2023] power_meter ACPI000D:00: Found ACPI power meter.</span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line">ACPI Error: No handler <span class="keyword">for</span> Region [SYSI]</span><br><span class="line">ACPI Error: Region IPMI (ID=7) has no handler</span><br></pre></td></tr></table></figure>

<ul>
<li>Disable the “acpi_power_meter” kernel module by running the following command<ul>
<li>modprobe -r acpi_power_meter</li>
</ul>
</li>
<li>Add the following line to the &#x2F;etc&#x2F;modprobe.d&#x2F;acpi.conf to blacklist it<ul>
<li>blacklist acpi_power_meter</li>
</ul>
</li>
</ul>
<h3 id="Logs-flooded-with-systemd-messages-Created-slice-Starting-Session"><a href="#Logs-flooded-with-systemd-messages-Created-slice-Starting-Session" class="headerlink" title="Logs flooded with systemd messages: Created slice, Starting Session"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1564823">Logs flooded with systemd messages: Created slice, Starting Session</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Jul 24 08:50:01 example.com systemd: Created slice user-0.slice.</span><br><span class="line">Jul 24 08:50:01 example.com systemd: Starting Session 150 of user root.</span><br><span class="line">Jul 24 08:50:01 example.com systemd: Started Session 150 of user root.</span><br><span class="line">Jul 24 09:00:01 example.com systemd: Created slice user-0.slice.</span><br><span class="line">Jul 24 09:00:02 example.com systemd: Starting Session 151 of user root.</span><br><span class="line">Jul 24 09:00:02 example.com systemd: Started Session 151 of user root.</span><br><span class="line"></span><br><span class="line"><span class="comment"># mkdir /etc/systemd/system/user@1000.service.d</span></span><br><span class="line"><span class="comment"># cat &gt; /etc/systemd/system/user@1000.service.d/logging.conf &lt;&lt;EOF</span></span><br><span class="line">[Service]</span><br><span class="line">LogLevelMax=notice</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># sed -i -e &#x27;s/#LogLevel=info/LogLevel=notice/&#x27; /etc/systemd/user.conf</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;systemd&quot; and ($msg contains &quot;Starting Session&quot; or $msg contains &quot;Started Session&quot; or $msg contains &quot;Created slice&quot; or $msg contains &quot;Starting user-&quot; or $msg contains &quot;Starting User Slice of&quot; or $msg contains &quot;Removed session&quot; or $msg contains &quot;Removed slice User Slice of&quot; or $msg contains &quot;Stopping User Slice of&quot;) then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-systemd-session-slice.conf</span><br><span class="line"><span class="comment"># systemctl restart rsyslog</span></span><br></pre></td></tr></table></figure>

<h3 id="crypt-the-file"><a href="#crypt-the-file" class="headerlink" title="crypt the file"></a><a target="_blank" rel="noopener" href="https://www.baeldung.com/linux/password-protect-tar-file">crypt the file</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ccrypt tar_file.tar</span><br><span class="line">Enter encryption key: </span><br><span class="line">Enter encryption key: (repeat) </span><br><span class="line"></span><br><span class="line">$ ccrypt --decrypt tar_file.tar.cpt</span><br><span class="line">Enter decryption key: </span><br><span class="line"></span><br><span class="line">$ gpg --symmetric --cipher-algo aes256 archive_file.tar</span><br><span class="line">$ gpg --output archive_file.tar --decrypt archive_file.tar.gpg </span><br></pre></td></tr></table></figure>

<h3 id="jq-JQ"><a href="#jq-JQ" class="headerlink" title="jq JQ"></a><a target="_blank" rel="noopener" href="https://www.baeldung.com/linux/jq-command-json">jq</a> JQ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;fruit&quot;:&#123;&quot;name&quot;:&quot;apple&quot;,&quot;color&quot;:&quot;green&quot;,&quot;price&quot;:1.20&#125;&#125;&#x27;</span> | jq <span class="string">&#x27;.&#x27;</span></span><br><span class="line"></span><br><span class="line">$ jq <span class="string">&#x27;.[] | .name&#x27;</span> fruits.json</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;[1,2,3,4,5,6,7,8,9,10]&#x27;</span> | jq <span class="string">&#x27;.[6:9]&#x27;</span></span><br><span class="line"></span><br><span class="line">$ jq <span class="string">&#x27;map(has(&quot;name&quot;))&#x27;</span> fruits.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> test.js</span><br><span class="line">[</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhangSan&quot;</span>, <span class="string">&quot;age&quot;</span>: 25, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Beijing&quot;</span>, <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Technology&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;LiSi&quot;</span>, <span class="string">&quot;age&quot;</span>: 30, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>, <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Sports&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;WangWu&quot;</span>, <span class="string">&quot;age&quot;</span>: 35, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Guangzhou&quot;</span>, <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Travel&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhaoLiu&quot;</span>, <span class="string">&quot;age&quot;</span>: 40, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shenzhen&quot;</span>, <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Reading&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ jq -r <span class="string">&#x27;.[] | [.name, .age] | @csv&#x27;</span> test.js</span><br><span class="line"><span class="string">&quot;ZhangSan&quot;</span>,25</span><br><span class="line"><span class="string">&quot;LiSi&quot;</span>,</span><br><span class="line"><span class="string">&quot;WangWu&quot;</span>,35</span><br><span class="line"><span class="string">&quot;ZhaoLiu&quot;</span>,40</span><br><span class="line"></span><br><span class="line">$ jq -r <span class="string">&#x27;[&quot;name&quot;, &quot;age&quot;], (.[] | [.name, .age]) | @csv&#x27;</span> test.js</span><br><span class="line">or</span><br><span class="line">$ jq -r <span class="string">&#x27;[&quot;name&quot;, &quot;age&quot;], (.[] | [.[&quot;name&quot;, &quot;age&quot;]]) | @csv&#x27;</span> test.js</span><br><span class="line"><span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="string">&quot;ZhangSan&quot;</span>,25</span><br><span class="line"><span class="string">&quot;LiSi&quot;</span>,</span><br><span class="line"><span class="string">&quot;WangWu&quot;</span>,35</span><br><span class="line"><span class="string">&quot;ZhaoLiu&quot;</span>,40</span><br><span class="line"></span><br><span class="line">$ jq -r <span class="string">&#x27;.[] | [.name, .age]&#x27;</span> test.js | jq -c <span class="string">&#x27;.&#x27;</span></span><br><span class="line">[<span class="string">&quot;ZhangSan&quot;</span>,25]</span><br><span class="line">[<span class="string">&quot;LiSi&quot;</span>,null]</span><br><span class="line">[<span class="string">&quot;WangWu&quot;</span>,35]</span><br><span class="line">[<span class="string">&quot;ZhaoLiu&quot;</span>,40]</span><br><span class="line"></span><br><span class="line">$ jq -r <span class="string">&#x27;((first | keys_unsorted), .[] | map(.)) | @csv&#x27;</span> test.js</span><br><span class="line"><span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;city&quot;</span>,<span class="string">&quot;preference&quot;</span></span><br><span class="line"><span class="string">&quot;ZhangSan&quot;</span>,25,<span class="string">&quot;Beijing&quot;</span>,<span class="string">&quot;Technology&quot;</span></span><br><span class="line"><span class="string">&quot;LiSi&quot;</span>,<span class="string">&quot;Shanghai&quot;</span>,<span class="string">&quot;Sports&quot;</span></span><br><span class="line"><span class="string">&quot;Guangzhou&quot;</span>,35,<span class="string">&quot;WangWu&quot;</span>,<span class="string">&quot;Travel&quot;</span></span><br><span class="line"><span class="string">&quot;ZhaoLiu&quot;</span>,40,<span class="string">&quot;Shenzhen&quot;</span>,<span class="string">&quot;Reading&quot;</span></span><br><span class="line"></span><br><span class="line">$ jq -r <span class="string">&#x27;(first | keys_unsorted) as $keys | $keys, (.[] | [.[$keys[]]]) | @csv&#x27;</span> test.js | <span class="built_in">tee</span> test.csv</span><br><span class="line"><span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;city&quot;</span>,<span class="string">&quot;preference&quot;</span></span><br><span class="line"><span class="string">&quot;ZhangSan&quot;</span>,25,<span class="string">&quot;Beijing&quot;</span>,<span class="string">&quot;Technology&quot;</span></span><br><span class="line"><span class="string">&quot;LiSi&quot;</span>,,<span class="string">&quot;Shanghai&quot;</span>,<span class="string">&quot;Sports&quot;</span></span><br><span class="line"><span class="string">&quot;WangWu&quot;</span>,35,<span class="string">&quot;Guangzhou&quot;</span>,<span class="string">&quot;Travel&quot;</span></span><br><span class="line"><span class="string">&quot;ZhaoLiu&quot;</span>,40,<span class="string">&quot;Shenzhen&quot;</span>,<span class="string">&quot;Reading&quot;</span></span><br><span class="line"></span><br><span class="line">(first | keys_unsorted) as <span class="variable">$keys</span> 获取键名称数组并定义一个变量 <span class="variable">$keys</span>。</span><br><span class="line"><span class="variable">$keys</span> 引用变量，其内容作为标题。</span><br><span class="line">(.[] | [.[<span class="variable">$keys</span>[]]]) 这部分可能较难理解，同案例二的第二种写法。我们从局部到整体逐步解析：</span><br><span class="line"><span class="variable">$keys</span>[] 遍历键数组中的每一个键；</span><br><span class="line">.[<span class="variable">$keys</span>[]] 从当前数组元素中提取每个键对应的值，数组元素源自管道传递；</span><br><span class="line">[.[<span class="variable">$keys</span>[]]] 将获取到的值重组为一个数组，一个对象的值对应一个数组；</span><br><span class="line">(.[] | [.[<span class="variable">$keys</span>[]]]) 得到JSON数组中每个对象的所有元素值的数组。</span><br><span class="line"></span><br><span class="line">$ jq -r --arg q <span class="string">&quot;&#x27;&quot;</span> --arg q2 <span class="string">&quot;&#x27;,&#x27;&quot;</span> <span class="string">&#x27;.[] |</span></span><br><span class="line"><span class="string"> &quot;insert into customer select &quot; +</span></span><br><span class="line"><span class="string"> $q + .name + $q + &quot;,&quot; + (.age | tostring) +</span></span><br><span class="line"><span class="string"> &quot;,&quot; + $q + .city + $q2 + .preference + $q +</span></span><br><span class="line"><span class="string"> &quot;,... from ... where ...;&quot;&#x27;</span> test.js</span><br><span class="line"></span><br><span class="line">insert into customer <span class="keyword">select</span> <span class="string">&#x27;ZhangSan&#x27;</span>,25,<span class="string">&#x27;Beijing&#x27;</span>,<span class="string">&#x27;Technology&#x27;</span>,... from ... <span class="built_in">where</span> ...;</span><br><span class="line">insert into customer <span class="keyword">select</span> <span class="string">&#x27;LiSi&#x27;</span>,null,<span class="string">&#x27;Shanghai&#x27;</span>,<span class="string">&#x27;Sports&#x27;</span>,... from ... <span class="built_in">where</span> ...;</span><br><span class="line">insert into customer <span class="keyword">select</span> <span class="string">&#x27;WangWu&#x27;</span>,35,<span class="string">&#x27;Guangzhou&#x27;</span>,<span class="string">&#x27;Travel&#x27;</span>,... from ... <span class="built_in">where</span> ...;</span><br><span class="line">insert into customer <span class="keyword">select</span> <span class="string">&#x27;ZhaoLiu&#x27;</span>,40,<span class="string">&#x27;Shenzhen&#x27;</span>,<span class="string">&#x27;Reading&#x27;</span>,... from ... <span class="built_in">where</span> ...;</span><br><span class="line"></span><br><span class="line">$ jq --argjson ageRange <span class="string">&#x27;[30,35]&#x27;</span> \</span><br><span class="line"><span class="string">&#x27;.[] | select(.age &gt;= $ageRange[0]</span></span><br><span class="line"><span class="string"> and .age &lt;= $ageRange[1])&#x27;</span> test.js</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Guangzhou&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: 35,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;WangWu&quot;</span>,</span><br><span class="line">  <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Travel&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ jq <span class="string">&#x27;. |= map(. + $ARGS.positional[0])&#x27;</span> test.js --jsonargs <span class="string">&#x27;&#123;&quot;customerManager&quot;:&quot;SunQi&quot;,&quot;area&quot;:&quot;South China&quot;&#125;&#x27;</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhangSan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 25,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Beijing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Technology&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;LiSi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Sports&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Guangzhou&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 35,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;WangWu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Travel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhaoLiu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 40,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shenzhen&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Reading&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ jq <span class="string">&#x27;. |= map(. +</span></span><br><span class="line"><span class="string"> &#123;customerManager: $ARGS.positional[0],</span></span><br><span class="line"><span class="string"> area: $ARGS.positional[1]&#125;)&#x27;</span> \</span><br><span class="line">test.js --args SunQi <span class="string">&quot;South China&quot;</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhangSan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 25,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Beijing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Technology&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;LiSi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Sports&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Guangzhou&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 35,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;WangWu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Travel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ZhaoLiu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: 40,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Shenzhen&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preference&quot;</span>: <span class="string">&quot;Reading&quot;</span>,</span><br><span class="line">    <span class="string">&quot;customerManager&quot;</span>: <span class="string">&quot;SunQi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;South China&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#name.list filed data</span></span><br><span class="line">$ jq --slurpfile names name.list <span class="string">&#x27;.[] |</span></span><br><span class="line"><span class="string"> select(.name == $names[])&#x27;</span> test.js</span><br></pre></td></tr></table></figure>

<h3 id="Hardware-spec"><a href="#Hardware-spec" class="headerlink" title="Hardware spec"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mean_time_between_failures">Hardware spec</a></h3><p>AFR&#x3D;总故障次数&#x2F;总工作时间×100%&#x3D;故障次数&#x2F;MTBF×100%<br>MTBF&#x3D;总工作时间&#x2F;故障次数&#x3D;总工作时间&#x2F;(总工作时间×AFR)&#x3D;1&#x2F;AFR   </p>
<p>Single HDD 2M MTBF<br>The HDD AFR&#x3D;1&#x2F;(2000000&#x2F;24&#x2F;365)≈0.438%; every year about 438xHDD will failure within 100000xHDD</p>
<h3 id="PAM-unable-to-dlopen-lib64-security-pam-fprintd-so"><a href="#PAM-unable-to-dlopen-lib64-security-pam-fprintd-so" class="headerlink" title="PAM unable to dlopen &#x2F;lib64&#x2F;security&#x2F;pam_fprintd.so"></a><a target="_blank" rel="noopener" href="https://medium.com/acme-data/pam-unable-to-dlopen-lib64-security-pam-fprintd-so-centos6-is-solved-6f911877d69">PAM unable to dlopen &#x2F;lib64&#x2F;security&#x2F;pam_fprintd.so</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Just disable it, and youll be fine.</span></span><br><span class="line">$ authconfig --disablefingerprint --update</span><br></pre></td></tr></table></figure>

<h3 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NextDenovo-2.5.2</span><br><span class="line">$ make arm_neon=1 aarch64=1 march=armv8-a</span><br><span class="line"></span><br><span class="line">The CPU usage of the C/C++ program is high.</span><br><span class="line">Optimization suggestion: Different compilation optimization options can bring different performance effects to applications.</span><br><span class="line">Modification method:</span><br><span class="line">1. Add the -O3 or -O2 GCC compilation option.</span><br><span class="line">2. For GCC 9.10, you are advised to add the -mtune=tsv110 -march=armv8-a compilation options.</span><br></pre></td></tr></table></figure>

<h3 id="labtop-power-management"><a href="#labtop-power-management" class="headerlink" title="labtop power management"></a><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/34452/how-can-i-limit-battery-charging-to-80-capacity">labtop power management</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install tlp</span><br><span class="line">$ sudo tlp-stat -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># If acpi_call is recommended</span></span><br><span class="line">$ sudo apt install acpi-call-dkms</span><br><span class="line"></span><br><span class="line"><span class="comment"># If smapi is recommended</span></span><br><span class="line">$ sudo apt install tp-smapi-dkms</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/tlp.conf</span><br><span class="line">START_CHARGE_THRESH_BAT0=75</span><br><span class="line">STOP_CHARGE_THRESH_BAT0=80</span><br><span class="line">$ sudo tlp start</span><br><span class="line">$ sudo tlp-stat -b</span><br></pre></td></tr></table></figure>

<h3 id="Does-the-NIC-of-the-KVM-guest-support-the-promisc-mode"><a href="#Does-the-NIC-of-the-KVM-guest-support-the-promisc-mode" class="headerlink" title="Does the NIC of the KVM guest support the promisc mode"></a>Does the NIC of the KVM guest support the promisc mode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ip -d <span class="built_in">link</span> | grep promisc</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 </span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:ee:0d:b5 brd ff:ff:ff:ff:ff:ff promiscuity 0 addrgenmode none numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 </span><br><span class="line"></span><br><span class="line">$ brctl showmacs br0</span><br><span class="line">port no	mac addr		is <span class="built_in">local</span>?	ageing timer</span><br><span class="line">  1	52:54:00:9e:d4:69	no		   4.73</span><br><span class="line">  1	a0:36:9f:40:32:44	<span class="built_in">yes</span>		   0.00</span><br><span class="line"></span><br><span class="line"><span class="comment">#brctl setageing &lt;brname&gt; &lt;time&gt; sets the ethernet (MAC) address ageing time, in seconds. After &lt;time&gt; seconds of not having seen a frame coming from a certain address, the bridge will time out (delete) that address from the Forwarding DataBase (fdb)</span></span><br><span class="line"></span><br><span class="line">$ ifconfig eth0 promisc </span><br><span class="line">$ ifconfig eth1 0.0.0.0 promisc up</span><br><span class="line"></span><br><span class="line">$ tcpdump -i eth0</span><br><span class="line"><span class="comment">#&quot;device eth0 entered promiscuous mode&quot; in the dmesg</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="google-auth"><a href="#google-auth" class="headerlink" title="google auth"></a>google auth</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#export QR code picture from your phone</span></span><br><span class="line"></span><br><span class="line">$ zbarimg ~/Downloads/thexport_20231127-101109.png</span><br><span class="line">otpauth-migration://offline?..........................</span><br><span class="line"></span><br><span class="line">$ go install github.com/dim13/otpauth@latest</span><br><span class="line">$ ~/go/bin/otpauth -<span class="built_in">link</span> <span class="string">&quot;otpauth-migration://offline?..........................</span></span><br><span class="line"><span class="string">otpauth://xxx/xxx%xxxxxxxxxxxxxxxxxx?algorithm=XXXX&amp;digits=X&amp;issuer=XXXXXXXX&amp;period=XX&amp;secret=AABBCCDDEEFFGG</span></span><br><span class="line"><span class="string">                                                                                                  ^</span></span><br><span class="line"><span class="string">                                                                                                  |</span></span><br><span class="line"><span class="string">                                                                         get the secret key  ------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ git clone https://github.com/arcanericky/ga-cmd</span></span><br><span class="line"><span class="string">$ cd ga-cmd/src/</span></span><br><span class="line"><span class="string">$ build.sh AABBCCDDEEFFGG</span></span><br><span class="line"><span class="string">$ ga-cmd/src/bin/ga-cmd </span></span><br><span class="line"><span class="string">115339</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">https://github.com/arcanericky/ga-cmd</span></span><br><span class="line"><span class="string">https://github.com/slicer69/doas/issues/63</span></span><br><span class="line"><span class="string">https://github.com/google/google-authenticator-android/issues/118</span></span><br><span class="line"><span class="string">https://github.com/dim13/otpauth</span></span><br><span class="line"><span class="string">https://github.com/google/google-authenticator/wiki/Key-Uri-Format</span></span><br><span class="line"><span class="string">https://askubuntu.com/questions/22871/software-to-read-a-qr-code</span></span><br></pre></td></tr></table></figure>

<h3 id="HEXDUMP-hexdump"><a href="#HEXDUMP-hexdump" class="headerlink" title="HEXDUMP hexdump"></a><a target="_blank" rel="noopener" href="https://www.suse.com/c/making-sense-hexdump/">HEXDUMP hexdump</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ hexdump -s 446 -n 64 -v</span><br><span class="line"><span class="comment">#it dumps 64 bytes at offset 446 with no collapsing of duplicates</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-e &#x27;1/1 &quot; %02X&quot;&#x27;</span></span><br><span class="line"><span class="comment">#The 1/1 means process one byte in groups of one. </span></span><br><span class="line"><span class="comment">#the &quot; %02X&quot; means output a space followed by the value of a single byte as two hexadecimal digits with a leading zero.</span></span><br><span class="line"></span><br><span class="line">$ hexdump -s 446 -n 64 -v -e <span class="string">&#x27;1/1 &quot; %02X&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># we can tell hexdump to output bytes in groups of 16 (the size of one partition table entry) by specifying 16/1 instead of 1/1</span></span><br><span class="line"><span class="string">#The 16/1 isnt reversible, the first number is the number of elements to process in a group and the second number is the element length. Sixteen single byte values is what I am looking for. The other way around, 1/16, would be a single sixteen byte value. That results in a &quot;bad byte count for conversion character X&quot; error. The value after the / is the number of bytes to process for each %02X and the value before the / is the number of times to repeat that operation. %02X will not decode a 128 bit (16 byte) value, hence the error. Therefore, 16/1 is the appropriate syntax.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># my understand: 1 Bytes output 2 hex number to mark, 2/1 means 2 Bytes output 4 hex number to display, 16/1 means 32 x hex number in single group, if not enough, blank padding</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># different format </span></span><br><span class="line"><span class="string">$ hexdump -s 446 -n 64 -v -e &#x27;</span>1/1 <span class="string">&quot;%02x&quot;</span> 3/1 <span class="string">&quot; %3d&quot;</span> 1/1 <span class="string">&quot; %02x&quot;</span> 3/1 <span class="string">&quot; %3d&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># u to indicate the value is unsigned (positive values only)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Dump what would be the partition table of the command line specified</span></span><br><span class="line"><span class="comment"># file if that file was partitioned media</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PARTITION TABLE IN&#x27;</span> <span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;   -------Start-------    --------End--------&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;St |  Hd | Cyl | Sec | Tp |  Hd | Cyl | Sec | LBA Start |   LBA End&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;---|-----|-----|-----|----|-----|-----|----------------------------&#x27;</span></span><br><span class="line">hexdump -s 446 -n 64 -v -e <span class="string">&#x27;1/1 &quot;%02x&quot; 3/1 &quot; | %3u&quot; 1/1 &quot; | %02x&quot; 3/1 &quot; | %3u&quot; 2/4 &quot; | %9u&quot; &quot;\n&quot;&#x27;</span> <span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;-------------------------------------------------------------------&#x27;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#output 64bit</span></span><br><span class="line">$ hexdump -s 446 -n 64 -v -e <span class="string">&#x27;1/1 &quot;%02x&quot; 3/1 &quot; %3u&quot; 1/1 &quot; %02x&quot; 3/1 &quot; %3u&quot; 1/8 &quot; %016x&quot; &quot;\n&quot;&#x27;</span> diskdump.ddimg</span><br></pre></td></tr></table></figure>


<h3 id="multipass-test"><a href="#multipass-test" class="headerlink" title="multipass test"></a><a target="_blank" rel="noopener" href="https://hsiaofongw.notion.site/multipass-2395ceed1645491ead65bb8f52a7b07a">multipass test</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">Debian 11</span><br><span class="line"></span><br><span class="line">$ sudo snap install multipass --classic --beta</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/snap/bin</span><br><span class="line"></span><br><span class="line">t-1$ multipass launch -n a-1 </span><br><span class="line">t-2$ multipass launch -n a-2 </span><br><span class="line">t-1$ multipass shell -n a-1</span><br><span class="line">t-2$ multipass shell -n a-2 </span><br><span class="line"></span><br><span class="line">Ens3 is default NIC</span><br><span class="line"></span><br><span class="line">ubuntu@a-1$ sudo ip <span class="built_in">link</span> add <span class="built_in">link</span> ens3 name ens3.2 <span class="built_in">type</span> vlan <span class="built_in">id</span> 2 </span><br><span class="line">ubuntu@a-1$ sudo ip <span class="built_in">link</span> <span class="built_in">set</span> ens3.2 up </span><br><span class="line">ubuntu@a-1$ sudo ip addr add 192.168.1.1/24 dev ens3.2</span><br><span class="line"></span><br><span class="line">ubuntu@a-3$ sudo ip <span class="built_in">link</span> add <span class="built_in">link</span> ens3 name ens3.2 <span class="built_in">type</span> vlan <span class="built_in">id</span> 3</span><br><span class="line">ubuntu@a-3$ sudo ip <span class="built_in">link</span> <span class="built_in">set</span> ens3.2 up </span><br><span class="line">ubuntu@a-3$ sudo ip addr add 192.168.2.1/24 dev ens3.2</span><br><span class="line">ubuntu@a-3$ ping -I ens3.2 -c 1 192.168.1.1</span><br><span class="line">PING 192.168.2.1 (192.168.1.1) 56(84) bytes of data.</span><br><span class="line">--- 192.168.2.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 0 received, 100% packet loss, time 0ms</span><br><span class="line"></span><br><span class="line">ubuntu@a-1$ ping -I ens3.2 -c 1 192.168.2.1</span><br><span class="line">PING 192.168.1.1 (192.168.2.1) 56(84) bytes of data.</span><br><span class="line">--- 192.168.1.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 0 received, 100% packet loss, time 0ms</span><br><span class="line"></span><br><span class="line"><span class="comment">#create route</span></span><br><span class="line">t-3$ multipass launch -n router</span><br><span class="line"></span><br><span class="line">ubuntu@router:~$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">	inet 127.0.0.1/8 scope host lo</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 ::1/128 scope host</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/ether 52:54:00:2f:82:fe brd ff:ff:ff:ff:ff:ff</span><br><span class="line">	altname enp0s3</span><br><span class="line">	inet 10.194.191.23/24 metric 100 brd 10.194.191.255 scope global ens3</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 fe80::5054:ff:fe2f:82fe/64 scope <span class="built_in">link</span></span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">ubuntu@router:~$ sudo ip <span class="built_in">link</span> add <span class="built_in">link</span> ens3 name ens3.2 <span class="built_in">type</span> vlan <span class="built_in">id</span> 2</span><br><span class="line">ubuntu@router:~$ sudo ip <span class="built_in">link</span> add <span class="built_in">link</span> ens3 name ens3.3 <span class="built_in">type</span> vlan <span class="built_in">id</span> 3</span><br><span class="line">ubuntu@router:~$ sudo ip <span class="built_in">link</span> <span class="built_in">set</span> ens3.2 up</span><br><span class="line">ubuntu@router:~$ sudo ip <span class="built_in">link</span> <span class="built_in">set</span> ens3.3 up</span><br><span class="line">ubuntu@router:~$ sudo ip addr del 192.168.2.100/24 dev ens3.2</span><br><span class="line">ubuntu@router:~$ sudo ip addr add 192.168.2.100/24 dev ens3.3</span><br><span class="line"></span><br><span class="line">ubuntu@router:~$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">	inet 127.0.0.1/8 scope host lo</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 ::1/128 scope host</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/ether 52:54:00:2f:82:fe brd ff:ff:ff:ff:ff:ff</span><br><span class="line">	altname enp0s3</span><br><span class="line">	inet 10.194.191.23/24 metric 100 brd 10.194.191.255 scope global ens3</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 fe80::5054:ff:fe2f:82fe/64 scope <span class="built_in">link</span></span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">3: ens3.2@ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/ether 52:54:00:2f:82:fe brd ff:ff:ff:ff:ff:ff</span><br><span class="line">	inet 192.168.1.100/24 scope global ens3.2</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 fe80::5054:ff:fe2f:82fe/64 scope <span class="built_in">link</span></span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">4: ens3.3@ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">	<span class="built_in">link</span>/ether 52:54:00:2f:82:fe brd ff:ff:ff:ff:ff:ff</span><br><span class="line">	inet 192.168.2.100/24 scope global ens3.3</span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line">	inet6 fe80::5054:ff:fe2f:82fe/64 scope <span class="built_in">link</span></span><br><span class="line">   	valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">ubuntu@a-3:~$ sudo ip route add default via 192.168.1.100</span><br><span class="line">ubuntu@a-1:~$ sudo ip r s</span><br><span class="line">default via 192.168.1.100 dev ens3.2</span><br><span class="line">10.194.191.0/24 dev ens3 proto kernel scope <span class="built_in">link</span> src 10.194.191.242 metric 100</span><br><span class="line">10.194.191.1 dev ens3 proto dhcp scope <span class="built_in">link</span> src 10.194.191.242 metric 100</span><br><span class="line">192.168.1.0/24 dev ens3.2 proto kernel scope <span class="built_in">link</span> src 192.168.1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ubuntu@a-3:~$ sudo ip route add default via 192.168.2.100</span><br><span class="line">ubuntu@a-3:~$ ip r s</span><br><span class="line">default via 192.168.2.100 dev ens3.2</span><br><span class="line">10.194.191.0/24 dev ens3 proto kernel scope <span class="built_in">link</span> src 10.194.191.140 metric 100</span><br><span class="line">10.194.191.1 dev ens3 proto dhcp scope <span class="built_in">link</span> src 10.194.191.140 metric 100</span><br><span class="line">192.168.2.0/24 dev ens3.2 proto kernel scope <span class="built_in">link</span> src 192.168.2.1</span><br><span class="line"></span><br><span class="line">worked</span><br><span class="line">ubuntu@a-1:~$ ping -I ens3.2 192.168.2.1</span><br><span class="line">PING 192.168.2.1 (192.168.2.1) from 192.168.1.1 ens3.2: 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.2.1: icmp_seq=1 ttl=63 time=1.06 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.2.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 1.058/1.058/1.058/0.000 ms</span><br><span class="line"></span><br><span class="line">ubuntu@a-3:~$ ping -I ens3.2 192.168.1.1</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) from 192.168.2.1 ens3.2: 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=1.17 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=2 ttl=63 time=1.17 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.1.1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1002ms</span><br><span class="line">rtt min/avg/max/mdev = 1.168/1.168/1.169/0.000 ms</span><br><span class="line"></span><br><span class="line">ubuntu@a-1:~$ ping -c 1 www.bing.com</span><br><span class="line">PING china.bing123.com (202.89.233.100) 56(84) bytes of data.</span><br><span class="line">--- china.bing123.com ping statistics ---</span><br><span class="line">1 packets transmitted, 0 received, 100% packet loss, time 0ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#set NAT </span></span><br><span class="line">ubuntu@router:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE</span><br><span class="line"></span><br><span class="line">worked</span><br><span class="line">ubuntu@a-1:~$ ping -I ens3.2 -c 1 snapcraft.io</span><br><span class="line">PING snapcraft.io (185.125.190.21) from 192.168.1.1 ens3.2: 56(84) bytes of data.</span><br><span class="line">64 bytes from website-content-cache-2.ps5.canonical.com (185.125.190.21): icmp_seq=1 ttl=46 time=224 ms</span><br><span class="line"></span><br><span class="line">--- snapcraft.io ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 224.432/224.432/224.432/0.000 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$  multipass list</span><br><span class="line">Name                	State         	IPv4         	Image</span><br><span class="line">a-1                 	Running       	10.194.191.242   Ubuntu 22.04 LTS</span><br><span class="line">                                      	192.168.1.1</span><br><span class="line">a-2                 	Deleted       	--           	Ubuntu 22.04 LTS</span><br><span class="line">a-3                 	Running       	10.194.191.140   Ubuntu 22.04 LTS</span><br><span class="line">                                      	192.168.2.1</span><br><span class="line">router              	Running       	10.194.191.23	Ubuntu 22.04 LTS</span><br><span class="line">                                      	192.168.1.100</span><br><span class="line">                                      	192.168.2.100</span><br></pre></td></tr></table></figure>

<h4 id="disable-usb-uas-function"><a href="#disable-usb-uas-function" class="headerlink" title="disable usb uas function"></a><a target="_blank" rel="noopener" href="https://gmd20.github.io/blog/%E9%87%91%E8%83%9C%E7%9A%84-kingshare-msata%E8%BD%ACUSB3.0%E7%A1%AC%E7%9B%98%E7%9B%92%E5%9C%A8linux%E7%9A%84%E9%A9%B1%E5%8A%A8%E9%97%AE%E9%A2%98%E9%9C%80%E8%A6%81%E7%A6%81%E7%94%A8uas%E6%89%8D%E8%A1%8C/">disable usb uas function</a></h4><p>UAS was introduced as part of the USB 3.0 standard, but can also be used with devices complying to the slower USB 2.0 standard. UAS drivers generally provide faster transfers when compared to the older USB Mass Storage Bulk-Only Transport (BOT) protocol drivers When used with an SSD, UAS is considerably faster than BOT for random reads and writes, but still well below the speed of a native SATA 3 interface (6 Gbit&#x2F;s).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">the quirks parameter of  usb-storage has the following foramt:</span><br><span class="line"><span class="string">&quot;VID:PID:flags&quot;</span>,</span><br><span class="line">the vendor_id and product_id can be found <span class="keyword">in</span> dmesg or lsusb output.</span><br><span class="line"></span><br><span class="line">see usb_stor_adjust_quirks <span class="keyword">function</span> <span class="keyword">in</span> </span><br><span class="line">https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/tree/drivers/usb/storage/usb.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;options usb-storage quirks=Vendor_ID:Product_ID:u&quot;</span> <span class="keyword">in</span> modprobe conf file,</span><br><span class="line">or try to <span class="built_in">set</span> it at runtime.</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /sys/module/usb_storage/parameters/quirks </span><br><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;174c:55aa:u&quot;</span>  &gt; /sys/module/usb_storage/parameters/quirks </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rmmod uas</span><br><span class="line">rmmod usb_storage</span><br><span class="line">modprobe usb_storage quirks=174c:55aa:u</span><br></pre></td></tr></table></figure>


<h4 id="lsiget-kernel-info"><a href="#lsiget-kernel-info" class="headerlink" title="lsiget kernel info"></a>lsiget kernel info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line">scsi_host/</span><br><span class="line">scsi_host/host0/</span><br><span class="line">scsi_host/host0/version_fw.txt</span><br><span class="line">scsi_host/host0/fwfault_debug.txt</span><br><span class="line">scsi_host/host0/diag_trigger_event.txt</span><br><span class="line">scsi_host/host0/logging_level.txt</span><br><span class="line">scsi_host/host0/prot_capabilities.txt</span><br><span class="line">scsi_host/host0/cmd_per_lun.txt</span><br><span class="line">scsi_host/host0/supported_mode.txt</span><br><span class="line">scsi_host/host0/BRM_status.txt</span><br><span class="line">scsi_host/host0/host_busy.txt</span><br><span class="line">scsi_host/host0/unchecked_isa_dma.txt</span><br><span class="line">scsi_host/host0/use_blk_mq.txt</span><br><span class="line">scsi_host/host0/uevent.txt</span><br><span class="line">scsi_host/host0/host_trace_buffer_enable.txt</span><br><span class="line">scsi_host/host0/io_delay.txt</span><br><span class="line">scsi_host/host0/device_delay.txt</span><br><span class="line">scsi_host/host0/board_name.txt</span><br><span class="line">scsi_host/host0/board_assembly.txt</span><br><span class="line">scsi_host/host0/state.txt</span><br><span class="line">scsi_host/host0/can_queue.txt</span><br><span class="line">scsi_host/host0/host_trace_buffer_size.txt</span><br><span class="line">scsi_host/host0/fw_queue_depth.txt</span><br><span class="line">scsi_host/host0/sg_prot_tablesize.txt</span><br><span class="line">scsi_host/host0/version_bios.txt</span><br><span class="line">scsi_host/host0/version_nvdata_default.txt</span><br><span class="line">scsi_host/host0/proc_name.txt</span><br><span class="line">scsi_host/host0/host_trace_buffer.txt</span><br><span class="line">scsi_host/host0/board_tracer.txt</span><br><span class="line">scsi_host/host0/eh_deadline.txt</span><br><span class="line">scsi_host/host0/unique_id.txt</span><br><span class="line">scsi_host/host0/prot_guard_type.txt</span><br><span class="line">scsi_host/host0/version_product.txt</span><br><span class="line">scsi_host/host0/scan.txt</span><br><span class="line">scsi_host/host0/reply_queue_count.txt</span><br><span class="line">scsi_host/host0/diag_trigger_mpi.txt</span><br><span class="line">scsi_host/host0/diag_trigger_scsi.txt</span><br><span class="line">scsi_host/host0/ioc_reset_count.txt</span><br><span class="line">scsi_host/host0/version_nvdata_persistent.txt</span><br><span class="line">scsi_host/host0/active_mode.txt</span><br><span class="line">scsi_host/host0/sg_tablesize.txt</span><br><span class="line">scsi_host/host0/drv_support_bitmap.txt</span><br><span class="line">scsi_host/host0/diag_trigger_master.txt</span><br><span class="line">scsi_host/host0/version_mpi.txt</span><br><span class="line">scsi_host/host0/host_reset.txt</span><br><span class="line">scsi_host/host0/host_sas_address.txt</span><br><span class="line">fdisk-l.txt</span><br><span class="line">sysctl-ah.txt</span><br><span class="line">boot-latrR.txt</span><br><span class="line">ps-ef.txt</span><br><span class="line">uptime.txt</span><br><span class="line">who-b.txt</span><br><span class="line">lspci/</span><br><span class="line">lspci/lspci-tvvv.txt</span><br><span class="line">lspci/lspci-vv.txt</span><br><span class="line">lspci/lspci-xxx.txt</span><br><span class="line">lspci/lspci-vvv.txt</span><br><span class="line">lspci/lspci-v.txt</span><br><span class="line">lspci/lspci-vvvxxxx.txt</span><br><span class="line">lspci/lspci-t.txt</span><br><span class="line">lspci/lspci.txt</span><br><span class="line">lspci/lspci-x.txt</span><br><span class="line">lspci/lspci-xxxx.txt</span><br><span class="line">sysctl-ad.txt</span><br><span class="line">biosdecode.txt</span><br><span class="line">lsblk-all.txt</span><br><span class="line">ps-e.txt</span><br><span class="line">top-b-n1.txt</span><br><span class="line">vpddecode.txt</span><br><span class="line">sd_time_out_value.txt</span><br><span class="line">journalctl-a.txt</span><br><span class="line">proc/</span><br><span class="line">proc/mounts</span><br><span class="line">proc/meminfo</span><br><span class="line">proc/cmdline</span><br><span class="line">proc/filesystems</span><br><span class="line">proc/net-dev</span><br><span class="line">proc/version</span><br><span class="line">proc/cpuinfo</span><br><span class="line">proc/stat</span><br><span class="line">proc/slabinfo</span><br><span class="line">proc/misc</span><br><span class="line">proc/devices</span><br><span class="line">proc/bus-pci-devices</span><br><span class="line">proc/sys/</span><br><span class="line">proc/sys/kernel/</span><br><span class="line">proc/sys/kernel/softlockup_panic</span><br><span class="line">proc/sys/kernel/overflowuid</span><br><span class="line">proc/sys/kernel/threads-max</span><br><span class="line">proc/sys/kernel/ftrace_dump_on_oops</span><br><span class="line">proc/sys/kernel/panic_on_stackoverflow</span><br><span class="line">proc/sys/kernel/shmmax</span><br><span class="line">proc/sys/kernel/printk_delay</span><br><span class="line">proc/sys/kernel/sched_wakeup_granularity_ns</span><br><span class="line">proc/sys/kernel/panic_on_oops</span><br><span class="line">proc/sys/kernel/sysrq</span><br><span class="line">proc/sys/kernel/version</span><br><span class="line">proc/sys/kernel/sched_cfs_bandwidth_slice_us</span><br><span class="line">proc/sys/kernel/bootloader_version</span><br><span class="line">proc/sys/kernel/shm_rmid_forced</span><br><span class="line">proc/sys/kernel/msg_next_id</span><br><span class="line">proc/sys/kernel/ns_last_pid</span><br><span class="line">proc/sys/kernel/stack_tracer_enabled</span><br><span class="line">proc/sys/kernel/bootloader_type</span><br><span class="line">proc/sys/kernel/hung_task_panic</span><br><span class="line">proc/sys/kernel/sched_schedstats</span><br><span class="line">proc/sys/kernel/hotplug</span><br><span class="line">proc/sys/kernel/kexec_load_disabled</span><br><span class="line">proc/sys/kernel/auto_msgmni</span><br><span class="line">proc/sys/kernel/sched_tunable_scaling</span><br><span class="line">proc/sys/kernel/dmesg_restrict</span><br><span class="line">proc/sys/kernel/numa_balancing_scan_period_min_ms</span><br><span class="line">proc/sys/kernel/acpi_video_flags</span><br><span class="line">proc/sys/kernel/panic</span><br><span class="line">proc/sys/kernel/pid_max</span><br><span class="line">proc/sys/kernel/compat-log</span><br><span class="line">proc/sys/kernel/msgmnb</span><br><span class="line">proc/sys/kernel/sched_rt_runtime_us</span><br><span class="line">proc/sys/kernel/numa_balancing_settle_count</span><br><span class="line">proc/sys/kernel/sched_autogroup_enabled</span><br><span class="line">proc/sys/kernel/printk_ratelimit_burst</span><br><span class="line">proc/sys/kernel/core_pattern</span><br><span class="line">proc/sys/kernel/msgmax</span><br><span class="line">proc/sys/kernel/numa_balancing_scan_period_max_ms</span><br><span class="line">proc/sys/kernel/modules_disabled</span><br><span class="line">proc/sys/kernel/shm_next_id</span><br><span class="line">proc/sys/kernel/perf_event_mlock_kb</span><br><span class="line">proc/sys/kernel/numa_balancing</span><br><span class="line">proc/sys/kernel/kptr_restrict</span><br><span class="line">proc/sys/kernel/perf_event_paranoid</span><br><span class="line">proc/sys/kernel/msgmni</span><br><span class="line">proc/sys/kernel/osrelease</span><br><span class="line">proc/sys/kernel/watchdog_cpumask</span><br><span class="line">proc/sys/kernel/core_uses_pid</span><br><span class="line">proc/sys/kernel/randomize_va_space</span><br><span class="line">proc/sys/kernel/sched_rr_timeslice_ms</span><br><span class="line">proc/sys/kernel/shmall</span><br><span class="line">proc/sys/kernel/cad_pid</span><br><span class="line">proc/sys/kernel/sched_migration_cost_ns</span><br><span class="line">proc/sys/kernel/io_delay_type</span><br><span class="line">proc/sys/kernel/sysctl_writes_strict</span><br><span class="line">proc/sys/kernel/perf_cpu_time_max_percent</span><br><span class="line">proc/sys/kernel/sem</span><br><span class="line">proc/sys/kernel/watchdog</span><br><span class="line">proc/sys/kernel/numa_balancing_scan_size_mb</span><br><span class="line">proc/sys/kernel/poweroff_cmd</span><br><span class="line">proc/sys/kernel/cap_last_cap</span><br><span class="line">proc/sys/kernel/acct</span><br><span class="line">proc/sys/kernel/perf_event_max_sample_rate</span><br><span class="line">proc/sys/kernel/core_pipe_limit</span><br><span class="line">proc/sys/kernel/sched_latency_ns</span><br><span class="line">proc/sys/kernel/panic_on_warn</span><br><span class="line">proc/sys/kernel/hostname</span><br><span class="line">proc/sys/kernel/softlockup_all_cpu_backtrace</span><br><span class="line">proc/sys/kernel/tainted</span><br><span class="line">proc/sys/kernel/sched_time_avg_ms</span><br><span class="line">proc/sys/kernel/ctrl-alt-del</span><br><span class="line">proc/sys/kernel/ostype</span><br><span class="line">proc/sys/kernel/watchdog_thresh</span><br><span class="line">proc/sys/kernel/sched_shares_window_ns</span><br><span class="line">proc/sys/kernel/sched_min_granularity_ns</span><br><span class="line">proc/sys/kernel/modprobe</span><br><span class="line">proc/sys/kernel/hardlockup_all_cpu_backtrace</span><br><span class="line">proc/sys/kernel/sem_next_id</span><br><span class="line">proc/sys/kernel/ftrace_enabled</span><br><span class="line">proc/sys/kernel/sched_nr_migrate</span><br><span class="line">proc/sys/kernel/hung_task_check_count</span><br><span class="line">proc/sys/kernel/real-root-dev</span><br><span class="line">proc/sys/kernel/print-fatal-signals</span><br><span class="line">proc/sys/kernel/hardlockup_panic</span><br><span class="line">proc/sys/kernel/ngroups_max</span><br><span class="line">proc/sys/kernel/domainname</span><br><span class="line">proc/sys/kernel/panic_on_io_nmi</span><br><span class="line">proc/sys/kernel/numa_balancing_scan_delay_ms</span><br><span class="line">proc/sys/kernel/hung_task_timeout_secs</span><br><span class="line">proc/sys/kernel/overflowgid</span><br><span class="line">proc/sys/kernel/printk</span><br><span class="line">proc/sys/kernel/sched_child_runs_first</span><br><span class="line">proc/sys/kernel/printk_ratelimit</span><br><span class="line">proc/sys/kernel/sched_rt_period_us</span><br><span class="line">proc/sys/kernel/shmmni</span><br><span class="line">proc/sys/kernel/nmi_watchdog</span><br><span class="line">proc/sys/kernel/grep-r_._proc_sys_kernel.txt</span><br><span class="line">proc/sys/kernel/hung_task_warnings</span><br><span class="line">proc/sys/kernel/max_lock_depth</span><br><span class="line">proc/sys/kernel/unknown_nmi_panic</span><br><span class="line">proc/sys/kernel/panic_on_unrecovered_nmi</span><br><span class="line">proc/sys/kernel/traceoff_on_warning</span><br><span class="line">proc/sys/kernel/timer_migration</span><br><span class="line">proc/sys/vm/</span><br><span class="line">proc/sys/vm/numa_zonelist_order.txt</span><br><span class="line">proc/sys/vm/page-cluster.txt</span><br><span class="line">proc/sys/vm/dirty_bytes.txt</span><br><span class="line">proc/sys/vm/compact_memory.txt</span><br><span class="line">proc/sys/vm/mmap_rnd_bits.txt</span><br><span class="line">proc/sys/vm/hugepages_treat_as_movable.txt</span><br><span class="line">proc/sys/vm/block_dump.txt</span><br><span class="line">proc/sys/vm/nr_overcommit_hugepages.txt</span><br><span class="line">proc/sys/vm/nr_hugepages_mempolicy.txt</span><br><span class="line">proc/sys/vm/mmap_min_addr.txt</span><br><span class="line">proc/sys/vm/overcommit_kbytes.txt</span><br><span class="line">proc/sys/vm/dirty_expire_centisecs.txt</span><br><span class="line">proc/sys/vm/dirty_background_ratio.txt</span><br><span class="line">proc/sys/vm/drop_caches.txt</span><br><span class="line">proc/sys/vm/swappiness.txt</span><br><span class="line">proc/sys/vm/panic_on_oom.txt</span><br><span class="line">proc/sys/vm/overcommit_ratio.txt</span><br><span class="line">proc/sys/vm/percpu_pagelist_fraction.txt</span><br><span class="line">proc/sys/vm/min_unmapped_ratio.txt</span><br><span class="line">proc/sys/vm/max_map_count.txt</span><br><span class="line">proc/sys/vm/oom_kill_allocating_task.txt</span><br><span class="line">proc/sys/vm/hugetlb_shm_group.txt</span><br><span class="line">proc/sys/vm/lowmem_reserve_ratio.txt</span><br><span class="line">proc/sys/vm/min_slab_ratio.txt</span><br><span class="line">proc/sys/vm/nr_hugepages.txt</span><br><span class="line">proc/sys/vm/admin_reserve_kbytes.txt</span><br><span class="line">proc/sys/vm/dirty_writeback_centisecs.txt</span><br><span class="line">proc/sys/vm/memory_failure_early_kill.txt</span><br><span class="line">proc/sys/vm/dirty_ratio.txt</span><br><span class="line">proc/sys/vm/oom_dump_tasks.txt</span><br><span class="line">proc/sys/vm/extfrag_threshold.txt</span><br><span class="line">proc/sys/vm/dirty_background_bytes.txt</span><br><span class="line">proc/sys/vm/mmap_rnd_compat_bits.txt</span><br><span class="line">proc/sys/vm/vfs_cache_pressure.txt</span><br><span class="line">proc/sys/vm/stat_interval.txt</span><br><span class="line">proc/sys/vm/laptop_mode.txt</span><br><span class="line">proc/sys/vm/legacy_va_layout.txt</span><br><span class="line">proc/sys/vm/memory_failure_recovery.txt</span><br><span class="line">proc/sys/vm/zone_reclaim_mode.txt</span><br><span class="line">proc/sys/vm/user_reserve_kbytes.txt</span><br><span class="line">proc/sys/vm/nr_pdflush_threads.txt</span><br><span class="line">proc/sys/vm/min_free_kbytes.txt</span><br><span class="line">proc/sys/vm/overcommit_memory.txt</span><br><span class="line">proc/scsi_logging_level-g.txt</span><br><span class="line">proc/buddyinfo</span><br><span class="line">proc/mdstat</span><br><span class="line">proc/partitions</span><br><span class="line">proc/interrupts</span><br><span class="line">proc/iomem</span><br><span class="line">proc/mtrr</span><br><span class="line">proc/proc-latrR.txt</span><br><span class="line">proc/ioports</span><br><span class="line">proc/kallsyms</span><br><span class="line">proc/uptime</span><br><span class="line">proc/dma</span><br><span class="line">proc/modules</span><br><span class="line">proc/zoneinfo</span><br><span class="line">proc/diskstats</span><br><span class="line">proc/scsi/</span><br><span class="line">proc/scsi/sg/</span><br><span class="line">proc/scsi/sg/version</span><br><span class="line">proc/scsi/sg/debug</span><br><span class="line">proc/scsi/sg/allow_dio</span><br><span class="line">proc/scsi/sg/devices</span><br><span class="line">proc/scsi/sg/device_strs</span><br><span class="line">proc/scsi/sg/def_reserved_size</span><br><span class="line">proc/scsi/sg/device_hdr</span><br><span class="line">proc/scsi/device_info</span><br><span class="line">proc/scsi/scsi</span><br><span class="line">proc/vmstat</span><br><span class="line">sysctl-a.txt</span><br><span class="line">var_log/</span><br></pre></td></tr></table></figure>

<h4 id="IPA"><a href="#IPA" class="headerlink" title="IPA"></a>IPA</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ipa user-show <span class="variable">$username</span> --all</span><br></pre></td></tr></table></figure>

<h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker update -m 128g --memory-swap 128g node1   limit swap</span></span><br><span class="line"><span class="comment"># docker update -m 128g --memory-swap -1 node2     not limit swap</span></span><br></pre></td></tr></table></figure>

<h3 id="xfusion"><a href="#xfusion" class="headerlink" title="xfusion"></a>xfusion</h3><p>AMD CBS–&gt; DF commo options —&gt; Memory Addressing —&gt; Numa Nodes Per Socket—&gt; NPS4</p>
<h3 id="osq-lock"><a href="#osq-lock" class="headerlink" title="osq_lock"></a>osq_lock</h3><p>parallel multiple process write zpool, more process and higher osq_lock overhead, memory ?</p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><p>LU-11976 req wrong generation leading to I&#x2F;O errors on 2.12<br>clients<br>▸ Disabled idling connection feature:<br>lctl set_param osc.*.idle_timeout&#x3D;0<br>LU-11888 + LU-11937 lnet.service randomly load tcp NIDs<br>▸ Added to &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;lnet.service.d&#x2F;deps.conf on all clients<br>[Unit]<br>After&#x3D;dkms.service network.service<br>[Service]</p>
<h1 id="we-don’t-want-tcp-nids"><a href="#we-don’t-want-tcp-nids" class="headerlink" title="we don’t want tcp nids"></a>we don’t want tcp nids</h1><p>ExecStartPost&#x3D;-&#x2F;usr&#x2F;sbin&#x2F;lnetctl net del –net tcp</p>
<h4 id="gnuplot"><a href="#gnuplot" class="headerlink" title="gnuplot"></a>gnuplot</h4><p><a target="_blank" rel="noopener" href="https://gnuplotting.org/circular-heat-map/index.html">Circular heat map</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/57215301/gnuplot-default-value-for-heatmap-if-no-data-is-available">example1</a></p>
<h4 id="ollama-download-model"><a href="#ollama-download-model" class="headerlink" title="ollama download model"></a><a target="_blank" rel="noopener" href="https://github.com/ollama/ollama/issues/729#issuecomment-1906311485">ollama download model</a></h4><p>create ollama user and group, start this service, don’t use root, Env will not work</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/systemd/system/ollama.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Ollama Service</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/ollama serve</span><br><span class="line">User=ollama</span><br><span class="line">Group=ollama</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=3</span><br><span class="line">Environment=<span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;https_proxy=http://mycorporateproxy.local:8080&quot;</span>  <span class="comment">#                             &lt;---------------- </span></span><br><span class="line">Environment=<span class="string">&quot;OLLAMA_TIMEOUT=600&quot;</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart ollama.service</span><br></pre></td></tr></table></figure>

<h4 id="API-send-image-to-AI-server"><a href="#API-send-image-to-AI-server" class="headerlink" title="API send image to AI server"></a><a target="_blank" rel="noopener" href="https://github.com/abetlen/llama-cpp-python/issues/1223#issuecomment-1964653525">API send image to AI server</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_to_base64_data_uri</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> img_file:</span><br><span class="line">        base64_data = base64.b64encode(img_file.read()).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;data:image/png;base64,<span class="subst">&#123;base64_data&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Replace &#x27;file_path.png&#x27; with the actual path to your PNG file</span></span><br><span class="line">file_path = <span class="string">&#x27;file_path.png&#x27;</span></span><br><span class="line">data_uri = image_to_base64_data_uri(file_path)</span><br><span class="line"></span><br><span class="line">messages = [</span><br><span class="line">    &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are an assistant who perfectly describes images.&quot;</span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: data_uri &#125;&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Describe this image in detail please.&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="VPS-ping"><a href="#VPS-ping" class="headerlink" title="VPS ping"></a>VPS ping</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.icmp_echo_ignore_all = 1</span><br><span class="line">net.ipv4.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv4.conf.default.disable_ipv6 = 1</span><br><span class="line">net.ipv4.conf.lo.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.icmp_msgs_per_sec = 3000</span><br><span class="line">net.ipv4.icmp_ratelimit = 3000</span><br><span class="line">net.ipv4.icmp_msgs_burst = 4000</span><br><span class="line"></span><br><span class="line">net.core.default_qdisc = fq</span><br><span class="line">net.ipv4.tcp_congestion_control = bbr</span><br><span class="line"></span><br><span class="line">net.core.netdev_max_backlog = 2048 <span class="comment">#proportional to rcvwnd</span></span><br></pre></td></tr></table></figure>

<h4 id="2024-renew-redhat"><a href="#2024-renew-redhat" class="headerlink" title="2024 renew redhat"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/management/subscriptions">2024 renew redhat</a></h4><h4 id="reference1"><a href="#reference1" class="headerlink" title="reference1"></a><a target="_blank" rel="noopener" href="https://developers.redhat.com/articles/renew-your-red-hat-developer-program-subscription?extIdCarryOver=true&intcmp=7013a000002q1lYAAQ&percmp=7013a000002w4YtAAI&sc_cid=7013a0000034jS4AAI#">reference1</a></h4><h4 id="reference2"><a href="#reference2" class="headerlink" title="reference2"></a><a target="_blank" rel="noopener" href="https://www.redhat.com/en/about/subscription-renewal-guide">reference2</a></h4><h4 id="terminal-record-video"><a href="#terminal-record-video" class="headerlink" title="terminal record video"></a><a target="_blank" rel="noopener" href="https://docs.asciinema.org/getting-started/#getting-started">terminal record video</a></h4>
  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#steam"><span class="toc-number">1.</span> <span class="toc-text">steam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#background-ctrl-z-and-continue"><span class="toc-number">2.</span> <span class="toc-text">background ctrl + z and continue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Are-you-kid-me-node-exporter"><span class="toc-number">3.</span> <span class="toc-text">Are you kid me, node_exporter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#el8-single-mode"><span class="toc-number">4.</span> <span class="toc-text">el8 single mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#caculate-the-oom-score-adj"><span class="toc-number">5.</span> <span class="toc-text">caculate the oom_score_adj</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umask-and-acl"><span class="toc-number">6.</span> <span class="toc-text">[umask and acl]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-disable-kcompactd-systemwide-permanently-forever"><span class="toc-number">7.</span> <span class="toc-text">How to disable kcompactd systemwide, permanently, forever</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#output-kernel-msg"><span class="toc-number">8.</span> <span class="toc-text">output kernel msg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cp-with-acl"><span class="toc-number">9.</span> <span class="toc-text">cp with acl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#remove-pci-dev"><span class="toc-number">10.</span> <span class="toc-text">remove pci dev</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debain-ubuntu"><span class="toc-number">11.</span> <span class="toc-text">Debain&#x2F;ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#distros"><span class="toc-number">11.1.</span> <span class="toc-text">distros</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#install-perf"><span class="toc-number">11.1.1.</span> <span class="toc-text">install perf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lenovo-enable-ipmi-over-lan-in-command-line"><span class="toc-number">11.1.2.</span> <span class="toc-text">lenovo enable ipmi over lan in command line</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Configure-Nemo-to-always-use-a-textual-input-for-the-location-bar"><span class="toc-number">11.1.3.</span> <span class="toc-text">Configure Nemo to always use a textual input for the location bar</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-todesk-new-ver-in-debian11"><span class="toc-number">12.</span> <span class="toc-text">upgrade todesk new ver in debian11</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#boot-options"><span class="toc-number">12.0.1.</span> <span class="toc-text">boot options</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#apt-proxy"><span class="toc-number">12.1.</span> <span class="toc-text">apt proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-repo"><span class="toc-number">12.2.</span> <span class="toc-text">ubuntu repo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-cloud-init"><span class="toc-number">12.2.1.</span> <span class="toc-text">disable cloud init</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-sleep"><span class="toc-number">12.2.2.</span> <span class="toc-text">disable sleep</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-screen-lock-and-screen-blackout"><span class="toc-number">12.3.</span> <span class="toc-text">disable screen lock and screen blackout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-GNOME"><span class="toc-number">12.4.</span> <span class="toc-text">ubuntu GNOME</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#clone-the-whole-linux-system-by-rsync"><span class="toc-number">12.4.1.</span> <span class="toc-text">clone the whole linux system by rsync</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#disable-upgrade"><span class="toc-number">12.4.2.</span> <span class="toc-text">disable upgrade</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#list-all-version-not-installed"><span class="toc-number">12.4.3.</span> <span class="toc-text">list all version(not installed)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VLC"><span class="toc-number">12.5.</span> <span class="toc-text">VLC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Upgrade-pixel-6a"><span class="toc-number">12.6.</span> <span class="toc-text">Upgrade pixel 6a</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rotated-pdf-file"><span class="toc-number">12.7.</span> <span class="toc-text">rotated pdf file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-split"><span class="toc-number">12.8.</span> <span class="toc-text">vim split</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd"><span class="toc-number">12.9.</span> <span class="toc-text">systemd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rc-local"><span class="toc-number">12.10.</span> <span class="toc-text">rc.local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS"><span class="toc-number">12.11.</span> <span class="toc-text">DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Flush-DNS-cache"><span class="toc-number">12.11.1.</span> <span class="toc-text">Flush DNS cache</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-wifi"><span class="toc-number">12.12.</span> <span class="toc-text">ubuntu wifi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-fstrim-service"><span class="toc-number">12.13.</span> <span class="toc-text">disable fstrim service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debian-set-boot-order"><span class="toc-number">12.14.</span> <span class="toc-text">debian set boot order</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delpoy"><span class="toc-number">12.15.</span> <span class="toc-text">delpoy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sysstat-systemd"><span class="toc-number">12.15.1.</span> <span class="toc-text">sysstat systemd</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#wechat"><span class="toc-number">12.15.2.</span> <span class="toc-text">wechat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#install-newer-glibc-deb-packages-and-apt-source-not-update-cause-the-deps-issue"><span class="toc-number">12.15.3.</span> <span class="toc-text">install newer glibc deb packages and apt source not update cause the deps issue</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Almalinux-9-install-X-boot-failed"><span class="toc-number">12.16.</span> <span class="toc-text">Almalinux 9 install X boot failed</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setup-VNC"><span class="toc-number">12.17.</span> <span class="toc-text">setup VNC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu-shutdown-slow"><span class="toc-number">12.18.</span> <span class="toc-text">ubuntu shutdown slow</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RHEL"><span class="toc-number">13.</span> <span class="toc-text">RHEL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#verify-packages"><span class="toc-number">13.1.</span> <span class="toc-text">verify-packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-almalinux-src-rpm"><span class="toc-number">13.2.</span> <span class="toc-text">Get almalinux src rpm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP-port-detect"><span class="toc-number">13.3.</span> <span class="toc-text">UDP port detect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Let-selinux-to-permissive-mode"><span class="toc-number">13.4.</span> <span class="toc-text">Let selinux to permissive mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Audit"><span class="toc-number">13.5.</span> <span class="toc-text">Audit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsync-debug"><span class="toc-number">13.6.</span> <span class="toc-text">rsync debug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chrome-enable-dns-over-https"><span class="toc-number">13.7.</span> <span class="toc-text">chrome enable dns over https</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#traceroute"><span class="toc-number">13.8.</span> <span class="toc-text">traceroute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapping-file-to-loop-dev"><span class="toc-number">13.9.</span> <span class="toc-text">mapping file to loop dev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#export-tcmalloc"><span class="toc-number">13.10.</span> <span class="toc-text">export tcmalloc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vi-paste-not-auto-inherit-the-file-type"><span class="toc-number">13.11.</span> <span class="toc-text">vi paste not auto inherit the file type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo"><span class="toc-number">13.12.</span> <span class="toc-text">sudo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NRPE-config"><span class="toc-number">13.12.1.</span> <span class="toc-text">NRPE config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#printk-messages"><span class="toc-number">13.13.</span> <span class="toc-text">printk messages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kill-sockets"><span class="toc-number">13.14.</span> <span class="toc-text">kill sockets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-by-xz"><span class="toc-number">13.15.</span> <span class="toc-text">compress by xz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-limit"><span class="toc-number">13.16.</span> <span class="toc-text">systemd limit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set-limit-by-systemd"><span class="toc-number">13.16.1.</span> <span class="toc-text">set limit by systemd</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#custom-rc-local"><span class="toc-number">13.17.</span> <span class="toc-text">custom rc-local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Starting-udev-Kernel-Device-Manager"><span class="toc-number">13.18.</span> <span class="toc-text">Starting udev Kernel Device Manager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pipe-fifo"><span class="toc-number">13.19.</span> <span class="toc-text">pipe, fifo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RHEL-tuning"><span class="toc-number">13.20.</span> <span class="toc-text">RHEL tuning</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#abrt-watch-log"><span class="toc-number">13.20.1.</span> <span class="toc-text">abrt-watch-log</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tuned-adm"><span class="toc-number">13.20.2.</span> <span class="toc-text">tuned-adm</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sync-time"><span class="toc-number">13.21.</span> <span class="toc-text">sync time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-7-upgrade-to-AlamLinux-8"><span class="toc-number">13.22.</span> <span class="toc-text">CentOS 7 upgrade to AlamLinux 8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">13.23.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nofile"><span class="toc-number">13.24.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#show-parent-pid"><span class="toc-number">13.25.</span> <span class="toc-text">show parent pid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pidstat"><span class="toc-number">13.26.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rand-file"><span class="toc-number">13.27.</span> <span class="toc-text">rand file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#samba"><span class="toc-number">14.</span> <span class="toc-text">samba</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Account"><span class="toc-number">14.1.</span> <span class="toc-text">Account</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">14.2.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update-kernel-moduels-in-lib-moduels-uname-r"><span class="toc-number">14.3.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter-syslog"><span class="toc-number">14.4.</span> <span class="toc-text">filter syslog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-permission"><span class="toc-number">14.5.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#taskset"><span class="toc-number">14.6.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-SSH"><span class="toc-number">14.7.</span> <span class="toc-text">ssh SSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strace"><span class="toc-number">14.8.</span> <span class="toc-text">strace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calulate-CPU-usage"><span class="toc-number">14.9.</span> <span class="toc-text">calulate CPU usage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">14.10.</span> <span class="toc-text">ps</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#others-process-tool"><span class="toc-number">14.10.1.</span> <span class="toc-text">others process tool</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xattr"><span class="toc-number">14.11.</span> <span class="toc-text">xattr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#extended-file-attributes"><span class="toc-number">14.12.</span> <span class="toc-text">extended file attributes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SUID-SGID-and-sticky-bit"><span class="toc-number">14.13.</span> <span class="toc-text">SUID, SGID, and sticky bit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tc"><span class="toc-number">14.14.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CentOS-VNC"><span class="toc-number">14.15.</span> <span class="toc-text">CentOS VNC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#KVM-guest-VNC-config"><span class="toc-number">14.15.1.</span> <span class="toc-text">KVM guest VNC config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#screen"><span class="toc-number">14.16.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grub"><span class="toc-number">14.17.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcpdump"><span class="toc-number">14.18.</span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number">14.19.</span> <span class="toc-text">MTU problem check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yum"><span class="toc-number">14.20.</span> <span class="toc-text">yum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">14.21.</span> <span class="toc-text">upgrade kernel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#install-crash-7-3-0"><span class="toc-number">14.22.</span> <span class="toc-text">install crash-7.3.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-BBR"><span class="toc-number">14.23.</span> <span class="toc-text">Enable BBR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">14.24.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#test-under-ubuntu"><span class="toc-number">14.24.1.</span> <span class="toc-text">test under ubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#test-under-centos-7"><span class="toc-number">14.24.2.</span> <span class="toc-text">test under centos 7</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">14.25.</span> <span class="toc-text">rdesktop to win10</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">14.26.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">14.27.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lshw"><span class="toc-number">14.28.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMCLI-nmcli"><span class="toc-number">14.29.</span> <span class="toc-text">NMCLI nmcli</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Permission"><span class="toc-number">14.30.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route-config"><span class="toc-number">14.31.</span> <span class="toc-text">static route config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collectl"><span class="toc-number">14.32.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time"><span class="toc-number">14.33.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#youtube-download"><span class="toc-number">14.34.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">14.35.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scan-file-size"><span class="toc-number">14.36.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kernel-issue"><span class="toc-number">14.37.</span> <span class="toc-text">kernel issue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slowpath-and-fastpath"><span class="toc-number">14.38.</span> <span class="toc-text">slowpath and fastpath</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">14.39.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">14.40.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">14.41.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">14.42.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compile-process"><span class="toc-number">14.43.</span> <span class="toc-text">compile process</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">14.44.</span> <span class="toc-text">size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">14.45.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">14.46.</span> <span class="toc-text">gpart recovery partition table</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#boot-by-freebsd-livecd"><span class="toc-number">14.46.1.</span> <span class="toc-text">boot by freebsd livecd</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">14.47.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ffmpeg"><span class="toc-number">14.48.</span> <span class="toc-text">ffmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iptables"><span class="toc-number">14.49.</span> <span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fail2ban"><span class="toc-number">14.50.</span> <span class="toc-text">fail2ban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof"><span class="toc-number">14.51.</span> <span class="toc-text">lsof</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Process-accounting-on-Linux"><span class="toc-number">14.52.</span> <span class="toc-text">Process accounting on Linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git"><span class="toc-number">14.53.</span> <span class="toc-text">git</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#git-single-branch"><span class="toc-number">14.53.1.</span> <span class="toc-text">git single branch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#token"><span class="toc-number">14.53.2.</span> <span class="toc-text">token</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tick"><span class="toc-number">14.54.</span> <span class="toc-text">Tick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dynticks"><span class="toc-number">14.55.</span> <span class="toc-text">Dynticks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cpu-partitioning-%E2%80%93-after-reboot"><span class="toc-number">14.56.</span> <span class="toc-text">Cpu-partitioning – after reboot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blacklist-kernel-module"><span class="toc-number">14.57.</span> <span class="toc-text">blacklist kernel module</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iftop"><span class="toc-number">14.58.</span> <span class="toc-text">iftop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NMI"><span class="toc-number">14.59.</span> <span class="toc-text">NMI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dmidecode"><span class="toc-number">14.60.</span> <span class="toc-text">dmidecode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netstat-show-port"><span class="toc-number">14.61.</span> <span class="toc-text">netstat show port</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-to-got-the-info-from-the-pipe-fd-and-socke-fd"><span class="toc-number">14.62.</span> <span class="toc-text">How to got the info from the pipe fd and socke fd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#process-schdule"><span class="toc-number">14.63.</span> <span class="toc-text">process schdule</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-watchdog"><span class="toc-number">14.64.</span> <span class="toc-text">Linux watchdog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lockdep"><span class="toc-number">14.65.</span> <span class="toc-text">lockdep</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IO-Type"><span class="toc-number"></span> <span class="toc-text">IO Type</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tmp-file-clean"><span class="toc-number">0.1.</span> <span class="toc-text">tmp file clean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dkms"><span class="toc-number">0.2.</span> <span class="toc-text">dkms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#glibc"><span class="toc-number">0.3.</span> <span class="toc-text">glibc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setfacl"><span class="toc-number">0.4.</span> <span class="toc-text">setfacl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vmlinux-h-and-ebpf"><span class="toc-number">0.5.</span> <span class="toc-text">vmlinux.h and ebpf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sysctl-p-not-work-for-etc-sysctl-d"><span class="toc-number">0.6.</span> <span class="toc-text">sysctl -p not work for &#x2F;etc&#x2F;sysctl.d</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rpm-spec"><span class="toc-number">0.7.</span> <span class="toc-text">rpm spec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setcap-set-file-capabilities"><span class="toc-number">0.8.</span> <span class="toc-text">setcap - set file capabilities</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#windows"><span class="toc-number">0.9.</span> <span class="toc-text">windows</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tasklist-hang-desktop-hang-when-start-another-program"><span class="toc-number">0.9.1.</span> <span class="toc-text">tasklist hang, desktop hang when start another program</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#auto-start-vmware-player"><span class="toc-number">0.9.2.</span> <span class="toc-text">auto start vmware player</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#terminal"><span class="toc-number">0.9.3.</span> <span class="toc-text">terminal</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aws-command"><span class="toc-number">0.10.</span> <span class="toc-text">aws command</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rclone"><span class="toc-number">0.11.</span> <span class="toc-text">rclone</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#interrput-the-tcp-link"><span class="toc-number">0.12.</span> <span class="toc-text">interrput the tcp link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash-history-env"><span class="toc-number">0.13.</span> <span class="toc-text">bash history env</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-file-by-inode"><span class="toc-number">0.14.</span> <span class="toc-text">delete file by inode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#got-the-node-ip-addr"><span class="toc-number">0.15.</span> <span class="toc-text">got the node ip addr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#route-info"><span class="toc-number">0.16.</span> <span class="toc-text">route info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#java-parameters"><span class="toc-number">0.17.</span> <span class="toc-text">java parameters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ISO"><span class="toc-number">0.18.</span> <span class="toc-text">ISO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#intel-boot-agent-message"><span class="toc-number">0.19.</span> <span class="toc-text">intel boot agent message</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Draw-kernel-boot-dmesg-image"><span class="toc-number">1.</span> <span class="toc-text">Draw kernel boot dmesg image</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Highcharts"><span class="toc-number">1.1.</span> <span class="toc-text">Highcharts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#google-slide"><span class="toc-number">1.2.</span> <span class="toc-text">google slide</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#centos-7-auto-login"><span class="toc-number">1.3.</span> <span class="toc-text">centos 7 auto login</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#restart-udev"><span class="toc-number">1.4.</span> <span class="toc-text">restart udev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Terminal-setting"><span class="toc-number">1.5.</span> <span class="toc-text">Terminal setting</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#overlayer-test"><span class="toc-number">1.6.</span> <span class="toc-text">overlayer test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsync-mirrors"><span class="toc-number">1.7.</span> <span class="toc-text">rsync mirrors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-proxy"><span class="toc-number">1.8.</span> <span class="toc-text">http proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get-the-driver-support-info"><span class="toc-number">1.9.</span> <span class="toc-text">get the driver support info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-USB-Attached-Storage-UAS"><span class="toc-number">1.10.</span> <span class="toc-text">disable USB Attached Storage UAS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cgroup"><span class="toc-number">1.11.</span> <span class="toc-text">cgroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kvm-KVM"><span class="toc-number">1.12.</span> <span class="toc-text">kvm KVM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PCIE-pass-through"><span class="toc-number">1.12.1.</span> <span class="toc-text">PCIE pass through</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bind-dev"><span class="toc-number">1.12.2.</span> <span class="toc-text">bind dev</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Re-import-lvm-LVM"><span class="toc-number">2.</span> <span class="toc-text">Re-import lvm LVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hot-plugin-pci-device"><span class="toc-number">3.</span> <span class="toc-text">hot plugin pci device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-a-nspawn-container"><span class="toc-number">4.</span> <span class="toc-text">Creating a nspawn container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddrescue"><span class="toc-number">5.</span> <span class="toc-text">ddrescue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resume-breakpoint"><span class="toc-number">5.1.</span> <span class="toc-text">resume breakpoint</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KVM"><span class="toc-number">6.</span> <span class="toc-text">KVM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sanlock"><span class="toc-number">6.0.1.</span> <span class="toc-text">sanlock</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#clear-icetea-cache"><span class="toc-number">6.1.</span> <span class="toc-text">clear icetea cache</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OOM"><span class="toc-number">7.</span> <span class="toc-text">OOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#curl"><span class="toc-number">8.</span> <span class="toc-text">curl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fonts-fonts"><span class="toc-number">9.</span> <span class="toc-text">Fonts fonts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Argument-list-too-long"><span class="toc-number">10.</span> <span class="toc-text">Argument list too long</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-randomization-of-memory-addresses"><span class="toc-number">11.</span> <span class="toc-text">Disable randomization of memory addresses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-module-under-centos"><span class="toc-number">12.</span> <span class="toc-text">make module under centos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detect-port"><span class="toc-number">13.</span> <span class="toc-text">detect port</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dnf"><span class="toc-number">14.</span> <span class="toc-text">dnf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deploy-IBM-Spectrum-Scale-GPFS-client"><span class="toc-number">15.</span> <span class="toc-text">deploy IBM Spectrum Scale(GPFS) client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab"><span class="toc-number">16.</span> <span class="toc-text">gitlab</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#certificate-issue"><span class="toc-number">16.1.</span> <span class="toc-text">certificate issue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU"><span class="toc-number">17.</span> <span class="toc-text">GPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-1"><span class="toc-number">18.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-file"><span class="toc-number">19.</span> <span class="toc-text">copy file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM"><span class="toc-number">20.</span> <span class="toc-text">JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#APCI-power-status"><span class="toc-number">21.</span> <span class="toc-text">APCI power status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TIME-time"><span class="toc-number">22.</span> <span class="toc-text">TIME time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron"><span class="toc-number">23.</span> <span class="toc-text">cron</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#my-desktop"><span class="toc-number">24.</span> <span class="toc-text">my desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Google"><span class="toc-number">25.</span> <span class="toc-text">Google</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping-PING"><span class="toc-number">26.</span> <span class="toc-text">ping PING</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVM"><span class="toc-number">27.</span> <span class="toc-text">LVM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lvm-metadata-full"><span class="toc-number">27.1.</span> <span class="toc-text">lvm metadata full</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wipefs"><span class="toc-number">28.</span> <span class="toc-text">wipefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apache-httpda-list-dir-and-link"><span class="toc-number">29.</span> <span class="toc-text">apache httpda list dir and link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#centos-6-upgrade-to-almalinux-8"><span class="toc-number">30.</span> <span class="toc-text">centos 6 upgrade to almalinux 8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-el6-to-el7"><span class="toc-number">30.1.</span> <span class="toc-text">upgrade el6 to el7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgrade-to-el8"><span class="toc-number">30.2.</span> <span class="toc-text">upgrade to el8</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Centos-7-upgrade-glibc-2-31-and-install-lustre-2-15-4-client"><span class="toc-number">31.</span> <span class="toc-text">Centos 7 upgrade glibc 2.31 and install lustre 2.15.4 client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#disable-acpi-power-meter"><span class="toc-number">32.</span> <span class="toc-text">disable acpi_power_meter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logs-flooded-with-systemd-messages-Created-slice-Starting-Session"><span class="toc-number">33.</span> <span class="toc-text">Logs flooded with systemd messages: Created slice, Starting Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crypt-the-file"><span class="toc-number">34.</span> <span class="toc-text">crypt the file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jq-JQ"><span class="toc-number">35.</span> <span class="toc-text">jq JQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-spec"><span class="toc-number">36.</span> <span class="toc-text">Hardware spec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PAM-unable-to-dlopen-lib64-security-pam-fprintd-so"><span class="toc-number">37.</span> <span class="toc-text">PAM unable to dlopen &#x2F;lib64&#x2F;security&#x2F;pam_fprintd.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARM"><span class="toc-number">38.</span> <span class="toc-text">ARM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labtop-power-management"><span class="toc-number">39.</span> <span class="toc-text">labtop power management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Does-the-NIC-of-the-KVM-guest-support-the-promisc-mode"><span class="toc-number">40.</span> <span class="toc-text">Does the NIC of the KVM guest support the promisc mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#google-auth"><span class="toc-number">41.</span> <span class="toc-text">google auth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HEXDUMP-hexdump"><span class="toc-number">42.</span> <span class="toc-text">HEXDUMP hexdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multipass-test"><span class="toc-number">43.</span> <span class="toc-text">multipass test</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-usb-uas-function"><span class="toc-number">43.1.</span> <span class="toc-text">disable usb uas function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsiget-kernel-info"><span class="toc-number">43.2.</span> <span class="toc-text">lsiget kernel info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IPA"><span class="toc-number">43.3.</span> <span class="toc-text">IPA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker"><span class="toc-number">43.4.</span> <span class="toc-text">docker</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfusion"><span class="toc-number">44.</span> <span class="toc-text">xfusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#osq-lock"><span class="toc-number">45.</span> <span class="toc-text">osq_lock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">46.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#we-don%E2%80%99t-want-tcp-nids"><span class="toc-number"></span> <span class="toc-text">we don’t want tcp nids</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gnuplot"><span class="toc-number">0.1.</span> <span class="toc-text">gnuplot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ollama-download-model"><span class="toc-number">0.2.</span> <span class="toc-text">ollama download model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API-send-image-to-AI-server"><span class="toc-number">0.3.</span> <span class="toc-text">API send image to AI server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VPS-ping"><span class="toc-number">0.4.</span> <span class="toc-text">VPS ping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2024-renew-redhat"><span class="toc-number">0.5.</span> <span class="toc-text">2024 renew redhat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reference1"><span class="toc-number">0.6.</span> <span class="toc-text">reference1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reference2"><span class="toc-number">0.7.</span> <span class="toc-text">reference2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#terminal-record-video"><span class="toc-number">0.8.</span> <span class="toc-text">terminal record video</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/14/os/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/14/os/&text=OS"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/14/os/&is_video=false&description=OS"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OS&body=Check out this article: http://example.com/2022/11/14/os/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/14/os/&title=OS"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/14/os/&name=OS&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/14/os/&t=OS"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
