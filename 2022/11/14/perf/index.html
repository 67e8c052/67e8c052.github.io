<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="kernel support12345678910111213141516171819202122232425262728293031323334353637383940414243# for perf_events:CONFIG_PERF_EVENTS&#x3D;y# for stack traces:CONFIG_FRAME_POINTER&#x3D;y# kernel symbols:CONFIG_KALLSY">
<meta property="og:type" content="article">
<meta property="og:title" content="perf">
<meta property="og:url" content="http://example.com/2022/11/14/perf/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="kernel support12345678910111213141516171819202122232425262728293031323334353637383940414243# for perf_events:CONFIG_PERF_EVENTS&#x3D;y# for stack traces:CONFIG_FRAME_POINTER&#x3D;y# kernel symbols:CONFIG_KALLSY">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/perf_flamegraph.png">
<meta property="article:published_time" content="2022-11-14T01:27:36.000Z">
<meta property="article:modified_time" content="2023-03-12T05:34:48.594Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="perf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/perf_flamegraph.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>perf</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/11/14/os/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/14/bios/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/14/perf/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/14/perf/&text=perf"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/14/perf/&is_video=false&description=perf"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=perf&body=Check out this article: http://example.com/2022/11/14/perf/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/14/perf/&name=perf&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/14/perf/&t=perf"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#kernel-support"><span class="toc-number">1.</span> <span class="toc-text">kernel support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#perf-cmd"><span class="toc-number">2.</span> <span class="toc-text">perf cmd</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#trace-page-fault"><span class="toc-number">2.1.</span> <span class="toc-text">trace page fault</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-stat"><span class="toc-number">2.2.</span> <span class="toc-text">perf stat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-record"><span class="toc-number">2.3.</span> <span class="toc-text">perf record</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-annotate"><span class="toc-number">2.4.</span> <span class="toc-text">perf annotate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-report"><span class="toc-number">2.5.</span> <span class="toc-text">perf report</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-diff"><span class="toc-number">2.6.</span> <span class="toc-text">perf diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-list"><span class="toc-number">2.7.</span> <span class="toc-text">perf list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flamegraph"><span class="toc-number">2.8.</span> <span class="toc-text">flamegraph</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-sched-latency-will-summarize-scheduler-latencies-by-task-including-average-and-maximum-delay"><span class="toc-number">2.9.</span> <span class="toc-text">perf sched latency will summarize scheduler latencies by task, including average and maximum delay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-probe"><span class="toc-number">2.10.</span> <span class="toc-text">perf probe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-timechart"><span class="toc-number">2.11.</span> <span class="toc-text">perf timechart</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-bench"><span class="toc-number">2.12.</span> <span class="toc-text">perf bench</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-trace"><span class="toc-number">2.13.</span> <span class="toc-text">perf trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trace-user-space"><span class="toc-number">2.14.</span> <span class="toc-text">trace user space</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        perf
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-14T01:27:36.000Z" itemprop="datePublished">2022-11-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Debug/">Debug</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/debug/" rel="tag">debug</a>, <a class="tag-link-link" href="/tags/perf/" rel="tag">perf</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="kernel-support"><a href="#kernel-support" class="headerlink" title="kernel support"></a><a target="_blank" rel="noopener" href="https://www.brendangregg.com/perf.html">kernel support</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for perf_events:</span></span><br><span class="line">CONFIG_PERF_EVENTS=y</span><br><span class="line"><span class="comment"># for stack traces:</span></span><br><span class="line">CONFIG_FRAME_POINTER=y</span><br><span class="line"><span class="comment"># kernel symbols:</span></span><br><span class="line">CONFIG_KALLSYMS=y</span><br><span class="line"><span class="comment"># tracepoints:</span></span><br><span class="line">CONFIG_TRACEPOINTS=y</span><br><span class="line"><span class="comment"># kernel function trace:</span></span><br><span class="line">CONFIG_FTRACE=y</span><br><span class="line"><span class="comment"># kernel-level dynamic tracing:</span></span><br><span class="line">CONFIG_KPROBES=y</span><br><span class="line">CONFIG_KPROBE_EVENTS=y</span><br><span class="line"><span class="comment"># user-level dynamic tracing:</span></span><br><span class="line">CONFIG_UPROBES=y</span><br><span class="line">CONFIG_UPROBE_EVENTS=y</span><br><span class="line"><span class="comment"># full kernel debug info:</span></span><br><span class="line">CONFIG_DEBUG_INFO=y</span><br><span class="line"><span class="comment"># kernel lock tracing:</span></span><br><span class="line">CONFIG_LOCKDEP=y</span><br><span class="line"><span class="comment"># kernel lock tracing:</span></span><br><span class="line">CONFIG_LOCK_STAT=y</span><br><span class="line"><span class="comment"># kernel dynamic tracepoint variables:</span></span><br><span class="line">CONFIG_DEBUG_INFO=y</span><br><span class="line"></span><br><span class="line">Kernel-level symbols are <span class="keyword">in</span> the kernel debuginfo package, or when the kernel is compiled with CONFIG_KALLSYMS</span><br><span class="line">The kernel stack traces are incomplete. Now a similar profile with CONFIG_FRAME_POINTER=y, it will cause information incomplete</span><br><span class="line">For kernel analysis, using CONFIG_KPROBES=y and CONFIG_KPROBE_EVENTS=y, to <span class="built_in">enable</span> kernel dynamic tracing. and CONFIG_FRAME_POINTER=y, <span class="keyword">for</span> frame pointer-based kernel stacks</span><br><span class="line">For user-level analysis, CONFIG_UPROBES=y and CONFIG_UPROBE_EVENTS=y, <span class="keyword">for</span> user-level dynamic tracing.</span><br><span class="line">If your kernel has debuginfo (CONFIG_DEBUG_INFO=y), you can fish out kernel variables from <span class="built_in">functions</span>. This is a simple example of examining a size_t (<span class="built_in">integer</span>)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /boot/config-`<span class="built_in">uname</span> -r`</span><br><span class="line">or</span><br><span class="line">$ zcat /proc/config.gz</span><br><span class="line"></span><br><span class="line">$ dmesg -T | grep PMU</span><br><span class="line">[Wed Aug  5 17:34:29 2020] Performance Events: PEBS fmt3+, Skylake events, 32-deep LBR, full-width counters, Intel PMU driver.</span><br><span class="line">[Wed Aug  5 17:34:29 2020] NMI watchdog: Enabled. Permanently consumes one hw-PMU counter.</span><br><span class="line">[Wed Aug  5 17:34:35 2020] RAPL PMU: API unit is 2^-32 Joules, 2 fixed counters, 655360 ms ovfl timer</span><br><span class="line">[Wed Aug  5 17:34:35 2020] RAPL PMU: hw unit of domain package 2^-14 Joules</span><br><span class="line">[Wed Aug  5 17:34:35 2020] RAPL PMU: hw unit of domain dram 2^-16 Joules</span><br><span class="line"></span><br><span class="line">https://cdn.kernel.org/pub/linux/kernel/</span><br></pre></td></tr></table></figure>

<h3 id="perf-cmd"><a href="#perf-cmd" class="headerlink" title="perf cmd"></a><a target="_blank" rel="noopener" href="https://www.phytium.com.cn/Site/theme/Uploads/20200601/%E9%A3%9E%E8%85%BE%E5%B9%B3%E5%8F%B0perf%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7.pdf">perf cmd</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/perf_event_mlock_kb</span><br><span class="line">$ perf top -g</span><br><span class="line"></span><br><span class="line"><span class="comment">## basic three step</span></span><br><span class="line">$ perf top</span><br><span class="line">$ perf top --<span class="built_in">sort</span> <span class="built_in">comm</span>,dso <span class="comment">#show the which process</span></span><br><span class="line">$ perf top -g</span><br><span class="line"></span><br><span class="line">$ perf top -ns overhead,<span class="built_in">comm</span>,dso,symbol,parent,cpu</span><br><span class="line">$ perf top -ag</span><br><span class="line"><span class="comment"># input ? for help ,&quot;e&quot; expand single &quot;E&quot; is all, &quot;c&quot; take it back, &quot;C&quot; is all</span></span><br><span class="line"></span><br><span class="line">events could get from /sys/kernel/debug/tracing/available_events</span><br><span class="line">$ perf top -e branch-misses,cycles,<span class="built_in">sched</span>:sched_switch</span><br><span class="line">$ perf top -e <span class="string">&#x27;&#123;branch-misses,cycles&#125;:u&#x27;</span></span><br><span class="line">$ perf top -e <span class="string">&#x27;cycles&#x27;</span> -s <span class="built_in">comm</span>,dso,sym</span><br><span class="line"></span><br><span class="line">$ perf list</span><br><span class="line">$ perf list hw</span><br><span class="line">$ perf list pmu</span><br><span class="line">$ perf list cache --detail</span><br><span class="line">$ perf top -c 1 <span class="comment"># Event period to sample</span></span><br><span class="line">$ perf top -C 0 <span class="comment"># CPU core</span></span><br><span class="line">$ perf top -d 5 <span class="comment"># interval 5 secs</span></span><br><span class="line">$ perf top -K <span class="comment">#hide_kernel_symbols</span></span><br><span class="line">$ perf top -U <span class="comment">#hide_user_symbols</span></span><br><span class="line">$ perf top -v <span class="comment"># show more</span></span><br><span class="line">$ perf top --fields period,sample</span><br><span class="line">$ perf top --max-stack 64</span><br><span class="line">$ perf top --hierarchy</span><br></pre></td></tr></table></figure>


<h4 id="trace-page-fault"><a href="#trace-page-fault" class="headerlink" title="trace page fault"></a><a target="_blank" rel="noopener" href="http://www.brendangregg.com/FlameGraphs/memoryflamegraphs.html">trace page fault</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ perf record -e page-fault -a -g -- <span class="built_in">sleep</span> 30</span><br><span class="line">$ perf script &gt; out.stacks</span><br><span class="line">$ ./stackcollapse-perf.pl &lt; out.stacks | ./flamegraph.pl --color=mem \</span><br><span class="line">    --title=<span class="string">&quot;Page Fault Flame Graph&quot;</span> --countname=<span class="string">&quot;pages&quot;</span> &gt; out.svg</span><br><span class="line"></span><br><span class="line">$ /usr/share/bcc/tools/stackcount <span class="string">&#x27;t:exceptions:page_fault_*&#x27;</span> &gt; out.stacks</span><br><span class="line">$ ./stackcollapse.pl &lt; out.stacks | ./flamegraph.pl --color=mem \</span><br><span class="line">    --title=<span class="string">&quot;Page Fault Flame Graph&quot;</span> --countname=<span class="string">&quot;pages&quot;</span> &gt; out.svg</span><br></pre></td></tr></table></figure>

<h4 id="perf-stat"><a href="#perf-stat" class="headerlink" title="perf stat"></a>perf stat</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">ask-clock：任务真正占用的处理器时间，单位为 ms。CPU utilized=task-clock/time elapsed。</span><br><span class="line">context-switches：程序在运行过程中上下文的切换次数。</span><br><span class="line">cpu-migrations：程序在运行过程中发生的处理器迁移次数，Linux 为了维持多个处理器的负载均衡，在</span><br><span class="line">特定条件下会将某个任务从一个 CPU 迁移到另一个 CPU。</span><br><span class="line">page-faults：缺页异常的次数。</span><br><span class="line">cycles：消耗的处理器周期数，处理器的主频可以用 cycles/task-clock 算出。</span><br><span class="line">instructions：执行了多少条指令。IPC 为平均每个 cpu cycles 执行了多少条指令。</span><br><span class="line">branches：遇到的分支指令数，目前不支持。</span><br><span class="line">branch-misses：预测错误的分支指令数。</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -a -e task-clock,cycles,instructions,branches,branch-misses -e stalled-cycles-frontend,stalled-cycles-backend -e cache-references,cache-misses -e LLC-loads,LLC-load-misses,LLC-stores,LLC-store-misses -e L1-dcache-loads,L1-dcache-load-misses,L1-dcache-stores,L1-dcache-store-misses -p <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e <span class="string">&#x27;sched:sched_process_*&#x27;</span> -a <span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;system wide&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                20      <span class="built_in">sched</span>:sched_process_free                     [100.00%]</span><br><span class="line">                21      <span class="built_in">sched</span>:sched_process_exit                     [100.00%]</span><br><span class="line">                37      <span class="built_in">sched</span>:sched_process_wait                     [100.00%]</span><br><span class="line">                20      <span class="built_in">sched</span>:sched_process_fork                     [100.00%]</span><br><span class="line">                41      <span class="built_in">sched</span>:sched_process_exec                     [100.00%]</span><br><span class="line">                 0      <span class="built_in">sched</span>:sched_process_hang</span><br><span class="line"></span><br><span class="line">       5.001391328 seconds time elapsed</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e <span class="string">&#x27;syscalls:sys_enter_*&#x27;</span> -a <span class="built_in">sleep</span> 5 | awk <span class="string">&#x27;$1&#x27;</span></span><br><span class="line"><span class="comment"># started on Wed Jul  2 23:39:50 2014</span></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;system wide&#x27;</span>:</span><br><span class="line">                60      syscalls:sys_enter_socket                    [99.95%]</span><br><span class="line">                68      syscalls:sys_enter_connect                    [99.95%]</span><br><span class="line">               148      syscalls:sys_enter_epoll_wait                    [99.97%]</span><br><span class="line">                 8      syscalls:sys_enter_statfs                    [99.97%]</span><br><span class="line">                18      syscalls:sys_enter_dup2                      [99.98%]</span><br><span class="line">                18      syscalls:sys_enter_getcwd                    [99.98%]</span><br><span class="line">               155      syscalls:sys_enter_select                    [99.98%]</span><br><span class="line">               226      syscalls:sys_enter_poll                      [99.98%]</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -I 1000 -e <span class="built_in">sched</span>:sched_switch -a <span class="built_in">sleep</span> 5</span><br><span class="line"><span class="comment">#           time             counts unit events</span></span><br><span class="line">     1.000205453                314      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">     2.000456051                290      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">     3.000644420                322      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">     4.000836009                305      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">     5.001022382                198      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">     5.001442140                  7      <span class="built_in">sched</span>:sched_switch</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -A -e <span class="built_in">sched</span>:sched_switch -a <span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;system wide&#x27;</span>:</span><br><span class="line"></span><br><span class="line">CPU0                   495      <span class="built_in">sched</span>:sched_switch</span><br><span class="line">CPU1                   632      <span class="built_in">sched</span>:sched_switch</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e syscalls:sys_enter_read --filter <span class="string">&#x27;count &gt; 4096&#x27;</span> -a <span class="built_in">sleep</span> 5</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;system wide&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                 1      syscalls:sys_enter_read</span><br><span class="line"></span><br><span class="line">       5.001407932 seconds time elapsed</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /sys/kernel/debug/tracing/events/syscalls/sys_enter_read/format</span><br><span class="line">name: sys_enter_read</span><br><span class="line">ID: 509</span><br><span class="line">format:</span><br><span class="line">    field:unsigned short common_type;   offset:0;   size:2; signed:0;</span><br><span class="line">    field:unsigned char common_flags;   offset:2;   size:1; signed:0;</span><br><span class="line">    field:unsigned char common_preempt_count;   offset:3;   size:1; signed:0;</span><br><span class="line">    field:int common_pid;   offset:4;   size:4; signed:1;</span><br><span class="line"></span><br><span class="line">    field:int nr;   offset:8;   size:4; signed:1;</span><br><span class="line">    field:unsigned int fd;  offset:16;  size:8; signed:0;</span><br><span class="line">    field:char * buf;   offset:24;  size:8; signed:0;</span><br><span class="line">    field:size_t count; offset:32;  size:8; signed:0;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">fmt</span>: <span class="string">&quot;fd: 0x%08lx, buf: 0x%08lx, count: 0x%08lx&quot;</span>, ((unsigned long)(REC-&gt;fd)), ((unsigned long)(REC-&gt;buf)), ((unsigned long)(REC-&gt;count))</span><br><span class="line"><span class="comment"># CPU counter statistics for the specified PID, until Ctrl-C:</span></span><br><span class="line">perf <span class="built_in">stat</span> -p PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU counter statistics for the entire system, for 5 seconds:</span></span><br><span class="line">perf <span class="built_in">stat</span> -a <span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># Various basic CPU statistics, system wide, for 10 seconds:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e cycles,instructions,cache-references,cache-misses,bus-cycles -a <span class="built_in">sleep</span> 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># Various CPU level 1 data cache statistics for the specified command:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e L1-dcache-loads,L1-dcache-load-misses,L1-dcache-stores <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Various CPU data TLB statistics for the specified command:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e dTLB-loads,dTLB-load-misses,dTLB-prefetch-misses <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Various CPU last level cache statistics for the specified command:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e LLC-loads,LLC-load-misses,LLC-stores,LLC-prefetches <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using raw PMC counters, eg, counting unhalted core cycles:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e r003c -a <span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># PMCs: counting cycles and frontend stalls via raw specification:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e cycles -e cpu/event=0x0e,<span class="built_in">umask</span>=0x01,inv,cmask=0x01/ -a <span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># Count syscalls per-second system-wide:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e raw_syscalls:sys_enter -I 1000 -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Count system calls by type for the specified PID, until Ctrl-C:</span></span><br><span class="line">perf <span class="built_in">stat</span> -e <span class="string">&#x27;syscalls:sys_enter_*&#x27;</span> -p PID</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e <span class="string">&#x27;block:*&#x27;</span> -a <span class="built_in">sleep</span> 10</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;system wide&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                 0      block:block_touch_buffer</span><br><span class="line">             6,925      block:block_dirty_buffer</span><br><span class="line">                 0      block:block_rq_abort</span><br><span class="line">                 0      block:block_rq_requeue</span><br><span class="line">             1,585      block:block_rq_complete</span><br><span class="line">             1,539      block:block_rq_insert</span><br><span class="line">             1,541      block:block_rq_issue</span><br><span class="line">                 0      block:block_bio_bounce</span><br><span class="line">                 0      block:block_bio_complete</span><br><span class="line">                 0      block:block_bio_backmerge</span><br><span class="line">                 0      block:block_bio_frontmerge</span><br><span class="line">             1,539      block:block_bio_queue</span><br><span class="line">             1,539      block:block_getrq</span><br><span class="line">                 0      block:block_sleeprq</span><br><span class="line">             1,495      block:block_plug</span><br><span class="line">             1,495      block:block_unplug</span><br><span class="line">                 0      block:block_split</span><br><span class="line">             1,497      block:block_bio_remap</span><br><span class="line">                 0      block:block_rq_remap</span><br><span class="line"></span><br><span class="line">      10.016486367 seconds time elapsed</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e <span class="string">&#x27;syscalls:sys_enter_*&#x27;</span> -p 101559</span><br><span class="line"></span><br><span class="line">                 0      syscalls:sys_enter_pselect6                                     (99.37%)</span><br><span class="line">                16      syscalls:sys_enter_poll                                       (99.33%)</span><br><span class="line">               100      syscalls:sys_enter_ppoll                                      (99.33%)</span><br><span class="line">                 0      syscalls:sys_enter_getdents                                     (99.33%)</span><br><span class="line">                 0      syscalls:sys_enter_getdents64                                     (99.33%)</span><br><span class="line">                63      syscalls:sys_enter_ioctl                                      (99.33%)</span><br><span class="line">                 0      syscalls:sys_enter_fcntl                                      (99.33%)</span><br><span class="line">                 0      syscalls:sys_enter_mknodat                                     (99.33%)</span><br><span class="line">                 0      syscalls:sys_enter_mknod                                      (99.29%)</span><br><span class="line">                 0      syscalls:sys_enter_mkdirat                                     (99.29%)</span><br><span class="line">                 0      syscalls:sys_enter_mkdir                                      (99.29%)</span><br><span class="line">                 0      syscalls:sys_enter_rmdir                                      (99.29%)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>u - user-space counting</li>
<li>k - kernel counting</li>
<li>h - hypervisor counting</li>
<li>I - non idle counting</li>
<li>G - guest counting (in KVM guests)</li>
<li>H - host counting (not in KVM guests)</li>
<li>p - precise level</li>
<li>P - use maximum detected precise level</li>
<li>S - read sample value (PERF_SAMPLE_READ)</li>
<li>D - pin the event to the PMU</li>
<li>W - group is weak and will fallback to non-group if not schedulable<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> -e instructions:H <span class="built_in">ls</span> -l</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;ls -l&#x27;</span>:</span><br><span class="line"></span><br><span class="line">         7,361,491      instructions:H</span><br><span class="line"></span><br><span class="line">       0.003494865 seconds time elapsed</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> <span class="built_in">ls</span> -l</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;ls -l&#x27;</span>:</span><br><span class="line"></span><br><span class="line">          3.051715      task-clock (msec)         <span class="comment">#    0.892 CPUs utilized</span></span><br><span class="line">                 1      context-switches          <span class="comment">#    0.328 K/sec</span></span><br><span class="line">                 0      cpu-migrations            <span class="comment">#    0.000 K/sec</span></span><br><span class="line">               412      page-faults               <span class="comment">#    0.135 M/sec</span></span><br><span class="line">         7,312,574      cycles                    <span class="comment">#    2.396 GHz</span></span><br><span class="line">         7,110,578      instructions              <span class="comment">#    0.97  insn per cycle</span></span><br><span class="line">         1,439,981      branches                  <span class="comment">#  471.860 M/sec</span></span><br><span class="line">            35,532      branch-misses             <span class="comment">#    2.47% of all branches</span></span><br><span class="line"></span><br><span class="line">       0.003421608 seconds time elapsed</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="perf-record"><a href="#perf-record" class="headerlink" title="perf record"></a>perf record</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">## user space</span><br><span class="line">$ perf record ./a.out</span><br><span class="line">$ perf annotate -s main</span><br><span class="line">#This command reads the input file and displays an annotated version of the code. If the object file has debug symbols then the source code will be displayed alongside assembly code.</span><br><span class="line">#If there is no debug info in the object, then annotated assembly is displayed.  </span><br><span class="line">#Since about the 3.9 kernel, perf_events has supported a workaround for missing frame pointers in user-level stacks: libunwind, which uses dwarf. </span><br><span class="line">#This can be enabled using &quot;-g dwarf&quot;</span><br><span class="line">#-fno-omit-frame-pointer for software</span><br><span class="line">#CONFIG_FRAME_POINTER=y</span><br><span class="line"></span><br><span class="line"># -g: 进行堆栈追踪，生成调用关系图，等价于-call-graph， 默认情况下，-g等同于-call-graph fp，即通过frame pointer来进行堆栈追踪。 如果frame pointer被优化掉的话，可以通过dwarf, lbr进行堆栈追踪</span><br><span class="line"></span><br><span class="line">$ perf record -a perf bench sched messaging -g 400 -p &amp;&amp; perf report</span><br><span class="line"></span><br><span class="line">#-F 888 Hertz was chosen instead of 100 to avoid lockstep sampling with other software routines</span><br><span class="line">#Since about the 3.9 kernel, perf_events has supported a workaround for missing frame pointers in user-level stacks: libunwind, which uses dwarf. This can be enabled using &quot;--call-graph dwarf&quot; (or &quot;-g dwarf&quot;)</span><br><span class="line">$ perf record -a -g --call-graph dwarf,8192 -F 888 sleep 60</span><br><span class="line">$ perf record -a -g --call-graph dwarf,8192 -F 888 -o your-perf.data sleep 60</span><br><span class="line"># some timer interrput was 1000ms, some guy suggest change the default frequency</span><br><span class="line"></span><br><span class="line">$ perf record -e context-switches -ag -- sleep 10</span><br><span class="line">$ perf record -e &#x27;cycles&#x27; -g -- collectl -i3 -scdnt</span><br><span class="line"></span><br><span class="line">-e, --event &lt;event&gt;   event selector. use &#x27;perf list&#x27; to list available events</span><br><span class="line">-g                    enables call-graph recording</span><br><span class="line"></span><br><span class="line"># Trace all block device issues and completions (has timestamps), until Ctrl-C:</span><br><span class="line">perf record -e block:block_rq_issue -e block:block_rq_complete -a</span><br><span class="line"></span><br><span class="line"># Trace all block completions, of size at least 100 Kbytes, until Ctrl-C:</span><br><span class="line">perf record -e block:block_rq_complete --filter &#x27;nr_sector &gt; 200&#x27;</span><br><span class="line">perf record -e block:block_rq_complete --filter &#x27;nr_sector &gt; 200&#x27; -- sleep 10</span><br><span class="line"></span><br><span class="line"># Trace all block completions, synchronous writes only, until Ctrl-C:</span><br><span class="line">perf record -e block:block_rq_complete --filter &#x27;rwbs == &quot;WS&quot;&#x27;</span><br><span class="line"></span><br><span class="line"># Trace all block completions, all types of writes, until Ctrl-C:</span><br><span class="line">perf record -e block:block_rq_complete --filter &#x27;rwbs ~ &quot;*W*&quot;&#x27;</span><br><span class="line"></span><br><span class="line"># Trace all ext4 calls, and write to a non-ext4 location, until Ctrl-C:</span><br><span class="line">perf record -e &#x27;ext4:*&#x27; -o /tmp/perf.data -ag</span><br><span class="line"></span><br><span class="line"># perf c2c</span><br><span class="line">$ perf c2c record</span><br><span class="line">$ perf c2c report</span><br><span class="line">Shared Data Cache Line Table     (12 entries, sorted on Total HITMs)</span><br><span class="line">       ----------- Cacheline ----------      Tot  ------- Load Hitm -------    Total    Total    Total  ---- Stores ----  ----- Core Load Hit -----  - LLC Load Hit --  - RMT</span><br><span class="line">Index             Address  Node  PA cnt     Hitm    Total  LclHitm  RmtHitm  records    Loads   Stores    L1Hit   L1Miss       FB       L1       L2    LclHit  LclHitm    Rmt</span><br><span class="line">    0  0xffffffff8329f000     0       1   70.15%       94       94        0      150      141        9        5        4        0        0        4        43       94      ▒</span><br><span class="line">    1  0xffffffff83d40640     0      77    7.46%       10       10        0      262      164       98       98        0        0      144        0        10       10      ▒</span><br><span class="line">    2  0xffffffff833e3100     0     134    6.72%        9        9        0      204      202        2        0        2      108       45        0        40        9      ▒</span><br><span class="line">    3  0xffffffff833e4540     0       3    5.22%        7        7        0       43       42        1        0        1        6       11        0        16        7      ◆</span><br><span class="line">    4  0xffffffff82a06000     0       1    2.99%        4        4        0       57       54        3        2        1       33        0        0        17        4      ▒</span><br><span class="line">    5  0xffff895ecf991080     0       1    1.49%        2        2        0        2        2        0        0        0        0        0        0         0        2      ▒</span><br><span class="line">    6  0xffff895ecf992880     0       1    1.49%        2        2        0        2        2        0        0        0        0        0        0         0        2      ▒</span><br><span class="line">    7  0xffff895f2fce9f40     0       8    1.49%        2        2        0       12       11        1        1        0        6        0        0         1        2      ▒</span><br><span class="line">    8  0xffff895d36a025c0     0       1    0.75%        1        1        0        1        1        0        0        0        0        0        0         0        1      ▒</span><br><span class="line">    9  0xffff895f2fc1d000     0      66    0.75%        1        1        0       95       86        9        9        0       62        4        0        19        1      ▒</span><br><span class="line">   10  0xffff895f2fca9ec0     0       3    0.75%        1        1        0       15       14        1        1        0        0       13        0         0        1      ▒</span><br><span class="line">   11          0x2cd04400     0       1    0.75%        1        1        0        1        1        0        0        0        0        0        0         0        1</span><br><span class="line"></span><br><span class="line">$ perf mem record -- --sample-cpu foo_exe</span><br><span class="line">$ perf mem report -F mem,cpu,dcacheline,snoop,symbol -s dcacheline --stdio</span><br></pre></td></tr></table></figure>

<h4 id="perf-annotate"><a href="#perf-annotate" class="headerlink" title="perf annotate"></a>perf annotate</h4><p>Read perf.data (created by perf record) and display annotated code  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ perf annotate -s intel_idle</span><br><span class="line">$ perf annotate -k /tmp/vmlinux -d symbol</span><br><span class="line">$ perf record ./noploop 5</span><br><span class="line">$ perf annotate -d ./noploop</span><br></pre></td></tr></table></figure>

<h4 id="perf-report"><a href="#perf-report" class="headerlink" title="perf report"></a>perf report</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">$ perf probe -m <span class="variable">$kernel_module</span> -V <span class="variable">$call</span></span><br><span class="line">$ perf report -g -S do_mem_abor</span><br><span class="line">$ perf probe -a <span class="string">&#x27;sk_filter_trim_cap%return return=$retval:s32&#x27;</span></span><br><span class="line"></span><br><span class="line">$ perf probe -a <span class="string">&#x27;sk_filter_trim_cap%return return=$retval:s32&#x27;</span></span><br><span class="line">$ perf record -e probe:sk_filter_trim_cap -agR --filter <span class="string">&#x27;return &lt; 0&#x27;</span> <span class="built_in">sleep</span> 10</span><br><span class="line">$ perf report</span><br><span class="line">     Samples: 692  of event <span class="string">&#x27;probe:sk_filter_trim_cap&#x27;</span>, Event count (approx.): 692</span><br><span class="line">       Children      Self  Trace output</span><br><span class="line">     +  100.00%   100.00%  (ffffffff8a0551c0 &lt;- ffffffff8a0a735c) <span class="built_in">return</span>=-12</span><br><span class="line"></span><br><span class="line">$ perf report -g --tui</span><br><span class="line"></span><br><span class="line">$ perf report</span><br><span class="line"></span><br><span class="line">Annotate trace_graph_entry                                                                                                                    ◆</span><br><span class="line">Zoom into the Kernel DSO                                                                                                                      ▒</span><br><span class="line">Browse mperfap details                                                                                                                            ▒</span><br><span class="line">Run scripts <span class="keyword">for</span> samples of symbol [trace_graph_entry]                                                                                         ▒</span><br><span class="line">Run scripts <span class="keyword">for</span> all samples                                                                                                                   ▒</span><br><span class="line">Switch to another data file <span class="keyword">in</span> PWD                                                                                                            ▒</span><br><span class="line">Exit</span><br><span class="line"></span><br><span class="line"><span class="comment">#Select Annotate trace_graph_entry</span></span><br><span class="line">  0.77 │       add    -0x7aecaba0(,%rax,8),%rbx</span><br><span class="line">  0.49 │       mov    <span class="variable">$0x1</span>,%eax</span><br><span class="line">       │       lock   xadd   %eax,0x18(%rbx)</span><br><span class="line"> 19.76 │       <span class="built_in">test</span>   %eax,%eax</span><br><span class="line">       │     ↓ jne    1b9</span><br><span class="line">       │       mov    %gs:0x10e78,%rax</span><br><span class="line">  0.84 │       mov    -0x3fbc(%rax),%ecx</span><br><span class="line">       │       mov    %r12,%rdx</span><br><span class="line">       │       mov    %rdi,%rsi</span><br><span class="line">       │       mov    %r8,%rdi</span><br><span class="line">  0.63 │     → callq  __trace_graph_entry</span><br><span class="line">       │       mov    %eax,%edx</span><br><span class="line">  0.70 │ b4:   lock   decl   0x18(%rbx)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ perf record -e <span class="built_in">sched</span>:* -a <span class="comment"># not add -g</span></span><br><span class="line">$ perf report -n --stdio -s <span class="built_in">comm</span>,dso,symbol</span><br><span class="line"><span class="comment"># Overhead       Samples  Command          Shared Object      Symbol</span></span><br><span class="line"><span class="comment"># ........  ............  ...............  .................  ..................</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">    66.85%         18167  swapper          [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line">     8.96%          2434  systemd-journal  [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line">     3.84%          1043  vhost-127249     [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line">     3.59%           976  vhost-100221     [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line">     3.49%           949  vhost-102705     [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line">     3.37%           917  vhost-100880     [kernel.kallsyms]  [k] ttwu_do_wakeup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Report, with stacks in folded format: one line per stack (needs 4.4):</span></span><br><span class="line">$ perf report --stdio -n -g folded</span><br><span class="line">$ perf report --stdio  <span class="comment">## record add -g</span></span><br><span class="line"><span class="comment"># Children      Self       Samples  Command</span></span><br><span class="line"><span class="comment"># ........  ........  ............  ...............</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">    64.39%    64.39%          1013  swapper</span><br><span class="line">            |</span><br><span class="line">             --64.39%--start_cpu</span><br><span class="line">                       |</span><br><span class="line">                        --64.39%--start_secondary</span><br><span class="line">                                  |</span><br><span class="line">                                   --64.39%--cpu_startup_entry</span><br><span class="line">                                             |</span><br><span class="line">                                              --64.39%--arch_cpu_idle</span><br><span class="line">                                                        cpuidle_idle_call</span><br><span class="line">                                                        |</span><br><span class="line">                                                        |--51.81%--cpuidle_enter_state</span><br><span class="line">                                                        |          |</span><br><span class="line">                                                        |          |--29.16%--poll_idle</span><br><span class="line">                                                        |          |</span><br><span class="line">                                                        |           --22.65%--intel_idle</span><br><span class="line">                                                        |</span><br><span class="line">                                                         --12.58%--ret_from_intr</span><br><span class="line">                                                                   __irqentry_text_start</span><br><span class="line">                                                                   |</span><br><span class="line">                                                                    --12.58%--irq_exit</span><br><span class="line">                                                                              do_softirq</span><br><span class="line">                                                                              call_softirq</span><br><span class="line">                                                                              __do_softirq</span><br><span class="line">                                                                              |</span><br><span class="line">                                                                               --12.58%--net_rx_action</span><br><span class="line">                                                                                         bnx2x_poll</span><br><span class="line">                                                                                         bnx2x_rx_int</span><br><span class="line">                                                                                         napi_gro_receive</span><br><span class="line">                                                                                         netif_receive_skb_internal</span><br><span class="line">                                                                                         __netif_receive_skb</span><br><span class="line">                                                                                         __netif_receive_skb_core</span><br><span class="line">                                                                                         br_handle_frame</span><br><span class="line">                                                                                         br_handle_frame_finish</span><br><span class="line">                                                                                         br_flood</span><br><span class="line">                                                                                         deliver_clone</span><br><span class="line">                                                                                         __br_forward</span><br><span class="line">                                                                                         br_forward_finish</span><br><span class="line">                                                                                         br_dev_queue_push_xmit</span><br><span class="line">                                                                                         dev_queue_xmit</span><br><span class="line">                                                                                         __dev_queue_xmit</span><br><span class="line">                                                                                         __qdisc_run</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ perf record -F 990 -a --call-graph lbr</span><br><span class="line">$ perf script</span><br><span class="line"></span><br><span class="line">$ perf record -e block:block_bio_complete -e block:block_bio_remap -ag <span class="built_in">sleep</span> 20</span><br><span class="line">$ perf script</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all perf.data events, with my recommended fields (needs record -a; newer kernels):</span></span><br><span class="line">$ perf script --header -F <span class="built_in">comm</span>,pid,tid,cpu,time,event,ip,sym,dso </span><br><span class="line"></span><br><span class="line"><span class="comment"># Dump raw contents from perf.data as hex (for debugging):</span></span><br><span class="line">$ perf script -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disassemble and annotate instructions with percentages (needs some debuginfo):</span></span><br><span class="line">$ perf annotate --stdio</span><br></pre></td></tr></table></figure>

<h4 id="perf-diff"><a href="#perf-diff" class="headerlink" title="perf diff"></a>perf diff</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ perf diff perf.data perf.data.old</span><br><span class="line"><span class="comment"># Event &#x27;cycles:ppp&#x27;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Baseline  Delta Abs  Shared Object              Symbol</span></span><br><span class="line"><span class="comment"># ........  .........  .........................  .....................................................</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">    50.00%    -50.00%  [kernel.kallsyms]          [k] prepare_ftrace_return</span><br><span class="line">    25.00%    +44.80%  [kernel.kallsyms]          [k] intel_idle</span><br><span class="line">    25.00%    -25.00%  [kernel.kallsyms]          [k] vcpu_enter_guest</span><br><span class="line">     0.00%    +23.45%  [kernel.kallsyms]          [k] trace_graph_entry</span><br><span class="line">     0.00%     +4.69%  [kernel.kallsyms]          [k] avl_find</span><br><span class="line">     0.00%     +2.05%  [kernel.kallsyms]          [k] poll_idle</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] ftrace_graph_caller</span><br><span class="line">     0.00%     +0.00%  systemd-journald           [.] 0x000000000000d1e0</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] __trace_graph_entry</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] trace_buffer_lock_reserve</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] ftrace_caller</span><br><span class="line">     0.00%     +0.00%  libsystemd.so.0.6.0        [.] 0x0000000000005b5f</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] ring_buffer_lock_reserve</span><br><span class="line">     0.00%     -0.00%  [kernel.kallsyms]          [k] console_unlock</span><br><span class="line">     0.00%     -0.00%  [kernel.kallsyms]          [k] native_queued_spin_lock_slowpath</span><br><span class="line">     0.00%     -0.00%  [kernel.kallsyms]          [k] osq_lock</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] ftrace_graph_is_dead</span><br><span class="line">     0.00%     +0.00%  [kernel.kallsyms]          [k] ftrace_stub</span><br></pre></td></tr></table></figure>

<h4 id="perf-list"><a href="#perf-list" class="headerlink" title="perf list"></a>perf list</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ perf list subsys block:*</span><br><span class="line">$ perf list | awk -F: <span class="string">&#x27;/Tracepoint event/ &#123; lib[$1]++; PROCINFO[&quot;sorted_in&quot;] = &quot;@val_num_desc&quot; &#125; END &#123;  for (l in lib) &#123; printf &quot;  %-16.16s %d\n&quot;, l, lib[l] &#125; &#125;&#x27;</span> | column</span><br><span class="line">    syscalls       604      kmem           12       context_tracki 2</span><br><span class="line">    xfs            391      net            9        gpio           2</span><br><span class="line">    nfs4           66       i2c            8        migrate        2</span><br><span class="line">    kvm            55       dma_fence      8        sock           2</span><br><span class="line">    nfs            44       iommu          7        task           2</span><br><span class="line">    xen            35       libata         6        raw_syscalls   2</span><br><span class="line">    sunrpc         31       filelock       6        pagemap        2</span><br><span class="line">    writeback      25       scsi           5        signal         2</span><br><span class="line">    <span class="built_in">sched</span>          23       mpx            5        filemap        2</span><br><span class="line">    irq_vectors    22       irq            5        qdisc          1</span><br><span class="line">    xhci-hcd       20       module         5        mce            1</span><br><span class="line">    power          20       rpm            4        intel_ish      1</span><br><span class="line">    block          19       mei            4        hyperv         1</span><br><span class="line">    nfsd           18       bridge         4        vsyscall       1</span><br><span class="line">    regmap         15       workqueue      4        rcu            1</span><br><span class="line">    random         15       drm            3        printk         1</span><br><span class="line">    vmscan         15       ras            3        udp            1</span><br><span class="line">    fs_dax         15       skb            3        napi           1</span><br><span class="line">    kvmmmu         14       compaction     3        ftrace         1</span><br><span class="line">    timer          13       exceptions     2        oom            1</span><br></pre></td></tr></table></figure>

<h4 id="flamegraph"><a href="#flamegraph" class="headerlink" title="flamegraph"></a><a target="_blank" rel="noopener" href="https://billtian.github.io/digoal.blog/2016/11/27/01.html">flamegraph</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/brendangregg/FlameGraph  # or download it from github</span><br><span class="line">$ cd FlameGraph</span><br><span class="line">$ perf record -F 99 -ag -- sleep 60</span><br><span class="line">$ perf script | ./stackcollapse-perf.pl --color=mem &gt; out.perf-folded</span><br><span class="line"></span><br><span class="line">$ cat out.perf-folded | ./flamegraph.pl &gt; perf-kernel.svg</span><br><span class="line">or</span><br><span class="line">$ grep -v cpu_idle out.perf-folded | ./flamegraph.pl &gt; nonidle.svg</span><br><span class="line">$ grep nfs out.perf-folded | ./flamegraph.pl &gt; nfsinternals.svg</span><br><span class="line">or</span><br><span class="line">$ grep -v cpu_idle out.perf-folded | ./flamegraph.pl &gt; nonidle.svg</span><br><span class="line">$ egrep &#x27;system_call.*sys_(read|write)&#x27; out.perf-folded | ./flamegraph.pl &gt; rw.svg</span><br><span class="line">--------- or</span><br><span class="line">$ perf record -agv sleep 30</span><br><span class="line">$ mv perf.data FlameGraph/</span><br><span class="line">$ perf script | ./stackcollapse-perf.pl &gt; out.perf-folded</span><br><span class="line">$ cat out.perf-folded | ./flamegraph.pl &gt; perf-kernel.svg</span><br></pre></td></tr></table></figure>
<p>y-axis process stack, each layer is the function, the higher means the more system stack, top is the function, the parent function under the function.<br>x-axis the calls count, the larger width(plateaus) means more overhead   </p>
<p>The single program exhaust all CPU resource<br><img src="/img/perf_flamegraph.png">   </p>
<h4 id="perf-sched-latency-will-summarize-scheduler-latencies-by-task-including-average-and-maximum-delay"><a href="#perf-sched-latency-will-summarize-scheduler-latencies-by-task-including-average-and-maximum-delay" class="headerlink" title="perf sched latency will summarize scheduler latencies by task, including average and maximum delay"></a>perf sched latency will summarize scheduler latencies by task, including average and maximum delay</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">perf <span class="built_in">sched</span> latency</span><br><span class="line">perf <span class="built_in">sched</span> timehist</span><br><span class="line">perf <span class="built_in">sched</span> timehist -MVw</span><br><span class="line">perf <span class="built_in">sched</span> map</span><br></pre></td></tr></table></figure>

<h4 id="perf-probe"><a href="#perf-probe" class="headerlink" title="perf probe"></a>perf probe</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">$ perf probe -F <span class="comment"># list all probe point</span></span><br><span class="line">$ perf probe -V tcp_sendmsg</span><br><span class="line">Available variables at tcp_sendmsg</span><br><span class="line">        @&lt;tcp_sendmsg+0&gt;</span><br><span class="line">                int     size_goal</span><br><span class="line">                long int        timeo</span><br><span class="line">                size_t  size</span><br><span class="line">                struct kiocb*   iocb</span><br><span class="line">                struct msghdr*  msg</span><br><span class="line">                struct sock*    sk</span><br><span class="line"></span><br><span class="line">$ perf probe --add <span class="string">&#x27;tcp_sendmsg size&#x27;</span></span><br><span class="line">Added new event:</span><br><span class="line">  probe:tcp_sendmsg    (on tcp_sendmsg with size)</span><br><span class="line"></span><br><span class="line">You can now use it <span class="keyword">in</span> all perf tools, such as: </span><br><span class="line">$ perf record -e probe:tcp_sendmsg -aR <span class="built_in">sleep</span> 10</span><br><span class="line"></span><br><span class="line">$ perf probe -V tcp_sendmsg</span><br><span class="line">Available variables at tcp_sendmsg</span><br><span class="line">        @&lt;tcp_sendmsg+0&gt;</span><br><span class="line">                int     size_goal</span><br><span class="line">                long int        timeo</span><br><span class="line">                size_t  size</span><br><span class="line">                struct kiocb*   iocb</span><br><span class="line">                struct msghdr*  msg</span><br><span class="line">                struct sock*    sk</span><br><span class="line"><span class="comment"># Show available variables for the kernel tcp_sendmsg() function (needs debuginfo):</span></span><br><span class="line"></span><br><span class="line">$  perf probe -V tcp_sendmsg:81</span><br><span class="line">Available variables at tcp_sendmsg:81</span><br><span class="line">        @&lt;tcp_sendmsg+826&gt;</span><br><span class="line">                bool    sg</span><br><span class="line">                int     copied</span><br><span class="line">                int     flags</span><br><span class="line">                int     iovlen</span><br><span class="line">                int     mss_now</span><br><span class="line">                int     offset</span><br><span class="line">                int     size_goal</span><br><span class="line">                long int        timeo</span><br><span class="line">                size_t  seglen</span><br><span class="line">                struct iovec*   iov</span><br><span class="line">                struct sock*    sk</span><br><span class="line">                unsigned char*  from</span><br><span class="line"></span><br><span class="line">$ perf record -e probe:tcp_sendmsg -a</span><br><span class="line">$ perf probe -d tcp_sendmsg</span><br><span class="line">$ perf probe <span class="string">&#x27;tcp_sendmsg %ax %dx %cx&#x27;</span></span><br><span class="line">$ perf record -e probe:tcp_sendmsg -aR <span class="built_in">sleep</span> 10</span><br><span class="line">$ perf script</span><br><span class="line">            sshd 226370 [022] 15061.139400: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x15</span><br><span class="line">            sshd 226371 [023] 15061.140399: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x500</span><br><span class="line">            sshd 226371 [012] 15061.190714: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x16c</span><br><span class="line">            sshd 226371 [012] 15061.258446: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x2c</span><br><span class="line">            sshd 226371 [012] 15061.260811: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x34</span><br><span class="line">            sshd 226371 [012] 15061.263167: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x14c</span><br><span class="line">            sshd 226371 [012] 15061.273640: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa0032731fd78 arg3=0x1c</span><br><span class="line">            sshd 226370 [022] 15061.277845: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x1f4</span><br><span class="line">            sshd 226370 [022] 15061.277885: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x2c</span><br><span class="line">            sshd 226370 [012] 15061.285352: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15061.285882: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x6c</span><br><span class="line">            sshd 226370 [012] 15061.289555: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x5c</span><br><span class="line">            sshd 226370 [012] 15061.464101: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x6c</span><br><span class="line">            sshd 226370 [012] 15061.590038: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15061.678381: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15061.876852: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15061.993911: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [014] 15062.199995: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15062.698951: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [012] 15062.956902: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x24</span><br><span class="line">            sshd 226370 [014] 15062.960704: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x1024</span><br><span class="line">            sshd 226370 [016] 15062.960805: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x1024</span><br><span class="line">            sshd 226370 [016] 15062.960835: probe:tcp_sendmsg: (ffffffffb6a95040) arg1=0xffffffffb6a95040 arg2=0xffffa003ac74fd78 arg3=0x12c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Trace code</span></span><br><span class="line">$ perf probe -L tcp_sendmsg</span><br><span class="line"></span><br><span class="line"><span class="comment"># Trace function</span></span><br><span class="line">$ perf probe -x /lib/libc-2.17.so -a malloc</span><br><span class="line">$ perf report</span><br><span class="line">$ perf probe -x /lib/libc-2.17.so -d malloc</span><br></pre></td></tr></table></figure>

<h4 id="perf-timechart"><a href="#perf-timechart" class="headerlink" title="perf timechart"></a>perf timechart</h4><p>show the latency svg file   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ perf timechart record ./a.out</span><br><span class="line">$ perf timechart</span><br><span class="line">Written 3.5 seconds of trace to output.svg</span><br></pre></td></tr></table></figure>

<h4 id="perf-bench"><a href="#perf-bench" class="headerlink" title="perf bench"></a>perf bench</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ perf bench numa all</span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 0,2,4,6,8,10,12,14,16,18 -M 0,0,0,0,0,0,0,0,0,0</span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 0,2,4,6,8,10,12,14,16,18 -M 0,0,0,0,0,0,0,0,0,0 -s 120 <span class="comment"># add number of seconds to run, here is 120s</span></span><br><span class="line"><span class="comment"># 1 x process, 10 x threads ( single numa ), -T means single thread mem overhead MB, -P means process mem overhead MB</span></span><br><span class="line"><span class="comment"># -C bind the first N tasks to these specific cpus (the rest is unbound)</span></span><br><span class="line"><span class="comment"># -M bind the first N tasks to these specific memory nodes (the rest is unbound)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Compare local and remote numa node overhead </span></span><br><span class="line">$ lscpu</span><br><span class="line">......</span><br><span class="line">NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18</span><br><span class="line">NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19</span><br><span class="line"></span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 1,3,5,7,9,11,13,15,17,19 -M 0,0,0,0,0,0,0,0,0,0 -s 120 <span class="comment"># running 120s</span></span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 1,3,5,7,9,11,13,15,17,19 -M 0,0,0,0,0,0,0,0,0,0</span><br><span class="line"><span class="comment"># Running &#x27;numa/mem&#x27; benchmark:</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Running main, &quot;perf bench numa numa-mem -p 1 -t 10 -T 12000 -Irq -H 1 -C 1,3,5,7,9,11,13,15,17,19 -M 0,0,0,0,0,0,0,0,0,0&quot;</span></span><br><span class="line">          8.837 secs slowest (max) thread-runtime</span><br><span class="line">          8.000 secs fastest (min) thread-runtime</span><br><span class="line">          8.182 secs average thread-runtime</span><br><span class="line">          4.738 % difference between max/avg runtime</span><br><span class="line">         12.584 GB data processed, per thread</span><br><span class="line">        125.840 GB data processed, total</span><br><span class="line">          0.702 nsecs/byte/thread runtime</span><br><span class="line">          1.424 GB/sec/thread speed</span><br><span class="line">         14.239 GB/sec total speed</span><br><span class="line"></span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 0,2,4,6,8,10,12,14,16,18 -M 0,0,0,0,0,0,0,0,0,0 -s 120 <span class="comment"># running 120s</span></span><br><span class="line">$ perf bench numa mem  -p 1 -t 10  -T 12000  -Irq -H 1 -C 0,2,4,6,8,10,12,14,16,18 -M 0,0,0,0,0,0,0,0,0,0</span><br><span class="line"><span class="comment"># Running &#x27;numa/mem&#x27; benchmark:</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Running main, &quot;perf bench numa numa-mem -p 1 -t 10 -T 12000 -Irq -H 1 -C 0,2,4,6,8,10,12,14,16,18 -M 0,0,0,0,0,0,0,0,0,0&quot;</span></span><br><span class="line">          5.528 secs slowest (max) thread-runtime</span><br><span class="line">          5.000 secs fastest (min) thread-runtime</span><br><span class="line">          5.084 secs average thread-runtime</span><br><span class="line">          4.776 % difference between max/avg runtime</span><br><span class="line">         12.584 GB data processed, per thread</span><br><span class="line">        125.840 GB data processed, total</span><br><span class="line">          0.439 nsecs/byte/thread runtime</span><br><span class="line">          2.276 GB/sec/thread speed</span><br><span class="line">         22.764 GB/sec total speed</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/brendangregg/perf-tools">perf tools</a><br><a target="_blank" rel="noopener" href="https://billtian.github.io/digoal.blog/2016/11/27/01.html">reference</a>   </p>
<h4 id="perf-trace"><a href="#perf-trace" class="headerlink" title="perf trace"></a>perf trace</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">perf trace -p 1234</span><br><span class="line">perf trace -e <span class="built_in">read</span>*</span><br><span class="line">perf trace -D 500  <span class="comment"># wait 500ms before traing (skip all the stratup gumf)</span></span><br><span class="line">perf trace record</span><br></pre></td></tr></table></figure>

<h4 id="trace-user-space"><a href="#trace-user-space" class="headerlink" title="trace user space"></a><a target="_blank" rel="noopener" href="https://opensource.com/article/17/7/dynamic-tracing-linux-user-and-kernel-space">trace user space</a></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> func_1_cnt;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> func_2_cnt;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">func_1</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">        func_1_cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">func_2</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">        func_2_cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">void</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> number;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">                number = rand() % <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">if</span> (number &lt; <span class="number">5</span>)</span><br><span class="line">                        func_2();</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        func_1();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -g -o <span class="built_in">test</span> test.c</span><br><span class="line">$ perf probe -x ./test func_2_entry=func_2</span><br><span class="line">$ perf probe -x ./test func_2_exit=func_2%<span class="built_in">return</span></span><br><span class="line">$ perf probe -x ./test test_15=test.c:15</span><br><span class="line">$ perf probe -x ./test test_25=test.c:25 number</span><br><span class="line">$ perf record -e probe_test:func_2_entry -e probe_test:func_2_exit__return -e probe_test:test_15 -e probe_test:test_25 ./test</span><br><span class="line">$ perf script</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168452.655708:             probe_test:test_25: (4005f2) number=3</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168452.655740:        probe_test:func_2_entry: (400592)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168452.655761:             probe_test:test_15: (400596)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168452.655767: probe_test:func_2_exit__return: (400592 &lt;- 4005fd)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168453.655937:             probe_test:test_25: (4005f2) number=6</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168454.656151:             probe_test:test_25: (4005f2) number=7</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168455.656320:             probe_test:test_25: (4005f2) number=5</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168456.656483:             probe_test:test_25: (4005f2) number=3</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168456.656496:        probe_test:func_2_entry: (400592)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168456.656504:             probe_test:test_15: (400596)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168456.656510: probe_test:func_2_exit__return: (400592 &lt;- 4005fd)</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168457.656695:             probe_test:test_25: (4005f2) number=5</span><br><span class="line">            <span class="built_in">test</span> 11772 [003] 168458.656882:             probe_test:test_25: (4005f2) number=6</span><br><span class="line"></span><br><span class="line">$ perf probe -d func_2_entry -d test_15 -d test_25 -d func_2_exit__return</span><br></pre></td></tr></table></figure>
<p>trace PMCs for memory I&#x2F;O events  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$  perf <span class="built_in">stat</span> -e LLC-loads,LLC-load-misses -a -I 1000</span><br><span class="line"><span class="comment">#           time             counts unit events</span></span><br><span class="line">     1.005137445        559,247,421      LLC-loads</span><br><span class="line">     1.005137445        269,259,408      LLC-load-misses           <span class="comment">#   48.15% of all LL-cache hits</span></span><br><span class="line">     2.007241604        551,600,432      LLC-loads</span><br><span class="line">     2.007241604        267,976,111      LLC-load-misses           <span class="comment">#   48.25% of all LL-cache hits</span></span><br><span class="line">     3.009090791        552,723,650      LLC-loads</span><br><span class="line">     3.009090791        268,186,466      LLC-load-misses           <span class="comment">#   48.36% of all LL-cache hits</span></span><br><span class="line">     4.011116721        560,135,096      LLC-loads</span><br><span class="line">     4.011116721        268,988,337      LLC-load-misses           <span class="comment">#   48.39% of all LL-cache hits</span></span><br><span class="line">$ perf record -e L1-dcache-load-misses -c 100000 -a</span><br><span class="line">$ perf report -n --stdio</span><br></pre></td></tr></table></figure>


  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#kernel-support"><span class="toc-number">1.</span> <span class="toc-text">kernel support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#perf-cmd"><span class="toc-number">2.</span> <span class="toc-text">perf cmd</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#trace-page-fault"><span class="toc-number">2.1.</span> <span class="toc-text">trace page fault</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-stat"><span class="toc-number">2.2.</span> <span class="toc-text">perf stat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-record"><span class="toc-number">2.3.</span> <span class="toc-text">perf record</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-annotate"><span class="toc-number">2.4.</span> <span class="toc-text">perf annotate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-report"><span class="toc-number">2.5.</span> <span class="toc-text">perf report</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-diff"><span class="toc-number">2.6.</span> <span class="toc-text">perf diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-list"><span class="toc-number">2.7.</span> <span class="toc-text">perf list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flamegraph"><span class="toc-number">2.8.</span> <span class="toc-text">flamegraph</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-sched-latency-will-summarize-scheduler-latencies-by-task-including-average-and-maximum-delay"><span class="toc-number">2.9.</span> <span class="toc-text">perf sched latency will summarize scheduler latencies by task, including average and maximum delay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-probe"><span class="toc-number">2.10.</span> <span class="toc-text">perf probe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-timechart"><span class="toc-number">2.11.</span> <span class="toc-text">perf timechart</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-bench"><span class="toc-number">2.12.</span> <span class="toc-text">perf bench</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf-trace"><span class="toc-number">2.13.</span> <span class="toc-text">perf trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trace-user-space"><span class="toc-number">2.14.</span> <span class="toc-text">trace user space</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/11/14/perf/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/11/14/perf/&text=perf"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/11/14/perf/&is_video=false&description=perf"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=perf&body=Check out this article: http://example.com/2022/11/14/perf/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/11/14/perf/&title=perf"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/11/14/perf/&name=perf&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/11/14/perf/&t=perf"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
