<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="mkfs ext4 for stripe1$ mkfs.ext4 -E stride&#x3D;8,stripe-width&#x3D;128,lazy_itable_init&#x3D;0,lazy_journal_init&#x3D;0 &#x2F;dev&#x2F;sdxx1  Oh, shit , data loss, here is lustre ldiskfs backup dataWhen backing up operating syste">
<meta property="og:type" content="article">
<meta property="og:title" content="ext4 info">
<meta property="og:url" content="http://example.com/2018/11/13/ext4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="mkfs ext4 for stripe1$ mkfs.ext4 -E stride&#x3D;8,stripe-width&#x3D;128,lazy_itable_init&#x3D;0,lazy_journal_init&#x3D;0 &#x2F;dev&#x2F;sdxx1  Oh, shit , data loss, here is lustre ldiskfs backup dataWhen backing up operating syste">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-11-13T01:02:56.000Z">
<meta property="article:modified_time" content="2022-11-15T01:59:35.375Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="ext4">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ext4 info</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2019/11/26/xfs/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2018/04/12/ansible/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2018/11/13/ext4/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2018/11/13/ext4/&text=ext4 info"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2018/11/13/ext4/&is_video=false&description=ext4 info"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ext4 info&body=Check out this article: http://example.com/2018/11/13/ext4/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2018/11/13/ext4/&name=ext4 info&description=&lt;h3 id=&#34;mkfs-ext4-for-stripe&#34;&gt;&lt;a href=&#34;#mkfs-ext4-for-stripe&#34; class=&#34;headerlink&#34; title=&#34;mkfs ext4 for stripe&#34;&gt;&lt;/a&gt;mkfs ext4 for stripe&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.ext4 -E stride=8,stripe-width=128,lazy_itable_init=0,lazy_journal_init=0 /dev/sdxx1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Oh, shit , data loss, here is lustre ldiskfs&lt;/p&gt;
&lt;p&gt;backup data&lt;br&gt;When backing up operating system partitions, the partition must be unmounted.&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;dd&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;=/dev/mapper/3600a098000b5ea3e000006065be52460 of=3600a098000b5ea3e000006065be52460 bs=1M conv=sparse&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;or you could &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dump -0uf /backup-files/sda3.dump /dev/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dump -0u -f - /dev/sda1 | ssh root@test-server &lt;span class=&#34;built_in&#34;&gt;dd&lt;/span&gt; of=/tmp/sda1.dump&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# recovery &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mount -t ext3 /dev/sda3 /mnt/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; /mnt/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;restore -rf /backup-files/sda3.dump&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2018/11/13/ext4/&t=ext4 info"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#mkfs-ext4-for-stripe"><span class="toc-number">1.</span> <span class="toc-text">mkfs ext4 for stripe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#For-huge-parttion-there-is-no-enough-memory-it-will-cause-slow"><span class="toc-number">2.</span> <span class="toc-text">For huge parttion, there is no enough memory, it will cause slow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount-from-partion-start"><span class="toc-number">3.</span> <span class="toc-text">mount from partion start</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Found-ext-magic-number"><span class="toc-number">4.</span> <span class="toc-text">Found ext magic number</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#because-there-is-no-any-parttion-in-this-block-dev"><span class="toc-number">5.</span> <span class="toc-text">because there is no any parttion in this block dev</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#You-can%E2%80%99t-fsck-by-default"><span class="toc-number">6.</span> <span class="toc-text">You can’t fsck by default</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Found-some-info-form-superblock"><span class="toc-number">7.</span> <span class="toc-text">Found some info form superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#You-have-to-disable-ext-journal-make-it-like-ext2-all-blocks-full-scan"><span class="toc-number">8.</span> <span class="toc-text">You have to disable ext journal, make it like ext2, all blocks full scan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Looks-like-the-block-dev-has-be-destroy-by-hardware-raid-controller-all-data-has-messed"><span class="toc-number">9.</span> <span class="toc-text">Looks like the block dev has be destroy by hardware raid controller, all data has messed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debugfs"><span class="toc-number">10.</span> <span class="toc-text">debugfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#check-ext4-fragment"><span class="toc-number">11.</span> <span class="toc-text">check ext4 fragment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount-the-backup-superblock"><span class="toc-number">12.</span> <span class="toc-text">mount the backup superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extra-log"><span class="toc-number">13.</span> <span class="toc-text">extra log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recovery-by-ext4magic"><span class="toc-number">14.</span> <span class="toc-text">recovery by ext4magic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack"><span class="toc-number">15.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-hole"><span class="toc-number">16.</span> <span class="toc-text">file hole</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ext4 info
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2018-11-13T01:02:56.000Z" itemprop="datePublished">2018-11-13</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Storage/">Storage</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/ext4/" rel="tag">ext4</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="mkfs-ext4-for-stripe"><a href="#mkfs-ext4-for-stripe" class="headerlink" title="mkfs ext4 for stripe"></a>mkfs ext4 for stripe</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkfs.ext4 -E stride=8,stripe-width=128,lazy_itable_init=0,lazy_journal_init=0 /dev/sdxx1</span><br></pre></td></tr></table></figure>

<p>Oh, shit , data loss, here is lustre ldiskfs</p>
<p>backup data<br>When backing up operating system partitions, the partition must be unmounted.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mapper/3600a098000b5ea3e000006065be52460 of=3600a098000b5ea3e000006065be52460 bs=1M conv=sparse</span><br><span class="line">or you could </span><br><span class="line">$ dump -0uf /backup-files/sda3.dump /dev/sda3</span><br><span class="line">$ dump -0u -f - /dev/sda1 | ssh root@test-server <span class="built_in">dd</span> of=/tmp/sda1.dump</span><br><span class="line"><span class="comment"># recovery </span></span><br><span class="line">$ mount -t ext3 /dev/sda3 /mnt/sda3</span><br><span class="line">$ <span class="built_in">cd</span> /mnt/sda3</span><br><span class="line">restore -rf /backup-files/sda3.dump</span><br></pre></td></tr></table></figure>

<span id="more"></span>
<p>Ext4 magic number “53 ef”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">$ hexdump -C /dev/sdg | head -n 4000 | grep &quot;53 ef&quot;</span><br><span class="line"></span><br><span class="line">$ debugfs /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line">debugfs 1.42.13.wc5 (15-Apr-2016)</span><br><span class="line">/dev/mapper/3600a098000b5ea3e000006065be52460: Can&#x27;t read an inode bitmap while reading inode bitmap</span><br><span class="line">debugfs:  stats</span><br><span class="line">stats: Filesystem not open</span><br><span class="line"></span><br><span class="line">$ dumpe2fs /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line">dumpe2fs 1.42.13.wc5 (15-Apr-2016)</span><br><span class="line">Filesystem volume name:   ldfsqd1-OST0004</span><br><span class="line">Last mounted on:          /</span><br><span class="line">Filesystem UUID:          8ffd7826-f9f5-4e92-99ef-75cca46c281a</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision #:    1 (dynamic)</span><br><span class="line">Filesystem features:      has_journal ext_attr dir_index filetype needs_recovery extent 64bit mmp flex_bg sparse_super large_file huge_file uninit_bg dir_nlink quota</span><br><span class="line">Filesystem flags:         signed_directory_hash</span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:          Continue</span><br><span class="line">Filesystem OS type:       Linux</span><br><span class="line">Inode count:              62914560</span><br><span class="line">Block count:              16106127360</span><br><span class="line">Reserved block count:     805306368</span><br><span class="line">Free blocks:              3782402091</span><br><span class="line">Free inodes:              60311208</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Group descriptor size:    64</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         128</span><br><span class="line">Inode blocks per group:   8</span><br><span class="line">Flex block group size:    256</span><br><span class="line">Filesystem created:       Tue Oct 10 13:54:45 2017</span><br><span class="line">Last mount time:          Sat Oct 20 16:15:57 2018</span><br><span class="line">Last write time:          Sat Oct 20 16:15:57 2018</span><br><span class="line">Mount count:              8</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Tue Oct 10 13:54:45 2017</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          5132 GB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:	          256</span><br><span class="line">Required extra isize:     28</span><br><span class="line">Desired extra isize:      28</span><br><span class="line">Journal inode:            8</span><br><span class="line">Default directory hash:   half_md4</span><br><span class="line">Directory Hash Seed:      7d46aee3-a481-456b-b9ff-6c7ab59a6e1c</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">MMP block number:         10246</span><br><span class="line">MMP update interval:      5</span><br><span class="line">User quota inode:         3</span><br><span class="line">Group quota inode:        4</span><br><span class="line">Journal superblock magic number invalid!</span><br><span class="line">......</span><br><span class="line">$ grep  --binary-files=text 0000430 3600a09800099437b000008f05be52536</span><br><span class="line">0000430: 9aba e45b 0c00 ffff 53ef 0100 0100 0000  ...[....S.......</span><br><span class="line">The magic number is little-endian 0xef53</span><br><span class="line"></span><br><span class="line">$ dumpe2fs /dev/mapper/3600a098000b5ea3e000006055be52442 | grep superblock -i</span><br><span class="line">dumpe2fs 1.42.13.wc5 (15-Apr-2016)</span><br><span class="line">  Primary superblock at 0, Group descriptors at 1-7680</span><br><span class="line">  Backup superblock at 32768, Group descriptors at 32769-40448</span><br><span class="line">  Backup superblock at 98304, Group descriptors at 98305-105984</span><br><span class="line">  Backup superblock at 163840, Group descriptors at 163841-171520</span><br><span class="line">  Backup superblock at 229376, Group descriptors at 229377-237056</span><br><span class="line">  Backup superblock at 294912, Group descriptors at 294913-302592</span><br><span class="line">  Backup superblock at 819200, Group descriptors at 819201-826880</span><br><span class="line">  Backup superblock at 884736, Group descriptors at 884737-892416</span><br><span class="line">  Backup superblock at 1605632, Group descriptors at 1605633-1613312</span><br><span class="line">  Backup superblock at 2654208, Group descriptors at 2654209-2661888</span><br><span class="line">  Backup superblock at 4096000, Group descriptors at 4096001-4103680</span><br><span class="line">  Backup superblock at 7962624, Group descriptors at 7962625-7970304</span><br><span class="line">  Backup superblock at 11239424, Group descriptors at 11239425-11247104</span><br><span class="line">  Backup superblock at 20480000, Group descriptors at 20480001-20487680</span><br><span class="line">  Backup superblock at 23887872, Group descriptors at 23887873-23895552</span><br><span class="line">  Backup superblock at 71663616, Group descriptors at 71663617-71671296</span><br><span class="line">  Backup superblock at 78675968, Group descriptors at 78675969-78683648</span><br><span class="line">  Backup superblock at 102400000, Group descriptors at 102400001-102407680</span><br><span class="line">  Backup superblock at 214990848, Group descriptors at 214990849-214998528</span><br><span class="line">  Backup superblock at 512000000, Group descriptors at 512000001-512007680</span><br><span class="line">  Backup superblock at 550731776, Group descriptors at 550731777-550739456</span><br><span class="line">  Backup superblock at 644972544, Group descriptors at 644972545-644980224</span><br><span class="line">  Backup superblock at 1934917632, Group descriptors at 1934917633-1934925312</span><br><span class="line">  Backup superblock at 2560000000, Group descriptors at 2560000001-2560007680</span><br><span class="line">  Backup superblock at 3855122432, Group descriptors at 3855122433-3855130112</span><br><span class="line">  Backup superblock at 5804752896, Group descriptors at 5804752897-5804760576</span><br><span class="line">  Backup superblock at 12800000000, Group descriptors at 12800000001-12800007680</span><br></pre></td></tr></table></figure>
<p>Why some parition all superblock were missing ?</p>
<h3 id="For-huge-parttion-there-is-no-enough-memory-it-will-cause-slow"><a href="#For-huge-parttion-there-is-no-enough-memory-it-will-cause-slow" class="headerlink" title="For huge parttion, there is no enough memory, it will cause slow"></a>For huge parttion, there is no enough memory, it will cause slow</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/e2fsck.conf</span><br><span class="line">[scratch_files]</span><br><span class="line">directory = /var/cache/e2fsck</span><br></pre></td></tr></table></figure>

<h3 id="mount-from-partion-start"><a href="#mount-from-partion-start" class="headerlink" title="mount from partion start"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/103919/how-do-i-find-the-offset-of-an-ext4-filesystem">mount from partion start</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">bsz=512 <span class="comment"># or 1024, 2048, 4096</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..10000000&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---&gt;<span class="variable">$i</span>&lt;---&quot;</span></span><br><span class="line">    mount -o offset=$((<span class="variable">$bsz</span>*<span class="variable">$i</span>)) -t ext4 /dev/whatever /mnt/foo</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ]; <span class="keyword">then</span> <span class="comment"># whahoo!</span></span><br><span class="line">        <span class="built_in">echo</span> Eureka</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## the case I resolved, before the parted the partion table, there is a no partition xfs in this whole block  </span></span><br><span class="line">$ parted /dev/vdb <span class="string">&#x27;unit s print&#x27;</span></span><br><span class="line">Model: Virtio Block Device (virtblk)</span><br><span class="line">Disk /dev/vdb: 8388874240s</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: loop</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start  End          Size         File system  Flags</span><br><span class="line"> 1      0s     8388874239s  8388874240s  xfs</span><br><span class="line"></span><br><span class="line">$ gdisk -l /dev/vdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): F372D874-C734-49A1-A634-87DD80602FD9</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 8388874206</span><br><span class="line">Partitions will be aligned on 8-sector boundaries</span><br><span class="line">Total free space is 1919 sectors (959.5 KiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1              34      8388872287   3.9 TiB     0700  primary</span><br><span class="line"></span><br><span class="line"><span class="comment">## https://ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout</span></span><br><span class="line">0x38  __le16  s_magic  Magic signature, 0xEF53</span><br><span class="line"></span><br><span class="line"><span class="comment">### find the magic num</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/vdb of=file_2M count=1M count=2</span><br><span class="line">$ hexdump -C file_2M | <span class="built_in">head</span> -n 4000 | grep <span class="string">&quot;53 ef &quot;</span></span><br><span class="line">00004830  50 d0 10 60 01 00 ff ff  53 ef 01 00 01 00 00 00  |P..`....S.......| </span><br><span class="line"></span><br><span class="line">padding:0x400 + metadata: 0x38 = offset: 0x438</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $(($((<span class="number">16#4838</span>))-$((<span class="number">16#438</span>))))</span><br><span class="line">17408</span><br><span class="line"></span><br><span class="line">$ mount /dev/vdb /mnt -o offset=17408 <span class="comment">### mounted</span></span><br></pre></td></tr></table></figure>

<h3 id="Found-ext-magic-number"><a href="#Found-ext-magic-number" class="headerlink" title="Found ext magic number"></a>Found ext magic number</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0000400: 0000 c003 0000 00c0 0000 0030 60c4 98a4  ...........0`...</span><br><span class="line">0000410: e243 9703 0000 0000 0200 0000 0200 0000  .C..............</span><br><span class="line">0000420: 0080 0000 0080 0000 8000 0000 9aba e45b  ...............[</span><br><span class="line">0000430: 9aba e45b 0c00 ffff 53ef 0100 0100 0000  ...[....S.......</span><br><span class="line">0000440: 8760 dc59 0000 0000 0000 0000 0100 0000  .`.Y............</span><br><span class="line">0000450: 0000 0000 0b00 0000 0001 0000 2c00 0000  ............,...</span><br><span class="line">0000460: c603 0000 3b01 0000 1c09 a61a 05f9 42cb  ....;.........B.</span><br><span class="line">0000470: a3a9 e929 ee10 20be 6c64 6673 7164 312d  ...).. .ldfsqd1-</span><br><span class="line">0000480: 4f53 5430 3030 3000 2f00 6d70 2f6d 6e74  OST0000./.mp/mnt</span><br><span class="line">0000490: 584e 4435 3733 0000 0000 0000 0000 0000  XND573..........</span><br><span class="line">00004a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00004b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00004c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></pre></td></tr></table></figure>

<h3 id="because-there-is-no-any-parttion-in-this-block-dev"><a href="#because-there-is-no-any-parttion-in-this-block-dev" class="headerlink" title="because there is no any parttion in this block dev"></a>because there is no any parttion in this block dev</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ parted /dev/mapper/3600a098000b5ea3e000006065be52460 p</span><br><span class="line">Model: Linux device-mapper (multipath) (dm)</span><br><span class="line">Disk /dev/mapper/3600a098000b5ea3e000006065be52460: 66.0TB</span><br><span class="line">Sector size (logical/physical): 512B/4096B</span><br><span class="line">Partition Table: loop <span class="comment">#######that means there is no parttion </span></span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End     Size    File system  Flags</span><br><span class="line"> 1      0.00B  66.0TB  66.0TB  ext4</span><br></pre></td></tr></table></figure>

<h3 id="You-can’t-fsck-by-default"><a href="#You-can’t-fsck-by-default" class="headerlink" title="You can’t fsck by default"></a>You can’t fsck by default</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ e2fsck -n -b 32768 /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line">e2fsck 1.42.13.wc5 (15-Apr-2016)</span><br><span class="line">MMP interval is 10 seconds and total wait time is 42 seconds. Please wait...</span><br><span class="line">Superblock has an invalid journal (inode 8).</span><br><span class="line">Clear? no</span><br><span class="line"></span><br><span class="line">e2fsck: Illegal inode number while checking ext3 journal for ldfsqd1-OST0004</span><br><span class="line"></span><br><span class="line">ldfsqd1-OST0004: ********** WARNING: Filesystem still has errors **********</span><br><span class="line"></span><br><span class="line">$ e2fsck -n -b 819200 /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line">e2fsck 1.42.13.wc5 (15-Apr-2016)</span><br><span class="line">MMP interval is 10 seconds and total wait time is 42 seconds. Please wait...</span><br><span class="line">Superblock has an invalid journal (inode 8).</span><br><span class="line">Clear? no</span><br><span class="line"></span><br><span class="line">e2fsck: Illegal inode number while checking ext3 journal for ldfsqd1-OST0004</span><br><span class="line"></span><br><span class="line">ldfsqd1-OST0004: ********** WARNING: Filesystem still has errors **********</span><br></pre></td></tr></table></figure>

<h3 id="Found-some-info-form-superblock"><a href="#Found-some-info-form-superblock" class="headerlink" title="Found some info form superblock"></a>Found some info form superblock</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-n     Causes mke2fs to not actually create a filesystem, but display what it would <span class="keyword">do</span> <span class="keyword">if</span> it were to create  a  filesystem.   </span><br><span class="line">       This can  be used to determine the location of the backup superblocks <span class="keyword">for</span> a particular filesystem, </span><br><span class="line">       so long as the mke2fs parame‐ters that were passed when the filesystem was originally created are used again.  </span><br><span class="line">       (With the -n option added, of course!)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maybe you could rewrite the superblock</span></span><br><span class="line">mke2fs -S</span><br><span class="line">    -S    Write  superblock and group descriptors only.  This is useful <span class="keyword">if</span> all</span><br><span class="line">          of the superblock and backup superblocks are corrupted, and a  last-</span><br><span class="line">          ditch  recovery method is desired.  It causes mke2fs to reinitialize</span><br><span class="line">          the superblock and group descriptors, <span class="keyword">while</span> not touching  the  inode</span><br><span class="line">          table and the block and inode bitmaps.  The e2fsck program should be</span><br><span class="line">          run immediately after this option is used, and there is no guarantee</span><br><span class="line">          that  any  data  will be salvageable.  It is critical to specify the</span><br><span class="line">          correct filesystem blocksize when using this option, or there is  no</span><br><span class="line">          chance of recovery.</span><br></pre></td></tr></table></figure>

<h3 id="You-have-to-disable-ext-journal-make-it-like-ext2-all-blocks-full-scan"><a href="#You-have-to-disable-ext-journal-make-it-like-ext2-all-blocks-full-scan" class="headerlink" title="You have to disable ext journal, make it like ext2, all blocks full scan"></a>You have to disable ext journal, make it like ext2, all blocks full scan</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tune2fs -O ^has_journal,needs_rwcovery -f /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line"><span class="comment">### you can fsck again, but it &#x27;s too slow..............maybe 60TB will wait 10 years</span></span><br><span class="line"></span><br><span class="line">$ e2fsck -y /dev/mapper/3600a098000b5ea3e000006065be52460</span><br><span class="line"><span class="comment">### it &#x27;s worked</span></span><br></pre></td></tr></table></figure>

<h3 id="Looks-like-the-block-dev-has-be-destroy-by-hardware-raid-controller-all-data-has-messed"><a href="#Looks-like-the-block-dev-has-be-destroy-by-hardware-raid-controller-all-data-has-messed" class="headerlink" title="Looks like the block dev has be destroy by hardware raid controller, all data has messed"></a>Looks like the block dev has be destroy by hardware raid controller, all data has messed</h3><p>In 60TiB raw dev, Lustre first 10MB is ext meta data and data map, it will not show any file part<br>But I found the horrible things, reserve space has been overrided as 128KiB, 128KiB is the raid controller segment size.<br>I don ‘t think we can recovery all data. when fsck finish, I ‘m not sure the data is it integrity. maybe some block has corruptted in single file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">00fffa0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00fffb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00fffc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00fffd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00fffe0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00ffff0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0100000: dcfa 60ef 039f c372 0793 3a8d 4c6a 642d  ..`....r..:.Ljd-</span><br><span class="line">0100010: 50c7 fddf b3f5 fbed f03f 71b5 ccb3 811c  P........?q.....</span><br><span class="line">0100020: 1495 a0c2 ab24 be48 ac46 1109 a19e aadc  .....$.H.F......</span><br><span class="line">0100030: 16d9 0488 2e26 d238 fe48 e492 27c5 dd02  .....&amp;.8.H..<span class="string">&#x27;...</span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="string">011ffd0: baf1 35e8 54e1 e97c dab5 e762 e74c 83cc  ..5.T..|...b.L..</span></span><br><span class="line"><span class="string">011ffe0: 7d02 7db3 53f2 613d 6ef4 775b a0e2 767f  &#125;.&#125;.S.a=n.w[..v.</span></span><br><span class="line"><span class="string">011fff0: ff8b 65fe 9c39 1018 3b76 586e 3893 2095  ..e..9..;vXn8. .</span></span><br><span class="line"><span class="string">0120000: c000 8023 c001 8023 0008 8023 0000 0100  ...#...#...#....</span></span><br><span class="line"><span class="string">0120010: 0000 0400 0000 0000 0000 0000 0000 3896  ..............8.</span></span><br><span class="line"><span class="string">0120020: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##### After 128KiB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##### Another parttion</span></span><br><span class="line"><span class="string">01bffe0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class="line"><span class="string">01bfff0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class="line"><span class="string">01c0000: 9fac ef20 dd9d fd1c 18ed a503 a19e 5f7a  ... .........._z</span></span><br><span class="line"><span class="string">01c0010: ea7d b6c7 850d 7a52 a0a9 61a6 a912 f489  .&#125;....zR..a.....</span></span><br><span class="line"><span class="string">01c0020: da1f 4941 4fe4 f612 1b25 ff91 9b61 928a  ..IAO....%...a..</span></span><br><span class="line"><span class="string">01c0030: 405d 5026 e2a7 a59e d08a d376 8c57 0d1f  @]P&amp;.......v.W..</span></span><br><span class="line"><span class="string">....</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">01fff90: 5080 aaaa 0ef0 3c5c 0020 0d5c 6408 2400  P.....&lt;\. .\d.$.</span></span><br><span class="line"><span class="string">01fffa0: ef15 08e8 7d00 2399 d60f 1b1e 0000 0000  ....&#125;.#.........</span></span><br><span class="line"><span class="string">01fffb0: 966c 6516 0000 0000 ff37 fb12 0000 0000  .le......7......</span></span><br><span class="line"><span class="string">01fffc0: 954a c013 0000 0000 ea47 c570 2708 0000  .J.......G.p&#x27;</span>...</span><br><span class="line">01fffd0: 45a6 5fd7 6c03 8ca1 be55 4c44 2a6a 1500  E._.l....ULD*j..</span><br><span class="line">01fffe0: aa06 3ba9 aaba e2a6 fc0f 1b1e 0000 0000  ..;.............</span><br><span class="line">01ffff0: b46c 6516 0000 0000 2838 fb12 0000 0000  .le.....(8......</span><br><span class="line">0200000: 6c65 0975 6e6b 6e6f 776e 0930 0930 0969  le.unknown.0.0.i</span><br><span class="line">0200010: 6e74 726f 6e09 6578 6163 7409 3109 0931  ntron.exact.1..1</span><br><span class="line">0200020: 3709 3130 3030 4745 4e4f 4d45 532c 4142  7.1000GENOMES,AB</span><br><span class="line">0200030: 492c 4146 4659 2c42 4749 2c43 4f4d 504c  I,AFFY,BGI,COMPL</span><br><span class="line">0200040: 4554 455f 4745 4e4f 4d49 4353 2c43 5348  ETE_GENOMICS,CSH</span><br><span class="line">0200050: 4c2d 4841 504d 4150 2c45 4e53 454d 424c  L-HAPMAP,ENSEMBL</span><br><span class="line">0200060: 2c45 5641 2d47 4f4e 4c2c 474d 492c 4855  ,EVA-GONL,GMI,HU</span><br><span class="line">0200070: 4d41 4e47 454e 4f4d 455f 4a43 5649 2c4a  MANGENOME_JCVI,J</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">021ffb0: 454e 4f4d 4553 2c09 3209 2d2c 4154 4141  ENOMES,.2.-,ATAA</span><br><span class="line">021ffc0: 542c 0933 2e30 3030 3030 302c 3530 3035  T,.3.000000,5005</span><br><span class="line">021ffd0: 2e30 3030 3030 302c 0930 2e30 3030 3539  .000000,.0.00059</span><br><span class="line">021ffe0: 392c 302e 3939 3934 3031 2c09 0a37 3032  9,0.999401,..702</span><br><span class="line">021fff0: 0963 6872 3130 0931 3533 3338 3336 3909  .chr10.15338369.</span><br><span class="line">0220000: c000 8043 c001 8043 0008 8043 0000 8000  ...C...C...C....</span><br><span class="line">0220010: 0000 0500 0000 0000 0000 0000 8000 e4f0  ................</span><br><span class="line">0220020: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0220030: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0220040: c100 8043 c101 8043 0808 8043 0000 8000  ...C...C...C....</span><br><span class="line">0220050: 0000 0500 0000 0000 0000 0000 8000 9be0  ................</span><br><span class="line">0220060: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0220070: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0220080: c200 8043 c201 8043 1008 8043 0000 8000  ...C...C...C....</span><br><span class="line">0220090: 0000 0500 0000 0000 0000 0000 8000 1ad0  ................</span><br><span class="line">02200a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">02200b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">02200c0: c300 8043 c301 8043 1808 8043 0000 8000  ...C...C...C....</span><br><span class="line"></span><br><span class="line"><span class="comment">## Why there is file part as 128KiB size override file system reserve space ????</span></span><br><span class="line"><span class="comment">## Here is file system log , looks like no problem</span></span><br></pre></td></tr></table></figure>

<h3 id="debugfs"><a href="#debugfs" class="headerlink" title="debugfs"></a>debugfs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/shm/test bs=1M count=512</span><br><span class="line">$ mfks.ext3 -b 4096 /dev/shm/test</span><br><span class="line">$ mount /dev/shm/test /mnt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">rm</span> -f <span class="built_in">test</span>;<span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..10000&#125;; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span>-<span class="variable">$i</span>-<span class="variable">$i</span> &gt;&gt; <span class="built_in">test</span>; <span class="keyword">done</span> </span><br><span class="line">$ filefrag -v <span class="built_in">test</span> </span><br><span class="line">Filesystem <span class="built_in">type</span> is: ef53</span><br><span class="line">Filesystem cylinder <span class="built_in">groups</span> approximately 4</span><br><span class="line">File size of <span class="built_in">test</span> is 146688 (36 blocks of 4096 bytes)</span><br><span class="line"> ext:     logical_offset:        physical_offset: length:   expected: flags:</span><br><span class="line">   0:        0..      15:       2576..      2591:     16:             merged</span><br><span class="line">   1:       16..      16:      33424..     33424:      1:       2592: merged</span><br><span class="line">   2:       17..      17:      33457..     33457:      1:      33425: merged</span><br><span class="line">   3:       18..      18:      33490..     33490:      1:      33458: merged</span><br><span class="line">   4:       19..      19:      33523..     33523:      1:      33491: merged</span><br><span class="line">   5:       20..      20:      33556..     33556:      1:      33524: merged</span><br><span class="line">   6:       21..      21:      33589..     33589:      1:      33557: merged</span><br><span class="line">   7:       22..      22:      33622..     33622:      1:      33590: merged</span><br><span class="line">   8:       23..      23:      33655..     33655:      1:      33623: merged</span><br><span class="line">   9:       24..      24:      33688..     33688:      1:      33656: merged</span><br><span class="line">  10:       25..      25:      33721..     33721:      1:      33689: merged</span><br><span class="line">  11:       26..      26:      33754..     33754:      1:      33722: merged</span><br><span class="line">  12:       27..      27:      33787..     33787:      1:      33755: merged</span><br><span class="line">  13:       28..      28:      33820..     33820:      1:      33788: merged</span><br><span class="line">  14:       29..      29:      33853..     33853:      1:      33821: merged</span><br><span class="line">  15:       30..      30:      33886..     33886:      1:      33854: merged</span><br><span class="line">  16:       31..      31:      33919..     33919:      1:      33887: merged</span><br><span class="line">  17:       32..      32:      33952..     33952:      1:      33920: merged</span><br><span class="line">  18:       33..      33:      34017..     34017:      1:      33953: merged</span><br><span class="line">  19:       34..      34:      34082..     34082:      1:      34018: merged</span><br><span class="line">  20:       35..      35:      34147..     34147:      1:      34083: last,merged,eof</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">$ debugfs /dev/shm/test </span><br><span class="line">debugfs 1.42.13 (17-May-2015)</span><br><span class="line">debugfs: <span class="built_in">stat</span> &lt;14&gt; </span><br><span class="line"></span><br><span class="line">Inode: 14   Type: regular    Mode:  0644   Flags: 0x0</span><br><span class="line">Generation: 3749441442    Version: 0x00000000:00000001</span><br><span class="line">User:     0   Group:     0   Size: 146688</span><br><span class="line">File ACL: 0    Directory ACL: 0</span><br><span class="line">Links: 1   Blockcount: 296</span><br><span class="line">Fragment:  Address: 0    Number: 0    Size: 0</span><br><span class="line"> ctime: 0x58763a68:1f1d1ee4 -- Wed Jan 11 22:00:08 2017</span><br><span class="line"> atime: 0x58763a67:e66e9d44 -- Wed Jan 11 22:00:07 2017</span><br><span class="line"> mtime: 0x58763a68:1f1d1ee4 -- Wed Jan 11 22:00:08 2017</span><br><span class="line">crtime: 0x58763a67:e66e9d44 -- Wed Jan 11 22:00:07 2017</span><br><span class="line">Size of extra inode fields: 32</span><br><span class="line">BLOCKS:</span><br><span class="line">(0-11):2576-2587, (IND):1538, (12-15):2588-2591, (16):33424, (17):33457, (18):33490, (19):33523, (20):33556, (21):33589, (22):33622, (23):33655, (24):33688, (25):33721, (26):33754, (27):33787, (28):33820, (29):33853, (30):33886, (31):33919, (32):33952, (33):34017, (34):34082, (35):34147</span><br><span class="line">TOTAL: 37</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/shm/test of=test-1 bs=4K skip=2576 count=$((<span class="number">2591</span>-<span class="number">2576</span>+<span class="number">1</span>))</span><br><span class="line">$ <span class="built_in">head</span> test-1 ; <span class="built_in">wc</span> -l test-1 ;<span class="built_in">tail</span> test-1</span><br><span class="line">0-0-0</span><br><span class="line">1-1-1</span><br><span class="line">2-2-2</span><br><span class="line">3-3-3</span><br><span class="line">4-4-4</span><br><span class="line">5-5-5</span><br><span class="line">6-6-6</span><br><span class="line">7-7-7</span><br><span class="line">8-8-8</span><br><span class="line">9-9-9</span><br><span class="line">4591 test-1</span><br><span class="line">4582-4582-4582</span><br><span class="line">4583-4583-4583</span><br><span class="line">4584-4584-4584</span><br><span class="line">4585-4585-4585</span><br><span class="line">4586-4586-4586</span><br><span class="line">4587-4587-4587</span><br><span class="line">4588-4588-4588</span><br><span class="line">4589-4589-4589</span><br><span class="line">4590-4590-4590</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/shm/test of=test-2 bs=4K skip=33424 count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">4096 bytes (4.1 kB, 4.0 KiB) copied, 0.000193943 s, 21.1 MB/s</span><br><span class="line">$ <span class="built_in">head</span> test-2 ; <span class="built_in">wc</span> -l test-2 ;<span class="built_in">tail</span> test-2</span><br><span class="line">591-4591-4591</span><br><span class="line">4592-4592-4592</span><br><span class="line">4593-4593-4593</span><br><span class="line">4594-4594-4594</span><br><span class="line">4595-4595-4595</span><br><span class="line">4596-4596-4596</span><br><span class="line">4597-4597-4597</span><br><span class="line">4598-4598-4598</span><br><span class="line">4599-4599-4599</span><br><span class="line">4600-4600-4600</span><br><span class="line">273 test-2</span><br><span class="line">4855-4855-4855</span><br><span class="line">4856-4856-4856</span><br><span class="line">4857-4857-4857</span><br><span class="line">4858-4858-4858</span><br><span class="line">4859-4859-4859</span><br><span class="line">4860-4860-4860</span><br><span class="line">4861-4861-4861</span><br><span class="line">4862-4862-4862</span><br><span class="line">4863-4863-4863</span><br><span class="line">48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/shm/test of=test-3 bs=4K skip=33457 count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">4096 bytes (4.1 kB, 4.0 KiB) copied, 0.000193132 s, 21.2 MB/s</span><br><span class="line">$ <span class="built_in">head</span> test-3 ; <span class="built_in">wc</span> -l test-3 ;<span class="built_in">tail</span> test-3</span><br><span class="line">64-4864-4864</span><br><span class="line">4865-4865-4865</span><br><span class="line">4866-4866-4866</span><br><span class="line">4867-4867-4867</span><br><span class="line">4868-4868-4868</span><br><span class="line">4869-4869-4869</span><br><span class="line">4870-4870-4870</span><br><span class="line">4871-4871-4871</span><br><span class="line">4872-4872-4872</span><br><span class="line">4873-4873-4873</span><br><span class="line">273 test-3</span><br><span class="line">5128-5128-5128</span><br><span class="line">5129-5129-5129</span><br><span class="line">5130-5130-5130</span><br><span class="line">5131-5131-5131</span><br><span class="line">5132-5132-5132</span><br><span class="line">5133-5133-5133</span><br><span class="line">5134-5134-5134</span><br><span class="line">5135-5135-5135</span><br><span class="line">5136-5136-5136</span><br><span class="line">513</span><br></pre></td></tr></table></figure>

<h3 id="check-ext4-fragment"><a href="#check-ext4-fragment" class="headerlink" title="check ext4 fragment"></a>check ext4 fragment</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ e4defrag -c /mnt</span><br><span class="line">&lt;Fragmented files&gt;                             now/best       size/ext</span><br><span class="line">1. /mnt/rw.24.9                                313/1            104 KB</span><br><span class="line">2. /mnt/rw.4.89                                265/1            123 KB</span><br><span class="line">3. /mnt/rw.29.99                               319/1            102 KB</span><br><span class="line">4. /mnt/rw.23.7                                291/1            112 KB</span><br><span class="line">5. /mnt/rw.31.71                               366/1             89 KB</span><br><span class="line"></span><br><span class="line"> Total/best extents				1184802/4096</span><br><span class="line"> Average size per extent			113 KB</span><br><span class="line"> Fragmentation score				28</span><br><span class="line"> [0-30 no problem: 31-55 a little bit fragmented: 56- needs defrag]</span><br><span class="line"> This directory (/mnt) does not need defragmentation.</span><br><span class="line"> Done.</span><br><span class="line"></span><br><span class="line">$ e4defrag /dev/sda &amp;</span><br></pre></td></tr></table></figure>

<h3 id="mount-the-backup-superblock"><a href="#mount-the-backup-superblock" class="headerlink" title="mount the backup superblock"></a>mount the backup superblock</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$  dumpe2fs /dev/sda2 | grep superblock</span><br><span class="line">$  fsck -b 32768 /dev/sda2</span><br><span class="line">or you could </span><br><span class="line">$  mount sb=32768 /dev/sda2 /mnt </span><br></pre></td></tr></table></figure>

<h3 id="extra-log"><a href="#extra-log" class="headerlink" title="extra log"></a>extra log</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ modprobe zram num_devices=1</span><br><span class="line">$ <span class="built_in">echo</span> 2589934592 &gt; /sys/block/zram0/disksize</span><br><span class="line">$ mke2fs -O journal_dev /dev/zram0</span><br><span class="line">$ mke2fs -t ext4 -J device=/dev/zram0 /dev/nvme0n1p1</span><br><span class="line"></span><br><span class="line">$ tune2fs -O ^has_journal /dev/zram0</span><br><span class="line">$ tune2fs -O ^has_journal /dev/nvme0n1p1</span><br><span class="line">$ tune2fs -J device=/dev/zram0 /dev/nvme0n1p1</span><br><span class="line">$ mount -o journal_path=/dev/zram0 /dev/nvme0n1p1 /mnt</span><br></pre></td></tr></table></figure>

<h3 id="recovery-by-ext4magic"><a href="#recovery-by-ext4magic" class="headerlink" title="recovery by ext4magic"></a><a target="_blank" rel="noopener" href="https://superuser.com/questions/1660630/proper-alternative-method-to-recover-lost-directory-ext4">recovery by ext4magic</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo debugfs -R <span class="string">&quot;dump &lt;8&gt; /opt/sda6.journal&quot;</span> /dev/sda6</span><br><span class="line">$ sudo apt-get install ext4magic</span><br><span class="line">$ umount /home</span><br><span class="line"><span class="comment">#list all files</span></span><br><span class="line">$ ext4magic /dev/sda6 -a $(<span class="built_in">date</span> -d <span class="string">&quot;-6hours&quot;</span> +%s) -f user/folder -j /opt/sda6.journal -l</span><br><span class="line"><span class="comment">#recovery</span></span><br><span class="line"><span class="comment"># -r will recover files that were marked as 100% in the previous output</span></span><br><span class="line"><span class="comment"># -d is the directory to store the recovered files</span></span><br><span class="line">$ ext4magic /dev/sda6 -a 1332606716 -f user/folder -j /tmp/sda6.journal -r -d /opt/RECOVER</span><br><span class="line"><span class="comment">#Exit from the shell and select the &quot;resume&quot; option in the menu. Delete unwanted files</span></span><br></pre></td></tr></table></figure>

<h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">ext4_has_free_clusters</span><br><span class="line">  ext4_validate_block_bitmap</span><br><span class="line">    ext4_get_group_number</span><br><span class="line">      ext4_get_group_no_and_offset</span><br><span class="line">        ext4_get_group_desc</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; do_fsync</span><br><span class="line">&gt;&gt;&gt;&gt;    vfs_fsync_range</span><br><span class="line">&gt;&gt;&gt;&gt;     ext4_sync_file</span><br><span class="line">&gt;&gt;&gt;&gt;      file_write_and_wait_range</span><br><span class="line">&gt;&gt;&gt;&gt;       __filemap_fdatawrite_range</span><br><span class="line">&gt;&gt;&gt;&gt;        do_writepages</span><br><span class="line">&gt;&gt;&gt;&gt;         ext4_writepages</span><br><span class="line">&gt;&gt;&gt;&gt;          mpage_map_and_submit_extent</span><br><span class="line">&gt;&gt;&gt;&gt;           mpage_map_one_extent</span><br><span class="line">&gt;&gt;&gt;&gt;            ext4_map_blocks</span><br><span class="line">&gt;&gt;&gt;&gt;             ext4_mb_new_blocks</span><br><span class="line">&gt;&gt;&gt;&gt;              ext4_mb_normalize_request</span><br><span class="line">&gt;&gt;&gt;&gt;               &gt;&gt;&gt; start + size &lt;= ac-&gt;ac_o_ex.fe_logical</span><br><span class="line">&gt;&gt;&gt;&gt;              ext4_mb_regular_allocator</span><br><span class="line">&gt;&gt;&gt;&gt;               ext4_mb_simple_scan_group</span><br><span class="line">&gt;&gt;&gt;&gt;                ext4_mb_use_best_found</span><br><span class="line">&gt;&gt;&gt;&gt;                 ext4_mb_new_preallocation</span><br><span class="line">&gt;&gt;&gt;&gt;                  ext4_mb_new_inode_pa</span><br><span class="line">&gt;&gt;&gt;&gt;                   ext4_mb_use_inode_pa</span><br><span class="line">&gt;&gt;&gt;&gt;                    &gt;&gt;&gt; <span class="built_in">set</span> ac-&gt;ac_b_ex.fe_len &lt;= 0</span><br><span class="line">&gt;&gt;&gt;&gt;              ext4_mb_mark_diskspace_used</span><br><span class="line">&gt;&gt;&gt;&gt;               &gt;&gt;&gt; BUG_ON(ac-&gt;ac_b_ex.fe_len &lt;= 0);</span><br><span class="line"></span><br><span class="line">$ grep -Rin <span class="string">&quot;define FIEMAP_EXTENT_UNWRITTEN&quot;</span> include/uapi/linux/fiemap.h</span><br><span class="line"></span><br><span class="line"><span class="comment">#define FIEMAP_EXTENT_UNWRITTEN         0x00000800 /* Space allocated, but</span></span><br><span class="line">                                                    * no data (i.e. zero). */</span><br><span class="line"></span><br><span class="line">https://lists.nongnu.org/archive/html/coreutils/2011-04/msg00056.html</span><br><span class="line">&gt;&gt; I<span class="string">&#x27;m not sure filefrag is at fault here.</span></span><br><span class="line"><span class="string">&gt;&gt; It just shifts and prints the returned lengths.</span></span><br><span class="line"><span class="string">&gt;&gt; Could you post the output of this (with the -r option)</span></span><br><span class="line"><span class="string">&gt;&gt; http://oss.oracle.com/~mason/fiemap-test.c</span></span><br><span class="line"><span class="string">&gt; </span></span><br><span class="line"><span class="string">&gt; Good idea.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ./filemap-test w1/rw-1.0.0</span></span><br><span class="line"><span class="string">ext: 5146 logical: [157224960..157255679] phys: 167804928..167835647 flags: 0x800 tot: 30720</span></span><br><span class="line"><span class="string">ext: 5147 logical: [157255680..157286399] phys: 167835648..167866367 flags: 0x801 tot: 30720</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>


<h3 id="file-hole"><a href="#file-hole" class="headerlink" title="file hole"></a>file hole</h3><ul>
<li>The FALLOC_FL_PUNCH_HOLE flag deallocates blocks. Since it has to be ORed with FALLOC_FL_KEEP_SIZE, what this means is you end up in a sparse file.</li>
<li>FALLOC_FL_ZERO_RANGE on the other hand, allocates blocks for the (offset, length) if not already present and zeroes it out. So in effect you are losing some of its sparseness if the file had holes to begin with. Also, it is a method of zeroing out regions of a file without the application manually having to write(2) zeroes.</li>
</ul>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#mkfs-ext4-for-stripe"><span class="toc-number">1.</span> <span class="toc-text">mkfs ext4 for stripe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#For-huge-parttion-there-is-no-enough-memory-it-will-cause-slow"><span class="toc-number">2.</span> <span class="toc-text">For huge parttion, there is no enough memory, it will cause slow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount-from-partion-start"><span class="toc-number">3.</span> <span class="toc-text">mount from partion start</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Found-ext-magic-number"><span class="toc-number">4.</span> <span class="toc-text">Found ext magic number</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#because-there-is-no-any-parttion-in-this-block-dev"><span class="toc-number">5.</span> <span class="toc-text">because there is no any parttion in this block dev</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#You-can%E2%80%99t-fsck-by-default"><span class="toc-number">6.</span> <span class="toc-text">You can’t fsck by default</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Found-some-info-form-superblock"><span class="toc-number">7.</span> <span class="toc-text">Found some info form superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#You-have-to-disable-ext-journal-make-it-like-ext2-all-blocks-full-scan"><span class="toc-number">8.</span> <span class="toc-text">You have to disable ext journal, make it like ext2, all blocks full scan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Looks-like-the-block-dev-has-be-destroy-by-hardware-raid-controller-all-data-has-messed"><span class="toc-number">9.</span> <span class="toc-text">Looks like the block dev has be destroy by hardware raid controller, all data has messed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debugfs"><span class="toc-number">10.</span> <span class="toc-text">debugfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#check-ext4-fragment"><span class="toc-number">11.</span> <span class="toc-text">check ext4 fragment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount-the-backup-superblock"><span class="toc-number">12.</span> <span class="toc-text">mount the backup superblock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extra-log"><span class="toc-number">13.</span> <span class="toc-text">extra log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recovery-by-ext4magic"><span class="toc-number">14.</span> <span class="toc-text">recovery by ext4magic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack"><span class="toc-number">15.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-hole"><span class="toc-number">16.</span> <span class="toc-text">file hole</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2018/11/13/ext4/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2018/11/13/ext4/&text=ext4 info"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2018/11/13/ext4/&is_video=false&description=ext4 info"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ext4 info&body=Check out this article: http://example.com/2018/11/13/ext4/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2018/11/13/ext4/&title=ext4 info"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2018/11/13/ext4/&name=ext4 info&description=&lt;h3 id=&#34;mkfs-ext4-for-stripe&#34;&gt;&lt;a href=&#34;#mkfs-ext4-for-stripe&#34; class=&#34;headerlink&#34; title=&#34;mkfs ext4 for stripe&#34;&gt;&lt;/a&gt;mkfs ext4 for stripe&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ mkfs.ext4 -E stride=8,stripe-width=128,lazy_itable_init=0,lazy_journal_init=0 /dev/sdxx1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Oh, shit , data loss, here is lustre ldiskfs&lt;/p&gt;
&lt;p&gt;backup data&lt;br&gt;When backing up operating system partitions, the partition must be unmounted.&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;dd&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;=/dev/mapper/3600a098000b5ea3e000006065be52460 of=3600a098000b5ea3e000006065be52460 bs=1M conv=sparse&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;or you could &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dump -0uf /backup-files/sda3.dump /dev/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ dump -0u -f - /dev/sda1 | ssh root@test-server &lt;span class=&#34;built_in&#34;&gt;dd&lt;/span&gt; of=/tmp/sda1.dump&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# recovery &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ mount -t ext3 /dev/sda3 /mnt/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ &lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; /mnt/sda3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;restore -rf /backup-files/sda3.dump&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2018/11/13/ext4/&t=ext4 info"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = '67e8c052/67e8c052.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'blog-comments';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
